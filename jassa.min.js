(function e(t,r,n){function i(s,o){if(!r[s]){if(!t[s]){var c=typeof require=="function"&&require;if(!o&&c)return c(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(e,module,t){var Jassa=e("./index.js");if(typeof define=="function"&&define.amd){define("Jassa",function(){return Jassa})}else{window.Jassa=Jassa}},{"./index.js":91}],2:[function(e,module,t){var r=function(){function e(e,t){var r;for(var n=1,i=arguments.length;n<i;n++){t=arguments[n];for(r in t){if(hasOwnProperty.call(t,r)){e[r]=t[r]}}}return e}function t(e){if(!e){return[]}if("toArray"in Object(e)){return e.toArray()}var t=e.length||0,r=new Array(t);while(t--){r[t]=e[t]}return r}var n=function(){};var i="[object Function]";var a=Object.prototype.toString;function s(e){return a.call(e)===i}function o(e){var t=e.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return t.length===1&&!t[0]?[]:t}function c(e,t){var r=e.length,n=t.length;while(n--){e[r+n]=t[n]}return e}function u(e,t){return function(){var r=c([e.bind(this)],arguments);return t.apply(this,r)}}var l=function(){for(var e in{toString:1}){if(e==="toString"){return false}}return true}();function f(){}function v(){var i=null,a=t(arguments);if(s(a[0])){i=a.shift()}function o(){this.initialize.apply(this,arguments)}e(o,r.Methods);o.superclass=i;o.subclasses=[];if(i){f.prototype=i.prototype;o.prototype=new f;i.subclasses.push(o)}for(var c=0,u=a.length;c<u;c++){o.addMethods(a[c])}if(!o.prototype.initialize){o.prototype.initialize=n}o.prototype.constructor=o;return o}function p(e){var t=this.superclass&&this.superclass.prototype,r=Object.keys(e);if(l){if(e.toString!==Object.prototype.toString){r.push("toString")}if(e.valueOf!==Object.prototype.valueOf){r.push("valueOf")}}for(var n=0,i=r.length;n<i;n++){var a=r[n],c=e[a];if(t&&s(c)&&o(c)[0]==="$super"){var f=c;c=u(function(e){return function(){return t[e].apply(this,arguments)}}(a),f);c.valueOf=function(e){return function(){return e.valueOf.call(e)}}(f);c.toString=function(e){return function(){return e.toString.call(e)}}(f)}this.prototype[a]=c}return this}return{create:v,Methods:{addMethods:p}}}();module.exports=r},{}],3:[function(e,module,t){var r;var n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var i;var a;var s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var o;function c(e){n.lastIndex=0;return n.test(e)?'"'+e.replace(n,function(e){var t=s[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function u(e,t){var r,n,s,l,f=i,v,p=t[e];if(p&&typeof p==="object"&&typeof p.toJSON==="function"){p=p.toJSON(e)}if(typeof o==="function"){p=o.call(t,e,p)}switch(typeof p){case"string":return c(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p){return"null"}i+=a;v=[];if(Object.prototype.toString.apply(p)==="[object Array]"){l=p.length;for(r=0;r<l;r+=1){v[r]=u(r,p)||"null"}s=v.length===0?"[]":i?"[\n"+i+v.join(",\n"+i)+"\n"+f+"]":"["+v.join(",")+"]";i=f;return s}if(o&&typeof o==="object"){l=o.length;for(r=0;r<l;r+=1){if(typeof o[r]==="string"){n=o[r];s=u(n,p);if(s){v.push(c(n)+(i?": ":":")+s)}}}}else{var h=Object.keys(p).sort();for(r in h){n=h[r];if(Object.prototype.hasOwnProperty.call(p,n)){s=u(n,p);if(s){v.push(c(n)+(i?": ":":")+s)}}}}s=v.length===0?"{}":i?"{\n"+i+v.join(",\n"+i)+"\n"+f+"}":"{"+v.join(",")+"}";i=f;return s}}var l=function(e,t,r){var n;i="";a="";if(typeof r==="number"){for(n=0;n<r;n+=1){a+=" "}}else if(typeof r==="string"){a=r}o=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return u("",{"":e})};r={stringify:l};module.exports=r},{}],4:[function(e,module,t){"use strict";var r={Class:e("./Class"),JSONCanonical:e("./JSONCanonical")};module.exports=r},{"./Class":2,"./JSONCanonical":3}],5:[function(e,module,t){var r=e("lodash.foreach");var n=e("lodash.uniq");var i=e("../ext/Class");var a=e("../sparql/ExprUtils");var s=e("./ElementsAndExprs");var o=e("../util/ArrayUtils");var c=i.create({classLabel:"jassa.facete.ConstraintManager",initialize:function(e){this.constraints=e||[]},clear:function(){o.clear(this.constraints)},isEmpty:function(){var e=this.constraints.length===0;return e},shallowClone:function(){var e=new c(this.constraints.slice(0));return e},getConstraintsByPath:function(e){var t=[];var r=this.constraints;r.forEach(function(r){var n=r.getDeclaredPaths();var i=n.some(function(t){var r=t.equals(e);return r});if(i){t.push(r)}});return t},getConstrainedSteps:function(e){var t=[];var r=e.getSteps();var i=this.constraints;for(var a=0;a<i.length;++a){var s=i[a];var o=s.getDeclaredPaths();for(var c=0;c<o.length;++c){var u=o[c];var l=u.getSteps();var f=l.length-r.length;var v=u.startsWith(e);if(f==1&&v){var p=l[l.length-1];t.push(p)}}}var h=n(t,function(e){return""+e});return h},getConstraints:function(){return this.constraints},addConstraint:function(e){this.constraints.push(e)},addConstraints:function(e){var t=this;e.forEach(function(e){t.addConstraint(e)})},removeConstraint:function(e){var t=false;var r=this.constraints;var n=[];for(var i=0;i<r.length;++i){var a=r[i];if(!a.equals(e)){n.push(a)}else{t=true}}this.constraints=n;return t},toggleConstraint:function(e){var t=this.removeConstraint(e);if(!t){this.addConstraint(e)}},createElementsAndExprs:function(e,t){var n=[];var i=[];var o={};var c=this;this.constraints.forEach(function(r){var i=r.getDeclaredPaths();var s=i.join(" ");if(t){var c=i.some(function(e){var r=t.equals(e);return r});if(c){return}}i.forEach(function(t){var r=e.forPath(t);var i=r.getElements();n.push.apply(n,i)});var u=r.createElementsAndExprs(e);var l=u.getElements();var f=u.getExprs();if(l){n.push.apply(n,l)}if(f&&f.length>0){var v=o[s];if(!v){v=[];o[s]=v}var p=a.andify(f);v.push(p)}});r(o,function(e){var t=a.orify(e);i.push(t)});var u=new s(n,i);return u}});module.exports=c},{"../ext/Class":2,"../sparql/ExprUtils":237,"../util/ArrayUtils":368,"./ElementsAndExprs":9,"lodash.foreach":482,"lodash.uniq":496}],6:[function(e,module,t){var r=e("../sparql/ElementUtils");var n=e("../sparql/expr/ExprVar");var i=e("../sparql/expr/E_Lang");var a=e("../sparql/expr/E_LangMatches");var s=e("../sparql/expr/E_Regex");var o=e("../sparql/expr/E_Equals");var c=e("../sparql/NodeValueUtils");var u=e("../sparql/element/ElementTriplesBlock");var l=e("./ElementsAndExprs");var f=e("../sparql/Concept");var v=e("../sparql/ConceptUtils");var p={createConstraintExists:function(e,t){var n=e.forPath(t);var i=r.createElementsTriplesBlock(n.getTriples());var a=new l(i,[]);return a},createConstraintLang:function(e,t,s){var o=e.forPath(t);var c=o.getVar();var u=new n(c);var f=r.createElementsTriplesBlock(o.getTriples());var v=s;var p=[new a(new i(u),v)];var h=new l(f,p);return h},createConstraintRegex:function(e,t,i){var a=e.forPath(t);var o=a.getVar();var c=new n(o);var u=r.createElementsTriplesBlock(a.getTriples());var f=i;var v=[new s(c,f,"i")];var p=new l(u,v);return p},createConstraintEquals:function(e,t,i){var a=e.forPath(t);var s=a.getVar();var u=new n(s);var f=r.createElementsTriplesBlock(a.getTriples());var v=c.makeNode(i);var p=[new o(u,v)];var h=new l(f,p);return h},createConstraintConcept:function(e,t,r){var n=e.forPath(t);var i=n.getVar();var a=new u(n.getTriples());var s=new f(a,i);var o=v.createCombinedConcept(s,r,true,false);var c=[];var p=new l([o.getElement()],c);return p}};module.exports=p},{"../sparql/Concept":228,"../sparql/ConceptUtils":229,"../sparql/ElementUtils":233,"../sparql/NodeValueUtils":243,"../sparql/element/ElementTriplesBlock":267,"../sparql/expr/E_Equals":279,"../sparql/expr/E_Lang":283,"../sparql/expr/E_LangMatches":284,"../sparql/expr/E_Regex":292,"../sparql/expr/ExprVar":303,"./ElementsAndExprs":9}],7:[function(e,module,t){var r=e("../ext/Class");var n=e("../util/collection/HashMap");var i=e("../rdf/NodeUtils");var a=e("../rdf/NodeFactory");var s=e("../sparql/element/ElementSubQuery");var o=e("../sparql/element/ElementUnion");var c=e("../sparql/element/ElementFilter");var u=e("../sparql/element/ElementGroup");var l=e("../sparql/Query");var f=e("../sparql/Concept");var v=e("../sparql/ConceptUtils");var p=e("../sparql/NodeValueUtils");var h=e("../sparql/expr/ExprVar");var d=e("../sparql/expr/E_OneOf");var g=e("../sparql/expr/E_Equals");var m=e("../service/list_service/ListServiceSparqlQuery");var y=e("../service/lookup_service/LookupService");var x=e("./FacetUtils");var S=e("../sparql/Relation");var _=e("../sparql/RelationUtils");var w=e("../sparql/VarUtils");var b=e("../sponate/agg/AggMap");var C=e("../sponate/agg/AggTransform");var E=e("../sponate/agg/AggLiteral");var L=e("../sponate/binding_mapper/BindingMapperExpr");var j=e("../sponate/LookupServiceUtils");var U=e("../sponate/ServiceUtils");var T=e("../util/shared");var F=T.Promise;var q=e("../sparql/QueryUtils");var k={createAggMapCount:function(e,t){var r=new b(new L(new h(e)),new C(new E(new L(new h(t))),i.getValue));return r},execQueries:function(e,t,r,i){var a=q.createQueryUnionSubQueries(t,[r,i]);var s;if(a){var o=this.createAggMapCount(r,i);s=U.execAgg(e,a,o)}else{s=F.resolve(new n)}return s},createQueriesPreCountCore:function(e,t,r,n){var i=e.getDefaultRelation();var a=e.getPropertyToRelation();var s=r.map(function(e){var r=a.get(e);if(!r){r=i}var s=n(r,e,t);return s});return s},createQueriesPreCount:function(e,t,r,n){var i=this.createQueriesPreCountCore(e,t,r,function(e,t,r){var i=_.createQueryRawSize(e,t,r,n);return i});return i},createQueriesExactCount:function(e,t,r){var n=this.createQueriesExactCountSingle(e,t,r);return n},createQueriesExactCountSingle:function(e,t,r){var n=this.createQueriesPreCountCore(e,t,r,function(e,t,r){var n=e.getSourceVar();var i=new c(new g(new h(n),p.makeNode(t)));var a=new S(new u([e.getElement(),i]),n,e.getTargetVar());var s=_.createQueryDistinctValueCount(a,r);return s});return n},createQueriesExactCountMulti:function(e,t,r){var n=e.getSourceVar();var i=e.getDefaultRelation();var a=e.getPropertyToRelation();var s=[];var o=[];r.forEach(function(e){var r=a.get(e);if(!r){s.push(e)}else{var n=_.createQueryDistinctValueCount(r,t);o.push(n)}});var l=i;var f=new c(new d(new h(n),s));var v=new S(new u([l.getElement(),f]),l.getSourceVar(),l.getTargetVar());var p=_.createQueryDistinctValueCount(v,t);o.push(p);return o}};module.exports=k},{"../ext/Class":2,"../rdf/NodeFactory":99,"../rdf/NodeUtils":100,"../service/list_service/ListServiceSparqlQuery":165,"../service/lookup_service/LookupService":170,"../sparql/Concept":228,"../sparql/ConceptUtils":229,"../sparql/NodeValueUtils":243,"../sparql/Query":247,"../sparql/QueryUtils":249,"../sparql/Relation":250,"../sparql/RelationUtils":251,"../sparql/VarUtils":256,"../sparql/element/ElementFilter":261,"../sparql/element/ElementGroup":262,"../sparql/element/ElementSubQuery":266,"../sparql/element/ElementUnion":268,"../sparql/expr/E_Equals":279,"../sparql/expr/E_OneOf":291,"../sparql/expr/ExprVar":303,"../sponate/LookupServiceUtils":326,"../sponate/ServiceUtils":334,"../sponate/agg/AggLiteral":352,"../sponate/agg/AggMap":353,"../sponate/agg/AggTransform":357,"../sponate/binding_mapper/BindingMapperExpr":360,"../util/collection/HashMap":389,"../util/shared":403,"./FacetUtils":20}],8:[function(e,module,t){var r=e("./FacetUtils");var n=e("../sparql/element/ElementGroup");var i=e("../sparql/element/ElementOptional");var a=e("./Path");var s={createElementTable:function(e,t){var s=r.createConceptResources(e,new a,false);var o=e.getRootFacetNode();var c=t.map(function(e){var t=o.forPath(e);var r=t.getElements(true);var a=new n(r);var s;if(r.length!==0){s=new i(a)}else{s=a}return s});var u=[];u.push.apply(u,s.getElements());u.push.apply(u,c);var l=new n(u);var f=l.flatten();return f}};module.exports=s},{"../sparql/element/ElementGroup":262,"../sparql/element/ElementOptional":264,"./FacetUtils":20,"./Path":22}],9:[function(e,module,t){var r=e("../ext/Class");var n=e("../sparql/ElementUtils");var i=r.create({initialize:function(e,t){this.elements=e;this.exprs=t},getElements:function(){return this.elements},getExprs:function(){return this.exprs},toElements:function(){var e=[];var t=n.createFilterElements(this.exprs);e.push.apply(e,this.elements);e.push.apply(e,t);return e}});module.exports=i},{"../ext/Class":2,"../sparql/ElementUtils":233}],10:[function(e,module,t){var r=e("../ext/Class");var n=e("../sparql/ConceptUtils");var i=e("./FacetNode");var a=e("./ConstraintManager");var s=r.create({classLabel:"jassa.facete.FacetConfig",initialize:function(e,t,r){this.baseConcept=e||n.createSubjectConcept();this.rootFacetNode=t||i.createRoot(this.baseConcept.getVar());this.constraintManager=r||new a},getBaseConcept:function(){return this.baseConcept},setBaseConcept:function(e){this.baseConcept=e},getRootFacetNode:function(){return this.rootFacetNode},setRootFacetNode:function(e){this.rootFacetNode=e},getConstraintManager:function(){return this.constraintManager},setConstraintManager:function(e){this.constraintManager=e}});module.exports=s},{"../ext/Class":2,"../sparql/ConceptUtils":229,"./ConstraintManager":5,"./FacetNode":11}],11:[function(e,module,t){var r=e("../ext/Class");var n=e("../rdf/NodeFactory");var i=e("../sparql/element/ElementTriplesBlock");var a=e("../sparql/GenSym");var s=e("../sparql/VarUtils");var o=e("./Path");var c=e("./Step");var u=e("./VarNode");var l=e("../util/collection/HashMap");var f=r.create({initialize:function(e,t,r,n){this.parent=r;this.root=n;if(!this.root){if(this.parent){this.root=r.root}else{this.root=this}}this.varNode=e;this.step=t;this._isActive=true;this.idToChild=new l},hashCode:function(){var e=this.idToChild.hashCode()*3;return e},equals:function(e){throw new Error("Should not be called")},getRootNode:function(){return this.root},isRoot:function(){var e=this.parent?false:true;return e},getVar:function(){var e=this.varNode.getVariableName();var t=n.createVar(e);return t},getVariable:function(){if(!this.warningShown){this.warningShown=true}return this.getVar()},getStep:function(){return this.step},getParent:function(){return this.parent},getPath:function(){var e=[];var t=this;while(t!=this.root){e.push(t.getStep());t=t.getParent()}e.reverse();var r=new o(e);return r},forPath:function(e){var t=e.getSteps();var r=this;t.forEach(function(e){r=r.forStep(e)});return r},getSteps:function(){return this.steps},isActiveDirect:function(){return this._isActive},getElements:function(){var e=[];var t=this.getTriples();if(t.length>0){var r=new i(t);e.push(r)}return e},getTriples:function(){var e=[];this.getTriples2(e);return e},getTriples2:function(e){this.createDirectTriples2(e);if(this.parent){this.parent.getTriples2(e)}return e},createDirectTriples:function(){var e=[];this.createDirectTriples2(e);return e},createDirectTriples2:function(e){if(this.step){var t=this.parent.getVariable();var r=this.getVariable();var n=this.step.createElement(t,r,this.generator);var i=n.getTriples();e.push.apply(e,i)}return e},isActive:function(){if(!this._isActive){return false}if(this.parent){return this.parent.isActive()}return true},attachToParent:function(){if(!this.parent){return}this.parent[this.id]=this;this.parent.attachToParent()},forProperty:function(e,t){var r=new c(e,t);var n=this.forStep(r);return n},forStep:function(e){var t=this.idToChild.get(e);if(!t){var r=this.varNode.forStep(e);t=new f(r,e,this,this.root);this.idToChild.put(e,t)}return t},copyExclude:function(){var e=new f;console.log("Now root:",e);this.root.copyExcludeRec(e,this);return e},copyExcludeRec:function(e,t){console.log("Copy:",this,e);if(this===t){return}this.copyTo(e);this.steps.forEach(function(r){var n=r.step;var i=r.child;console.log("child:",n,i);if(i===t){return}var a=e.forStep(n);console.log("New child:",a);i.copyExcludeRec(a,t)})}});f.createRoot=function(e,t){var r=e?e.getName():s.s.getName();t=t?t:new a("fv");var n=new u(r,t);var i=new f(n);return i};module.exports=f},{"../ext/Class":2,"../rdf/NodeFactory":99,"../sparql/GenSym":238,"../sparql/VarUtils":256,"../sparql/element/ElementTriplesBlock":267,"../util/collection/HashMap":389,"./Path":22,"./Step":27,"./VarNode":30}],12:[function(e,module,t){var r=e("../ext/Class");var n=e("../service/ListFilter");var i=r.create({initialize:function(e,t,r){this._isExpanded=!!e;this._isInverse=!!t;this.listFilter=r||new n},getListFilter:function(){return this.listFilter},setListFilter:function(e){this.listFilter=e},isExpanded:function(){return this._isExpanded},setExpanded:function(e){this._isExpanded=e},isInverse:function(){return this._isInverse},setInverse:function(e){this._isInverse=e}});module.exports=i},{"../ext/Class":2,"../service/ListFilter":131}],13:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t,r){this.sourceVar=e;this.defaultRelation=t;this.propertyToRelation=r},getSourceVar:function(){return this.sourceVar},getDefaultRelation:function(){return this.defaultRelation},getPropertyToRelation:function(){return this.propertyToRelation}});module.exports=n},{"../ext/Class":2}],14:[function(e,module,t){var r=e("../ext/Class");var n=e("./FacetServiceUtils");var i=e("./facet_service/FacetServiceFn");var a=e("./facet_service/FacetServiceClientIndex");var s=e("../sparql/LiteralPreference");var o=e("../sponate/LookupServiceUtils");var c=e("./facet_service/FacetServiceTransformConcept");var u=e("../service/list_service/ListServiceTransformItem");var l=e("../service/list_service/ListServiceTransformItems");var f=e("../sponate/MappedConceptUtils");var v=e("../sparql/LabelUtils");var p=e("../sparql/search/KeywordSearchUtils");var h=e("../util/collection/HashMap");var d=r.create({initialize:function(e,t){this.facetService=e;this.defaultSparqlService=t},create:function(){return this.facetService},labelConfig:function(e){e=e||new s;this.labelConfigLabels(e);this.labelConfigFilter(e);return this},tagFn:function(e){this.facetService=new i(this.facetService,function(t){var r=new u(t,e);return r});return this},pathToTags:function(e,t){e=e||new h;t=t||"tags";this.facetService=new i(this.facetService,function(r){var n=new l(r,function(r){r.forEach(function(r){var n=r.val;var i=n.path;var a=e.get(i);if(!a){a={};e.put(i,a)}n[t]=a});return r});return n});return this},labelConfigFilter:function(e){var t=function(t){var r;if(t){var n=v.createRelationLiteralPreference(e);r=p.createConceptRegex(n,t,true)}else{r=null}return r};this.facetService=new c(this.facetService,t);return this},labelConfigLabels:function(e,t){t=t||"labelInfo";var r=this;this.facetService=new i(this.facetService,function(n){var i=new l(n,function(n){var i=f.createMappedConceptLiteralPreference(e);var a=o.createLookupServiceMappedConcept(r.defaultSparqlService,i);var s=n.map(function(e){return e.val.property});var c=a.lookup(s).then(function(e){n.forEach(function(r){r.val[t]=e.get(r.val.property)});return n});return c});return i});return this},index:function(){var e=function(e){var t;if(e!=null){var r=new RegExp(e,"mi");t=function(e){var t=e.val.labelInfo||{id:e.key.getUri(),displayLabel:e.key.getUri(),hiddenLabels:[]};var n=r.test(t.id);var i=n||r.test(t.displayLabel);var a=i||t.hiddenLabels&&t.hiddenLabels.some(function(e){return r.test(e)});return a}}else{t=function(e){return true}}return t};this.facetService=new a(this.facetService,e,100);return this}});d.core=function(e,t){var r=n.createFacetService(e,t);var i=new d(r,e);return i};module.exports=d},{"../ext/Class":2,"../service/list_service/ListServiceTransformItem":168,"../service/list_service/ListServiceTransformItems":169,"../sparql/LabelUtils":241,"../sparql/LiteralPreference":242,"../sparql/search/KeywordSearchUtils":314,"../sponate/LookupServiceUtils":326,"../sponate/MappedConceptUtils":329,"../util/collection/HashMap":389,"./FacetServiceUtils":15,"./facet_service/FacetServiceClientIndex":45,"./facet_service/FacetServiceFn":46,"./facet_service/FacetServiceTransformConcept":51}],15:[function(e,module,t){var r=e("../sparql/ConceptUtils");var n=e("./FacetNode");var i=e("./facet_concept_supplier/FacetConceptSupplierExact");var a=e("./facet_concept_supplier/FacetConceptSupplierDeclared");var s=e("./facet_service/FacetServiceSparql");var o=e("./facet_service/FacetServiceTransformConcept");var c=e("./facet_service/FacetServiceClientIndex");var u=e("./facet_service/FacetServiceLookup");var l=e("../sparql/LabelUtils");var f=e("../sparql/search/KeywordSearchUtils");var v=e("./FacetConfig");var p=e("./ConstraintManager");var h=e("../sparql/BestLabelConfig");var d=e("../sponate/MappedConceptUtils");var g=e("../sponate/LookupServiceUtils");var m=e("../service/lookup_service/LookupServiceMulti");var y=e("../service/lookup_service/LookupServiceKeyMap");var x=e("../service/lookup_service/LookupServiceTransformKey");var S=e("../service/lookup_service/LookupServiceFn");var _=e("../service/lookup_service/LookupServiceConst");var w=e("./FacetUtils");var b=e("./lookup_service/LookupServiceFacetCount");var C=e("./lookup_service/LookupServiceFacetPreCount");var E=e("./lookup_service/LookupServiceFacetExactCount");var L=e("./Step");var j=e("./Path");var U={createFacetConceptSupplier:function(e){var t=new a(e);return t},createFacetService:function(e,t){var r=U.createFacetConceptSupplier(t);var n=new s(e,r);var i=function(r){var n;if(r==null){n=new m({id:new y,countInfo:new _({count:0,hasMoreItems:true})})}else{var i=w.createFacetRelationIndex(t,r);var a=new C(e,i);var s=new E(e,i);var o=new b(a,s);n=new m({id:new y,valueCountInfo:o})}return n};n=new u(n,i);return n}};module.exports=U},{"../service/lookup_service/LookupServiceConst":174,"../service/lookup_service/LookupServiceFn":177,"../service/lookup_service/LookupServiceKeyMap":180,"../service/lookup_service/LookupServiceMulti":183,"../service/lookup_service/LookupServiceTransformKey":187,"../sparql/BestLabelConfig":224,"../sparql/ConceptUtils":229,"../sparql/LabelUtils":241,"../sparql/search/KeywordSearchUtils":314,"../sponate/LookupServiceUtils":326,"../sponate/MappedConceptUtils":329,"./ConstraintManager":5,"./FacetConfig":10,"./FacetNode":11,"./FacetUtils":20,"./Path":22,"./Step":27,"./facet_concept_supplier/FacetConceptSupplierDeclared":41,"./facet_concept_supplier/FacetConceptSupplierExact":42,"./facet_service/FacetServiceClientIndex":45,"./facet_service/FacetServiceLookup":47,"./facet_service/FacetServiceSparql":49,"./facet_service/FacetServiceTransformConcept":51,"./lookup_service/LookupServiceFacetCount":60,"./lookup_service/LookupServiceFacetExactCount":61,"./lookup_service/LookupServiceFacetPreCount":62}],16:[function(e,module,t){var r=e("../ext/Class");var n=e("../sparql/LiteralPreference");var i=e("./FacetConfig");var a=e("../util/collection/HashMap");var s=e("./FacetTreeState");var o=e("../service/ListFilter");var c=r.create({initialize:function(e,t,r,o,c,u){this.facetConfig=e||new i;this.literalPreference=t||new n;this.facetTreeState=r||new s;this.pathToTags=o||new a;this.tagFn=u},getFacetConfig:function(){return this.facetConfig},getFacetTreeState:function(){return this.facetTreeState},getLiteralPreference:function(){return this.literalPreference},getPathToTags:function(){return this.pathToTags},getTagFn:function(){return this.tagFn}});module.exports=c},{"../ext/Class":2,"../service/ListFilter":131,"../sparql/LiteralPreference":242,"../util/collection/HashMap":389,"./FacetConfig":10,"./FacetTreeState":19}],17:[function(e,module,t){var r=e("./Step");var n=e("./Path");var i=e("./PathHead");var a=e("../util/shared");var s=a.Promise;var o=e("./FacetNodeState");var c=e("../service/ListFilter");var u=e("../util/ObjectUtils");var l=e("../util/PromiseUtils");var f={fetchFacetTree:function(e,t,r){var n=f.fetchFacetTreePathRec(e,t,r).then(function(e){var t=r==null?e.outgoing.children[0]:e;return t});return n},fetchFacetTreePathRec:function(e,t,r){r=r||null;var n=t.getPathExpansions();var a=t.getPathToDirection();var s=r?n.contains(r):true;var o=a.get(r)||1;var c=[];if(s){var u;var f;if(o==null||o===1||o===2){u=r?new i(r,false):null;f=this.fetchFacetTreePathHeadRec(e,t,u);c.push(f)}else{c.push(null)}if(o===-1||o===2){u=r?new i(r,true):null;f=this.fetchFacetTreePathHeadRec(e,t,u);c.push(f)}else{c.push(null)}}return l.all(c).spread(function(e,t){var n={path:r,isExpanded:s,outgoing:e,incoming:t};return n})},fetchFacetTreePathHeadRec:function(e,t,r){var n=t.getPathHeadToFilter();var i=n.get(r)||new c(null,10);var a=s.resolve(e.prepareListService(r)).then(function(e){var t=e.fetchItems(i.getConcept(),i.getLimit(),i.getOffset());var r=e.fetchCount(i.getConcept());return[t,r]}).spread(function(n,a){var s=n.map(function(e){return e.val});var o=s.map(function(r){var n=r.path;if(!n){throw new Error("Could not obtain a path for the sub facets of "+JSON.stringify(r))}var i=f.fetchFacetTreePathRec(e,t,n);return i});var c=l.all(o).then(function(e){s.forEach(function(t,r){var n=e[r];u.extend(t,n)});var t={path:r?r.getPath():null,pathHead:r,childCountInfo:a,listFilter:i,children:s};return t});return c});return a}};module.exports=f},{"../service/ListFilter":131,"../util/ObjectUtils":376,"../util/PromiseUtils":378,"../util/shared":403,"./FacetNodeState":12,"./Path":22,"./PathHead":23,"./Step":27}],18:[function(e,module,t){var r=e("./facet_tree_service/FacetTreeService");var n=e("../util/collection/HashMap");var i=e("./FacetServiceBuilder");var a=e("./FacetNodeState");var s={createFacetTreeService:function(e,t){var n=t.getFacetConfig();var a=t.getPathToTags();var s=function(e){var r=t.getTagFn();if(r){e=r(e)}return e};var o=i.core(e,n).labelConfig().index().pathToTags(a).tagFn(s).create();var c=new r(o,t.getFacetTreeState());return c}};module.exports=s},{"../util/collection/HashMap":389,"./FacetNodeState":12,"./FacetServiceBuilder":14,"./facet_tree_service/FacetTreeService":53}],19:[function(e,module,t){var r=e("../ext/Class");var n=e("../service/ListFilter");var i=e("../util/collection/HashMap");var a=e("../util/collection/HashSet");var s=r.create({initialize:function(e,t,r){this.pathExpansions=e||new a;this.pathToDirection=t||new i;this.pathHeadToFilter=r||new i},getPathExpansions:function(){return this.pathExpansions},getPathToDirection:function(){return this.pathToDirection},getPathHeadToFilter:function(){return this.pathHeadToFilter}});module.exports=s},{"../ext/Class":2,"../service/ListFilter":131,"../util/collection/HashMap":389,"../util/collection/HashSet":390}],20:[function(e,module,t){var r=e("../sparql/Concept");var n=e("../sparql/Relation");var i=e("../util/collection/HashMap");var a=e("../rdf/NodeFactory");var s=e("../rdf/Triple");var o=e("../rdf/NodeUtils");var c=e("../sparql/expr/ExprVar");var u=e("../sparql/expr/E_Equals");var l=e("../sparql/expr/NodeValue");var f=e("../sparql/NodeValueUtils");var v=e("../sparql/expr/E_LogicalNot");var p=e("../sparql/expr/E_OneOf");var h=e("../sparql/element/ElementGroup");var d=e("../sparql/element/ElementFilter");var g=e("../sparql/element/ElementTriplesBlock");var m=e("../sparql/PatternUtils");var y=e("../sparql/ElementUtils");var x=e("../sparql/VarUtils");var S=e("./Step");var _=e("./StepUtils");var w=e("./StepRelation");var b=e("./FacetRelationIndex");var C=e("./PathHead");var E={createConceptResources:function(e,t,n){var i=e.getBaseConcept();var a=e.getRootFacetNode();var s=e.getConstraintManager();var o=n?t:null;var c=s.createElementsAndExprs(a,o);var u=c.getElements();var l=c.getExprs();var f=a.forPath(t);var v=f.getVar();var p=i.getElements();var g=f.getElements();var m=[];m.push.apply(m,g);m.push.apply(m,u);if(i.isSubjectConcept()){if(m.length===0){m=p}}else{m.push.apply(m,p)}var y=l.map(function(e){var t=new d(e);return t});m.push.apply(m,y);var x=new h(m).flatten();var S=new r(x,v);return S},createConceptFacets:function(e,t){var n=this.createRelationFacets(e,t);var i=new r(n.getElement(),n.getSourceVar());return i},createRelationFacets:function(e,t,r){var i=t.getPath();var a=t.isInverse();var o=e.getBaseConcept();var l=e.getRootFacetNode();var v=e.getConstraintManager();var p=null;if(r){p=new S(r.getUri(),a)}var y=null;if(p){y=i.copyAppendStep(p)}var _=v.createElementsAndExprs(l,y);var w=_.toElements();var b=l.forPath(i);var C=b.getVar();var E=o.getElements();var L;if(o.isSubjectConcept()){L=w}else{L=E.concat(w)}var j=m.getVarsMentioned(L);var U=x.freshVar("p",j);var T=x.freshVar("o",j);var F=!a?new s(C,U,T):new s(T,U,C);L.push(new g([F]));if(p){var q=new c(U);var k=new u(q,f.makeNode(r));L.push(new d(k))}var A=b.getElements();L.push.apply(L,A);var N=new h(L).flatten();var V=new n(N,U,T);return V},createStepRelationsProperties:function(e,t,r,i){var a=[];var s=t.getPath();var c=t.isInverse();var u=e.getBaseConcept();var l=e.getRootFacetNode();var f=e.getConstraintManager();var v=r.map(o.getUri);var p=l.forPath(s);var d=f.getConstrainedSteps(s);var g=d.filter(function(e){var t=e.isInverse()===c;if(!t){return false}var r=v.indexOf(e.getPropertyName())>=0;var n=i?!r:r;return n});var m=g.map(_.getPropertyName);var y=[];var x=[];r.forEach(function(e){if(m.indexOf(e.getUri())>=0){x.push(e)}else{y.push(e)}});var S=this.createStepRelations(e,s,g);a.push.apply(a,S);var b=this.createRelationFacets(e,t);var C=this.createElementFilterBindVar(b.getSourceVar(),y,false);if(C!=null){b=new n(new h([b.getElement(),C]),b.getSourceVar(),b.getTargetVar())}if(y.length>0||i){var E=new w(null,b);a.push(E)}return a},createFacetRelationIndex:function(e,t){var r=E.createStepRelationsProperties(e,t,[],true);var n=r.length>0?r[0].getRelation().getSourceVar():null;var s=new i;var o=null;r.forEach(function(e){var t=e.getStep();var r=e.getRelation();var n=t?a.createUri(t.getPropertyName()):null;if(n){s.put(n,r)}else{o=r}});var c=new b(n,o,s);return c},createElementFilterBindVar:function(e,t,r){var n=null;if(t.length>0){var i=new p(new c(e),t);if(r){i=new v(i)}n=new d(i)}return n},createStepRelations:function(e,t,r){var n=this;var i=r.map(function(r){var i=n.createStepRelation(e,t,r);return i});return i},createStepRelation:function(e,t,r){var n=r.getPropertyName();var i=a.createUri(n);var s=new C(t,r.isInverse());var o=this.createRelationFacets(e,s,i);var c=new w(r,o);return c}};module.exports=E},{"../rdf/NodeFactory":99,"../rdf/NodeUtils":100,"../rdf/Triple":102,"../sparql/Concept":228,"../sparql/ElementUtils":233,"../sparql/NodeValueUtils":243,"../sparql/PatternUtils":244,"../sparql/Relation":250,"../sparql/VarUtils":256,"../sparql/element/ElementFilter":261,"../sparql/element/ElementGroup":262,"../sparql/element/ElementTriplesBlock":267,"../sparql/expr/E_Equals":279,"../sparql/expr/E_LogicalNot":288,"../sparql/expr/E_OneOf":291,"../sparql/expr/ExprVar":303,"../sparql/expr/NodeValue":304,"../util/collection/HashMap":389,"./FacetRelationIndex":13,"./PathHead":23,"./Step":27,"./StepRelation":28,"./StepUtils":29}],21:[function(e,module,t){var r=e("../ext/Class");var n=e("../service/list_service/ListServiceTransformConcept");var i=e("../service/list_service/ListServiceConceptKeyLookup");var a=e("../service/list_service/ListServiceTransformItems");var s=e("../sponate/LookupServiceUtils");var o=e("./facet_value_service/FacetValueService");var c=e("./facet_value_service/FacetValueServiceWrapListService");var u=e("../sparql/LiteralPreference");var l=e("../sparql/search/KeywordSearchUtils");var f=e("../sparql/LabelUtils");var v=r.create({initialize:function(e,t,r){this.facetValueService=e;this.sparqlService=t;this.facetConfig=r},labelConfig:function(e){e=e||new u;this._labelConfigLookup(e);this._labelConfigFilter(e);return this},wrapListService:function(e){this.facetValueService=new c(this.facetValueService,e);return this},constraintTagging:function(){var e=this.facetConfig.getConstraintManager()
;var t=function(t,r){var n=new a(t,function(t){var n=e.getConstraintsByPath(r);var i={};n.forEach(function(e){if(e.getName()==="equals"){i[e.getValue()]=true}});t.forEach(function(e){var t=e.val;var r=i[""+t.node];t.isConstrainedEqual=r});return t});return n};this.wrapListService(t);return this},_labelConfigFilter:function(e){var t=function(t){var r;if(t){var n=f.createRelationLiteralPreference(e);r=l.createConceptRegex(n,t,true)}else{r=null}return r};var r=function(e){var r=new n(e,t);return r};this.wrapListService(r);return this},_labelConfigLookup:function(e){var t=this;var r=function(r){var n=s.createLookupServiceNodeLabels(t.sparqlService,e);var a=new i(r,n,null,function(e,t){e.val.labelInfo=t;return e});return a};this.wrapListService(r);return this},create:function(){return this.facetValueService}});v.core=function(e,t,r){var n=new o(e,t,r);var i=new v(n,e,t);return i};module.exports=v},{"../ext/Class":2,"../service/list_service/ListServiceConceptKeyLookup":161,"../service/list_service/ListServiceTransformConcept":166,"../service/list_service/ListServiceTransformItems":169,"../sparql/LabelUtils":241,"../sparql/LiteralPreference":242,"../sparql/search/KeywordSearchUtils":314,"../sponate/LookupServiceUtils":326,"./facet_value_service/FacetValueService":56,"./facet_value_service/FacetValueServiceWrapListService":57}],22:[function(e,module,t){var r=e("../ext/Class");var n=e("./Step");var i=r.create({classLabel:"jassa.facete.Path",initialize:function(e){this.steps=e?e:[]},getParent:function(){var e=this.steps.length;var t=e===0?null:new i(this.steps.slice(0,e-1));return t},getLength:function(){return this.steps.length},isEmpty:function(){var e=this.steps.length===0;return e},toString:function(){var e=this.steps.join(" ");return e},concat:function(e){var t=new i(this.steps.concat(e.steps));return t},getLastStep:function(){var e=this.steps;var t=e.length;var r;if(t===0){r=null}else{r=e[t-1]}return r},getSteps:function(){return this.steps},slice:function(e,t){var r=this.steps.slice(e,t);var n=new i(r);return n},startsWith:function(e){var t=e.steps.length;if(t>this.steps.length){return false}for(var r=0;r<t;++r){var n=this.steps[r];var i=e.steps[r];if(!n.equals(i)){return false}}return true},hashCode:function(){if(this.hash==null){this.hash=this.steps.reduce(function(e,t){var r=e+t.hashCode();return r},1357)}return this.hash},equals:function(e){if(!e){return false}var t=this.steps.length;if(t!=e.steps.length){return false}var r=this.startsWith(e);return r},copyAppendStep:function(e){var t=this.steps.slice(0);t.push(e);var r=new i(t);return r},toJson:function(){var e=[];var t=this.steps;for(var r=0;r<t.length;++r){var n=t[r];var i=n.toJson();e.push(i)}return e},getPropertyNames:function(){var e=[];var t=this.steps;for(var r=0;r<t.length;++r){var n=t[r];var i=n.getPropertyName();e.push(i)}return e}});i.fromJson=function(e){var t=[];for(var r=0;r<e.length;++r){var a=e[r];var s=n.fromJson(a);t.push(s)}var o=new i(t);return o};i.parse=function(e){e=e.trim();var t=e.length!==0?e.split(" "):[];var r=t.map(function(e){return n.parse(e)});var a=new i(r);return a};module.exports=i},{"../ext/Class":2,"./Step":27}],23:[function(e,module,t){var r=e("../ext/Class");var n=e("./Path");var i=e("../util/ObjectUtils");var a=r.create({initialize:function(e,t){this.path=e;this._isInverse=!!t},getPath:function(){return this.path},equals:function(e){var t=this===e||this._isInverse===e._isInverse&&i.isEqual(this.path,e.path);return t},hashCode:function(){if(this.hash==null){this.hash=(this._isInverse?3:7)*this.path.hashCode()}return this.hash},isInverse:function(){return this._isInverse},toString:function(){return""+this.path+(this._isInverse?" (inverse)":"")},up:function(e){var t=this.path.slice(0,-1);e=e==null?this._isInverse:e;var r=new a(t,e);return r}});a.parse=function(e,t){var r=n.parse(e);var i=new a(r,!!t);return i};module.exports=a},{"../ext/Class":2,"../util/ObjectUtils":376,"./Path":22}],24:[function(e,module,t){var r=e("lodash");var n=e("../rdf/NodeFactory");var i=e("./FacetNode");var a=e("../sparql/VarUtils");var s=e("../sparql/ElementUtils");var o=e("../sparql/Relation");var c=e("../rdf/NodeUtils");var u=e("../util/StringUtils");var l={createRelation:function(e,t){t=t||a.s;var r=i.createRoot(t);var n=r.forPath(e);var c=n.getElements();var u=s.groupIfNeeded(c);var l=n.getVar();var f=new o(u,t,l);return f},getUris:function(e){var t=e?e.getSteps():[];var n=t.map(function(e){return e.getPropertyName()});var i=r.uniq(n);return i},getNodes:function(e){var t=l.getUris(e);var r=t.map(n.createUri);return r},getNodesFromPaths:function(e){var t=e.map(function(e){var t=l.getNodes(e);return t});var n=r.flatten(t);var i=c.uniq(n);return i},createLabelFn:function(e,t,r){var n=function(n,i){var a=l.createLabel(n,i,e,t,r);return a};return n},createLabel:function(e,t,i,a,s){i=i||"Items";a=a||"^-1:";s=s||" ";var o=r.isFunction(a)?a:u.parseAffixFn(a);var c=e.getSteps();var l=c.map(function(e){var r=n.createUri(e.getPropertyName());var i=t.get(r);var a=i.displayLabel||"(no label available)";if(e.isInverse()){a=o(a)}return a});var f=l.join(s);if(f===""){f=i}return f}};module.exports=l},{"../rdf/NodeFactory":99,"../rdf/NodeUtils":100,"../sparql/ElementUtils":233,"../sparql/Relation":250,"../sparql/VarUtils":256,"../util/StringUtils":383,"./FacetNode":11,lodash:499}],25:[function(e,module,t){var r=e("../rdf/NodeFactory");var n=e("../sparql/Query");var i=e("../sparql/expr/ExprVar");var a=e("../sparql/SortCondition");var s=[];var o=e("../sparql/expr/E_LogicalNot");var c=e("../sparql/expr/E_Bound");var u={createQueryFacet:function(e,t){if(!e){return null}var u=t.isDistinct();var l=new n;l.setQueryPattern(e);var f=t.getColumns();var v={};var p=[];var h=[];f.forEach(function(e){var t=e.getId();var n=r.createVar(t);var a=new i(n);var o=e.getAggregator();if(o){p.push(t);var c=o.getName();var u=s[c];if(!u){throw new Error("No aggExprFactory for "+c)}var f=u.createExpr(a);a=f;l.getProject().add(n,a)}else{h.push(t);l.getProject().add(n)}v[t]=a});if(p.length>0){h.forEach(function(e){var t=v[e];l.getGroupBy().push(t)});u=false}var d=t.getLimitAndOffset();l.setLimit(d.getLimit());l.setOffset(d.getOffset());var g=t.getSortConditions();g.forEach(function(e){var t=e.getColumnId();var r=v[t];if(!r){console.log("[ERROR] Should not happen");throw new Error("Should not happen")}var n=e.getSortDir();var i=e.getSortType();var s=null;switch(i){case"null":if(p.indexOf(t)<0){if(n>0){s=new a(new o(new c(r)),1)}else if(n<0){s=new a(new c(r),1)}}break;case"data":s=!n?null:new a(r,n);break;default:throw new Error("Should not happen")}if(s){l.getOrderBy().push(s)}});l.setDistinct(u);return l}}},{"../rdf/NodeFactory":99,"../sparql/Query":247,"../sparql/SortCondition":252,"../sparql/expr/E_Bound":277,"../sparql/expr/E_LogicalNot":288,"../sparql/expr/ExprVar":303}],26:[function(e,module,t){},{}],27:[function(e,module,t){var r=e("lodash.isequal");var n=e("../ext/Class");var i=e("../rdf/NodeFactory");var a=e("../rdf/Triple");var s=e("../sparql/element/ElementTriplesBlock");var o=e("../util/ObjectUtils");var c=n.create({classLabel:"jassa.facete.Step",initialize:function(e,t){this.type="property";this.propertyName=e;this._isInverse=t},toJson:function(){var e={isInverse:this.isInverse,propertyName:this.propertyName};return e},getPropertyName:function(){return this.propertyName},isInverse:function(){return this._isInverse},equals:function(e){var t=this._isInverse===e._isInverse&&this.propertyName===e.propertyName;return t},hashCode:function(){if(this.hash==null){this.hash=(this._isInverse?3:7)*o.hashCodeStr(this.propertyName)}return this.hash},toString:function(){if(this._isInverse){return"<"+this.propertyName}else{return this.propertyName}},createElement:function(e,t,r){var n=i.createUri(this.propertyName);var o;if(this._isInverse){o=new a(t,n,e)}else{o=new a(e,n,t)}var c=new s([o]);return c}});c.fromJson=function(e){var t=e.propertyName;var r=e.IsInverse();var n=new c(t,r);return n};c.parse=function(e){var t;if(e.charAt(0)==="<"){t=new c(e.substring(1),true)}else{t=new c(e,false)}return t};module.exports=c},{"../ext/Class":2,"../rdf/NodeFactory":99,"../rdf/Triple":102,"../sparql/element/ElementTriplesBlock":267,"../util/ObjectUtils":376,"lodash.isequal":487}],28:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.step=e;this.relation=t},getStep:function(){return this.step},getRelation:function(){return this.relation},toString:function(){return this.step+": "+this.relation}});module.exports=n},{"../ext/Class":2}],29:[function(e,module,t){var r={getPropertyName:function(e){var t=e.getPropertyName();return t}};module.exports=r},{}],30:[function(e,module,t){var r=e("lodash.foreach");var n=e("../ext/Class");var i=e("./VarNode");var a=e("./Step");var s=e("../util/collection/HashMap");var o=e("../util/ObjectUtils");var i=n.create({initialize:function(e,t,r,n,i){this.variableName=e;this.generator=t;this.step=r;this.parent=n;this.root=i;if(!this.root){if(this.parent){this.root=n.root}else{this.root=this}}this.idToChild=new s},hashCode:function(){var e=o.hashCodeStr(this.variableName)*(this.step?this.step.hashCode():7);return e},equals:function(e){throw new Error("Should not be called")},isRoot:function(){var e=this.parent?false:true;return e},getVariableName:function(){return this.variableName},getStop:function(e){return this.step},getSteps:function(){return this.steps},forProperty:function(e,t){var r=new a(e,t);var n=this.forStep(r);return n},forStep:function(e){var t=this.idToChild.get(e);if(!t){var r=this.generator.next();t=new i(r,this.generator,e,this);this.idToChild.put(e,t)}return t},findNodeByVarName:function(e){if(this.variableName===e){return this}var t=[];r(this.idToChild,function(e){t.push(e)});for(var n=0;n<t.length;++n){var i=t[n];var a=i.findNodeByVarName(e);if(a){return a}}return null}});module.exports=i},{"../ext/Class":2,"../util/ObjectUtils":376,"../util/collection/HashMap":389,"./Step":27,"./VarNode":30,"lodash.foreach":482}],31:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({getName:function(){throw new Error("Override me")},getDeclaredPaths:function(){console.log("[ERROR] Override me");throw new Error("Override me")},createElementsAndExprs:function(e){throw new Error("Override me")},equals:function(){throw new Error("Override me")},hashCode:function(){throw new Error("Override me")}});module.exports=n},{"../../ext/Class":2}],32:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Constraint");var i=r.create(n,{initialize:function(e,t){this.name=e;this.path=t},getName:function(){return this.name},getDeclaredPaths:function(){return[this.path]},getDeclaredPath:function(){return this.path}});module.exports=i},{"../../ext/Class":2,"./Constraint":31}],33:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/ObjectUtils");var i=e("./ConstraintBasePath");var a=r.create(i,{initialize:function($super,e,t,r){$super(e,t);this.value=r},getValue:function(){return this.value},equals:function(e){if(!(e instanceof i)){return false}var t=this.name==e.name;var r=this.path.equals(e.path);var n=this.value.equals(e.value);var a=t&&r&&n;return a},hashCode:function(){var e=n.hashCode(this,true);return e}});module.exports=a},{"../../ext/Class":2,"../../util/ObjectUtils":376,"./ConstraintBasePath":32}],34:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ConstraintUtils");var i=e("./ConstraintBasePath");var a=e("../../util/ObjectUtils");var s=r.create(i,{classLabel:"jassa.facete.ConstraintConcept",initialize:function($super,e,t){$super("concept",e);this.concept=t},createElementsAndExprs:function(e){var t=n.createConstraintConcept(e,this.path,this.concept);return t},equals:function(e){var t=e&&this.path.equals(e.path)&&""+this.concept===""+e.concept;return t},hashCode:function(){var e=a.hashCode(this,true);return e}});module.exports=s},{"../../ext/Class":2,"../../util/ObjectUtils":376,"../ConstraintUtils":6,"./ConstraintBasePath":32}],35:[function(e,module,t){},{}],36:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ConstraintUtils");var i=e("./ConstraintBasePathValue");var a=r.create(i,{classLabel:"jassa.facete.ConstraintEquals",initialize:function($super,e,t){$super("equals",e,t)},createElementsAndExprs:function(e){var t=n.createConstraintEquals(e,this.path,this.value);return t}});module.exports=a},{"../../ext/Class":2,"../ConstraintUtils":6,"./ConstraintBasePathValue":33}],37:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ConstraintUtils");var i=e("./ConstraintBasePath");var a=r.create(i,{classLabel:"jassa.facete.ConstraintExists",initialize:function($super,e){$super("exists",e)},createElementsAndExprs:function(e){var t=n.createConstraintExists(e,this.path);return t}});module.exports=a},{"../../ext/Class":2,"../ConstraintUtils":6,"./ConstraintBasePath":32}],38:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ConstraintUtils");var i=e("./ConstraintBasePathValue");var a=r.create(i,{classLabel:"jassa.facete.ConstraintLang",initialize:function($super,e,t){$super("lang",e,t)},createElementsAndExprs:function(e){var t=n.createConstraintLang(e,this.path,this.value);return t}});module.exports=a},{"../../ext/Class":2,"../ConstraintUtils":6,"./ConstraintBasePathValue":33}],39:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ConstraintUtils");var i=e("./ConstraintBasePathValue");var a=r.create(i,{classLabel:"jassa.facete.ConstraintRegex",initialize:function($super,e,t){$super("regex",e,t)},createElementsAndExprs:function(e){var t=n.createConstraintRegex(e,this.path,this.value.getLiteralLexicalForm());return t}});module.exports=a},{"../../ext/Class":2,"../ConstraintUtils":6,"./ConstraintBasePathValue":33}],40:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({getConcept:function(e){throw new Error("Override me")}});module.exports=n},{"../../ext/Class":2}],41:[function(e,module,t){var r=e("../../ext/Class");var n=e("./FacetConceptSupplierExact");var i=e("../../sparql/CannedConceptUtils");var a=r.create(n,{initialize:function($super,e){$super(e)},getConcept:function($super,e){var t=this.facetConfig;var r=e.getPath();var n=t.getConstraintManager();var a=t.getBaseConcept();var s=a.isSubjectConcept();var o=r.isEmpty();var c=n.isEmpty();var u=s&&o&&c;var l=u?i.createConceptDeclaredProperties(a.getVar()):$super(e);return l}});module.exports=a},{"../../ext/Class":2,"../../sparql/CannedConceptUtils":227,"./FacetConceptSupplierExact":42}],42:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../sparql/Concept");var i=e("../FacetUtils");var a=e("./FacetConceptSupplier");var s=r.create(a,{initialize:function(e){this.facetConfig=e},getConcept:function(e){var t=i.createRelationFacets(this.facetConfig,e);var r=new n(t.getElement(),t.getSourceVar());return r}});module.exports=s},{"../../ext/Class":2,"../../sparql/Concept":228,"../FacetUtils":20,"./FacetConceptSupplier":40}],43:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/collection/HashMap");var i=e("../FacetUtils");var a=e("./FacetConceptSupplier");var s=r.create({initialize:function(e,t){this.facetConceptSupplierFallback=e;this.pathHeadToConcept=t||new n},getPathHeadToConcept:function(){return this.pathHeadToConcept},getConcept:function(e){var t=this.pathHeadToConcept.get(e);var r=t||this.facetConceptSupplierFallback.getConcept(e);return r}});module.exports=s},{"../../ext/Class":2,"../../util/collection/HashMap":389,"../FacetUtils":20,"./FacetConceptSupplier":40}],44:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({prepareListService:function(e){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],45:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../service/list_service/ListServiceArray");var i=e("../../service/list_service/ListServiceTransformItem");var a=e("../../util/shared");var s=a.Promise;var o=r.create({initialize:function(e,t,r){this.facetService=e;this.filterSupplierFn=t;this.itemLimit=r||100},prepareListService:function(e){var t=this;var r=s.resolve(this.facetService.prepareListService(e)).then(function(e){var r=e.fetchCount(null,t.itemLimit);return[r,e]}).spread(function(e,r){var i=e.hasMoreItems?r:r.fetchItems().then(function(e){var r=new n(e,t.filterSupplierFn);return r});return i});return r}});module.exports=o},{"../../ext/Class":2,"../../service/list_service/ListServiceArray":158,"../../service/list_service/ListServiceTransformItem":168,"../../util/shared":403}],46:[function(e,module,t){var r=e("../../ext/Class");var n=e("./FacetService");var i=r.create(n,{initialize:function(e,t){this.facetService=e;this.fn=t},prepareListService:function(e){var t=this;var r=this.facetService.prepareListService(e).then(function(e){var r=t.fn(e);return r});return r}});module.exports=i},{"../../ext/Class":2,"./FacetService":44}],47:[function(e,module,t){var r=e("../../ext/Class");var n=e("./FacetService");var i=e("../../util/collection/HashMap");var a=e("../../service/list_service/ListServiceConceptKeyLookup");var s=e("../../service/list_service/ListServiceTransformItem");var o=r.create(n,{initialize:function(e,t){this.facetService=e;this.fnLookupService=t},prepareListService:function(e){var t=this.fnLookupService(e);var r=this.facetService.prepareListService(e).then(function(e){e=new a(e,t,function(e){var t=e.val.property;return t});return e});return r}});module.exports=o},{"../../ext/Class":2,"../../service/list_service/ListServiceConceptKeyLookup":161,"../../service/list_service/ListServiceTransformItem":168,"../../util/collection/HashMap":389,"./FacetService":44}],48:[function(e,module,t){var r=e("../../ext/Class");var n=e("./FacetService");var i=e("../../util/collection/HashMap");var a=r.create(n,{initialize:function(e,t){this.facetServiceFallback=e;this.pathHeadToFacetService=this.pathHeadToFacetService||new i},getPathHeadToFacetService:function(){return this.pathHeadToFacetService},prepareListService:function(e){var t=this.pathHeadToFacetService.get(e);var r=t||this.facetServiceFallback;var n=r.prepareListService(e);return n}});module.exports=a},{"../../ext/Class":2,"../../util/collection/HashMap":389,"./FacetService":44}],49:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeFactory");var i=e("../../sparql/Concept");var a=e("../../sparql/ConceptUtils");var s=e("../../service/list_service/ListServiceArray");var o=e("../../service/list_service/ListServiceSparqlQuery");var c=e("../../service/list_service/ListServiceTransformItem");var u=e("./FacetService");var l=e("../FacetUtils");var f=e("../../sparql/RelationUtils");var v=e("../../sparql/VarUtils");var p=e("../Step");var h=e("../Path");var d=e("../../util/shared");var g=d.Promise;var m=r.create(u,{initialize:function(e,t){this.sparqlService=e;this.facetConceptSupplier=t},prepareListService:function(e){var t;if(e==null){var r=new h;var i=[{key:r,val:{path:r,property:n.createUri("http://facete.aksw.org/resource/rootFacet")}}];t=new s(i,function(e){return function(e){return true}})}else{var u=this.facetConceptSupplier.getConcept(e);var l=a.createQueryList(u);t=new o(this.sparqlService,l,u.getVar(),false,true);t=new c(t,function(t){var r=t.key;var n=new p(r.getUri(),e.isInverse());var i=e.getPath().copyAppendStep(n);var a={key:r,val:{path:i,property:r}};return a})}var f=g.resolve(t);return f}});module.exports=m},{"../../ext/Class":2,"../../rdf/NodeFactory":99,"../../service/list_service/ListServiceArray":158,"../../service/list_service/ListServiceSparqlQuery":165,"../../service/list_service/ListServiceTransformItem":168,"../../sparql/Concept":228,"../../sparql/ConceptUtils":229,"../../sparql/RelationUtils":251,"../../sparql/VarUtils":256,"../../util/shared":403,"../FacetUtils":20,"../Path":22,"../Step":27,"./FacetService":44}],50:[function(e,module,t){},{}],51:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../service/list_service/ListServiceTransformConcept");var i=e("./FacetService");var a=r.create({initialize:function(e,t){this.facetService=e;this.fnTransform=t},prepareListService:function(e){var t=this.facetService.prepareListService(e);var r=this;var i=t.then(function(e){var t=new n(e,r.fnTransform);return t});return i}});module.exports=a},{"../../ext/Class":2,"../../service/list_service/ListServiceTransformConcept":166,"./FacetService":44}],52:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({createFacetService:function(e,t){throw new Error("Override me")}});module.exports=n},{"../../ext/Class":2}],53:[function(e,module,t){var r=e("../../ext/Class");var n=e("../FacetTreeServiceHelpers");var i=r.create({initialize:function(e,t){this.facetService=e;this.facetTreeState=t},fetchFacetTree:function(e){var t=n.fetchFacetTree(this.facetService,this.facetTreeState,e);return t}});module.exports=i},{"../../ext/Class":2,"../FacetTreeServiceHelpers":17}],54:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({prepareConcept:function(e,t){throw new Error("Method not overridden")}});module.exports=n},{"../../ext/Class":2}],55:[function(e,module,t){var r=e("../../ext/Class");var n=e("./FacetValueConceptService");var i=e("../FacetUtils");var a=e("../../util/shared");var s=a.Promise;var o=r.create({initialize:function(e){this.facetConfig=e},prepareConcept:s.method(function(e,t){var r=i.createConceptResources(this.facetConfig,e,t);return r})});module.exports=o},{"../../ext/Class":2,"../../util/shared":403,"../FacetUtils":20,"./FacetValueConceptService":54}],56:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeUtils");var i=e("../../sparql/Relation");var a=e("../../sparql/RelationUtils");var s=e("../FacetUtils.js");var o=e("../../sparql/Binding");var c=e("../../sparql/ElementUtils");var u=e("../../sparql/ConceptUtils");var l=e("../../service/ServiceUtils");var f=e("../../service/list_service/ListServiceSparqlQuery");var v=e("../../service/list_service/ListServiceTransformItem");var p=e("../../sparql/SortCondition");var h=r.create({initialize:function(e,t,r){this.sparqlService=e;this.rowLimit=r||1e5;this.facetConfig=t},prepareTableService:function(e,t){var r=s.createConceptResources(this.facetConfig,e,t);var h=this.facetConfig.getRootFacetNode().getVar();var d=this;var g=l.fetchCountRows(this.sparqlService,r.getElement(),this.rowLimit).then(function(t){var s=t.hasMoreItems===false;var l;var g;var m;if(s){var y=new i(r.getElement(),r.getVar(),h);m=c.freshVar(y.getElement(),"c");g=a.createQueryDistinctValueCount(y,m);g.getOrderBy().push(new p(g.getProject().getExpr(m),"desc"));l=new f(d.sparqlService,g,r.getVar(),null,true)}else{m=null;g=u.createQueryList(r);l=new f(d.sparqlService,g,r.getVar(),null,true)}l=new v(l,function(t){var r=t.val;var i=r.getBindings();var a=i[0]||new o;var c=m?n.getValue(a.get(m)):null;var u={key:t.key,val:{node:t.key,path:e,countInfo:{hasMoreItems:!s,count:c}}};return u});return l});return g}});module.exports=h},{"../../ext/Class":2,"../../rdf/NodeUtils":100,"../../service/ServiceUtils":140,"../../service/list_service/ListServiceSparqlQuery":165,"../../service/list_service/ListServiceTransformItem":168,"../../sparql/Binding":225,"../../sparql/ConceptUtils":229,"../../sparql/ElementUtils":233,"../../sparql/Relation":250,"../../sparql/RelationUtils":251,"../../sparql/SortCondition":252,"../FacetUtils.js":20}],57:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.facetValueService=e;this.listServiceWrapperFn=t},prepareTableService:function(e,t){var r=this;var n=this.facetValueService.prepareTableService(e,t).then(function(n){var i=r.listServiceWrapperFn(n,e,t);return i});return n}});module.exports=n},{"../../ext/Class":2}],58:[function(e,module,t){"use strict";var r={ConstraintManager:e("./ConstraintManager"),ConstraintUtils:e("./ConstraintUtils"),CountUtils:e("./CountUtils"),ElementUtils:e("./ElementUtils"),ElementsAndExprs:e("./ElementsAndExprs"),FacetConfig:e("./FacetConfig"),FacetNode:e("./FacetNode"),FacetNodeState:e("./FacetNodeState"),FacetRelationIndex:e("./FacetRelationIndex"),FacetServiceBuilder:e("./FacetServiceBuilder"),FacetServiceUtils:e("./FacetServiceUtils"),FacetTreeConfig:e("./FacetTreeConfig"),FacetTreeServiceHelpers:e("./FacetTreeServiceHelpers"),FacetTreeServiceUtils:e("./FacetTreeServiceUtils"),FacetTreeState:e("./FacetTreeState"),FacetUtils:e("./FacetUtils"),ListFilter:e("../service/ListFilter"),Path:e("./Path"),PathHead:e("./PathHead"),QueryUtils:e("./QueryUtils"),ServiceUtils:e("./ServiceUtils"),Step:e("./Step"),StepRelation:e("./StepRelation"),StepUtils:e("./StepUtils"),VarNode:e("./VarNode"),Constraint:e("./constraint/Constraint"),ConstraintBasePath:e("./constraint/ConstraintBasePath"),ConstraintBasePathValue:e("./constraint/ConstraintBasePathValue"),ConstraintConcept:e("./constraint/ConstraintConcept"),ConstraintElementFactoryBBoxRange:e("./constraint/ConstraintElementFactoryBBoxRange"),ConstraintEquals:e("./constraint/ConstraintEquals"),ConstraintExists:e("./constraint/ConstraintExists"),ConstraintLang:e("./constraint/ConstraintLang"),ConstraintRegex:e("./constraint/ConstraintRegex"),FacetConceptSupplier:e("./facet_concept_supplier/FacetConceptSupplier"),FacetConceptSupplierDeclared:e("./facet_concept_supplier/FacetConceptSupplierDeclared"),FacetConceptSupplierExact:e("./facet_concept_supplier/FacetConceptSupplierExact"),FacetConceptSupplierMeta:e("./facet_concept_supplier/FacetConceptSupplierMeta"),FacetService:e("./facet_service/FacetService"),FacetServiceClientIndex:e("./facet_service/FacetServiceClientIndex"),FacetServiceFn:e("./facet_service/FacetServiceFn"),FacetServiceLookup:e("./facet_service/FacetServiceLookup"),FacetServiceMeta:e("./facet_service/FacetServiceMeta"),FacetServiceSparql:e("./facet_service/FacetServiceSparql"),FacetServiceTagger:e("./facet_service/FacetServiceTagger"),FacetServiceTransformConcept:e("./facet_service/FacetServiceTransformConcept"),FacetSystem:e("./facet_system/FacetSystem"),FacetTreeService:e("./facet_tree_service/FacetTreeService"),FacetValueConceptService:e("./facet_value_concept_service/FacetValueConceptService"),FacetValueConceptServiceExact:e("./facet_value_concept_service/FacetValueConceptServiceExact"),FacetValueService:e("./facet_value_service/FacetValueService"),FacetValueServiceBuilder:e("./FacetValueServiceBuilder"),FacetValueServiceWrapListService:e("./facet_value_service/FacetValueServiceWrapListService"),LookupServiceConstraintLabels:e("./lookup_service/LookupServiceConstraintLabels"),LookupServiceFacetCount:e("./lookup_service/LookupServiceFacetCount"),LookupServiceFacetExactCount:e("./lookup_service/LookupServiceFacetExactCount"),LookupServiceFacetPreCount:e("./lookup_service/LookupServiceFacetPreCount"),LookupServicePathLabels:e("./lookup_service/LookupServicePathLabels"),Aggregator:e("./table/Aggregator"),ColumnView:e("./table/ColumnView"),FilterString:e("./table/FilterString"),QueryFactoryFacetTable:e("./table/QueryFactoryFacetTable"),SortCondition:e("./table/SortCondition"),TableConfigFacet:e("./table/TableConfigFacet"),TableMod:e("./table/TableMod"),TableUtils:e("./table/TableUtils"),PathUtils:e("./PathUtils")};module.exports=r},{"../service/ListFilter":131,"./ConstraintManager":5,"./ConstraintUtils":6,"./CountUtils":7,"./ElementUtils":8,"./ElementsAndExprs":9,"./FacetConfig":10,"./FacetNode":11,"./FacetNodeState":12,"./FacetRelationIndex":13,"./FacetServiceBuilder":14,"./FacetServiceUtils":15,"./FacetTreeConfig":16,"./FacetTreeServiceHelpers":17,"./FacetTreeServiceUtils":18,"./FacetTreeState":19,"./FacetUtils":20,"./FacetValueServiceBuilder":21,"./Path":22,"./PathHead":23,"./PathUtils":24,"./QueryUtils":25,"./ServiceUtils":26,"./Step":27,"./StepRelation":28,"./StepUtils":29,"./VarNode":30,"./constraint/Constraint":31,"./constraint/ConstraintBasePath":32,"./constraint/ConstraintBasePathValue":33,"./constraint/ConstraintConcept":34,"./constraint/ConstraintElementFactoryBBoxRange":35,"./constraint/ConstraintEquals":36,"./constraint/ConstraintExists":37,"./constraint/ConstraintLang":38,"./constraint/ConstraintRegex":39,"./facet_concept_supplier/FacetConceptSupplier":40,"./facet_concept_supplier/FacetConceptSupplierDeclared":41,"./facet_concept_supplier/FacetConceptSupplierExact":42,"./facet_concept_supplier/FacetConceptSupplierMeta":43,"./facet_service/FacetService":44,"./facet_service/FacetServiceClientIndex":45,"./facet_service/FacetServiceFn":46,"./facet_service/FacetServiceLookup":47,"./facet_service/FacetServiceMeta":48,"./facet_service/FacetServiceSparql":49,"./facet_service/FacetServiceTagger":50,"./facet_service/FacetServiceTransformConcept":51,"./facet_system/FacetSystem":52,"./facet_tree_service/FacetTreeService":53,"./facet_value_concept_service/FacetValueConceptService":54,"./facet_value_concept_service/FacetValueConceptServiceExact":55,"./facet_value_service/FacetValueService":56,"./facet_value_service/FacetValueServiceWrapListService":57,"./lookup_service/LookupServiceConstraintLabels":59,"./lookup_service/LookupServiceFacetCount":60,"./lookup_service/LookupServiceFacetExactCount":61,"./lookup_service/LookupServiceFacetPreCount":62,"./lookup_service/LookupServicePathLabels":63,"./table/Aggregator":64,"./table/ColumnView":65,"./table/FilterString":66,"./table/QueryFactoryFacetTable":67,"./table/SortCondition":68,"./table/TableConfigFacet":69,"./table/TableMod":70,"./table/TableUtils":71}],59:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeUtils");var i=e("../../service/lookup_service/LookupServiceBase");var a=e("./LookupServicePathLabels");var s=e("../../util/collection/HashMap");var o=e("../../util/shared");var c=o.Promise;var u=e("../../util/PromiseUtils");var l=r.create(i,{initialize:function(e,t){this.lookupServiceNodeLabels=e;this.lookupServicePathLabels=t||new a(e)},lookup:function(e){var t=[];var r=[];e.forEach(function(e){var n=e.getDeclaredPaths();var i=e.getValue?e.getValue():null;t.push.apply(t,n);if(i&&i.isUri()){r.push(i)}});var i=this.lookupServiceNodeLabels.lookup(r);var a=this.lookupServicePathLabels.lookup(t);var o=u.all([i,a]).spread(function(t,r){var i=new s;e.forEach(function(e){var a=e.getDeclaredPath();var s=e.getValue();var o=s&&s.isUri()?t.get(s):null;var c=o?o.displayLabel:null;c=c||n.toPrettyString(s);var u=r.get(a);var l=u+" = "+c;i.put(e,l)});return i});return o}});module.exports=l},{"../../ext/Class":2,"../../rdf/NodeUtils":100,"../../service/lookup_service/LookupServiceBase":171,"../../util/PromiseUtils":378,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupServicePathLabels":63}],60:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/collection/HashMap");var i=e("../../sparql/VarUtils");var a=e("../CountUtils");var s=e("../../service/lookup_service/LookupService");var o=e("../../util/shared");var c=o.Promise;var u=r.create(s,{initialize:function(e,t){this.lsPreCount=e;this.lsExactCount=t},lookup:function(e){var t=this;var r=c.resolve(this.lsPreCount.lookup(e)).then(function(e){var r=e.entries();var n=[];r.forEach(function(e){var t=e.key;var r=e.val;if(r.hasMoreItems===false){n.push(t)}});var i=t.lsExactCount.lookup(n);return[e,i]}).spread(function(t,r){var i=new n;e.forEach(function(e){var n=r.get(e);n=n||t.get(e);n=n||{count:0,hasMoreItems:false};i.put(e,n)});return i});return r}});module.exports=u},{"../../ext/Class":2,"../../service/lookup_service/LookupService":170,"../../sparql/VarUtils":256,"../../util/collection/HashMap":389,"../../util/shared":403,"../CountUtils":7}],61:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../sparql/VarUtils");var i=e("../CountUtils");var a=e("../../util/collection/HashMap");var s=e("../../service/lookup_service/LookupService");var o=r.create(s,{initialize:function(e,t){this.sparqlService=e;this.facetRelationIndex=t},lookup:function(e){var t=n.c;var r=i.createQueriesExactCount(this.facetRelationIndex,t,e,this.rowLimit);var s=i.execQueries(this.sparqlService,r,this.facetRelationIndex.getSourceVar(),t);var o=s.then(function(e){var t=new a;var r=e.entries();r.forEach(function(e){
var r=e.key;var n=e.val;var i={count:n,hasMoreItems:false};t.put(r,i)});return t});return o}});module.exports=o},{"../../ext/Class":2,"../../service/lookup_service/LookupService":170,"../../sparql/VarUtils":256,"../../util/collection/HashMap":389,"../CountUtils":7}],62:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../sparql/VarUtils");var i=e("../CountUtils");var a=e("../../util/collection/HashMap");var s=e("../../service/lookup_service/LookupService");var o=r.create(s,{initialize:function(e,t){this.sparqlService=e;this.facetRelationIndex=t;this.rowLimit=1e4},lookup:function(e){var t=this.rowLimit;var r=n.c;var s=i.createQueriesPreCount(this.facetRelationIndex,r,e,t+1);var o=i.execQueries(this.sparqlService,s,this.facetRelationIndex.getSourceVar(),r);var c=o.then(function(e){var r=new a;var n=e.entries();n.forEach(function(e){var n=e.key;var i=e.val;var a=i>t;var s={count:a?t:i,hasMoreItems:a};r.put(n,s)});return r});return c}});module.exports=o},{"../../ext/Class":2,"../../service/lookup_service/LookupService":170,"../../sparql/VarUtils":256,"../../util/collection/HashMap":389,"../CountUtils":7}],63:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../service/lookup_service/LookupServiceBase");var i=e("../../util/collection/HashMap");var a=e("../../facete/PathUtils");var s=r.create(n,{initialize:function(e,t){this.lookupServiceBase=e;this.labelFn=t||a.createLabelFn("Items","$&sup1","&raquo;")},lookup:function(e){var t=this;var r=a.getNodesFromPaths(e);var n=this.lookupServiceBase.lookup(r).then(function(r){var n=new i;e.forEach(function(e){var i=t.labelFn(e,r);n.put(e,i)});return n});return n}});module.exports=s},{"../../ext/Class":2,"../../facete/PathUtils":24,"../../service/lookup_service/LookupServiceBase":171,"../../util/collection/HashMap":389}],64:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.name=e;this.attrs=t},getName:function(){return this.name},getAttrs:function(){return this.attrs}});module.exports=n},{"../../ext/Class":2}],65:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.tableMod=e;this.columnId=t},getId:function(){return this.columnId},getSortConditions:function(){var e={};var t=this.columnId;this.tableMod.getSortConditions().forEach(function(r){var n=r.getColumnId();if(n===t){var i=r.getSortType();e[i]=r.getSortDir()}});return e},getAggregator:function(){var e=this.tableMod.getAggregator(this.columnId);return e},setAggregator:function(e){this.tableMod.getAggregators()[this.columnId]=e}});module.exports=n},{"../../ext/Class":2}],66:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.str=e;this.mode=t}})},{"../../ext/Class":2}],67:[function(e,module,t){},{}],68:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t,r){this.columnId=e;this.sortDir=t==null?1:t;this.sortType=r||"data"},getColumnId:function(){return this.columnId},getSortType:function(){return this.sortType},setSortType:function(e){this.sortType=e},getSortDir:function(){return this.sortDir},setSortDir:function(e){this.sortDir=e}});module.exports=n},{"../../ext/Class":2}],69:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/CollectionUtils");var i=e("./TableMod");var a=e("../ElementUtils");var s=e("../Path");var o=e("../../sparql/Concept");var c=e("../../util/ArrayUtils");var u=e("../../util/collection/ArrayList");var l=r.create({initialize:function(e,t,r){this.facetConfig=e;this.tableMod=t||new i;this.paths=r||[]},getFacetConfig:function(){return this.facetConfig},getTableMod:function(){return this.tableMod},getPaths:function(){return this.paths},getPath:function(e){var t=this.tableMod.getColumnIds().indexOf(e);var r=this.paths[t];return r},getColumnId:function(e){var t=c.firstIndexOf(this.paths,e);var r=this.tableMod.getColumnIds()[t];return r},removeColumn:function(e){var t=this.getPath(e);c.removeItem(this.paths,t)},getColIdForPath:function(e){var t=this.facetConfig.getRootFacetNode();var r=t.forPath(e);var n=r.getVar().getName();return n},togglePath:function(e){var t=new u(this.paths);var r=n.toggleItem(t,e);var i=this.getColIdForPath(e);if(r){this.tableMod.addColumn(i)}else{this.tableMod.removeColumn(i)}},createDataConcept:function(){var e=new s;var t=this.paths.slice(0);if(!c.contains(this.paths,e)){t.push(e)}var r=a.createElementTable(this.facetConfig,t);var n=this.facetConfig.getRootFacetNode();var i=n.getVar();var u=new o(r,i);return u}});module.exports=l},{"../../ext/Class":2,"../../sparql/Concept":228,"../../util/ArrayUtils":368,"../../util/CollectionUtils":371,"../../util/collection/ArrayList":386,"../ElementUtils":8,"../Path":22,"./TableMod":70}],70:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/ArrayUtils");var i=e("./ColumnView");var a=e("../../util/collection/HashMap");var s=r.create({initialize:function(){this.columnIds=[];this.colIdToColView=new a;this.sortConditions=[];this.colIdToAgg=new a;this.limit=null;this.offset=null;this._isDistinct=true},getLimit:function(){return this.limit},setLimit:function(e){this.limit=e},getOffset:function(){return this.offset},setOffset:function(e){this.offset=e},isDistinct:function(){return this._isDistinct},setDistinct:function(e){this._isDistinct=e},getColumnIds:function(){return this.columnIds},getColumn:function(e){return this.colIdToColView[e]},getColumns:function(){var e=this;var t=this.columnIds.map(function(t){var r=e.colIdToColView[t];return r});return t},getSortConditions:function(){return this.sortConditions},getLimitAndOffset:function(){return this.limitAndOffset},getAggregator:function(e){var t=this.colIdToAgg[e];return t},getAggregators:function(){return this.colIdToAgg},addColumn:function(e,t){var r=this.colIdToColView[e];if(r){throw new Error("Column "+e+" already part of the table")}r=new i(this,e);this.colIdToColView[e]=r;if(!t){this.columnIds.push(e)}return r},removeColumn:function(e){delete this.colIdToColView[e];var t=this;n.filter(this.columnIds,function(t){var r=e!=t;return r});n.filter(this.sortConditions,function(t){var r=e!=t.getColumnId()});delete this.colIdToAgg[e]}});module.exports=s},{"../../ext/Class":2,"../../util/ArrayUtils":368,"../../util/collection/HashMap":389,"./ColumnView":65}],71:[function(e,module,t){var r={createNgGridColumnDefs:function(e){var t=e.getColumns();var r=t.forEach(function(e){var t={field:e.getId(),displayName:e.getId()};return t});return r}};module.exports=r},{}],72:[function(e,module,t){var r=e("../ext/Class");var n=r.create({createExpr:function(e){throw new Error("Not implemented")}});module.exports=n},{"../ext/Class":2}],73:[function(e,module,t){var r=e("../ext/Class");var n=e("./BboxExprFactory");var i=e("./GeoExprUtils");var a=r.create(n,{initialize:function(e,t,r){this.xVar=e;this.yVar=t;this.castNode=r},createExpr:function(e){var t=i.createExprWgs84Intersects(this.xVar,this.yVar,e,this.castNode);return t}});module.exports=a},{"../ext/Class":2,"./BboxExprFactory":72,"./GeoExprUtils":79}],74:[function(e,module,t){var r=e("../ext/Class");var n=e("./BboxExprFactory");var i=e("./GeoExprUtils");var a=r.create(n,{initialize:function(e,t,r){this.wktVar=e;this.intersectsFnName=t;this.geomFromTextFnName=r},createExpr:function(e){var t=i.createExprOgcIntersects(this.wktVar,e,this.intersectsFnName,this.geomFromTextFnName);return t}});module.exports=a},{"../ext/Class":2,"./BboxExprFactory":72,"./GeoExprUtils":79}],75:[function(e,module,t){var r=e("../ext/Class");var n=e("./Point");var i=e("./Range");var a=r.create({initialize:function(e,t,r,n){this.left=e;this.right=r;this.bottom=t;this.top=n},containsPoint:function(e){return e.x>=this.left&&e.x<this.right&&e.y>=this.bottom&&e.y<this.top},getCenter:function(){return new n(.5*(this.left+this.right),.5*(this.bottom+this.top))},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},contains:function(e){return e.left>=this.left&&e.right<this.right&&e.bottom>=this.bottom&&e.top<this.top},rangeX:function(){return new i(this.left,this.right)},rangeY:function(){return new i(this.bottom,this.top)},overlap:function(e){if(!e.rangeX||!e.rangeY){console.error("Missing range");throw"Error"}var t=this.rangeX().getOverlap(e.rangeX());if(!t){return null}var r=this.rangeY().getOverlap(e.rangeY());if(!r){return null}return new a(t.min,r.min,r.max,t.max)},isOverlap:function(e){var t=this.overlap(e);return t!=null},toString:function(){return"["+this.left+" - "+this.right+", "+this.bottom+" - "+this.top+"]"}});a.createFromJson=function(e){var t=new a(e.left,e.bottom,e.right,e.top);return t};module.exports=a},{"../ext/Class":2,"./Point":85,"./Range":89}],76:[function(e,module,t){var r=e("../ext/Class");var n=e("lodash.flatten");var i=e("lodash.uniq");var a=e("../service/data_service/DataService");var s=e("../vocab/wgs84");var o=e("../rdf/NodeFactory");var c=e("../util/shared");var u=c.Promise;var l=e("./Bounds");var f=e("./QuadTree");var v=e("./GeoExprUtils");var p=function(){return false};var h=e("../util/PromiseUtils");var d=r.create(a,{initialize:function(e,t,r,n){this.listServiceBbox=e;var i=new l(-180,-90,180,90);this.quadTree=new f(i,18,0);this.maxItemsPerTileCount=r||25;this.maxGlobalItemCount=t||50;this.aquireDepth=n||2},fetchData:function(e){var t=this.runWorkflow(e).then(function(e){var t=e.map(function(e){return e.data.docs});var r=t.filter(function(e){return e});r=n(r,true);e.forEach(function(e){if(e.isLoaded){return}var t=v.boundsToWkt(e.getBounds());var n={key:t,val:{id:t,zoomClusterBounds:e.getBounds(),wkt:t}};r.push(n)});return r});return t},runCheckGlobal:function(){var e;var t=this.quadTree.getRootNode();if(!t.checkedGlobal){var r=this.listServiceBbox.fetchCount(null,this.maxGlobalItemCount);e=r.then(function(e){var r=!e.hasMoreItems;t.canUseGlobal=r;t.checkedGlobal=true;return r})}else{e=u.resolve(t.canUseGlobal).cancellable()}return e},runWorkflow:function(e){var t=this.quadTree.getRootNode();var r=this;var n=this.runCheckGlobal().then(function(n){var i;if(n){i=r.runGlobalWorkflow(t)}else{i=r.runTiledWorkflow(e)}return i.then(function(e){return e})});return n},runGlobalWorkflow:function(e){var t=this;var r=this.listServiceBbox.fetchItems(null).then(function(r){t.loadTaskAction(e,r);return[e]});return r},runTiledWorkflow:function(e){var t=this;var r=this.quadTree.aquireNodes(e,this.aquireDepth);r.forEach(function(e){if(!e.data){e.data={}}});r.forEach(function(e){if(e.isCountComplete()&&e.infMinItemCount===0){e.isLoaded=true}});var n=r.filter(function(e){return t.isCountingNeeded(e)});var i=this.createCountTasks(n);var a=h.all(i).then(function(){var e=r.filter(function(e){return t.isLoadingNeeded(e)});var n=t.createLoadTasks(e);return h.all(n).then(function(){return r})});return a},createCountTask:function(e){var t=this;var r=t.maxItemsPerTileCount;var n=this.listServiceBbox.fetchCount(e.getBounds(),r);var i=n.then(function(t){var r=t.count;e.setMinItemCount(t.count);if(r===0){e.isLoaded=true}});return i},isCountingNeeded:function(e){return!(this.isTooManyGeoms(e)||e.isCountComplete())},isLoadingNeeded:function(e){var t=e.isLoaded||e.isCountComplete()&&e.infMinItemCount===0||this.isTooManyGeoms(e);return!t},isTooManyGeoms:function(e){return e.infMinItemCount>=this.maxItemsPerTileCount},createCountTasks:function(e){var t=this;var r=e.map(function(e){return t.createCountTask(e)}).filter(function(e){return e});return r},loadTaskAction:function(e,t){e.data.docs=t;e.isLoaded=true},createLoadTasks:function(e){var t=this;var r=e.map(function(e){var r=t.listServiceBbox.fetchItems(e.getBounds()).then(function(r){t.loadTaskAction(e,r)});return r});return r},finalizeLoading:function(e){var t=[];e.forEach(function(e){if(e.parent){t.push(e.parent)}});t=i(t);var r=function(t){var r=e.indexOf(t);if(r>=0){e[r]=undefined}};var n=false;do{n=false;for(var a in t){var s=t[a];var o=s.children;var c=p(s);if(!c){continue}n=true;o.forEach(r);e.push(s);if(s.parent){t.push(s.parent)}break}}while(n===true);e=e.filter(function(e){return e})}});module.exports=d},{"../ext/Class":2,"../rdf/NodeFactory":99,"../service/data_service/DataService":151,"../util/PromiseUtils":378,"../util/shared":403,"../vocab/wgs84":410,"./Bounds":75,"./GeoExprUtils":79,"./QuadTree":87,"lodash.flatten":481,"lodash.uniq":496}],77:[function(e,module,t){var r=e("../sparql/Concept");var n=e("../sparql/element/ElementString");var i=e("../sparql/VarUtils");var a={conceptWgs84:new r(n.create("?s <http://www.w3.org/2003/01/geo/wgs84_pos#long> ?x ;  <http://www.w3.org/2003/01/geo/wgs84_pos#lat> ?y"),i.s),conceptGeoVocab:new r(n.create("?s <http://www.opengis.net/ont/geosparql#asWKT> ?w"),i.s),conceptSchemaOrgGeoCoordinate:new r(n.create("?s <http://schema.org/longitude> ?x ;  <http://schema.org/latitude> ?y"),i.s)};module.exports=a},{"../sparql/Concept":228,"../sparql/VarUtils":256,"../sparql/element/ElementString":265}],78:[function(e,module,t){var r=e("../service/LookupServiceUtils");var n=e("../service/lookup_service/LookupServiceConst");var i=e("../service/lookup_service/LookupServiceTransform");var a=e("../service/list_service/ListServiceAugmenter");var s=e("../service/list_service/AugmenterLookup");var o=e("../sparql/BestLabelConfig");var c=e("./ListServiceBbox");var u=e("./DataServiceBboxCache");var r=e("../sponate/LookupServiceUtils");var l=e("../sponate/MappedConceptUtils");var f={createGeoDataSourceLabels:function(e,t,f,v){if(v==null){v={}}var p=new c(e,t,f);var h=new o;var d=l.createMappedConceptBestLabel(h);var g=r.createLookupServiceMappedConcept(e,d);g=new i(g,function(e,t){var r={shortLabel:e};return r});var m=new s(g);p=new a(p,m);var y=new n(v);var x=new s(y);p=new a(p,x);var S=new u(p,1500,500,2);return S}};module.exports=f},{"../service/LookupServiceUtils":134,"../service/list_service/AugmenterLookup":156,"../service/list_service/ListServiceAugmenter":159,"../service/lookup_service/LookupServiceConst":174,"../service/lookup_service/LookupServiceTransform":186,"../sparql/BestLabelConfig":224,"../sponate/LookupServiceUtils":326,"../sponate/MappedConceptUtils":329,"./DataServiceBboxCache":76,"./ListServiceBbox":84}],79:[function(e,module,t){var r=e("../sparql/NodeValueUtils");var n=e("../sparql/expr/ExprVar");var i=e("../sparql/expr/E_Cast");var a=e("../sparql/expr/NodeValue");var s=e("../sparql/expr/E_LogicalAnd");var o=e("../sparql/expr/E_Function");var c=e("../sparql/expr/E_GreaterThan");var u=e("../sparql/expr/E_LessThan");var l={createExprWgs84Intersects:function(e,t,i,a){var l=new n(e);var f=new n(t);if(a){var v=a.getUri();l=new o(v,[l]);f=new o(v,[f])}var p=r.makeDecimal(i.left);var h=r.makeDecimal(i.right);var d=r.makeDecimal(i.bottom);var g=r.makeDecimal(i.top);var m=new s(new s(new c(l,p),new u(l,h)),new s(new c(f,d),new u(f,g)));return m},createExprOgcIntersects:function(e,t,i,a){var s="http://www.opengis.net/rdf#";i=i||s+"intersects";a=a||s+"geomFromText";var c=new n(e);var u=this.boundsToWkt(t);var l=r.makeString(u);var f=new o(i,[c,new o(a,[l])]);return f},boundsToWkt:function(e){var t=e.left;var r=e.bottom;var n=e.right;var i=e.top;var a="POLYGON(("+t+" "+r+","+n+" "+r+","+n+" "+i+","+t+" "+i+","+t+" "+r+"))";return a}};module.exports=l},{"../sparql/NodeValueUtils":243,"../sparql/expr/E_Cast":278,"../sparql/expr/E_Function":280,"../sparql/expr/E_GreaterThan":281,"../sparql/expr/E_LessThan":285,"../sparql/expr/E_LogicalAnd":287,"../sparql/expr/ExprVar":303,"../sparql/expr/NodeValue":304}],80:[function(e,module,t){var r=e("../ext/Class");var n=e("../sparql/Concept");var i=e("../sparql/element/ElementGroup");var a=e("../sparql/element/ElementFilter");var s=e("../sponate/MappedConcept");var o=r.create({classLabel:"GeoMapFactory",initialize:function(e,t){this.mappedConcept=e;this.bboxExprFactory=t},createMap:function(e){var t=this.createMapForBounds(e);return t},createMapForGlobal:function(){var e=this.createMapForBounds(null);return e},createMapForBounds:function(e){var t=this.mappedConcept;var r=this.bboxExprFactory;var o=t.getConcept();var c=t.getAgg();var u=o.getElement();var l=u;if(e){var f=r.createExpr(e);var v=new a(f);l=new i([u,v])}var p=new n(l,o.getVar());var h=new s(p,c);return h}});module.exports=o},{"../ext/Class":2,"../sparql/Concept":228,"../sparql/element/ElementFilter":261,"../sparql/element/ElementGroup":262,"../sponate/MappedConcept":327}],81:[function(e,module,t){var r=e("./BboxExprFactoryWkt");var n=e("./BboxExprFactoryWgs84");var i=e("./GeoMapUtils");var a=e("./GeoMapFactory");var s=e("../sparql/VarUtils");var o=e("../sparql/Concept");var c=e("../sparql/element/ElementString");var u=e("../sparql/element/ElementTriplesBlock");var l=e("../rdf/NodeFactory");var f=e("../rdf/Triple");var v=e("../vocab/rdf");var p=e("../vocab/xsd");var h=e("../sponate/SponateUtils");var d="bif:st_intersects";var g="bif:st_geomFromText";var m={createXyMapFactory:function(e,t,r){var u="?s <"+e+"> ?x ; <"+t+"> ?y";var l=new o(c.create(u),s.s);var f=r?p.xdouble:null;var v=new a(i.createXyView(l),new n(s.x,s.y,f));return v},wgs84MapFactory:new a(i.wgs84GeoView,new n(s.x,s.y)),wgs84CastMapFactory:new a(i.wgs84GeoView,new n(s.x,s.y,p.xdouble)),ogcVirtMapFactory:new a(i.ogcGeoView,new r(s.w,d,g)),createWktMapFactory:function(e,t,n){e=e||"http://www.opengis.net/ont/geosparql#asWKT";t=t||d;n=n||g;var i=l.createUri(e);var c=new o(new u([new f(s.s,i,s.w)]),s.s);var v=h.parseSpec({name:"geoMap-"+e,template:[{id:""+c.getVar(),wkt:""+s.w}],from:c.getElement()});var p=new a(v,new r(s.w,t,n));return p}};module.exports=m},{"../rdf/NodeFactory":99,"../rdf/Triple":102,"../sparql/Concept":228,"../sparql/VarUtils":256,"../sparql/element/ElementString":265,"../sparql/element/ElementTriplesBlock":267,"../sponate/SponateUtils":335,"../vocab/rdf":408,"../vocab/xsd":411,"./BboxExprFactoryWgs84":73,"./BboxExprFactoryWkt":74,"./GeoMapFactory":80,"./GeoMapUtils":82}],82:[function(e,module,t){var r=e("../sparql/VarUtils");var n=e("../rdf/NodeFactory");var i=e("../sparql/Concept");var a=e("./GeoConceptUtils");var s=e("../sponate/SponateUtils");var o={createXyView:function(e,t,n){t=t||r.x;n=n||r.y;var i=s.parseSpec({name:"lonlat",template:[{id:e.getVar(),lon:""+t,lat:""+n,wkt:[""+t,""+n,function(e,t){var r="POINT("+e+" "+t+")";return r}]}],from:e.getElement()});return i},wgs84GeoView:s.parseSpec({name:"lonlat",template:[{id:a.conceptWgs84.getVar(),lon:""+r.x,lat:""+r.y,wkt:[""+r.x,""+r.y,function(e,t){var r="POINT("+e+" "+t+")";return r}]}],from:a.conceptWgs84.getElement()}),ogcGeoView:s.parseSpec({name:"lonlat",template:[{id:a.conceptGeoVocab.getVar(),wkt:""+r.w}],from:a.conceptGeoVocab.getElement()})};module.exports=o},{"../rdf/NodeFactory":99,"../sparql/Concept":228,"../sparql/VarUtils":256,"../sponate/SponateUtils":335,"./GeoConceptUtils":77}],83:[function(e,module,t){var r=e("../rdf/node/Node");var n=e("../sparql/expr/ExprVar");var i=e("../sparql/expr/NodeValue");var a=e("../sparql/expr/E_LogicalAnd");var s=e("../sparql/expr/E_LogicalOr");var o=e("../sparql/expr/E_Function");var c=e("../sparql/expr/E_Cast");var u=e("../sparql/expr/E_GreaterThan");var l=e("../sparql/expr/E_LessThan");var f={boundsToWkt:function(e){var t=e.left;var r=e.bottom;var n=e.right;var i=e.top;var a="POLYGON(("+t+" "+r+","+n+" "+r+","+n+" "+i+","+t+" "+i+","+t+" "+r+"))";return a},createFilterOgcIntersects:function(e,t){var r="http://www.opengis.net/rdf#";var i=new n(e);var a=this.boundsToWkt(t);var s=new o(r+"intersects",i,new o(r+"geomFromText",a));return s},createWgsFilter:function(e,t,s,o){var f=new n(e);var v=new n(t);if(o){f=new c(f,o);v=new c(v,o)}var p=i.makeNode(r.forValue(s.left));var h=i.makeNode(r.forValue(s.right));var d=i.makeNode(r.forValue(s.bottom));var g=i.makeNode(r.forValue(s.top));var m=new a(new a(new u(f,p),new l(f,h)),new a(new u(v,d),new l(v,g)));return m}};module.exports=f},{"../rdf/node/Node":112,"../sparql/expr/E_Cast":278,"../sparql/expr/E_Function":280,"../sparql/expr/E_GreaterThan":281,"../sparql/expr/E_LessThan":285,"../sparql/expr/E_LogicalAnd":287,"../sparql/expr/E_LogicalOr":289,"../sparql/expr/ExprVar":303,"../sparql/expr/NodeValue":304}],84:[function(e,module,t){var r=e("../ext/Class");var n=e("../service/list_service/ListService");var i=e("../sponate/facade/StoreFacade");var a=r.create(n,{initialize:function(e,t,r){this.sparqlService=e;this.geoMapFactory=t;this.concept=r},createListService:function(e){var t=new i(this.sparqlService);var r=this.geoMapFactory.createMap(e);var n={name:"geoMap",template:r};t.addMap(n);var a=t.geoMap.getListService();return a},fetchItems:function(e,t,r){var n=this.createListService(e);var i=n.fetchItems(this.concept,t,r);return i},fetchCount:function(e,t,r){var n=this.createListService(e);var i=n.fetchCount(this.concept,t,r);return i}});module.exports=a},{"../ext/Class":2,"../service/list_service/ListService":157,"../sponate/facade/StoreFacade":365}],85:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.x=e;this.y=t},getX:function(){return this.x},getY:function(){return this.y}});module.exports=n},{"../ext/Class":2}],86:[function(e,module,t){var r={lonlatToWkt:function(e){var t=this.pointToWkt(e.lon,e.lat);return t},xyToWkt:function(e){var t=this.pointToWkt(e.x,e.y);return t},pointToWkt:function(e,t){var r="POINT ("+e+" "+t+")";return r},wktPointRegex:/^\s*POINT\s*\(\s*([^\s]+)\s+([^)]+)\)\s*$/i,isWktPoint:function(e){var t=this.wktPointRegex.exec(e);var r=!!t;return r},wktToXy:function(e){var t=this.wktPointRegex.exec(e);if(!t){return null}var r=t[1];var n=t[2];var i={x:parseFloat(r),y:parseFloat(n)};return i}};module.exports=r},{}],87:[function(e,module,t){var r=e("../ext/Class");var n=e("./QuadTreeNode");var i=r.create({initialize:function(e,t,r){if(r==null){r=.25}this.node=new n(null,e,t,0,r);this.idToNodes=[]},getRootNode:function(){return this.node},aquireNodes:function(e,t){return this.node.aquireNodes(e,t)},query:function(e,t){return this.node.query(e,t)},insert:function(e){}});module.exports=i},{"../ext/Class":2,"./QuadTreeNode":88}],88:[function(e,module,t){var r=e("../ext/Class");var n=e("./Point");var i=e("./Bounds");var a=e("lodash.reduce");var s=r.create({initialize:function(e,t,r,n,i,a){this.parent=e;this.parentChildIndex=a;this._bounds=t;this._maxDepth=r;this._depth=n;this._k=i;this.isLoaded=false;this.children=null;this.data={};this._minItemCount=null;this.infMinItemCount=null;this.idToPos={};this._classConstructor=s},getId:function(){var e=this.parent;var t=e?e.getId():"";var r=this.parentChildIndex!=null?this.parentChildIndex:"r";var n=t+r;return n},isLeaf:function(){return this.children==null},addItem:function(e,t){this.idToPos[e]=t},addItems:function(e){for(var t in e){var r=e[t];this.addItem(t,r)}},removeItem:function(e){delete this.idToPos[e]},setMinItemCount:function(e){this._minItemCount=e;this.infMinItemCount=e;if(this.parent){this.parent.updateInfMinItemCount()}},getMinItemCount:function(){return this._minItemCount},isCountComplete:function(){if(this.getMinItemCount()!=null){return true}if(this.children){var e=a(this.children,function(e,t){return e&&t.isCountComplete()},true);return e}return false},updateInfMinItemCount:function(){if(!this.children&&this._minItemCount!=null){return}var e=0;this.children.forEach(function(t,r){if(t._minItemCount!=null){e+=t._minItemCount}else if(t.infMinItemCount){e+=t.infMinItemCount}});this.infMinItemCount=e;if(this.parent){this.parent.updateInfMinItemCount()}},getBounds:function(){return this._bounds},getCenter:function(){return this._bounds.getCenter()},subdivide:function(){var e=this._depth+1;var t=this.getCenter();var r=this._k*.5*this._bounds.getWidth();var n=this._k*.5*this._bounds.getHeight();this.children=[];this.children[s.TOP_LEFT]=new this._classConstructor(this,new i(this._bounds.left,t.y-n,t.x+r,this._bounds.top),this._maxDepth,e,this._k,s.TOP_LEFT);this.children[s.TOP_RIGHT]=new this._classConstructor(this,new i(t.x-r,t.y-n,this._bounds.right,this._bounds.top),this._maxDepth,e,this._k,s.TOP_RIGHT);this.children[s.BOTTOM_LEFT]=new this._classConstructor(this,new i(this._bounds.left,this._bounds.bottom,t.x+r,t.y+n),this._maxDepth,e,this._k,s.BOTTOM_LEFT);this.children[s.BOTTOM_RIGHT]=new this._classConstructor(this,new i(t.x-r,this._bounds.bottom,this._bounds.right,t.y+n),this._maxDepth,e,this._k,s.BOTTOM_RIGHT)},getOverlaps:function(e){},query:function(e,t){var r=[];this.queryRec(e,r,t);return r},queryRec:function(e,t,r){if(!this._bounds.isOverlap(e)){return}var n=e.getWidth()/this._bounds.getWidth();var i=e.getHeight()/this._bounds.getHeight();var a=Math.max(n,i);if(this.isLoaded||!this.children||a>=r){t.push(this);return}for(var s in this.children){var o=this.children[s];o.queryRec(e,r,t)}},splitFor:function(e,t,r){if(!this._bounds.isOverlap(e)){return}if(this.isLoaded){if(r){r.push(this)}return}var n=e.getWidth()/this._bounds.getWidth();var i=e.getHeight()/this._bounds.getHeight();var a=Math.max(n,i);if(a>=t||this._depth>=this._maxDepth){if(r){r.push(this)}return}if(!this.children){this.subdivide()}for(var s=0;s<this.children.length;++s){var o=this.children[s];o.splitFor(e,t,r)}},aquireNodes:function(e,t){var r=[];this.splitFor(e,t,r);return r},unlink:function(){if(!this.parent){return}for(var e in this.parent.children){var t=this.parent.children[e];if(t==this){this.parent.children=new s(this.parent,this._bounds,this._depth,this._k)}}}});s.TOP_LEFT=0;s.TOP_RIGHT=1;s.BOTTOM_LEFT=2;s.BOTTOM_RIGHT=3;module.exports=s},{"../ext/Class":2,"./Bounds":75,"./Point":85,"lodash.reduce":493}],89:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.min=e;this.max=t},getOverlap:function(e){var t=Math.max(this.min,e.min);var r=Math.min(this.max,e.max);return t>r?null:new n(t,r)}});module.exports=n},{"../ext/Class":2}],90:[function(e,module,t){"use strict";var r={BboxExprFactory:e("./BboxExprFactory"),BboxExprFactoryWgs84:e("./BboxExprFactoryWgs84"),BboxExprFactoryWkt:e("./BboxExprFactoryWkt"),Bounds:e("./Bounds"),DataServiceBboxCache:e("./DataServiceBboxCache"),GeoConceptUtils:e("./GeoConceptUtils"),GeoDataSourceUtils:e("./GeoDataSourceUtils"),GeoExprUtils:e("./GeoExprUtils"),GeoMapFactory:e("./GeoMapFactory"),GeoMapFactoryUtils:e("./GeoMapFactoryUtils"),GeoMapUtils:e("./GeoMapUtils"),GeoUtils:e("./GeoUtils"),ListServiceBbox:e("./ListServiceBbox"),Point:e("./Point"),PointUtils:e("./PointUtils"),QuadTree:e("./QuadTree"),QuadTreeNode:e("./QuadTreeNode"),Range:e("./Range")};module.exports=r},{"./BboxExprFactory":72,"./BboxExprFactoryWgs84":73,"./BboxExprFactoryWkt":74,"./Bounds":75,"./DataServiceBboxCache":76,"./GeoConceptUtils":77,"./GeoDataSourceUtils":78,"./GeoExprUtils":79,"./GeoMapFactory":80,"./GeoMapFactoryUtils":81,"./GeoMapUtils":82,"./GeoUtils":83,"./ListServiceBbox":84,"./Point":85,"./PointUtils":86,"./QuadTree":87,"./QuadTreeNode":88,"./Range":89}],91:[function(e,module,t){var r=e("./util/shared");var n=e("./util/AjaxUtils");var Jassa=function(t,i){if(arguments.length===1){i=arguments[0];t=null}r.Promise=t||e("bluebird");r.ajax=n.createAjaxWrapperFn(i);return{util:e("./util"),rdf:e("./rdf"),io:e("./io"),vocab:e("./vocab"),sparql:e("./sparql"),service:e("./service"),sponate:e("./sponate"),facete:e("./facete"),geo:e("./geo")}};Jassa.ext=e("./ext");module.exports=Jassa},{"./ext":4,"./facete":58,"./geo":90,"./io":93,"./rdf":111,"./service":155,"./sparql":306,"./sponate":366,"./util":402,"./util/AjaxUtils":367,"./util/shared":403,"./vocab":406,bluebird:414}],92:[function(e,module,t){var r=e("../rdf/Triple");var n=e("../rdf/GraphImpl");var i=e("../rdf/NodeFactory");var a=e("../rdf/NodeUtils");var s={containsTriple:function(e,t){},triplesToTalisRdfJson:function(e,t){t=t||{};e.forEach(function(e){s.tripleToTalisRdfJson(e,t)});return t},tripleToTalisRdfJson:function(e,t){t=t||{};var r=e.getSubject();var n=r.isUri()?r.getUri():""+r;var i=t[n]=t[n]||{};var s=e.getPredicate().getUri();var o=i[s]=i[s]||[];var c=e.getObject();var u=a.toTalisRdfJson(c);o.push(u)},talisRdfJsonToGraph:function(e){var t=this.talisRdfJsonToTriples(e);var r=new n;r.addAll(t);return r},talisRdfJsonToTriples:function(e){var t=[];var n=Object.keys(e);n.sort();n.forEach(function(n){var a=i.createUri(n);var o=e[n];var c=Object.keys(o);c.sort();c.forEach(function(e){var n=i.createUri(e);var c=o[e];c.forEach(function(e){var o=s.createTalisRdfJsonObjectWithDefaults(e);try{var c=i.createFromTalisRdfJson(o);var u=new r(a,n,c);t.push(u)}catch(t){console.log("Error: could not create node from "+e)}})})});return t},shortForm:function(e,t){var r=t?t.shortForm(e):e;if(r===e){r="<"+e+">"}return r},talisRdfJsonToTurtle:function(e,t){var r=Object.keys(e);r.sort();var n="";r.forEach(function(r){n+=s.shortForm(r,t)+"\n";var a=e[r];var o=Object.keys(a);o.sort();o.forEach(function(e){n+="    "+s.shortForm(e,t);var r=a[e];var o=r.map(function(e){var r=s.createTalisRdfJsonObjectWithDefaults(e);var n;try{var a=i.createFromTalisRdfJson(r);n=a.isUri()?s.shortForm(a.getUri(),t):""+a}catch(t){n="\n";n+="        // Invalid data for RDF generation:\n";n+="        // raw: "+JSON.stringify(e)+"\n";n+="        // defaults: "+JSON.stringify(e)+"\n";n+="        // "+t+"\n";n+="\n"}return n});n+=" "+o.join(", ")+" ; \n"});n+="    . \n"});return n},createTalisRdfJsonObjectWithDefaults:function(e){var t={type:e.type||"literal",value:e.value||"",lang:e.lang||"",datatype:e.datatype||""};return t}};module.exports=s},{"../rdf/GraphImpl":96,"../rdf/NodeFactory":99,"../rdf/NodeUtils":100,"../rdf/Triple":102}],93:[function(e,module,t){"use strict";var r={TalisRdfJsonUtils:e("./TalisRdfJsonUtils")};module.exports=r},{"./TalisRdfJsonUtils":92}],94:[function(e,module,t){var r=e("../ext/Class");var n=r.create({classLabel:"AnonId",getLabelString:function(){throw new Error("not implemented")}});module.exports=n},{"../ext/Class":2}],95:[function(e,module,t){var r=e("../ext/Class");var n=e("./AnonId");var i=r.create(n,{classLabel:"AnonIdStr",initialize:function(e){this.label=e},getLabelString:function(){return this.label},toString:function(){return this.label}});module.exports=i},{"../ext/Class":2,"./AnonId":94}],96:[function(e,module,t){var r=e("../ext/Class");var n=e("../util/collection/HashSet");var i=e("./Triple");var a=e("./TripleUtils");var s=r.create({initialize:function(e){this.triples=e||new n;var t=this},isEmpty:function(){var e=this.triples.isEmpty();return e},equals:function(){throw new Error("Not implemented yet")},hashCode:function(){var e=this.triples.hashCode();return e},add:function(e){var t=this.triples.add(e);return t},remove:function(e){var t=this.triples.remove(e);return t},removeAll:function(e){this.triples.removeAll(e)},removeMatch:function(e){var t=[];this.triples.forEach(function(r){var n=a.matches(e,r);if(n){t.push(r)}});this.removeAll(t)},forEach:function(e){this.triples.forEach(e)},map:function(e){var t=this.triples.map(e);return t},contains:function(e){var t=this.triples.contains(e);return t},addAll:function(e){var t=this;e.forEach(function(e){t.add(e)})},clear:function(){this.triples.clear()},toArray:function(){var e=this.triples.entries();return e},size:function(){var e=this.triples.size();return e}});module.exports=s},{"../ext/Class":2,"../util/collection/HashSet":390,"./Triple":102,"./TripleUtils":103}],97:[function(e,module,t){var r=e("../util/collection/HashSet");var n=e("../util/collection/HashMap");var i=e("./GraphImpl");var a={extractUris:function(e){var t=new r;e.forEach(function(e){e.toArray().forEach(function(e){if(e!=null&&e.isUri()){t.add(e.getUri())}})});var n=t.entries();return n},indexBySubject:function(e,t){t=t||new n;e.forEach(function(e){var r=e.getSubject();var n=t.get(r);if(!n){n=new i;t.put(r,n)}n.add(e)});return t}};module.exports=a},{"../util/collection/HashMap":389,"../util/collection/HashSet":390,"./GraphImpl":96}],98:[function(e,module,t){var r=e("../ext/Class");var n=e("./node/Node_Concrete");var i=function(e){var t=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"');return t};var a=r.create(n,{classLabel:"jassa.rdf.LiteralLabel",initialize:function(e,t,r,n){this.val=e
;this.lex=t;this.lang=r;this.dtype=n},getValue:function(){return this.val},getLexicalForm:function(){return this.lex instanceof String?this.lex:this.lex.toString()},getLanguage:function(){return this.lang},getDatatype:function(){return this.dtype},toString:function(){var e=this.dtype?this.dtype.getUri():null;var t=i(this.lex);var r;if(e){r='"'+t+'"^^<'+e+">"}else{r='"'+t+'"'+(this.lang?"@"+this.lang:"")}return r}});module.exports=a},{"../ext/Class":2,"./node/Node_Concrete":114}],99:[function(e,module,t){var r=e("./AnonIdStr");var n=e("./node/Var");var i=e("./node/Node");var a=e("./node/Node_Uri");var s=e("./node/Node_Blank");var o=e("./node/Node_Literal");var c=e("./LiteralLabel");var u=e("./TypeMapper");var l=e("./rdf_datatype/DefaultRdfDatatypes");var f=e("../util/ObjectUtils");var v=/"([^"\\]*(\\.[^"\\]*)*)"/;var p=function(e){var t;if(e.charAt(0)==="<"){t=e.slice(1,-1)}else{throw new Error("[ERROR] Cannot deal with "+e)}return t};var h={createAnon:function(e){return new s(e)},createUri:function(e){return new a(e)},createVar:function(e){return new n(e)},createPlainLiteral:function(e,t){if(t==null){t=""}var r=new c(e,e,t);return new o(r)},createTypedLiteralFromValue:function(e,t){var r=l[t];if(!r){var n=u.getInstance();r=n.getSafeTypeByName(t)}var i=r.unparse(e);var a=null;var s=new c(e,i,a,r);return new o(s)},createTypedLiteralFromString:function(e,t){var r=l[t];if(!r){var n=u.getInstance();r=n.getSafeTypeByName(t)}if(!r){throw new Error("Internal error: No datatype object for: "+t+"("+typeof t+")")}var i=r.parse(e);var a=e;var s="";var f=new c(i,a,s,r);return new o(f)},createFromTalisRdfJson:function(e){if(!e||typeof e.type==="undefined"){throw new Error("Invalid node: "+JSON.stringify(e))}var t;var n=e.datatype;switch(e.type){case"bnode":var i=new r(e.value);t=new h.createAnon(i);break;case"uri":t=h.createUri(e.value);break;case"literal":if(!f.isEmptyString(n)){t=h.createTypedLiteralFromString(e.value,n)}else{var a=e.lang||e["xml:lang"];t=h.createPlainLiteral(e.value,a)}break;case"typed-literal":t=h.createTypedLiteralFromString(e.value,n);break;default:console.log("Unknown type: '"+e.type+"'");throw new Error("Bailing out")}return t},parseRdfTerm:function(e){if(!e){throw new Error("[ERROR] Null Pointer Exception")}e=e.trim();if(e.length===0){throw new Error("[ERROR] Empty string")}var t=e.charAt(0);var n;switch(t){case"<":var i=e.slice(1,-1);n=h.createUri(i);break;case"_":var a=new r(e);n=h.createAnon(a);break;case'"':var s=v.exec(e);var o=s[0];var c=o.slice(1,-1);var u=o.length;var l=e.charAt(u);if(!l){n=h.createTypedLiteralFromString(c,"http://www.w3.org/2001/XMLSchema#string")}switch(l){case"":case"@":var f=e.substr(u+1);n=h.createPlainLiteral(c,f);break;case"^":var d=e.substr(u+2);var g=p(d);n=h.createTypedLiteralFromString(c,g);break;default:throw new Error("[ERROR] Excepted @ or ^^")}break;default:throw new Error("Could not parse "+e)}return n}};module.exports=h},{"../util/ObjectUtils":376,"./AnonIdStr":95,"./LiteralLabel":98,"./TypeMapper":104,"./node/Node":112,"./node/Node_Blank":113,"./node/Node_Literal":116,"./node/Node_Uri":117,"./node/Var":119,"./rdf_datatype/DefaultRdfDatatypes":121}],100:[function(e,module,t){var r=e("lodash");var n=e("../util/UriUtils");var i=e("./rdf_datatype/TypedValue");var a={matches:function(e,t){var r=t&&(e==null||t.equals(e));return r},uniq:function(e){var t=r.uniq(e,false,function(e){return""+e});return t},getSubstitute:function(e,t){var r=t(e);if(!r){r=e}return r},pushVar:function(e,t){if(t.isVariable()){var r=false;e.forEach(function(e){r=r||t.equals(e)});if(!r){e.push(t)}}return e},getLang:function(e){var t=e&&e.isLiteral()?e.getLiteralLanguage():null;return t},getUri:function(e){var t=e&&e.isUri()?e.getUri():null;return t},toPrettyString:function(e,t){var r;if(e==null){r=null}else if(e.isUri()){var i=e.getUri();if(t){r=t.shortForm(i);if(r===i){r=n.extractLabel(i)}}else{r=n.extractLabel(i)}}else{r=""+this.getValue(e)}return r},getValue:function(e){var t;if(e==null){t=null}else if(e.isUri()){t=e.getUri()}else if(e.isBlank()){t=e.toString()}else if(e.isLiteral()){var r=e.getLiteralValue();t=r instanceof i?r.getLexicalValue():r}else{throw new Error("Unknow node type: ",e)}return t},toTalisRdfJson:function(e){var t;if(e==null){t=null}else if(e.isUri()){t={type:"uri",value:e.getUri()}}else if(e.isBlank()){t={type:"bnode",value:e.toString()}}else if(e.isLiteral()){t={type:"literal",value:e.getLiteralLexicalForm(),datatype:e.getLiteralDatatypeUri(),lang:e.getLiteralLanguage()}}else{t={type:"unknown"}}return t}};module.exports=a},{"../util/UriUtils":385,"./rdf_datatype/TypedValue":125,lodash:499}],101:[function(e,module,t){var r=e("lodash.foreach");var n=e("../ext/Class");var i=e("../util/CurieUtils");var a=e("../util/PrefixUtils");var s=e("./GraphUtils");var o=function(e,t){if(t===""){return true}if(e==null||t==null){return false}e=String(e);t=String(t);return e.length>=t.length&&e.slice(0,t.length)===t};var c=function(e){return typeof e==="function"};var u=function(e,t){var r;for(r in t){if(hasOwnProperty.call(t,r)){e[r]=t[r]}}return e};var l=n.create({initialize:function(e){this.prefixes=e?e:{}},expandPrefix:function(e){var t=a.parseCurie(e);var r;if(t==null){r=e}else{var n=this.prefixes[t.key];r=n?n+t.val:e}return r},getNsPrefixMap:function(){return this.prefixes},getNsPrefixURI:function(e){return this.prefixes[e]},getNsURIPrefix:function(e){var t=null;var n=null;var i=function(r,i){if(o(e,r)){if(!n||r.length>n.length){t=i;n=r}}};var a=this.prefixes;while(a!=null){r(a,i);a=Object.getPrototypeOf(a)}return t},qnameFor:function(){},removeNsPrefix:function(e){delete this.prefixes[e]},samePrefixMappingAs:function(){throw new Error("Not implemented yet - Sorry")},setNsPrefix:function(e,t){this.prefixes[e]=t;return this},setNsPrefixes:function(e){var t=c(e.getNsPrefixMap)?e.getNsPrefixMap():e;for(var r in t){if(t.hasOwnProperty(r)){var n=t[r];this.setNsPrefix(r,n)}}return this},shortForm:function(e){var t=this.getNsURIPrefix(e);var r;if(t){var n=this.prefixes[t];var a=e.substring(n.length);var s=i.isValidSparqlLocalName(a);r=s?t+":"+a:e}else{r=e}return r},addPrefix:function(e,t){this.prefixes[e]=t},addJson:function(e){u(this.prefixes,e)},getJson:function(){return this.prefixes},toString:function(){var e=a.prefixObjectToString(this.prefixes);return e},retainByGraph:function(e){var t=this;var r={};var n=s.extractUris(e);n.forEach(function(e){var n=t.getNsURIPrefix(e);if(n!=null){r[n]=t.getNsPrefixURI(n)}});var i=new l(r);return i}});module.exports=l},{"../ext/Class":2,"../util/CurieUtils":372,"../util/PrefixUtils":377,"./GraphUtils":97,"lodash.foreach":482}],102:[function(e,module,t){var r=e("../ext/Class");var n=e("./NodeUtils");var i=r.create({classLabel:"jassa.rdf.Triple",initialize:function(e,t,r){this.subject=e;this.predicate=t;this.object=r},equals:function(e){var t=this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object);return t},hashCode:function(){if(this.hash==null){this.hash=this.subject.hashCode()+3*this.predicate.hashCode()+7*this.object.hashCode()}return this.hash},toString:function(){return this.subject+" "+this.predicate+" "+this.object},copySubstitute:function(e){var t=new i(n.getSubstitute(this.subject,e),n.getSubstitute(this.predicate,e),n.getSubstitute(this.object,e));return t},getSubject:function(){return this.subject},getPredicate:function(){return this.predicate},getObject:function(){return this.object},getVarsMentioned:function(){var e=[];n.pushVar(e,this.subject);n.pushVar(e,this.predicate);n.pushVar(e,this.object);return e},toArray:function(){var e=[this.subject,this.predicate,this.object];return e}});module.exports=i},{"../ext/Class":2,"./NodeUtils":100}],103:[function(e,module,t){var r=e("lodash.uniq");var n=e("./NodeUtils");var i={uniqTriples:function(e){var t=r(e,false,function(e){return e.toString()});return t},matches:function(e,t){var r=e.toArray();var i=t.toArray();var a=true;for(var s=0;s<3;++s){var o=r[s];var c=i[s];var u=n.matches(o,c);if(!u){a=false;break}}return a},getNodeAt:function(e,t){if(e==null){t=null}var r;switch(t){case 0:r=e.getSubject();break;case 1:r=e.getPredicate();break;case 2:r=e.getObject();break;default:r=null}return r}};module.exports=i},{"./NodeUtils":100,"lodash.uniq":496}],104:[function(e,module,t){var r=e("../ext/Class");var n=e("./rdf_datatype/DefaultRdfDatatypes");var i=e("./rdf_datatype/BaseDatatype");var a={enableSilentAcceptanceOfUnknownDatatypes:true};var s=null;var o=r.create({classLabel:"jassa.rdf.TypeMapper",initialize:function(e){this.uriToDt=e},getSafeTypeByName:function(e){var t=this.uriToDt;var r=t[e];if(r==null){if(e==null){return null}else{if(a.enableSilentAcceptanceOfUnknownDatatypes){r=new i(e);this.registerDatatype(r)}else{console.log("Attempted to created typed literal using an unknown datatype - "+e);throw new Error("Bailing out")}}}return r},registerDatatype:function(e){var t=e.getUri();this.uriToDt[t]=e}});o.staticInstance=null;o.getInstance=function(){if(o.staticInstance==null){o.staticInstance=new o(n)}return o.staticInstance};module.exports=o},{"../ext/Class":2,"./rdf_datatype/BaseDatatype":120,"./rdf_datatype/DefaultRdfDatatypes":121}],105:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({classLabel:"DatatypeLabel",parse:function(){throw new Error("Not implemented")},unparse:function(){throw new Error("Not implemented")}});module.exports=n},{"../../ext/Class":2}],106:[function(e,module,t){var r=e("../../ext/Class");var n=e("./DatatypeLabel");var i=r.create(n,{classLabel:"jassa.rdf.DatatypeLabelDate",parse:function(e){var t=!e?null:new Date(e);return t},unparse:function(e){var t=!e?null:e.toString();return t}});module.exports=i},{"../../ext/Class":2,"./DatatypeLabel":105}],107:[function(e,module,t){var r=e("../../ext/Class");var n=e("./DatatypeLabel");var i=r.create(n,{classLabel:"jassa.rdf.DatatypeLabelFloat",parse:function(e){return parseFloat(e)},unparse:function(e){return e.toString()}});module.exports=i},{"../../ext/Class":2,"./DatatypeLabel":105}],108:[function(e,module,t){var r=e("../../ext/Class");var n=e("./DatatypeLabel");var i=r.create(n,{classLabel:"jassa.rdf.DatatypeLabelInteger",parse:function(e){return parseInt(e,10)},unparse:function(e){return e.toString()}});module.exports=i},{"../../ext/Class":2,"./DatatypeLabel":105}],109:[function(e,module,t){var r=e("../../ext/Class");var n=e("./DatatypeLabel");var i=r.create(n,{classLabel:"jassa.rdf.DatatypeLabelString",parse:function(e){return e},unparse:function(e){return e.toString()}});module.exports=i},{"../../ext/Class":2,"./DatatypeLabel":105}],110:[function(e,module,t){var r=e("./DatatypeLabelInteger");var n=e("./DatatypeLabelFloat");var i=e("./DatatypeLabelString");var a=e("./DatatypeLabelDate");var s={xinteger:new r,xfloat:new n,xdouble:new n,xstring:new i,date:new a,dateTime:new a,decimal:new n};module.exports=s},{"./DatatypeLabelDate":106,"./DatatypeLabelFloat":107,"./DatatypeLabelInteger":108,"./DatatypeLabelString":109}],111:[function(e,module,t){"use strict";var r={AnonId:e("./AnonId"),AnonIdStr:e("./AnonIdStr"),GraphImpl:e("./GraphImpl"),GraphUtils:e("./GraphUtils"),LiteralLabel:e("./LiteralLabel"),NodeFactory:e("./NodeFactory"),NodeUtils:e("./NodeUtils"),PrefixMappingImpl:e("./PrefixMappingImpl"),Triple:e("./Triple"),TripleUtils:e("./TripleUtils"),TypeMapper:e("./TypeMapper"),DatatypeLabel:e("./datatype/DatatypeLabel"),DatatypeLabelDate:e("./datatype/DatatypeLabelDate"),DatatypeLabelFloat:e("./datatype/DatatypeLabelFloat"),DatatypeLabelInteger:e("./datatype/DatatypeLabelInteger"),DatatypeLabelString:e("./datatype/DatatypeLabelString"),DefaultDatatypeLabels:e("./datatype/DefaultDatatypeLabels"),Node:e("./node/Node"),Node_Blank:e("./node/Node_Blank"),Node_Concrete:e("./node/Node_Concrete"),Node_Fluid:e("./node/Node_Fluid"),Node_Literal:e("./node/Node_Literal"),Node_Uri:e("./node/Node_Uri"),Node_Variable:e("./node/Node_Variable"),Var:e("./node/Var"),BaseDatatype:e("./rdf_datatype/BaseDatatype"),DefaultRdfDatatypes:e("./rdf_datatype/DefaultRdfDatatypes"),RdfDatatype:e("./rdf_datatype/RdfDatatype"),RdfDatatypeBase:e("./rdf_datatype/RdfDatatypeBase"),RdfDatatypeLabel:e("./rdf_datatype/RdfDatatypeLabel"),TypedValue:e("./rdf_datatype/TypedValue"),Coordinate:e("./talis/Coordinate"),GraphTalis:e("./talis/GraphTalis"),TalisRdfJsonUtils:e("./talis/TalisRdfJsonUtils")};module.exports=r},{"./AnonId":94,"./AnonIdStr":95,"./GraphImpl":96,"./GraphUtils":97,"./LiteralLabel":98,"./NodeFactory":99,"./NodeUtils":100,"./PrefixMappingImpl":101,"./Triple":102,"./TripleUtils":103,"./TypeMapper":104,"./datatype/DatatypeLabel":105,"./datatype/DatatypeLabelDate":106,"./datatype/DatatypeLabelFloat":107,"./datatype/DatatypeLabelInteger":108,"./datatype/DatatypeLabelString":109,"./datatype/DefaultDatatypeLabels":110,"./node/Node":112,"./node/Node_Blank":113,"./node/Node_Concrete":114,"./node/Node_Fluid":115,"./node/Node_Literal":116,"./node/Node_Uri":117,"./node/Node_Variable":118,"./node/Var":119,"./rdf_datatype/BaseDatatype":120,"./rdf_datatype/DefaultRdfDatatypes":121,"./rdf_datatype/RdfDatatype":122,"./rdf_datatype/RdfDatatypeBase":123,"./rdf_datatype/RdfDatatypeLabel":124,"./rdf_datatype/TypedValue":125,"./talis/Coordinate":126,"./talis/GraphTalis":127,"./talis/TalisRdfJsonUtils":128}],112:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({classLabel:"Node",getUri:function(){throw new Error("not a URI node")},getName:function(){throw new Error("is not a variable node")},getBlankNodeId:function(){throw new Error("is not a blank node")},getBlankNodeLabel:function(){throw new Error("is not a blank node")},getLiteral:function(){throw new Error("is not a literal node")},getLiteralValue:function(){throw new Error("is not a literal node")},getLiteralLexicalForm:function(){throw new Error("is not a literal node")},getLiteralDatatype:function(){throw new Error("is not a literal node")},getLiteralDatatypeUri:function(){throw new Error("is not a literal node")},isBlank:function(){return false},isUri:function(){return false},isLiteral:function(){return false},isVariable:function(){return false},equals:function(){throw new Error("not overridden")},hashCode:function(){throw new Error("not overridden")}});module.exports=n},{"../../ext/Class":2}],113:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Node_Concrete");var i=e("../../util/ObjectUtils");var a=r.create(n,{classLabel:"jassa.rdf.Node_Blank",initialize:function(e){this.anonId=e},isBlank:function(){return true},getBlankNodeId:function(){return this.anonId},getBlankNodeLabel:function(){return this.anonId.getLabelString()},hashCode:function(){if(this.hash==null){var e=this.anonId.getLabelString();this.hash=i.hashCodeStr(e)}return this.hash},equals:function(e){var t=e!=null&&e.anonId!=null&&e.anonId.getLabelString!=null&&this.anonId.getLabelString()===e.anonId.getLabelString();return t},toString:function(){return"_:"+this.anonId}});module.exports=a},{"../../ext/Class":2,"../../util/ObjectUtils":376,"./Node_Concrete":114}],114:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Node");var i=r.create(n,{classLabel:"jassa.rdf.Node_Concrete",isConcrete:function(){return true}});module.exports=i},{"../../ext/Class":2,"./Node":112}],115:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Node");var i=r.create(n,{classLabel:"jassa.rdf.Node_Fluid",isConcrete:function(){return false}});module.exports=i},{"../../ext/Class":2,"./Node":112}],116:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Node_Concrete");var i=e("../../util/ObjectUtils");var a=r.create(n,{classLabel:"Node_Literal",initialize:function(e){this.literalLabel=e},isLiteral:function(){return true},getLiteral:function(){return this.literalLabel},getLiteralValue:function(){return this.literalLabel.getValue()},getLiteralLexicalForm:function(){return this.literalLabel.getLexicalForm()},getLiteralDatatype:function(){return this.literalLabel.getDatatype()},getLiteralDatatypeUri:function(){var e=this.getLiteralDatatype();var t=e?e.getUri():null;return t},getLiteralLanguage:function(){return this.literalLabel.getLanguage()},hashCode:function(){if(this.hash==null){this.hash=i.hashCodeStr(this.getLiteralLexicalForm())+3*i.hashCodeStr(this.getLiteralDatatypeUri())+7*i.hashCodeStr(this.getLiteralLanguage())}return this.hash},equals:function(e){var t=e!=null&&e.isLiteral!=null&&e.isLiteral()&&this.getLiteralLexicalForm()===e.getLiteralLexicalForm()&&this.getLiteralDatatypeUri()===e.getLiteralDatatypeUri()&&this.getLiteralLanguage()===e.getLiteralLanguage();return t},toString:function(){return this.literalLabel.toString()}});module.exports=a},{"../../ext/Class":2,"../../util/ObjectUtils":376,"./Node_Concrete":114}],117:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Node_Concrete");var i=e("../../util/ObjectUtils");var a=r.create(n,{classLabel:"jassa.rdf.Node_Uri",initialize:function(e){this.uri=e},isUri:function(){return true},getUri:function(){return this.uri},toString:function(){return"<"+this.uri+">"},hashCode:function(){if(this.hash==null){this.hash=i.hashCodeStr(this.uri)}return this.hash},equals:function(e){var t=e!=null&&e.isUri!=null&&e.isUri()&&this.uri===e.uri;return t}});module.exports=a},{"../../ext/Class":2,"../../util/ObjectUtils":376,"./Node_Concrete":114}],118:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Node_Fluid");var i=r.create(n,{classLabel:"jassa.rdf.Node_Variable",isVariable:function(){return true}});module.exports=i},{"../../ext/Class":2,"./Node_Fluid":115}],119:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Node_Variable");var i=e("../../util/ObjectUtils");var a=r.create(n,{classLabel:"Var",initialize:function(e){this.name=e},getName:function(){return this.name},toString:function(){return"?"+this.name},hashCode:function(){if(this.hash==null){this.hash=i.hashCodeStr(this.name)}return this.hash},equals:function(e){var t=e!=null&&e.isVariable!=null&&e.isVariable()&&this.name===e.name;return t}});module.exports=a},{"../../ext/Class":2,"../../util/ObjectUtils":376,"./Node_Variable":118}],120:[function(e,module,t){var r=e("../../ext/Class");var n=e("./RdfDatatype");var i=e("./TypedValue");var a=r.create(n,{classLabel:"jassa.rdf.BaseDatatype",initialize:function(e){this.datatypeUri=e},getUri:function(){return this.datatypeUri},unparse:function(e){var t;if(e instanceof i){t=e.getLexicalValue()}else{t=e.toString()}return t},parse:function(e){return new i(e,this.datatypeUri)},toString:function(){return"Datatype ["+this.datatypeUri+"]"}});module.exports=a},{"../../ext/Class":2,"./RdfDatatype":122,"./TypedValue":125}],121:[function(e,module,t){var r=e("../../vocab/xsd");var n=e("../datatype/DefaultDatatypeLabels");var i=e("./RdfDatatypeLabel");var a={};var s=function(e,t){var r=e.getUri();a[r]=new i(r,t)};s(r.xint,n.xinteger);s(r.xlong,n.xinteger);s(r.xinteger,n.xinteger);s(r.xstring,n.xstring);s(r.xfloat,n.xfloat);s(r.xdouble,n.xdouble);s(r.decimal,n.xfloat);s(r.date,n.date);s(r.dateTime,n.dateTime);module.exports=a},{"../../vocab/xsd":411,"../datatype/DefaultDatatypeLabels":110,"./RdfDatatypeLabel":124}],122:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({classLabel:"RdfDatatype",getUri:function(){throw new Error("Not implemented")},unparse:function(){throw new Error("Not implemented")},parse:function(){throw new Error("Not implemented")}});module.exports=n},{"../../ext/Class":2}],123:[function(e,module,t){var r=e("../../ext/Class");var n=e("./RdfDatatype");var i=r.create(n,{classLabel:"jassa.rdf.RdfDatatypeBase",initialize:function(e){this.uri=e},getUri:function(){return this.uri}});module.exports=i},{"../../ext/Class":2,"./RdfDatatype":122}],124:[function(e,module,t){var r=e("../../ext/Class");var n=e("./RdfDatatypeBase");var i=r.create(n,{classLabel:"jassa.rdf.RdfDatatype_Label",initialize:function($super,e,t){$super(e);this.datatypeLabel=t},parse:function(e){return this.datatypeLabel.parse(e)},unparse:function(e){return this.datatypeLabel.unparse(e)}});module.exports=i},{"../../ext/Class":2,"./RdfDatatypeBase":123}],125:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({classLabel:"jassa.rdf.TypedValue",initialize:function(e,t){this.lexicalValue=e;this.datatypeUri=t},getLexicalValue:function(){return this.lexicalValue},getDatatypeUri:function(){return this.datatypeUri}});module.exports=n},{"../../ext/Class":2}],126:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/ObjectUtils");var i=r.create({initialize:function(e,t,r,n){this.s=e||"";this.p=t||"";this.i=r||0;this.c=n||""},equals:function(e){var t=this.s===e.s&&this.p===e.p&&this.i===e.i&&this.c===e.c;return t},hashCode:function(){if(this.hash==null){this.hash=n.hashCodeStr(this.s)+3*n.hashCodeStr(this.p)+7*this.i+11*n.hashCodeStr(this.c)}return this.hash},toString:function(){var e=this.s+" "+this.p+" "+this.i+" "+this.c;return e}});module.exports=i},{"../../ext/Class":2,"../../util/ObjectUtils":376}],127:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/collection/HashSet");var i=e("../Triple");var a=e("../TripleUtils");var s=e("../../util/ObjectUtils");var o=r.create({initialize:function(e){this.data=e||{}},isEmpty:function(){var e=this.size()===0;return e},equals:function(){throw new Error("Not implemented yet")},hashCode:function(){var e=s.hashCode(this.data);return e},add:function(e){var t=this.triples.add(e);return t},remove:function(e){var t=this.triples.remove(e);return t},removeAll:function(e){this.triples.removeAll(e)},removeMatch:function(e){var t=[];this.triples.forEach(function(r){var n=a.matches(e,r);if(n){t.push(r)}});this.removeAll(t)},forEach:function(e){this.triples.forEach(e)},map:function(e){this.triples.map(e)},contains:function(e){var t=this.triples.contains(e);return t},addAll:function(e){var t=this;e.forEach(function(e){t.add(e)})},clear:function(){this.triples.clear()},toArray:function(){var e=this.triples.entries();return e},size:function(){var e=this.triples.size();return e}});module.exports=o},{"../../ext/Class":2,"../../util/ObjectUtils":376,"../../util/collection/HashSet":390,"../Triple":102,"../TripleUtils":103}],128:[function(e,module,t){var r=e("./Coordinate");var n=e("../NodeUtils");var i=e("../../util/ArrayUtils");var a={addTripleJson:function(e,t){},removeTripleJson:function(e){},add:function(e,t,r){},remove:function(e,t,r){},merge:function(e,t){},tripleToJson:function(e){var t=e.getSubject();var r=t.isUri()?t.getUri():""+t;var i=e.getPredicate().getUri();var a=e.getObject();var s=n.toTalisRdfJson(a);var o={s:r,p:i,o:s};return o},getObjectsAt:function(e,t){var r=t?e[t.s]:null;var n=r?r[t.p]:null;return n},getObjectAt:function(e,t){var r=this.getObjectsAt(e,t);var n=r?r[t.i]:null;return n},getOrCreateObjectAt:function(e,t,r){var n=e[t.s]=e[t.s]||{};var i=n[t.p]=n[t.p]||[];var a=i[t.i]=i[t.i]||r||{};return a},removeValueAt:function(e,t){var r=e[t.s];var n=r?r[t.p]:null;var a=n?n[t.i]:null;if(a){delete a[t.c];if(Object.keys(a).length===0){delete n[t.i];i.compactTrailingNulls(n);if(n.length===0){delete r[t.p];if(Object.keys(r).length===0){delete e[t.s]}}}}},setValueAt:function(e,t,r){if(t!=null){var n=this.getOrCreateObjectAt(e,t);n[t.c]=r}},getValueAt:function(e,t){var r=this.getObjectAt(e,t);var n=r?r[t.c]:null;return n},renameSubject:function(e,t,r){this.renameKey(e,t,r)},renamePredicate:function(e,t,r,n){var i=e[t];if(i){this.renameKey(i,r,n)}},deleteSubject:function(e,t){delete e[t]},deletePredicate:function(e,t,r){var n=e[t];if(n){delete n[r]}},renameKey:function(e,t,r){if(t in e){var n=e[t];delete e[t];e[r]=n}}};module.exports=a},{"../../util/ArrayUtils":368,"../NodeUtils":100,"./Coordinate":126}],129:[function(e,module,t){var r=e("lodash.defaults");var n={unwrapSingleItem:function(e){var t=e?e.length>1?e:e[0]||null:null;return t},createSparqlUpdateAjaxSpec:function(e,t,i,a,s,o){var c={update:e,"using-graph-uri":n.unwrapSingleItem(i),"using-named-graph-uri":n.unwrapSingleItem(a)};var u={url:t,type:"POST",dataType:"json",crossDomain:true,traditional:true,data:c};r(c,s);r(u,o);return u},createSparqlRequestAjaxSpec:function(e,t,i,a,s){var o=n.unwrapSingleItem(t.getDefaultGraphUris());var c=n.unwrapSingleItem(t.getNamedGraphUris());var u={query:i,"default-graph-uri":o,"named-graph-uri":c};var l={url:e,dataType:"json",crossDomain:true,traditional:true,data:u};r(u,a);r(l,s);return l}};module.exports=n},{"lodash.defaults":478}],130:[function(e,module,t){var r=e("../ext/Class");var n=e("../sparql/ExprUtils");var i=r.create({initialize:function(e,t){this.sparqlService=e;this.element=t},lookupByIterator:function(e){var t=[];while(e.hasNext()){var r=e.nextBinding();var i=n.bindingToExprs(r);var a=i.join(", ");t.push({binding:r,exprs:i,exprsKey:a})}}});module.exports=i},{"../ext/Class":2,"../sparql/ExprUtils":237}],131:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t,r){this.concept=e;this.limit=t;this.offset=r},getConcept:function(){return this.concept},setConcept:function(e){this.concept=e},getLimit:function(){return this.limit},setLimit:function(e){this.limit=e},getOffset:function(){return this.offset},setOffset:function(e){this.offset=e}});module.exports=n},{"../ext/Class":2}],132:[function(e,module,t){var r=e("../sparql/ConceptUtils");var n=e("./list_service/ListServiceSparqlQuery");var i={createTargetListService:function(e,t,i){var a=r.createTargetConcept(t,i);var s=r.createQueryList(a);var o=new n(e,s,a.getVar());return o}};module.exports=i},{"../sparql/ConceptUtils":229,"./list_service/ListServiceSparqlQuery":165}],133:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e){this.ls=e},create:function(){return this.ls},filter:function(){},transform:function(){}});n.from=function(e){var t=new n(e);return t};module.exports=n},{"../ext/Class":2}],134:[function(e,module,t){var r=e("../util/collection/HashMap");var n=e("../util/shared");var i=n.Promise;var a=e("../util/PromiseUtils");var s={lookup:function(e,t){var r;if(!e||!t){r=i.resolve([])}else{r=e.lookup(t)}return r},zip:function(e,t){var n=a.all(t).then(function(){var t=new r;for(var n=0;n<e.length;++n){var i=e[n];var a=arguments[n];t.put(i,a)}return t});return n},unmapKeys:function(e,t,n){var i=new r;e.forEach(function(e){var r=t(e);var a=n.get(r);i.put(e,a)});return i},fetchItemsMapped:function(e,t,r){var n=t.map(r);var i=e.fetchItems(n).then(function(e){var n=s.unmapKeys(t,r,e);return n});return i},fetchCountsMapped:function(e,t,r){var n=t.map(r);var i=e.fetchCounts(n).then(function(e){var n=s.unmapKeys(t,r,e);return n});return i}};module.exports=s},{"../util/PromiseUtils":378,"../util/collection/HashMap":389,"../util/shared":403}],135:[function(e,module,t){var r={computeRange:function(e,t,r){var n=t||0;var i=n%r;n-=i;var a=e;var s=null;if(a){s=a;var o=a%r;var c=o?r-o:0;a+=c}var u={limit:a,offset:n,subLimit:s,subOffset:i};return u}};module.exports=r},{}],136:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.query=e;var r=e.getOffset();var n=e.getLimit();this.nextOffset=r||0;this.nextRemaining=n==null?null:n;this.pageSize=t},getPageSize:function(){return this.pageSize},next:function(){var e=this.nextOffset===0?null:this.nextOffset;this.query.setOffset(e);if(this.nextRemaining==null){this.query.setLimit(this.pageSize);this.nextOffset+=this.pageSize}else{var t=Math.min(this.pageSize,this.nextRemaining);this.nextOffset+=t;this.nextRemaining-=t;if(t===0){return null}this.query.setLimit(t)}return this.query}});module.exports=n},{"../ext/Class":2}],137:[function(e,module,t){var r=e("../ext/Class");var n=e("./cache/CacheSimple");var i=r.create({initialize:function(e,t){this.executionCache=e?e:{};this.resultCache=t?t:new n},getExecutionCache:function(){return this.executionCache},getResultCache:function(){return this.resultCache}});module.exports=i},{"../ext/Class":2,"./cache/CacheSimple":145}],138:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.varNames=e||[];this.bindings=t||[]},getVarNames:function(){return this.varNames},getBindings:function(){return this.bindings},toString:function(){return"ResultSetPart: vars="+this.varNames+", bindings="+this.bindings}});module.exports=n},{"../ext/Class":2}],139:[function(e,module,t){var r=e("../util/collection/HashMap");var n=e("../util/collection/IteratorArray");var i=e("../sparql/VarUtils");var a=e("./result_set/ResultSetArrayIteratorBinding");var s=e("./ResultSetPart");var o=e("../sparql/Binding");var c=e("../rdf/Triple");var u=e("../rdf/GraphImpl");var l={jsonToResultSet:function(e){var t=e.head.vars;var r=e.results.bindings;var i=r.map(function(e){var t=o.fromTalisJson(e);return t});var s=new n(i);var c=new a(s,t);return c},partition:function(e,t){var n=e.getVarNames();var i=new r;while(e.hasNext()){var a=e.next();var o=a.get(t);var c=i.get(o);if(c==null){c=new s(n);i.put(o,c)}c.getBindings().push(a)}return i},createResultSetFromBindings:function(e,t){var r=new n(e);var i=new a(r,t);return i},createEmptyResultSet:function(e){var t=e.getProjectVars();var r=i.getVarNames(t);var n=this.createResultSetFromBindings([],r);return n},resultSetToGraph:function(e,t,r,n){var i=e.getBindings();var a=this.bindingsToGraph(i,t,r,n);return a},bindingsToGraph:function(e,t,r,n){var i=new u;e.forEach(function(e){var a=new c(e.get(t),e.get(r),e.get(n));i.add(a)});return i}};module.exports=l},{"../rdf/GraphImpl":96,"../rdf/Triple":102,"../sparql/Binding":225,"../sparql/VarUtils":256,"../util/collection/HashMap":389,"../util/collection/IteratorArray":393,"./ResultSetPart":138,"./result_set/ResultSetArrayIteratorBinding":200}],140:[function(e,module,t){var r=e("lodash.union");var n=e("../util/shared");var i=n.Promise;var a=e("./result_set/ResultSetArrayIteratorBinding");var s=e("../util/ArrayUtils");var o=e("../util/collection/IteratorArray");var c=e("../sparql/expr/ExprVar");var u=e("../sparql/element/ElementFilter");var l=e("../sparql/expr/E_OneOf");var f=e("../sparql/element/ElementSubQuery");var v=e("../sparql/VarUtils");var p=e("../sparql/Binding");var h=e("../sparql/ConceptUtils");var d=e("../sparql/ElementUtils");var g=e("../sparql/QueryUtils");var m=e("./ResultSetUtils");var y=e("../util/PromiseUtils");var x={constrainQueryVar:function(e,t,r){var n=new c(t);var i=this.constrainQueryExprVar(e,n,r);return i},constrainQueryExprVar:function(e,t,r){var n=e.clone();var i=new u(new l(t,r));n.getElements().push(i);return n},chunkQuery:function(e,t,r,n){var i=s.chunk(r,n);var a=new c(t);var o=this;var u=i.map(function(){var t=o.constrainQueryExprVar(e,a,r);return t});return u},mergeResultSets:function(e){var t=[];var n=[];e.forEach(function(e){var i=e.getVarNames();n=r(n,i);var a=e.getIterator().getArray();t.push.apply(t,a)});var i=new o(t);var s=new a(i,n);return s},execSelectForNodes:function(e,t,r,n,i){var a=this.chunkQuery(t,r,n,i);var s=a.map(function(t){var r=e.createQueryExecution(t);var n=r.execSelect();return n});var o=y.all(s);var c=this;var u=o.then(function(){var e=c.mergeResultSets(arguments);return e});return u},consumeResultSet:function(e){while(e.hasNext()){e.nextBinding()}},resultSetToList:function(e,t){var r=[];while(e.hasNext()){var n=e.nextBinding();var i=n.get(t);r.push(i)}return r},resultSetToInt:function(e,t){var r=null;if(e.hasNext()){var n=e.nextBinding();var i=n.get(t);r=i.getLiteralValue()}return r},fetchList:function(e,t){var r=this;var n=e.execSelect().then(function(e){var n=r.resultSetToList(e,t);return n});return n},fetchInt:function(e,t,r){var n=e.createQueryExecution(t);var i=this.fetchIntQe(n,r);return i},fetchIntQe:function(e,t){var r=this;var n=e.execSelect().then(function(e){var n=r.resultSetToInt(e,t);return n});return n},fetchCountConcept:i.method(function(e,t,r,n){var i=h.freshVar(t);var a=r==null?null:r+1;var s=n==null?null:n+1;var o=h.createQueryCount(t,i,a,s);return x.fetchInt(e,o,i).then(function(e){var t=n!=null?null:r!=null?e>r:false;var i={hasMoreItems:t,count:t?r:e,itemLimit:r,rowLimit:n};return i})}),fetchCountRows:function(e,t,r){var n=d.freshVar(t,"c")
;var i=d.createQueryCountRows(t,n,r+1);var a=this.fetchInt(e,i,n).then(function(e){var t={count:Math.min(e,r),hasMoreItems:e>r,rowLimit:r};return t});return a},fetchCountQuery:i.method(function(e,t,r,n){var i=[new f(t)];var a=t.getVarsMentioned();var s=v.createVarGen("c",a);var o=s.next();var c=g.createQueryCount(i,null,null,o,null,null,null);var u=e.createQueryExecution(c);u.setTimeout(r);return x.fetchIntQe(u,o).then(function(e){return{count:e,limit:null,hasMoreItems:false}}).caught(function(){var t=g.createQueryCount(i,n+1,null,o,null,null,null);var r=e.createQueryExecution(t);return x.fetchIntQe(r,o).then(function(e){return{count:e,limit:n,hasMoreItems:e>n}})})}),fetchItemsConcept:function(e,t,r,n){var i=h.createQueryList(t,r,n);var a=e.createQueryExecution(i);var s=a.execSelect().then(function(e){var r=x.resultSetToList(e,t.getVar());return r});return s},execDescribeViaSelect:function(e,t){var r=g.createQueryDescribeViaSelect(t,v.s,v.p,v.o);var n=e.createQueryExecution(r);var i=n.execSelect().then(function(e){var t=m.resultSetToGraph(e,v.s,v.p,v.o);return t});return i}};module.exports=x},{"../sparql/Binding":225,"../sparql/ConceptUtils":229,"../sparql/ElementUtils":233,"../sparql/QueryUtils":249,"../sparql/VarUtils":256,"../sparql/element/ElementFilter":261,"../sparql/element/ElementSubQuery":266,"../sparql/expr/E_OneOf":291,"../sparql/expr/ExprVar":303,"../util/ArrayUtils":368,"../util/PromiseUtils":378,"../util/collection/IteratorArray":393,"../util/shared":403,"./ResultSetUtils":139,"./result_set/ResultSetArrayIteratorBinding":200,"lodash.union":495}],141:[function(e,module,t){var r=e("../ext/Class");var n=e("./sparql_service/SparqlServiceHttp");var i=e("./sparql_service/SparqlServicePaginate");var a=e("./sparql_service/SparqlServicePageExpand");var s=e("./sparql_service/SparqlServiceCache");var o=e("./sparql_service/SparqlServiceVirtFix");var c=e("./sparql_service/SparqlServiceLimit");var u=e("./sparql_service/SparqlServiceConsoleLog");var l=r.create({initialize:function(e){this.sparqlService=e},create:function(){return this.sparqlService},log:function(){this.sparqlService=new u(this.sparqlService);return this},paginate:function(e){this.sparqlService=new i(this.sparqlService,e);return this},pageExpand:function(e){this.sparqlService=new a(this.sparqlService,e);return this},cache:function(e){this.sparqlService=new s(this.sparqlService,e);return this},virtFix:function(){this.sparqlService=new o(this.sparqlService);return this},limit:function(e){this.sparqlService=new c(this.sparqlService,e);return this}});l.from=function(e){var t=new l(e);return t};l.http=function(e,t,r,i){var a=new n(e,t,r,i);var s=l.from(a);return s};module.exports=l},{"../ext/Class":2,"./sparql_service/SparqlServiceCache":204,"./sparql_service/SparqlServiceConsoleLog":205,"./sparql_service/SparqlServiceHttp":210,"./sparql_service/SparqlServiceLimit":211,"./sparql_service/SparqlServicePageExpand":212,"./sparql_service/SparqlServicePaginate":213,"./sparql_service/SparqlServiceVirtFix":215}],142:[function(e,module,t){var r=e("lodash.uniq");var n=e("lodash.foreach");var i=e("../sparql/VarUtils");var a=e("./ServiceUtils");var s=e("../util/collection/IteratorArray");var o=e("./result_set/ResultSetArrayIteratorBinding");var c=e("../util/shared");var u=c.Promise;var l={bindingToJsMap:function(e,t){var r={};e.forEach(function(e){var n=e.getName();r[n]=t.get(e)});return r},createNgGridOptionsFromQuery:function(e){if(!e){return[]}var t=e.getProjectVars();var r=i.getVarNames(t);var n=r.map(function(e){var t={field:e,displayName:e};return t});return n},fetchCount:function(e,t,r,n){var i;if(!e||!t){i=new u(function(e){e(0)})}else{t=t.clone();t.setLimit(null);t.setOffset(null);i=a.fetchCountQuery(e,t,r,n)}return i},fetchData:function(e,t,r,n){if(!e||!t){var i=new s([]);var a=[];var c=new o(i,a);return new u(function(e){e(c)})}t=t.clone();t.setLimit(r);t.setOffset(n);var f=e.createQueryExecution(t);var v=f.execSelect().then(function(e){var r=[];var n=t.getProjectVars();while(e.hasNext()){var i=e.next();var a=l.bindingToJsMap(n,i);r.push(a)}return r});return v},collectNodes:function(e){var t=[];e.forEach(function(e){n(e,function(e){if(e!=null){t.push(e)}else{console.log("should not happen")}})});t=r(t,false,function(e){return e.toString()});return t},fetchSchemaTableConfigFacet:function(e,t){var r=e.getPaths();var n=t.lookup(r);var i=n.then(function(t){var n=r.map(function(r){var n={field:e.getColumnId(r),displayName:t.get(r),path:r};return n});var i={colDefs:n};return i});return i},transformToNodeLabels:function(e,t){var r=this.collectNodes(t);var i=e.lookup(r);var a=i.then(function(e){var r=t.map(function(t){var r={};n(t,function(t,n){var i=e.get(t);r[n]={node:t,displayLabel:i?i.displayLabel:"(no label)"}});return r});return r});return a}};module.exports=l},{"../sparql/VarUtils":256,"../util/collection/IteratorArray":393,"../util/shared":403,"./ServiceUtils":140,"./result_set/ResultSetArrayIteratorBinding":200,"lodash.foreach":482,"lodash.uniq":496}],143:[function(e,module,t){var r=e("../sparql/QuadUtils");var n=e("../sparql/update/UpdateDataInsert");var i=e("../sparql/update/UpdateDataDelete");var a=e("../util/PromiseUtils");var s={performUpdate:function(e,t,r,n){var i=[];var o;var c=s.createDeleteRequest(t.removed,r,n);if(c){o=e.createUpdateExecution(c).execUpdate();i.push(o)}var u=s.createInsertRequest(t.added,r,n);if(u){o=e.createUpdateExecution(u).execUpdate();i.push(o)}var l=a.all(i);return l},createInsertRequest:function(e,t,i){var a;if(e&&!e.isEmpty()){var s=r.triplesToQuads(e,t);a=""+new n(s)}else{a=null}return a},createDeleteRequest:function(e,t,n){var a;if(e&&!e.isEmpty()){var s=r.triplesToQuads(e,t);a=""+new i(s)}else{a=null}return a}};module.exports=s},{"../sparql/QuadUtils":246,"../sparql/update/UpdateDataDelete":316,"../sparql/update/UpdateDataInsert":317,"../util/PromiseUtils":378}],144:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({getItem:function(e){throw new Error("not implemented")},setItem:function(e,t){throw new Error("not implemented")}});module.exports=n},{"../../ext/Class":2}],145:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Cache");var i=e("../../util/ObjectUtils");var a=r.create(n,{initialize:function(e){this.data=e||{}},getItem:function(e){var t=this.data[e];return t},setItem:function(e,t){this.data[e]=t},clear:function(){i.clear(this.data)}});module.exports=a},{"../../ext/Class":2,"../../util/ObjectUtils":376,"./Cache":144}],146:[function(e,module,t){var r=e("lodash.foreach");var n=e("../../ext/Class");var i=e("../../util/ObjectUtils");var a=e("../../util/collection/HashMap");var s=e("./CacheSimple");var o=n.create({initialize:function(){this.serviceToGraphsToCache={}},getCache:function(e,t){var r=this.serviceToGraphsToCache[e];if(!r){r=new a;this.serviceToGraphsToCache[e]=r}var n=r.get(t);if(!n){n=new s;r.put(t,n)}var i=n;return i},invalidate:function(e,t,n){if(!e){r(this.serviceToGraphsToCache,function(e){e.entries().forEach(function(e){var t=e.val;t.clear()})})}else{if(!t){var i=this.serviceToGraphsToCache[e];if(i){i.entries().forEach(function(e){var t=e.val;t.clear()})}}else{var a=this.serviceToGraphsToCache[e];if(a){a.clear()}}}}});module.exports=o},{"../../ext/Class":2,"../../util/ObjectUtils":376,"../../util/collection/HashMap":389,"./CacheSimple":145,"lodash.foreach":482}],147:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e){this.v=e;this.orders=[];this.restrictions=[];this.subCriteria=[]},createCriteria:function(e,t,r){var i=new n;this.subCriteria.push({property:e})},add:function(e){},getVar:function(){return this.v},addOrder:function(e){this.orders.push(e)},toSparqlString:function(){},createListService:function(){}});module.exports=n},{"../../ext/Class":2}],148:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.property=e;this._isAscending=t},isAscending:function(){return this._isAscending}});module.exports=n},{"../../ext/Class":2}],149:[function(e,module,t){var r={gt:function(e,t){}};module.exports=r},{}],150:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e){}});module.exports=n},{"../../ext/Class":2}],151:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({fetchData:function(e){throw new Error("Not implemented")}});module.exports=n},{"../../ext/Class":2}],152:[function(e,module,t){var r=e("../../ext/Class");var n=e("./DataService");var i=e("../../util/shared");var a=i.Promise;var s=r.create(n,{initialize:function(e){this.data=e||[]},fetchData:function(e){var t=a.resolve(this.data);return t}});module.exports=s},{"../../ext/Class":2,"../../util/shared":403,"./DataService":151}],153:[function(e,module,t){var r=e("../../ext/Class");var n=e("./DataService");var i=r.create(n,{initialize:function(e,t){this.delegate=e;this.filterFn=t||function(){return true}},fetchData:function(e){var t=this;return this.delegate.fetchData(e).then(function(e){return e.filter(t.filterFn)})},setFilter:function(e){this.filter=e}});module.exports=i},{"../../ext/Class":2,"./DataService":151}],154:[function(e,module,t){var r=e("../../ext/Class");var n=e("./DataService");var i=r.create(n,{initialize:function(e,t){this.delegate=e;this.transformFn=t},fetchData:function(e){var t=this;return this.delegate.fetchData(e).then(function(e){var r=e.map(t.transformFn);return r})}});module.exports=i},{"../../ext/Class":2,"./DataService":151}],155:[function(e,module,t){"use strict";var r={AjaxUtils:e("./AjaxUtils"),BindingLookup:e("./BindingLookup"),ListFilter:e("./ListFilter"),LookupServiceBuilder:e("./LookupServiceBuilder"),LookupServiceUtils:e("./LookupServiceUtils"),PageExpandUtils:e("./PageExpandUtils"),QueryPaginator:e("./QueryPaginator"),RequestCache:e("./RequestCache"),ResultSetPart:e("./ResultSetPart"),ResultSetUtils:e("./ResultSetUtils"),ServiceUtils:e("./ServiceUtils"),SparqlServiceBuilder:e("./SparqlServiceBuilder"),TableServiceUtils:e("./TableServiceUtils"),SparqlCacheSupplier:e("./cache/SparqlCacheSupplier"),Cache:e("./cache/Cache"),CacheSimple:e("./cache/CacheSimple"),Criteria:e("./criteria/Criteria"),Order:e("./criteria/Order"),Restrictions:e("./criteria/Restrictions"),ServiceBuilder:e("./criteria/ServiceBuilder"),DataService:e("./data_service/DataService"),DataServiceArray:e("./data_service/DataServiceArray"),DataServiceFilter:e("./data_service/DataServiceFilter"),DataServiceTransformEntry:e("./data_service/DataServiceTransformEntry"),AugmenterLookup:e("./list_service/AugmenterLookup"),ListService:e("./list_service/ListService"),ListServiceArray:e("./list_service/ListServiceArray"),ListServiceAugmenter:e("./list_service/ListServiceAugmenter"),ListServiceConcept:e("./list_service/ListServiceConcept"),ListServiceConceptKeyLookup:e("./list_service/ListServiceConceptKeyLookup"),ListServiceFn:e("./list_service/ListServiceFn"),ListServiceIndexSubString:e("./list_service/ListServiceIndexSubString"),ListServicePageExpand:e("./list_service/ListServicePageExpand"),ListServiceSparqlQuery:e("./list_service/ListServiceSparqlQuery"),ListServiceTransformConcept:e("./list_service/ListServiceTransformConcept"),ListServiceTransformConceptMode:e("./list_service/ListServiceTransformConceptMode"),ListServiceTransformItem:e("./list_service/ListServiceTransformItem"),ListServiceTransformItems:e("./list_service/ListServiceTransformItems"),ListServiceUtils:e("./ListServiceUtils"),LookupService:e("./lookup_service/LookupService"),LookupServiceBase:e("./lookup_service/LookupServiceBase"),LookupServiceCache:e("./lookup_service/LookupServiceCache"),LookupServiceChunker:e("./lookup_service/LookupServiceChunker"),LookupServiceConst:e("./lookup_service/LookupServiceConst"),LookupServiceDelegateBase:e("./lookup_service/LookupServiceDelegateBase"),LookupServiceFn:e("./lookup_service/LookupServiceFn"),LookupServiceGraphSparql:e("./lookup_service/LookupServiceGraphSparql"),LookupServiceIdFilter:e("./lookup_service/LookupServiceIdFilter"),LookupServiceKeyMap:e("./lookup_service/LookupServiceKeyMap"),LookupServiceListServiceSparql:e("./lookup_service/LookupServiceListServiceSparql"),LookupServiceMap:e("./lookup_service/LookupServiceMap"),LookupServiceFallback:e("./lookup_service/LookupServiceFallback"),LookupServiceMulti:e("./lookup_service/LookupServiceMulti"),LookupServiceSparqlQuery:e("./lookup_service/LookupServiceSparqlQuery"),LookupServiceTimeout:e("./lookup_service/LookupServiceTimeout"),LookupServiceTransform:e("./lookup_service/LookupServiceTransform"),LookupServiceTransformKey:e("./lookup_service/LookupServiceTransformKey"),QueryCacheBindingHashSingle:e("./query_cache/QueryCacheBindingHashSingle"),QueryCacheNodeFactory:e("./query_cache/QueryCacheNodeFactory"),QueryCacheNodeFactoryImpl:e("./query_cache/QueryCacheNodeFactoryImpl"),QueryExecution:e("./query_execution/QueryExecution"),QueryExecutionCache:e("./query_execution/QueryExecutionCache"),QueryExecutionDelegate:e("./query_execution/QueryExecutionDelegate"),QueryExecutionFailover:e("./query_execution/QueryExecutionFailover"),QueryExecutionHttp:e("./query_execution/QueryExecutionHttp"),QueryExecutionPageExpand:e("./query_execution/QueryExecutionPageExpand"),QueryExecutionPaginate:e("./query_execution/QueryExecutionPaginate"),UpdateExecutionHttp:e("./query_execution/UpdateExecutionHttp"),ResultSet:e("./result_set/ResultSet"),ResultSetArrayIteratorBinding:e("./result_set/ResultSetArrayIteratorBinding"),ResultSetHashJoin:e("./result_set/ResultSetHashJoin"),SparqlService:e("./sparql_service/SparqlService"),SparqlServiceBaseString:e("./sparql_service/SparqlServiceBaseString"),SparqlServiceCache:e("./sparql_service/SparqlServiceCache"),SparqlServiceConsoleLog:e("./sparql_service/SparqlServiceConsoleLog"),SparqlServiceFactory:e("./sparql_service/SparqlServiceFactory"),SparqlServiceFactoryConst:e("./sparql_service/SparqlServiceFactoryConst"),SparqlServiceFactoryDefault:e("./sparql_service/SparqlServiceFactoryDefault"),SparqlServiceFailover:e("./sparql_service/SparqlServiceFailover"),SparqlServiceHttp:e("./sparql_service/SparqlServiceHttp"),SparqlServiceLimit:e("./sparql_service/SparqlServiceLimit"),SparqlServicePageExpand:e("./sparql_service/SparqlServicePageExpand"),SparqlServicePaginate:e("./sparql_service/SparqlServicePaginate"),SparqlServiceReliableLimit:e("./sparql_service/SparqlServiceReliableLimit"),SparqlServiceVirtFix:e("./sparql_service/SparqlServiceVirtFix"),SparqlUpdateBaseString:e("./sparql_service/SparqlUpdateBaseString"),SparqlUpdateHttp:e("./sparql_service/SparqlUpdateHttp"),TableService:e("./table_service/TableService"),TableServiceDelegateBase:e("./table_service/TableServiceDelegateBase"),TableServiceFacet:e("./table_service/TableServiceFacet"),TableServiceListService:e("./table_service/TableServiceListService"),TableServiceNodeLabels:e("./table_service/TableServiceNodeLabels"),TableServiceQuery:e("./table_service/TableServiceQuery"),UpdateUtils:e("./UpdateUtils")};module.exports=r},{"./AjaxUtils":129,"./BindingLookup":130,"./ListFilter":131,"./ListServiceUtils":132,"./LookupServiceBuilder":133,"./LookupServiceUtils":134,"./PageExpandUtils":135,"./QueryPaginator":136,"./RequestCache":137,"./ResultSetPart":138,"./ResultSetUtils":139,"./ServiceUtils":140,"./SparqlServiceBuilder":141,"./TableServiceUtils":142,"./UpdateUtils":143,"./cache/Cache":144,"./cache/CacheSimple":145,"./cache/SparqlCacheSupplier":146,"./criteria/Criteria":147,"./criteria/Order":148,"./criteria/Restrictions":149,"./criteria/ServiceBuilder":150,"./data_service/DataService":151,"./data_service/DataServiceArray":152,"./data_service/DataServiceFilter":153,"./data_service/DataServiceTransformEntry":154,"./list_service/AugmenterLookup":156,"./list_service/ListService":157,"./list_service/ListServiceArray":158,"./list_service/ListServiceAugmenter":159,"./list_service/ListServiceConcept":160,"./list_service/ListServiceConceptKeyLookup":161,"./list_service/ListServiceFn":162,"./list_service/ListServiceIndexSubString":163,"./list_service/ListServicePageExpand":164,"./list_service/ListServiceSparqlQuery":165,"./list_service/ListServiceTransformConcept":166,"./list_service/ListServiceTransformConceptMode":167,"./list_service/ListServiceTransformItem":168,"./list_service/ListServiceTransformItems":169,"./lookup_service/LookupService":170,"./lookup_service/LookupServiceBase":171,"./lookup_service/LookupServiceCache":172,"./lookup_service/LookupServiceChunker":173,"./lookup_service/LookupServiceConst":174,"./lookup_service/LookupServiceDelegateBase":175,"./lookup_service/LookupServiceFallback":176,"./lookup_service/LookupServiceFn":177,"./lookup_service/LookupServiceGraphSparql":178,"./lookup_service/LookupServiceIdFilter":179,"./lookup_service/LookupServiceKeyMap":180,"./lookup_service/LookupServiceListServiceSparql":181,"./lookup_service/LookupServiceMap":182,"./lookup_service/LookupServiceMulti":183,"./lookup_service/LookupServiceSparqlQuery":184,"./lookup_service/LookupServiceTimeout":185,"./lookup_service/LookupServiceTransform":186,"./lookup_service/LookupServiceTransformKey":187,"./query_cache/QueryCacheBindingHashSingle":188,"./query_cache/QueryCacheNodeFactory":189,"./query_cache/QueryCacheNodeFactoryImpl":190,"./query_execution/QueryExecution":191,"./query_execution/QueryExecutionCache":192,"./query_execution/QueryExecutionDelegate":193,"./query_execution/QueryExecutionFailover":194,"./query_execution/QueryExecutionHttp":195,"./query_execution/QueryExecutionPageExpand":196,"./query_execution/QueryExecutionPaginate":197,"./query_execution/UpdateExecutionHttp":198,"./result_set/ResultSet":199,"./result_set/ResultSetArrayIteratorBinding":200,"./result_set/ResultSetHashJoin":201,"./sparql_service/SparqlService":202,"./sparql_service/SparqlServiceBaseString":203,"./sparql_service/SparqlServiceCache":204,"./sparql_service/SparqlServiceConsoleLog":205,"./sparql_service/SparqlServiceFactory":206,"./sparql_service/SparqlServiceFactoryConst":207,"./sparql_service/SparqlServiceFactoryDefault":208,"./sparql_service/SparqlServiceFailover":209,"./sparql_service/SparqlServiceHttp":210,"./sparql_service/SparqlServiceLimit":211,"./sparql_service/SparqlServicePageExpand":212,"./sparql_service/SparqlServicePaginate":213,"./sparql_service/SparqlServiceReliableLimit":214,"./sparql_service/SparqlServiceVirtFix":215,"./sparql_service/SparqlUpdateBaseString":216,"./sparql_service/SparqlUpdateHttp":217,"./table_service/TableService":218,"./table_service/TableServiceDelegateBase":219,"./table_service/TableServiceFacet":220,"./table_service/TableServiceListService":221,"./table_service/TableServiceNodeLabels":222,"./table_service/TableServiceQuery":223}],156:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/ObjectUtils");var i=r.create({initialize:function(e,t,r){this.lookupService=e;this.itemToKeyFn=t||function(e){return e.key};this.mergeFn=r||function(e,t){var r=n.extend(e,t);return r}},augment:function(e){var t=e.map(this.itemToKeyFn);var r=this;var n=this.lookupService.lookup(t).then(function(n){for(var i=0;i<t.length;++i){var a=t[i];var s=e[i];var o=n.get(a);e[i]=r.mergeFn(s,o)}return e});return n}});module.exports=i},{"../../ext/Class":2,"../../util/ObjectUtils":376}],157:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({fetchItems:function(e,t,r){throw new Error("Not implemented")},fetchCount:function(e,t,r){throw new Error("Not implemented")}});module.exports=n},{"../../ext/Class":2}],158:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ServiceUtils");var i=e("./ListService");var a=e("../../util/shared");var s=a.Promise;var o=r.create(i,{initialize:function(e,t){this.items=e;this.fnFilterSupplier=t},fetchItems:function(e,t,r){var n=this.fnFilterSupplier(e);var i=this.items.filter(n);var a=r||0;var o=t?a+t:i.length;var c=i.slice(a,o);return s.resolve(c)},fetchCount:function(e,t,r){var n=this.fnFilterSupplier(e);var i=this.items.filter(n);var a=i.length;var o=t!=null?Math.min(a,t):a;var c={count:o,hasMoreItems:o<a};return s.resolve(c)}});module.exports=o},{"../../ext/Class":2,"../../util/shared":403,"../ServiceUtils":140,"./ListService":157}],159:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ListService");var i=r.create(n,{initialize:function(e,t){this.listService=e;this.augmenter=t},fetchItems:function(e,t,r){var n=this;var i=this.listService.fetchItems(e,t,r).then(function(e){var t=n.augmenter.augment(e);return t});return i},fetchCount:function(e,t,r){var n=this.listService.fetchCount(e,t,r);return n}});module.exports=i},{"../../ext/Class":2,"./ListService":157}],160:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ServiceUtils");var i=e("./ListService");var a=r.create(i,{initialize:function(e){this.sparqlService=e},fetchItems:function(e,t,r){var i=n.fetchItemsConcept(this.sparqlService,e,t,r);return i},fetchCount:function(e,t,r){var i=n.fetchCountConcept(this.sparqlService,e,t,r);return i}});module.exports=a},{"../../ext/Class":2,"../ServiceUtils":140,"./ListService":157}],161:[function(e,module,t){var r=e("lodash.values");var n=e("../../ext/Class");var i=e("./ListService");var a=e("../ServiceUtils");var s=e("../../util/shared");var o=s.Promise;var c=e("../../sparql/ConceptUtils");var u=e("../../util/ObjectUtils");var l=n.create(i,{initialize:function(e,t,r,n,i){this.keyListService=e;this.keyLookupService=t;this.keyFn=r||function(e){return e.key};this.resolveFn=n||function(e,t){u.extend(e.val||e,t);return e};this.isLeftJoin=i==null?true:i},fetchItems:function(e,t,r){var n=this;var i=o.resolve(this.keyListService.fetchItems(e,t,r)).then(function(e){var t=e.map(n.keyFn);return[e,n.keyLookupService.lookup(t)]}).spread(function(e,t){var r=e.map(function(e){var r=n.keyFn(e);var i=t.get(r);var a=n.resolveFn(e,i);return a});return r});return i},fetchCount:o.method(function(e,t,r){var n;if(this.isLeftJoin){n=this.keyListService.fetchCount(e,t,r)}else{var i=this;n=this.keyListService.fetchItems(e,t).then(function(e){var t=e.map(i.keyFn);return i.keyLookupService.lookup(t)}).then(function(e){var r=e.keys();var n=r.length;var i={count:n,hasMoreItems:t==null?false:null};return i})}return n})});module.exports=l},{"../../ext/Class":2,"../../sparql/ConceptUtils":229,"../../util/ObjectUtils":376,"../../util/shared":403,"../ServiceUtils":140,"./ListService":157,"lodash.values":497}],162:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ListService");var i=r.create(n,{initialize:function(e){this.listServiceFn=e},fetchItems:function(e,t,r){var n=this.listServiceFn();var i=n.fetchItems(e,t,r);return i},fetchCount:function(e,t,r){var n=this.listServiceFn();var i=n.fetchCount(e,t,r);return i}});module.exports=i},{"../../ext/Class":2,"./ListService":157}],163:[function(e,module,t){var r=e("../../ext/Class");var n=e("../PageExpandUtils");var i=e("./ListService");var a=r.create(i,{initialize:function(e,t,r,n,i){this.delegate=e;this.filterSupplierFn=t;this.countThreshold=r||1e3;this.itemLimit=n;this.rowLimit=i;this.strToPromise={}},getBestCandKey:function(e){e=e||"";var t=Object.keys(this.strToPromise);var r=this;var n=t.filter(function(t){var r=e.indexOf(t)!==-1;return r});var i=null;var a=null;n.forEach(function(t){var n=r.strToPromise[t];if(n.isFulfilled()){var s=n.value();var o=s?s.length:null;if(o!=null&&(a==null||o<a)){i=t;a=o}}else{if(a==null&&e.indexOf(i)!==-1){i=e}}});return i},filterEntries:function(e,t){var r=this.filterSupplierFn(e);var n=t.filter(r);return n},fetchItems:function(e,t,r){var n=this;var i=this.strToPromise[""];if(i==null||i.isRejected()){i=this.fetchItemsForStr(null)}var a=i.then(function(t){var r=t||e!=null&&n.fetchItemsForStr(e);return r}).then(function(i){var a=r||0;var s=a+(t||i.length);var o=i?n.filterEntries(e,i).slice(a,s):n.delegate.fetchItems(e,t,r);return o});return a},fetchItemsForStr:function(e){var t=this.getBestCandKey(e);var r=t!=null?this.strToPromise[t]:r=this.fetchForStr(e);return r},removeSubsumedStrs:function(e){var t=this;var r=Object.keys(this.strToPromise);r.forEach(function(r){if(e!==r&&r.indexOf(e)!==-1){delete t.strToPromise[r]}})},fetchForStr:function(e){var t=this;if(e===""){e=null}var r=this.delegate.fetchCount(e,this.itemLimit,this.rowLimit).then(function(r){var n=null;if(r.hasMoreItems===false&&r.count<t.countThreshold){n=t.delegate.fetchItems(e).then(function(r){t.removeSubsumedStrs(e);return r})}return n});var n=e||"";this.strToPromise[n]=r;return r},fetchCount:function(e,t,r){var n=this;var i=this.getBestCandKey(e);var a;if(i!=null){var s=this.strToPromise[i];a=s.then(function(i){var a;if(!i){a=n.delegate.fetchCount(e,t,r)}else{var s=n.filterEntries(e,i);a={count:s.length,hasMoreItems:false}}return a})}else{a=this.delegate.fetchCount(e,t,r)}return a}});module.exports=a},{"../../ext/Class":2,"../PageExpandUtils":135,"./ListService":157}],164:[function(e,module,t){var r=e("../../ext/Class");var n=e("../PageExpandUtils");var i=e("./ListService");var a=r.create(i,{initialize:function(e,t){this.listService=e;this.pageSize=t},fetchItems:function(e,t,r){var i=n.computeRange(t,r,this.pageSize);var a=this.listService.fetchItems(e,i.limit,i.offset);var s=a.then(function(e){var t=i.subLimit?i.subOffset+i.subLimit:e.length;var r=e.slice(i.subOffset,t);return r});return s},fetchCount:function(e,t,r){var n=this.listService.fetchCount(e,t,r);return n}});module.exports=a},{"../../ext/Class":2,"../PageExpandUtils":135,"./ListService":157}],165:[function(e,module,t){var r=e("../../ext/Class");var n=e("lodash.values");var i=e("../../util/shared");var a=i.Promise;var s=e("../../sparql/Concept");var o=e("../../sparql/ConceptUtils");var c=e("../ServiceUtils");var u=e("../ResultSetUtils");var l=e("./ListService");var f=e("../../sparql/element/ElementSubQuery");var v=r.create(l,{initialize:function(e,t,r,n,i){if(t.getLimit()||t.getOffset()){throw new Error("Limit and offset in attribute queries not yet supported")}this.sparqlService=e;this.attrQuery=t;this.attrVar=r;this.isLeftJoin=n;this.forceSubQuery=i},fetchItems:function(e,t,r){var i=this.attrVar;if(!e){e=o.createSubjectConcept()}var a=o.createAttrQuery(this.attrQuery,i,this.isLeftJoin,e,t,r,this.forceSubQuery);var s=this.sparqlService.createQueryExecution(a);var c=s.execSelect().then(function(e){var t=u.partition(e,i);var r=t.entries();var a=n(r);return a});return c},fetchCount:function(e,t,r){if(!e){e=o.createSubjectConcept()}var n;if(this.isLeftJoin){var i=o.createAttrQuery(this.attrQuery,this.attrVar,this.isLeftJoin,e,t,null,this.forceSubQuery);n=new s(i.getQueryPattern(),this.attrVar)}else{var a=this.forceSubQuery?new s(new f(this.attrQuery),this.attrVar):new s(this.attrQuery.getQueryPattern(),this.attrVar);n=o.createCombinedConcept(a,e,true,false,false)}var u=c.fetchCountConcept(this.sparqlService,n,t,r);return u}});module.exports=v},{"../../ext/Class":2,"../../sparql/Concept":228,"../../sparql/ConceptUtils":229,"../../sparql/element/ElementSubQuery":266,"../../util/shared":403,"../ResultSetUtils":139,"../ServiceUtils":140,"./ListService":157,"lodash.values":497}],166:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ListService");var i=r.create(n,{initialize:function(e,t){this.listService=e;this.fnTransformConcept=t;if(!t){throw new Error("No transformation function provided")}},fetchItems:function(e,t,r){var n=this.fnTransformConcept(e);var i=this.listService.fetchItems(n,t,r);return i},fetchCount:function(e,t,r){var n=this.fnTransformConcept(e);var i=this.listService.fetchCount(n,t,r);return i}});module.exports=i},{"../../ext/Class":2,"./ListService":157}],167:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ListService");var i=e("../../sparql/search/KeywordSearchUtils");var a={regex:i.createConceptRegexLabelOnly,fulltext:i.createConceptBifContains};var s=r.create({initialize:function(e,t,r){this.listService=e;this.labelRelationFn=t;this.idToFilterFn=r||a},createConcept:function(e){var t;if(e==null||e.searchString==null||e.searchString.trim()===""){t=null}else{var r=this.labelRelationFn();var n=e.mode?e.mode:"default";var i=this.idToFilterFn[n];if(!i){throw new Error('No filter function registered for mode "'+n+'"')}t=i(r,e.searchString)}return t},fetchItems:function(e,t,r){var n=this.createConcept(e);var i=this.listService.fetchItems(n,t,r);return i},fetchCount:function(e,t,r){var n=this.createConcept(e);var i=this.listService.fetchCount(n,t,r);return i}});module.exports=s},{"../../ext/Class":2,"../../sparql/search/KeywordSearchUtils":314,"./ListService":157}],168:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ListService");var i=r.create(n,{initialize:function(e,t){this.listService=e;this.fnTransformItem=t},fetchItems:function(e,t,r){var n=this;var i=this.listService.fetchItems(e,t,r).then(function(e){if(e==null){throw new Error("Should not happen")}var t=e.map(n.fnTransformItem);return t});return i},fetchCount:function(e,t,r){var n=this.listService.fetchCount(e,t,r);return n}});module.exports=i},{"../../ext/Class":2,"./ListService":157}],169:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ListService");var i=e("../../util/shared");var a=i.Promise;var s=r.create(n,{initialize:function(e,t){this.listService=e;this.fnTransformItems=t},fetchItems:function(e,t,r){var n=this;var i=this.listService.fetchItems(e,t,r).then(function(e){var t=n.fnTransformItems(e);return t});return i},fetchCount:function(e,t,r){var n=this.listService.fetchCount(e,t,r);return n}});module.exports=s},{"../../ext/Class":2,"../../util/shared":403,"./ListService":157}],170:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({getIdStr:function(){throw new Error("Not overridden")},lookup:function(e){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],171:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupService");var i=r.create(n,{getIdStr:function(e){var t=e.toString();return t}});module.exports=i},{"../../ext/Class":2,"./LookupService":170}],172:[function(e,module,t){var r=e("../../ext/Class");var n=e("lodash.uniq");var i=e("lodash.find");var a=e("./LookupServiceDelegateBase");var s=e("../RequestCache");var o=e("../../util/collection/HashMap");var c=e("../../util/PromiseUtils");var u=r.create(a,{initialize:function($super,e,t){$super(e);this.requestCache=t||new s},lookup:function(e){var t=this;var r=n(e,false,function(e){var r=t.getIdStr(e);return r});var a=new o;var s=this.requestCache.getResultCache();var u=this.requestCache.getExecutionCache();var l=[];var f=[];var v=[];r.forEach(function(e){var r=t.getIdStr(e);var n=s.getItem(r);if(!n){var o=u[r];if(o){f.push(e);var c=i(v,function(e){var t=e===o;return t});if(!c){v.push(o)}}else{l.push(e);f.push(e)}}else{a.put(e,n)}});if(l.length>0){var p=this.fetchAndCache(l);v.push(p)}var h=c.all(v).then(function(e){f.forEach(function(t){var r=null;i(e,function(e){r=e.get(t);return Boolean(r)});if(r){a.put(t,r)}});return a});return h},fetchAndCache:function(e){var t=this.requestCache.getResultCache();var r=this.requestCache.getExecutionCache();var n=this;var i=this.delegate.lookup(e);var a=i.then(function(i){var a=new o;e.forEach(function(e){var r=n.getIdStr(e);var s=i.get(e);t.setItem(r,s);a.put(e,s)});e.forEach(function(e){var t=n.getIdStr(e);delete r[t]});return a});e.forEach(function(e){var t=n.getIdStr(e);r[t]=a});return a}});module.exports=u},{"../../ext/Class":2,"../../util/PromiseUtils":378,"../../util/collection/HashMap":389,"../RequestCache":137,"./LookupServiceDelegateBase":175,"lodash.find":480,"lodash.uniq":496}],173:[function(e,module,t){var r=e("../../ext/Class");var n=e("lodash.uniq");var i=e("../../util/ArrayUtils");var a=e("../../util/collection/HashMap");var s=e("./LookupServiceDelegateBase");var o=e("../../util/PromiseUtils");var c=r.create(s,{initialize:function($super,e,t){$super(e);this.maxChunkSize=t},lookup:function(e){var t=this;var r=n(e,false,function(e){var r=t.getIdStr(e);return r});var s=i.chunk(r,this.maxChunkSize);var c=s.map(function(e){var r=t.delegate.lookup(e);return r});var u=o.all(c).then(function(e){var t=new a;e.forEach(function(e){t.putMap(e)});return t})
;return u}});module.exports=c},{"../../ext/Class":2,"../../util/ArrayUtils":368,"../../util/PromiseUtils":378,"../../util/collection/HashMap":389,"./LookupServiceDelegateBase":175,"lodash.uniq":496}],174:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceBase");var i=e("../../util/collection/HashMap");var a=e("../../util/shared");var s=a.Promise;var o=r.create(n,{initialize:function(e){this.data=e},lookup:function(e){var t=new i;var r=this;e.forEach(function(e){t.put(e,r.data)});var n=s.resolve(t);return n}});module.exports=o},{"../../ext/Class":2,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupServiceBase":171}],175:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupService");var i=r.create(n,{initialize:function(e){this.delegate=e},getIdStr:function(e){var t=this.delegate.getIdStr(e);return t}});module.exports=i},{"../../ext/Class":2,"./LookupService":170}],176:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceBase");var i=e("../../util/collection/HashMap");var a=e("../../util/shared");var s=a.Promise;var o=r.create(n,{initialize:function(e,t,r,n){this.primaryLookupService=e;this.fallbackLookupService=t;this.acceptFn=r||function(e,t){return e!=null};this.resolveFn=n||function(e,t,r){return e}},lookup:function(e){var t=this;var r=this.primaryLookupService.lookup(e).then(function(r){var n=e.filter(function(e){var n=r.get(e);var i=t.acceptFn(n,e);return i});var a=t.fallbackLookupService.lookup(n).then(function(e){var a=new i;a.putEntries(r.entries());var s=e.entries();n.forEach(function(n){var i=r.get(n);var s=e.get(n);var o=t.resolveFn(s,i,n);a.put(n,o)});return a});return a});return r}});module.exports=o},{"../../ext/Class":2,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupServiceBase":171}],177:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceBase");var i=e("../../util/collection/HashMap");var a=e("../../util/shared");var s=a.Promise;var o=r.create(n,{initialize:function(e){this.fn=e},lookup:s.method(function(e){var t=new i;var r=this;e.forEach(function(e){var n=r.fn(e);if(typeof n!=="undefined"){t.put(e,n)}});return t})});module.exports=o},{"../../ext/Class":2,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupServiceBase":171}],178:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceBase");var i=e("../ServiceUtils");var a=e("../../util/collection/HashMap");var s=e("../../rdf/GraphImpl");var o=e("../../rdf/GraphUtils");var c=r.create(n,{initialize:function(e){this.sparqlService=e},lookup:function(e){var t=i.execDescribeViaSelect(this.sparqlService,e);var r=t.then(function(t){var r=new a;e.forEach(function(e){r.put(e,new s)});o.indexBySubject(t,r);return r});return r}});module.exports=c},{"../../ext/Class":2,"../../rdf/GraphImpl":96,"../../rdf/GraphUtils":97,"../../util/collection/HashMap":389,"../ServiceUtils":140,"./LookupServiceBase":171}],179:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceDelegateBase");var i=r.create(n,{initialize:function($super,e,t){$super(e);this.predicateFn=t},lookup:function(e){var t=e.filter(this.predicateFn);var r=this.delegate.lookup(t);return r}});module.exports=i},{"../../ext/Class":2,"./LookupServiceDelegateBase":175}],180:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupService");var i=e("../../util/ObjectUtils");var a=e("../../util/collection/HashMap");var s=e("../../util/shared");var o=s.Promise;var c=r.create(n,{initialize:function(e){this.fnTransformKey=e||i.identity},lookup:function(e){var t=new a;var r=this;e.forEach(function(e){var n=r.fnTransformKey(e);t.put(e,n)});return o.resolve(t)}});module.exports=c},{"../../ext/Class":2,"../../util/ObjectUtils":376,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupService":170}],181:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/shared");var i=n.Promise;var a=e("../../util/collection/HashMap");var s=e("../../sparql/Concept");var o=e("../../sparql/VarUtils");var c=e("../../sparql/expr/ExprVar");var u=e("../../sparql/expr/E_OneOf");var l=e("../../sparql/element/ElementFilter");var f=e("./LookupServiceBase");var v=r.create(f,{initialize:function(e){this.listService=e},lookup:function(e){var t=o.s;var r=new l(new u(new c(t),e));var n=new s(r,t);var i=this.listService.fetchItems(n).then(function(e){var t=new a;t.putEntries(e);return t});return i}});module.exports=v},{"../../ext/Class":2,"../../sparql/Concept":228,"../../sparql/VarUtils":256,"../../sparql/element/ElementFilter":261,"../../sparql/expr/E_OneOf":291,"../../sparql/expr/ExprVar":303,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupServiceBase":171}],182:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceBase");var i=e("../../util/collection/HashMap");var a=e("../../util/shared");var s=a.Promise;var o=r.create(n,{initialize:function(e){this.map=e},lookup:s.method(function(e){var t=new i;var r=this;e.forEach(function(e){var n=r.map.get(e);t.put(e,n)});return t})});module.exports=o},{"../../ext/Class":2,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupServiceBase":171}],183:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupService");var i=e("../../util/collection/HashMap");var a=e("../../util/shared");var s=a.Promise;var o=r.create(n,{initialize:function(e){this.attrToLookupService=e},lookup:function(e){var t=this;var r={};var n=Object.keys(this.attrToLookupService);n.forEach(function(n){var i=t.attrToLookupService[n];if(i){r[n]=i.lookup(e)}else{r[n]=null}});var a=s.props(r).then(function(t){var r=new i;e.forEach(function(e){var i={};n.forEach(function(r){var n=t[r];var a=n?n.get(e):null;i[r]=a});r.put(e,i)});return r});return a}});module.exports=o},{"../../ext/Class":2,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupService":170}],184:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/shared");var i=n.Promise;var a=e("../../util/collection/HashMap");var s=e("../../sparql/expr/ExprVar");var o=e("../../sparql/expr/E_OneOf");var c=e("../../sparql/element/ElementFilter");var u=e("../../sparql/element/ElementGroup");var l=e("../ResultSetUtils");var f=e("./LookupServiceBase");var v=r.create(f,{initialize:function(e,t,r){this.sparqlService=e;this.query=t;this.v=r},lookup:function(e){var t=e.some(function(e){var t=e==null;return t});if(t){throw new Error("Lookup requests must not include null values as it most likely indicates a problem")}var r=this.v;var n;if(e.length===0){n=i.resolve(new a)}else{var f=this.query.clone();var v=new c(new o(new s(r),e));var p=new u([f.getQueryPattern(),v]);f.setQueryPattern(p);var h=this.sparqlService.createQueryExecution(f);n=h.execSelect().then(function(e){var t=l.partition(e,r);return t})}return n}});module.exports=v},{"../../ext/Class":2,"../../sparql/element/ElementFilter":261,"../../sparql/element/ElementGroup":262,"../../sparql/expr/E_OneOf":291,"../../sparql/expr/ExprVar":303,"../../util/collection/HashMap":389,"../../util/shared":403,"../ResultSetUtils":139,"./LookupServiceBase":171}],185:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceDelegateBase");var i=e("../../util/collection/HashMap");var a=e("../../util/shared");var s=a.Promise;var o=function(){var e;var t;var r=new s(function(){e=arguments[0];t=arguments[1]});return{resolve:e,reject:t,promise:r}};var c=r.create(n,{initialize:function($super,e,t,r){$super(e);this.delayInMs=t;this.maxRefreshCount=r||0;this.idStrToId={};this.currentDeferred=null;this.currentPromise=null;this.currentTimer=null;this.currentRefreshCount=0},getIdStr:function(e){var t=this.delegate.getIdStr(e);return t},lookup:function(e){if(!this.currentDeferred){this.currentDeferred=o();this.currentPromise=this.currentDeferred.promise()}var t=this;e.forEach(function(e){var r=t.getIdStr(e);var n=t.idStrToId[r];if(!n){t.idStrToId[r]=e}});if(!this.currentTimer){this.startTimer()}var r=this.currentPromise.then(function(t){var r=new i;e.forEach(function(e){var n=t.get(e);r.put(e,n)});return r});return r},startTimer:function(){var e=this;var t=this.currentRefreshCount;var r=e.currentDeferred;this.currentTimer=setTimeout(function(){if(e.maxRefreshCount<0||t<e.maxRefreshCount){++e.currentRefreshCount;e.startTimer();return}var n=[];for(var i in e.idStrToId){n.push(e.idStrToId[i])}e.idStrToId={};e.currentRefreshCount=0;e.currentDeferred=null;e.currentTimer=null;e.delegate.lookup(n).then(function(e){r.resolve(e)})},this.delayInMs)}});module.exports=c},{"../../ext/Class":2,"../../util/collection/HashMap":389,"../../util/shared":403,"./LookupServiceDelegateBase":175}],186:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceDelegateBase");var i=r.create(n,{initialize:function($super,e,t,r){$super(e);this.fnTransform=t;this.fnNullHandler=r},lookup:function(e){var t=this.fnTransform;var r=this.fnNullHandler;var n=this.delegate.lookup(e).then(function(n){e.forEach(function(e){var i=n.get(e);if(i!=null){var a=t(i,e);n.put(e,a)}else if(r){i=r(e);if(i!=null){n.put(e,i)}}});return n});return n}});module.exports=i},{"../../ext/Class":2,"./LookupServiceDelegateBase":175}],187:[function(e,module,t){var r=e("../../ext/Class");var n=e("./LookupServiceDelegateBase");var i=e("../../util/collection/HashMap");var a=r.create(n,{initialize:function($super,e,t){$super(e);this.fnKey=t},lookup:function(e){var t=this;var r=new i;e.forEach(function(e){var n=t.fnKey(e);r.put(n,e)});var n=r.keys();var a=this.delegate.lookup(n).then(function(e){var t=new i;e.entries().forEach(function(e){var n=r.get(e.key);t.put(n,e.val)});return t});return a}});module.exports=a},{"../../ext/Class":2,"../../util/collection/HashMap":389,"./LookupServiceDelegateBase":175}],188:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../sparql/ExprEvaluatorImpl");var i=e("../../util/collection/IteratorArray");var a=e("../result_set/ResultSetArrayIteratorBinding");var s=e("../../sparql/expr/E_OneOf");var o=e("../../sparql/element/ElementFilter");var c=e("../../util/shared");var u=c.Promise;var l=e("../../util/PromiseUtils");var f=r.create({initialize:function(e,t,r){this.sparqlService=e;this.query=t;this.indexExpr=r;this.maxChunkSize=50;this.exprEvaluator=new n;this.nodeToBindings={};this.nodeMisses={}},fetchResultSet:function(e){var t=this;var r=this.nodeToBindings;var n=this.analyze(e);var s=[];n.cachedNodes.forEach(function(e){var t=r.getItem(e.toString());s.push.apply(s,t)});var o=n.nonCachedChunks.map(function(e){var r=t.fetchChunk(e);return r});var c=l.all(o);var u=this.exprEvaluator;var f=this.indexExpr;return c.then(function(){var e={};for(var t=0;t<arguments.length;++t){var n=arguments[t];while(n.hasNext()){var o=n.nextBinding();s.push(o);var c=u.eval(f,o);var l=c.toString();e[l]=c;var v=r.getItem(l);if(v==null){v=[];r.setItem(l,v)}v.push(o)}}var p=new i(s);var h=new a(p);return h})},fetchChunk:function(e){var t=this.query.clone();var r=new s(this.indexExpr,e);var n=new o([r]);t.getElements().push(n);var i=this.sparqlService.createQueryExecution(t);var a=i.execSelect();return a},analyze:function(e){var t=this.nodeToBindings;var r=[];var n=[];e.forEach(function(e){var i=t.getItem(e.toString());if(i==null){n.push(e)}else{r.push(e)}});var i=this.maxChunkSize;var a=[];for(var s=0;s<n.length;s+=i){var o=e.slice(s,s+i);a.push(o)}var c={cachedNodes:r,nonCachedNodes:n,nonCachedChunks:a,maxChunkSize:i};return c}});module.exports=f},{"../../ext/Class":2,"../../sparql/ExprEvaluatorImpl":235,"../../sparql/element/ElementFilter":261,"../../sparql/expr/E_OneOf":291,"../../util/PromiseUtils":378,"../../util/collection/IteratorArray":393,"../../util/shared":403,"../result_set/ResultSetArrayIteratorBinding":200}],189:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({createQueryCache:function(){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],190:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryCacheNodeFactory");var i=e("./QueryCacheBindingHashSingle");var a=r.create(n,{initialize:function(){this.keyToCache={}},createQueryCache:function(e,t,r){var n="cache:/"+e.getServiceId()+"/"+e.getServiceState()+"/"+t+"/"+r;console.log("cache requested with id: "+n);var a=this.keyToCache.getItem(n);if(a==null){a=new i(e,t,r);this.keyToCache.addItem(n,a)}return a}});module.exports=a},{"../../ext/Class":2,"./QueryCacheBindingHashSingle":188,"./QueryCacheNodeFactory":189}],191:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({execSelect:function(){throw new Error("Not overridden")},execAsk:function(){throw new Error("Not overridden")},execDescribeTriples:function(){throw new Error("Not overridden")},execConstructTriples:function(){throw new Error("Not overridden")},setTimeout:function(){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],192:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryExecution");var i=e("../../util/collection/IteratorArray");var a=e("../result_set/ResultSetArrayIteratorBinding");var s=e("../../util/CacheUtils");var o=r.create(n,{initialize:function(e,t,r){this.queryExecution=e;this.cacheKey=t;this.requestCache=r},createResultSetFromCacheData:function(e){var t=new i(e.bindings);var r=e.varNames;var n=new a(t,r);return n},setTimeout:function(e){this.queryExecution.setTimeout(e)},execSelect:function(){var e=this.cacheKey;var t=this.requestCache;var r=t.getResultCache();var n=t.getExecutionCache();var i=this;var a=s.cacheExecutionAndResult(n,r,e,function(){var e=i.queryExecution.execSelect().then(function(e){var t={bindings:e.getBindings(),varNames:e.getVarNames()};return t});return e});var o=a.then(function(e){var t=i.createResultSetFromCacheData(e);return t});return o}});module.exports=o},{"../../ext/Class":2,"../../util/CacheUtils":369,"../../util/collection/IteratorArray":393,"../result_set/ResultSetArrayIteratorBinding":200,"./QueryExecution":191}],193:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryExecution");var i=r.create(n,{initialize:function(e,t){this.sparqlService=e;this.query=t;this.timeout=null},setTimeout:function(e){this.timeout=e},createQueryExecution:function(e){var t=this.sparqlService.createQueryExecution(e||this.query);t.setTimeout(this.timeout);return t},execSelect:function(){var e=this.createQueryExecution().execSelect(this.query);return e},execAsk:function(){var e=this.createQueryExecution().execAsk(this.query);return e}});module.exports=i},{"../../ext/Class":2,"./QueryExecution":191}],194:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryExecution");var i=e("../QueryPaginator");var a=e("../../util/collection/IteratorArray");var s=e("../result_set/ResultSetArrayIteratorBinding");var o=e("../../util/shared");var c=o.Promise;var u=r.create(n,{initialize:function(e){this.sparqlServices=e;this.timeoutInMillis=null},execSelect:function(){var e=this.sparqlServices.createQueryExecution(this.query);e.setTimeout(this.timeoutInMillis);return e},setTimeout:function(e){this.timeoutInMillis=e}});module.exports=u},{"../../ext/Class":2,"../../util/collection/IteratorArray":393,"../../util/shared":403,"../QueryPaginator":136,"../result_set/ResultSetArrayIteratorBinding":200,"./QueryExecution":191}],195:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryExecution");var i=e("../ResultSetUtils");var a=e("../AjaxUtils");var s=e("../../util/shared");var o=s.ajax;var c=s.Promise;var u=r.create(n,{initialize:function(e,t,r,n,i,a){this.queryString=e;this.serviceUri=t;this.defaultGraphUris=r;this.ajaxOptions=n||{};this.httpArgs=i;this.httpClient=a||o},execSelect:function(){var e=this.execAny().then(function(e){var t;try{t=i.jsonToResultSet(e)}catch(t){console.log("Error processing result set. Response was: ",e);throw t}return t});return e},execAsk:function(){var e=this.execAny().then(function(e){return e.boolean});return e},execConstructTriples:function(){throw new Error("Not implemented yet")},execDescribeTriples:function(){throw new Error("Not implemented yet")},setTimeout:function(e){this.ajaxOptions.timeout=e},getTimeout:function(){return this.ajaxOptions.timeout},execAny:function(){var e=a.createSparqlRequestAjaxSpec(this.serviceUri,this.defaultGraphUris,this.queryString,this.httpArgs,this.ajaxOptions);var t=this.httpClient(e);return t}});module.exports=u},{"../../ext/Class":2,"../../util/shared":403,"../AjaxUtils":129,"../ResultSetUtils":139,"./QueryExecution":191}],196:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryExecutionDelegate");var i=e("../PageExpandUtils");var a=e("../../util/collection/IteratorArray");var s=e("../result_set/ResultSetArrayIteratorBinding");var o=r.create(n,{initialize:function($super,e,t,r){$super(e,t);this.pageSize=r},execSelect:function(){var e=this.query.clone();var t=i.computeRange(e.getLimit(),e.getOffset(),this.pageSize);e.setLimit(t.limit);e.setOffset(t.offset);var r=this.createQueryExecution(e);var n=r.execSelect();var o=n.then(function(e){var r=e.getIterator().getArray();var n=t.subLimit?t.subOffset+t.subLimit:r.length;var i=r.slice(t.subOffset,n);var o=e.getVarNames();var c=new a(i);var u=new s(c,o);return u});return o}});module.exports=o},{"../../ext/Class":2,"../../util/collection/IteratorArray":393,"../PageExpandUtils":135,"../result_set/ResultSetArrayIteratorBinding":200,"./QueryExecutionDelegate":193}],197:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryExecution");var i=e("../QueryPaginator");var a=e("../../util/collection/IteratorArray");var s=e("../result_set/ResultSetArrayIteratorBinding");var o=e("../../util/shared");var c=o.Promise;var u=r.create(n,{initialize:function(e,t,r){this.defaultPageSize=1e3;this.sparqlService=e;this.query=t;this.pageSize=r;this.timeoutInMillis=null},executeSelectRec:c.method(function(e,t){var r=e.next();if(!r){return t}var n=this;var i=this.sparqlService.createQueryExecution(r);i.setTimeout(this.timeoutInMillis);var o=i.execSelect().then(function(i){if(!i){throw new Error("Null result set for query: "+r)}var o;if(!t){o=i}else{var c=t.getIterator().getArray();var u=i.getIterator().getArray();var l=c.concat(u);var f=new a(l);o=new s(f)}var v=i.getIterator().getArray().length;var p=e.getPageSize();var h=v===0||v<p;if(!h){o=n.executeSelectRec(e,o)}return o});return o}),execSelect:function(){var e=this.query.clone();var t=this.pageSize||u.defaultPageSize;var r=new i(e,t);return this.executeSelectRec(r,null)},setTimeout:function(e){this.timeoutInMillis=e;if(!u.timeoutMsgShown){console.log("[WARN] Only preliminary timeout implementation for paginated query execution.");u.timeoutMsgShown=true}}});module.exports=u},{"../../ext/Class":2,"../../util/collection/IteratorArray":393,"../../util/shared":403,"../QueryPaginator":136,"../result_set/ResultSetArrayIteratorBinding":200,"./QueryExecution":191}],198:[function(e,module,t){var r=e("../../ext/Class");var n=e("../AjaxUtils");var i=e("../../util/shared");var a=i.ajax;var s=i.Promise;var o=r.create({initialize:function(e,t,r,n,i,s,o){this.queryString=e;this.serviceUri=t;this.usingGraphUris=r;this.usingNamedGraphUris=n;this.ajaxOptions=i||{};this.httpArgs=s;this.httpClient=o||a},execUpdate:function(){var e=this.execAny();return e},setTimeout:function(e){this.ajaxOptions.timeout=e},getTimeout:function(){return this.ajaxOptions.timeout},execAny:function(){var e=n.createSparqlUpdateAjaxSpec(this.queryString,this.serviceUri,this.usingGraphUris,this.usingNamedGraphUris,this.httpArgs,this.ajaxOptions);var t=this.httpClient(e);return t}});module.exports=o},{"../../ext/Class":2,"../../util/shared":403,"../AjaxUtils":129}],199:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/collection/Iterator");var i=r.create(n,{getVarNames:function(){throw new Error("Override me")}});module.exports=i},{"../../ext/Class":2,"../../util/collection/Iterator":391}],200:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ResultSet");var i=r.create(n,{initialize:function(e,t){this.itBinding=e;this.varNames=t},hasNext:function(){return this.itBinding.hasNext()},next:function(){return this.nextBinding()},nextBinding:function(){return this.itBinding.next()},getVarNames:function(){return this.varNames},getBindings:function(){return this.itBinding.getArray()},getIterator:function(){return this.itBinding}});module.exports=i},{"../../ext/Class":2,"./ResultSet":199}],201:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/collection/IteratorAbstract");var i=r.create(n,{initialize:function(e,t,r,n){this.rsA=e;this.serviceB=t;this.elementB=r;this.expr=n;e.getVarsMentioned();n.getVarsMentioned()},$prefetch:function(){}});module.exports=i},{"../../ext/Class":2,"../../util/collection/IteratorAbstract":392}],202:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({getServiceId:function(){throw new Error("[ERROR] Method not overridden")},getStateHash:function(){throw new Error("[ERROR] Method not overridden")},createQueryExecution:function(e){throw new Error("[ERROR] Method not overridden")}});module.exports=n},{"../../ext/Class":2}],203:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=r.create(n,{createQueryExecution:function(e){var t;if(Object.toString(e)==="[object String]"){t=this.createQueryExecutionStr(e)}else{t=this.createQueryExecutionObj(e)}return t},createQueryExecutionObj:function(e){var t=e.toString();var r=this.createQueryExecutionStr(t);return r},createQueryExecutionStr:function(){throw new Error("Not implemented")}});module.exports=i},{"../../ext/Class":2,"./SparqlService":202}],204:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=e("../RequestCache");var a=e("../query_execution/QueryExecutionCache");var s=r.create(n,{initialize:function(e,t){this.sparqlService=e;this.requestCache=t||new i},getServiceId:function(){return this.sparqlService.getServiceId()},getStateHash:function(){return this.sparqlService.getStateHash()},hashCode:function(){return"cached:"+this.sparqlService.hashCode()},createQueryExecution:function(e){var t=this.sparqlService.getServiceId();var r=this.sparqlService.getStateHash();var n=""+e;var i=t+"-"+r+n;var s=this.sparqlService.createQueryExecution(e);var o=new a(s,i,this.requestCache);return o}});module.exports=s},{"../../ext/Class":2,"../RequestCache":137,"../query_execution/QueryExecutionCache":192,"./SparqlService":202}],205:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=r.create(n,{initialize:function(e){this.sparqlService=e},getServiceId:function(){return this.sparqlService.getServiceId()},getStateHash:function(){return this.sparqlService.getStateHash()},hashCode:function(){return"console-log:"+this.sparqlService.hashCode()},createQueryExecution:function(e){console.log("SparqlServiceConsoleLog saw query: "+e);var t=this.sparqlService.createQueryExecution(e);return t}});module.exports=i},{"../../ext/Class":2,"./SparqlService":202}],206:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({createSparqlService:function(){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],207:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e){this.sparqlService=e},createSparqlService:function(){var e=this.sparqlService;if(e==null){throw new Error("[ERROR] Creation of a SPARQL service requested, but none was provided")}return e},setSparqlService:function(e){this.sparqlService=e}});module.exports=n},{"../../ext/Class":2}],208:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlServiceHttp");var i=e("./SparqlServiceCache");var a=r.create({initialize:function(){this.hashToCache={}},createSparqlService:function(e,t){var r=new n(e,t);r=new i(r);var a=r.getStateHash();var s=this.hashToCache[a];var o;if(s){o=s}else{this.hashToCache[a]=r;o=r}return o}});module.exports=a},{"../../ext/Class":2,"./SparqlServiceCache":204,"./SparqlServiceHttp":210}],209:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=e("../query_execution/QueryExecutionFailover");var a=r.create(n,{initialize:function(e){this.sparqlServices=e},getServiceId:function(){return this.sparqlService.getServiceId()},getStateHash:function(){return this.sparqlService.getStateHash()},hashCode:function(){return"failover:"+this.sparqlService.hashCode()},createQueryExecution:function(e){return new i(this.sparqlServices)}});module.exports=a},{"../../ext/Class":2,"../query_execution/QueryExecutionFailover":194,"./SparqlService":202}],210:[function(e,module,t){var r=e("../../ext/Class");var n=e("lodash.defaults");var i=e("./SparqlServiceBaseString");var a=e("../query_execution/QueryExecutionHttp");var s=e("../../ext/JSONCanonical");var o=e("../../sparql/DatasetDescription");var c=e("lodash");var u=r.create(i,{initialize:function(e,t,r,n,i){var a=t==null?new o:c.isArray(t)?new o(t):t;this.initializeCore(e,a,r,n,i)},initializeCore:function(e,t,r,n,i){this.serviceUri=e;this.datasetDescription=t;this.ajaxOptions=r;this.httpArgs=n;this.httpClient=i},getServiceId:function(){return this.serviceUri},getStateHash:function(){var e=""+this.datasetDescription+s.stringify(this.httpArgs);return e},hashCode:function(){return this.getServiceId()+"/"+this.getStateHash()},getDatasetDescription:function(){return this.datasetDescription},createQueryExecutionStr:function(e){var t=n({},this.ajaxOptions);var r=new a(e,this.serviceUri,this.datasetDescription,t,this.httpArgs,this.httpClient);return r},createQueryExecutionObj:function($super,e){if(true){if(e.flatten){var t=e;e=t.flatten()}}var r=$super(e);return r}});module.exports=u},{"../../ext/Class":2,"../../ext/JSONCanonical":3,"../../sparql/DatasetDescription":230,"../query_execution/QueryExecutionHttp":195,"./SparqlServiceBaseString":203,lodash:499,"lodash.defaults":478}],211:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=r.create(n,{initialize:function(e,t){this.sparqlService=e;this.maxLimit=t},getServiceId:function(){return this.sparqlService.getServiceId()},getStateHash:function(){return this.sparqlService.getStateHash()},hashCode:function(){return"maxLimit:"+this.sparqlService.hashCode()},createQueryExecution:function(e){var t=e.getLimit();if(t==null||t>this.maxLimit){e=e.clone();e.setLimit(this.maxLimit)}var r=this.sparqlService.createQueryExecution(e);return r}});module.exports=i},{"../../ext/Class":2,"./SparqlService":202}],212:[function(e,module,t){var r=e("../../ext/Class");var n=e("../query_execution/QueryExecutionPageExpand");var i=e("./SparqlService");var a=r.create(i,{initialize:function(e,t){this.sparqlService=e;this.pageSize=t},getServiceId:function(){return this.sparqlService.getServiceId()},getStateHash:function(){return this.sparqlService.getStateHash()},hashCode:function(){return"page-expand:"+this.sparqlService.hashCode()},createQueryExecution:function(e){var t=new n(this.sparqlService,e,this.pageSize);return t}});module.exports=a},{"../../ext/Class":2,"../query_execution/QueryExecutionPageExpand":196,"./SparqlService":202}],213:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=e("../query_execution/QueryExecutionPaginate");var a=r.create(n,{initialize:function(e,t){this.defaultPageSize=1e3;this.sparqlService=e;this.pageSize=t},getServiceId:function(){return this.sparqlService.getServiceId()},getStateHash:function(){return this.sparqlService.getStateHash()},hashCode:function(){return"paginate:"+this.sparqlService.hashCode()},createQueryExecution:function(e){var t=new i(this.sparqlService,e,this.pageSize);return t}});module.exports=a},{"../../ext/Class":2,"../query_execution/QueryExecutionPaginate":197,"./SparqlService":202}],214:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=e("../../sparql/element/ElementGroup");var a=r.create({initialize:function(e){},createQueryExecution:function(e){},applyTransform:function(e){var t=e.getQueryPattern();if(t instanceof i){var r=t.getArgs();var n=[];var a=[];r.forEach(function(){})}}});module.exports=a},{"../../ext/Class":2,"../../sparql/element/ElementGroup":262,"./SparqlService":202}],215:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=e("../../sparql/expr/ExprAggregator");var a=e("../../sparql/Query");var s=e("../../sparql/element/ElementSubQuery");var o=r.create(n,{initialize:function(e){this.sparqlService=e},getServiceId:function(){return this.sparqlService.getServiceId()},getStateHash:function(){return this.sparqlService.getStateHash()},hashCode:function(){return"virtfix:"+this.sparqlService.hashCode()},createQueryExecution:function(e){var t=e.getOrderBy();var r=e.getLimit();var n=e.getOffset();var i=n!=null&&r==null;var o=e.getAggregators().length>0;var c=t.length>0&&(r||n)||o;var u=i||c;var l=u?e.clone():e;if(i){r=2e9;l.setLimit(r)}if(c){var f=l;f.setLimit(null);f.setOffset(null);var v=new s(f);l=new a;l.setQueryPattern(v);l.setLimit(r);l.setOffset(n);l.setQueryResultStar(true)}var p=this.sparqlService.createQueryExecution(l);return p}});module.exports=o},{"../../ext/Class":2,"../../sparql/Query":247,"../../sparql/element/ElementSubQuery":266,"../../sparql/expr/ExprAggregator":295,"./SparqlService":202}],216:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SparqlService");var i=r.create(n,{createUpdateExecution:function(e){var t;if(Object.toString(e)==="[object String]"){t=this.createUpdateExecutionStr(e)}else{t=this.createUpdateExecutionObj(e)}return t},createUpdateExecutionObj:function(e){var t=e.toString();var r=this.createUpdateExecutionStr(t);return r},createUpdateExecutionStr:function(){throw new Error("Not implemented")}});module.exports=i},{"../../ext/Class":2,"./SparqlService":202}],217:[function(e,module,t){var r=e("../../ext/Class");var n=e("lodash.defaults");var i=e("./SparqlUpdateBaseString");var a=e("../query_execution/UpdateExecutionHttp");var s=e("../../ext/JSONCanonical");var o=r.create(i,{initialize:function(e,t,r,n,i){this.serviceUri=e;this.usingGraphUris=t;this.usingNamedGraphUris=r;this.ajaxOptions=n;this.httpArgs=i},getServiceId:function(){return this.serviceUri},getStateHash:function(){var e="using:"+s.stringify(this.usingGraphUris);e+="usingNamed:"+s.stringify(this.usingNamedGraphUris);e+=s.stringify(this.httpArgs);return e},hashCode:function(){return this.getServiceId()+"/"+this.getStateHash()},createUpdateExecutionStr:function(e){var t=n({},this.ajaxOptions);var r=new a(e,this.serviceUri,this.usingGraphUris,this.usingNamedGraphUris,t,this.httpArgs);return r}});module.exports=o},{"../../ext/Class":2,"../../ext/JSONCanonical":3,"../query_execution/UpdateExecutionHttp":198,"./SparqlUpdateBaseString":216,"lodash.defaults":478}],218:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({fetchSchema:function(){throw new Error("Override me")},fetchCount:function(e){throw new Error("Override me")},fetchData:function(e,t){throw new Error("Override me")}});module.exports=n},{"../../ext/Class":2}],219:[function(e,module,t){var r=e("../../ext/Class");var n=e("./TableService");var i=r.create(n,{initialize:function(e){this.delegate=e},fetchSchema:function(){var e=this.delegate.fetchSchema();return e},fetchCount:function(){var e=this.delegate.fetchCount();return e},fetchData:function(){var e=this.delegate.fetchData();return e}});module.exports=i},{"../../ext/Class":2,"./TableService":218}],220:[function(e,module,t){var r=e("../../ext/Class");var n=e("./TableServiceNodeLabels");var i=e("../TableServiceUtils");var a=r.create(n,{initialize:function($super,e,t,r,n){$super(e,r);this.tableConfigFacet=t;this.lookupServicePathLabels=n},fetchSchema:function(){var e=i.fetchSchemaTableConfigFacet(this.tableConfigFacet,this.lookupServicePathLabels);return e}});module.exports=a},{"../../ext/Class":2,"../TableServiceUtils":142,"./TableServiceNodeLabels":222}],221:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e){this.listService=e},fetchCount:function(e,t){
this.listService.fetchCount(null,e,t)},fetchData:function(){}});module.exports=n},{"../../ext/Class":2}],222:[function(e,module,t){var r=e("../../ext/Class");var n=e("./TableServiceDelegateBase");var i=e("../TableServiceUtils");var a=r.create(n,{initialize:function($super,e,t){$super(e);this.lookupServiceNodeLabels=t},fetchData:function(e,t){var r=this.delegate.fetchData(e,t);var n=this;var a=r.then(function(e){var t=i.transformToNodeLabels(n.lookupServiceNodeLabels,e);return t});return a}});module.exports=a},{"../../ext/Class":2,"../TableServiceUtils":142,"./TableServiceDelegateBase":219}],223:[function(e,module,t){var r=e("../../ext/Class");var n=e("./TableService");var i=e("../TableServiceUtils");var a=e("../../util/shared");var s=a.Promise;var o=r.create(n,{initialize:function(e,t,r,n){this.sparqlService=e;this.query=t;this.timeoutInMillis=r||3e3;this.secondaryCountLimit=n||1e3},fetchSchema:function(){var e={colDefs:i.createNgGridOptionsFromQuery(this.query)};return new s(function(t){t(e)})},fetchCount:function(){var e=i.fetchCount(this.sparqlService,this.query,this.timeoutInMillis,this.secondaryCountLimit);return e},fetchData:function(e,t){var r=i.fetchData(this.sparqlService,this.query,e,t);return r}});module.exports=o},{"../../ext/Class":2,"../../util/shared":403,"../TableServiceUtils":142,"./TableService":218}],224:[function(e,module,t){var r=e("../ext/Class");var n=e("./VarUtils");var i=e("./LiteralPreference");var a=r.create({initialize:function(e,t,r,a){this.literalPreference=e||new i;this.subjectVar=r||n.x;this.predicateVar=a||n.y;this.objectVar=t||n.z},getLangs:function(){var e=this.literalPreference.getLangs();return e},getPredicates:function(){var e=this.literalPreference.getPredicates();return e},getLiteralPreference:function(){return this.literalPrefence},getSubjectVar:function(){return this.subjectVar},getPredicateVar:function(){return this.predicateVar},getObjectVar:function(){return this.objectVar},toString:function(){var e=["BestLabelConfig",this.langs,this.predicates,this.subjectVar,this.predicateVar,this.objectVar].join(", ");return e}});module.exports=a},{"../ext/Class":2,"./LiteralPreference":242,"./VarUtils":256}],225:[function(e,module,t){var r=e("../rdf/NodeFactory");var n=e("../rdf/node/Var");var i=function(e){this.varNameToEntry=e?e:{}};i.create=function(e){var t={};for(var n in e){var a=e[n];t[n]={v:r.createVar(n),node:a}}var s=new i(t);return s};i.fromTalisJson=function(e){var t={};for(var n in e){var a=e[n];var s=r.createFromTalisRdfJson(a);t[n]=s}var o=i.create(t);return o};i.prototype={put:function(e,t){this.varNameToEntry[e.getName()]={v:e,node:t}},get:function(e){if(!(e instanceof n)){throw new Error("var not an instance of Var")}var t=e.getName();var r=this.varNameToEntry[t];var i=r?r.node:null;return i},entries:function(){var e=[];for(var t in this.varNameToEntry){var r=this.varNameToEntry[t];e.push(r)}var n=e.sort(function(e,t){return e.v.getName()>t.v.getName()?1:-1});return n},toString:function(){var e=this.entries();var t=e.map(function(e){return'"'+e.v.getName()+'": "'+e.node+'"'});var r="{"+t.join(", ")+"}";return r},getVars:function(){var e=[];for(var t in this.varNameToEntry){var r=this.varNameToEntry[t];e.push(r.v)}return e}};module.exports=i},{"../rdf/NodeFactory":99,"../rdf/node/Var":119}],226:[function(e,module,t){var r=e("../vocab/xsd");var n=e("../rdf/NodeFactory");var i=e("./Binding");var a={cloneBinding:function(e){var t=new i;var r=e.entries();r.forEach(function(e){t.put(e.v,e.node)});return t},cloneBindings:function(e){var t=e.map(function(e){var t=a.cloneBinding(e);return t});return t},addRowIds:function(e,t,i){i=i||0;e.forEach(function(e,a){var s=i+a;var o=n.createTypedLiteralFromString(""+s,r.xinteger);e.put(t,o)});return e}};module.exports=a},{"../rdf/NodeFactory":99,"../vocab/xsd":411,"./Binding":225}],227:[function(e,module,t){var r=e("../vocab/rdf");var n=e("../vocab/owl");var i=e("../rdf/Triple");var a=e("../sparql/element/ElementTriplesBlock");var s=e("../sparql/element/ElementFilter");var o=e("../sparql/element/ElementGroup");var c=e("../sparql/expr/E_LogicalOr");var u=e("../sparql/expr/E_Equals");var l=e("../sparql/expr/ExprVar");var f=e("../sparql/Concept");var v=e("../sparql/NodeValueUtils");var p=e("../sparql/VarUtils");var h={createConceptDeclaredProperties:function(e,t){e=e||p.s;t=t||p.o;var h=new l(t);var d=v.makeNode(r.Property);var g=v.makeNode(n.DatatypeProperty);var m=v.makeNode(n.ObjectProperty);var y=v.makeNode(n.AnnotationProperty);var x=new f(new o([new a([new i(e,r.type,t)]),new s(new c(new u(h,d),new c(new u(h,g),new c(new u(h,m),new u(h,y)))))]),e);return x}};module.exports=h},{"../rdf/Triple":102,"../sparql/Concept":228,"../sparql/NodeValueUtils":243,"../sparql/VarUtils":256,"../sparql/element/ElementFilter":261,"../sparql/element/ElementGroup":262,"../sparql/element/ElementTriplesBlock":267,"../sparql/expr/E_Equals":279,"../sparql/expr/E_LogicalOr":289,"../sparql/expr/ExprVar":303,"../vocab/owl":407,"../vocab/rdf":408}],228:[function(e,module,t){var r=e("../ext/Class");var n=e("./ElementUtils");var i=e("./element/ElementGroup");var a=e("./element/ElementTriplesBlock");var s=r.create({classLabel:"jassa.sparql.Concept",initialize:function(e,t){this.element=e;this.variable=t},toJson:function(){var e={element:JSON.parse(JSON.stringify(this.element)),variable:this.variable};return e},getElement:function(){return this.element},getVarsMentioned:function(){var e=this.getElement().getVarsMentioned();return e},hasTriples:function(){var e=this.getElements();var t=n.getElementsDirectTriples(e);var r=t.length>0;return r},getElements:function(){var e;if(this.element instanceof i){e=this.element.elements}else{e=[this.element]}return e},getVar:function(){return this.variable},getVariable:function(){if(!this.warningShown){this.warningShown=true}return this.getVar()},toString:function(){return""+this.element+"; "+this.variable},isSubjectConcept:function(){var e=false;var t=this.variable;var r=this.element;if(r instanceof a){var n=r.triples;if(n.length===1){var i=n[0];var s=i.getSubject();var o=i.getPredicate();var c=i.getObject();e=t.equals(s)&&o.isVariable()&&c.isVariable()}}return e},createOptimizedConcept:function(){var e=this.getElement();var t=e.flatten();var r=new s(t,this.variable);return r},getOptimizedElement:function(){return null}});s.createFromElements=function(e,t){var r;if(e.length==1){r=e[0]}else{r=new i(e)}var n=new s(r,t);return n};module.exports=s},{"../ext/Class":2,"./ElementUtils":233,"./element/ElementGroup":262,"./element/ElementTriplesBlock":267}],229:[function(e,module,t){var r=e("../rdf/node/Node");var n=e("../rdf/NodeFactory");var i=e("../rdf/Triple");var a=e("../util/collection/HashMap");var s=e("./../vocab/rdf");var o=e("./VarUtils");var c=e("./ElementUtils");var u=e("./expr/ExprAggregator");var l=e("./agg/AggCount");var f=e("./expr/ExprVar");var v=e("./expr/E_Equals");var p=e("./element/ElementTriplesBlock");var h=e("./element/ElementOptional");var d=e("./element/ElementSubQuery");var g=e("./element/ElementGroup");var m=e("./element/ElementFilter");var y=e("./QueryUtils");var x=e("./NodeValueUtils");var S=e("./Query");var _=e("./Concept");var w={createTargetConcept:function(e,t){var r;var n=t.getElement().getVarsMentioned();var i=e.getElement().getVarsMentioned();var a=[t.getSourceVar()];var s=[e.getVar()];var o=c.createJoinVarMap(n,i,a,s);var u=c.createRenamedElement(e.getElement(),o);var l=t.getElement();var f=t.getTargetVar();if(e.isSubjectConcept()){if(t.isEmpty()){r=e}else{r=new _(l,f)}}else{var v=new g([u,l]);r=new _(v,f)}return r},createVarMap:function(e,t){var r=e.getElement();var n=t.getElement();var i=r.getVarsMentioned();var a=n.getVarsMentioned();var s=[e.getVar()];var o=[t.getVar()];var u=c.createJoinVarMap(i,a,s,o);return u},createRenamedConcept:function(e,t){var r=this.createVarMap(e,t);var n=e.getVar();var i=t.getElement();var a=c.createRenamedElement(i,r);var s=new _(a,n);return s},renameVars:function(e,t){var r=o.fnSubst(t);var n=r(e.getVar());var i=e.getElement().copySubstitute(r);var a=new _(i,n);return a},createCombinedConcept:function(e,t,r,i,s){var o=e.getVar();var c=t.getVar();if(!c.equals(o)){var u=new a;u.put(c,o);var l=n.createVar("cc_"+o.getName());u.put(o,l);t=this.renameVars(t,u)}var f;if(r){f=this.createRenamedConcept(e,t)}else{f=t}var v=f.getElements();var p=e.getElement();var m;if(v.length>0){if(f.isSubjectConcept()){m=e.getElement()}else{var y=[];if(i){p=new h(e.getElement())}y.push(p);if(s){v=[new d(f.asQuery())]}y.push.apply(y,v);m=new g(y);m=m.flatten()}}else{m=p}var x=new _(m,o);return x},createSubjectConcept:function(e,t,r){e=e||o.s;t=t||o._p_;r=r||o._o_;var n=new p([new i(e,t,r)]);var a=new _(n,e);return a},createTypeConcept:function(e,t){var a=e instanceof r?e:n.createUri(e);var o=!t?n.createVar("s"):t instanceof r?t:n.createVar(t);var c=new _(new p([new i(o,s.type,a)]),o);return c},createQueryList:function(e,t,r){var n=new S;n.setQuerySelectType();n.setDistinct(true);n.setLimit(t);n.setOffset(r);n.getProject().add(e.getVar());n.setQueryPattern(e.getElement());return n},freshVar:function(e,t){t=t||"c";var r=e.getVarsMentioned();var n=o.createVarGen(t,r);var i=n.next();return i},wrapAsSubQuery:function(e,t){var r=new d(e);var n=new S;n.setQuerySelectType();n.getProject().add(t);n.setQueryPattern(r);return n},createQueryCount:function(e,t,r,n){var i=this.createQueryList(e);if(n!=null){i.setDistinct(false);i.setLimit(n);i=this.wrapAsSubQuery(i,e.getVar());i.setDistinct(true)}if(r!=null){i.setLimit(r)}var a=new d(i);var s=new S;s.setQuerySelectType();s.getProject().add(t,new u(null,new l));s.setQueryPattern(a);return s},createQueryRawSize:function(e,t,r,n){var i=e.getVar();var a=e.getElement();var s=new f(i);var o=x.makeNode(t);var c=new m(new v(s,o));var p=new g([a,c]).flatten();if(n!=null){var h=new S;h.setQuerySelectType();h.getProject().add(i);h.setQueryPattern(p);h.setLimit(n);p=new d(h)}var y=new S;y.setQuerySelectType();y.getProject().add(i);y.getProject().add(r,new u(null,new l));y.setQueryPattern(p);y.getGroupBy().push(s);return y},isGroupedOnlyByVar:function(e,t){var r=false;var n=e.getGroupBy().length===1;if(n){var i=e.getGroupBy()[0];if(i instanceof f){var a=i.asVar();r=a.equals(t)}}return r},isDistinctConceptVar:function(e,t){var r=e.isDistinct();var n=e.getProjectVars();var i=!e.isQueryResultStar()&&n&&n.length===1;var a=r&&i&&n[0].equals(t);return a},isConceptQuery:function(e,t){var r=this.isGroupedOnlyByVar(e,t);var n=this.isDistinctConceptVar(e,t);var i=r||n;return i},createAttrQuery:function(e,t,r,n,i,a,s){var o=new _(new d(e),t);var c=w.createRenamedConcept(o,n);var u=this.isConceptQuery(e,t);var l;if(u){l=e.clone();var f;if(s){var v=new S;v.setQuerySelectType();v.setDistinct(true);v.getProject().add(o.getVar());v.setQueryPattern(e.getQueryPattern());var p=new d(v);var m=e.getProject().getRefVars();if(m.length===1&&t.equals(m[0])){f=p}else{f=new g([e.getQueryPattern(),p])}}else{f=e.getQueryPattern()}if(!c.isSubjectConcept()){var y=new g([f,c.getElement()]);y=y.flatten();l.setQueryPattern(y)}l.setLimit(i);l.setOffset(a)}else{var x=i!=null||a!=null;var b;if(x){var C;if(r){C=c}else{var E;if(c.isSubjectConcept()){E=e.getQueryPattern()}else{E=new g([e.getQueryPattern(),c.getElement()])}C=new _(E,t)}var L=w.createQueryList(C,i,a);b=new d(L)}else{b=c.getElement()}var j=e.clone();var U=j.getQueryPattern();var T;if(!x&&(!n||n.isSubjectConcept())){T=U}else{if(r){T=new g([b,new h(U)])}else{T=new g([U,b])}}j.setQueryPattern(T);l=j}return l}};module.exports=w},{"../rdf/NodeFactory":99,"../rdf/Triple":102,"../rdf/node/Node":112,"../util/collection/HashMap":389,"./../vocab/rdf":408,"./Concept":228,"./ElementUtils":233,"./NodeValueUtils":243,"./Query":247,"./QueryUtils":249,"./VarUtils":256,"./agg/AggCount":257,"./element/ElementFilter":261,"./element/ElementGroup":262,"./element/ElementOptional":264,"./element/ElementSubQuery":266,"./element/ElementTriplesBlock":267,"./expr/E_Equals":279,"./expr/ExprAggregator":295,"./expr/ExprVar":303}],230:[function(e,module,t){var r=e("../ext/Class");var n=e("../util/ObjectUtils");var i=e("lodash.uniq");var a=r.create({initialize:function(e,t){this.defaultGraphUris=e||[];this.namedGraphUris=t||[]},getDefaultGraphUris:function(){return this.defaultGraphUris},getNamedGraphUris:function(){return this.namedGraphUris},getUrisMentioned:function(){var e=this.defaultGraphUris.concat(this.namedGraphUris);var t=i(e);return t},hashCode:function(){if(this.hash==null){this.hash=n.hashCode(this)}return this.hash},equals:function(e){var t=n.isEqual(this,e);return t},toString:function(){return"DatasetDescription: "+JSON.stringify(this)}});module.exports=a},{"../ext/Class":2,"../util/ObjectUtils":376,"lodash.uniq":496}],231:[function(e,module,t){},{}],232:[function(e,module,t){var r={joinElements:function(e,t){var r=t.map(function(e){return e.toString()});var n=r.filter(function(e){return e.length!==0});return n.join(e)}};module.exports=r},{}],233:[function(e,module,t){var r=e("lodash.uniq");var n=e("./element/ElementTriplesBlock");var i=e("./element/ElementFilter");var a=e("./element/ElementGroup");var s=e("./element/ElementSubQuery");var o=e("./../rdf/TripleUtils");var c=e("./VarUtils");var u=e("./GenSym");var l=e("./GeneratorBlacklist");var f=e("../util/collection/HashBidiMap");var v=e("../rdf/NodeFactory");var p=e("./Query");var h=e("./expr/ExprAggregator");var d=e("./agg/AggCount");var g={isEmpty:function(e){var t=e==null||e instanceof a&&e.getArgs().length===0;return t},groupIfNeeded:function(e){var t=e.length!=1?new a(e):e[0];return t},createQueryCountRows:function(e,t,r){var n;if(r==null){n=e}else{var i=new p;i.setQuerySelectType();i.setQueryPattern(e);i.setQueryResultStar(true);i.setLimit(r);n=new s(e)}var a=new p;a.setQuerySelectType();a.setQueryPattern(n);a.getProject().add(t,new h(null,new d));return a},createFilterElements:function(e){var t=e.map(function(e){var t=new i(e);return t});return t},createElementsTriplesBlock:function(e){var t=[];if(e.length>0){var r=new n(e);t.push(r)}return t},createDistinctVarMap:function(e,t,r){var n=e.map(c.getVarName);if(r==null){var i=new u("v");r=new l(i,n)}var a=new f;t.forEach(function(e){var t=e.getName();var i;if(n.indexOf(t)!==-1){var s=r.next();i=v.createVar(s)}else{i=e}a.put(e,i)});return a},createJoinVarMap:function(e,t,r,n,i){if(r.length!==n.length){console.log("[ERROR] Cannot join on different number of columns");throw"Bailing out"}var a=g.createDistinctVarMap(e,t,i);for(var s=0;s<r.length;++s){var o=r[s];var c=n[s];a.put(c,o)}return a},createRenamedElement:function(e,t){var r=c.fnSubst(t);var n=e.copySubstitute(r);return n},getElementsDirectTriples:function(e){var t=[];for(var r=0;r<e.length;++r){var i=e[r];if(i instanceof n){t.push.apply(t,i.triples)}}return t},freshVar:function(e,t){var r=this.freshVarGen(e,t);var n=r.next();return n},freshVarGen:function(e,t){t=t||"v";var r=e.getVarsMentioned();var n=c.freshVarGen(t,r);return n}};module.exports=g},{"../rdf/NodeFactory":99,"../util/collection/HashBidiMap":388,"./../rdf/TripleUtils":103,"./GenSym":238,"./GeneratorBlacklist":240,"./Query":247,"./VarUtils":256,"./agg/AggCount":257,"./element/ElementFilter":261,"./element/ElementGroup":262,"./element/ElementSubQuery":266,"./element/ElementTriplesBlock":267,"./expr/ExprAggregator":295,"lodash.uniq":496}],234:[function(e,module,t){var r=e("../ext/Class");var n=r.create({eval:function(){throw new Error("Not overridden")}});module.exports=n},{"../ext/Class":2}],235:[function(e,module,t){var r=e("../ext/Class");var n=e("./expr/NodeValue");var i=e("./NodeValueUtils");var a=e("./ExprEvaluator");var s=r.create(a,{eval:function(e,t){var r;var n;if(e.isVar()){n=e.getExprVar();r=this.evalExprVar(n,t)}else if(e.isFunction()){n=e.getFunction();r=this.evalExprFunction(n,t)}else if(e.isConstant()){n=e.getConstant();r=this.evalConstant(n,t)}else{throw new Error("Unsupported expr type")}return r},evalExprVar:function(e,t){var r=e.asVar();var a=t.get(r);var s;if(a==null){return n.nvNothing}else{s=i.makeNode(a)}return s},evalExprFunction:function(){},evalNodeValue:function(){}});module.exports=s},{"../ext/Class":2,"./ExprEvaluator":234,"./NodeValueUtils":243,"./expr/NodeValue":304}],236:[function(e,module,t){var r={newBinaryExpr:function(e,t){if(t.length!==2){throw new Error("Invalid argument")}var r=t[0];var n=t[1];var i=new e(r,n);return i},newUnaryExpr:function(e,t){if(t.length!==1){throw new Error("Invalid argument")}var r=t[0];var n=new e(r);return n},joinElements:function(e,t){var r=t.map(function(e){return e.toString()});var n=r.filter(function(e){return e.length!==0});return n.join(e)}};module.exports=r},{}],237:[function(e,module,t){var r=e("./expr/ExprVar");var n=e("./expr/NodeValue");var i=e("./NodeValueUtils");var a=e("./expr/E_Equals");var s=e("./expr/E_LogicalAnd");var o=e("./expr/E_LogicalOr");var c={copySubstitute:function(e,t){var r=function(e){var r=null;if(e.isVar()){var n=t.get(e);if(n!=null){r=n}}if(r==null){r=e}return r};var n=e.copySubstitute(r);return n},bindingToExprs:function(e,t){if(t==null){t=e.getVars()}var n=[];t.forEach(function(t){var s=new r(t);var o=e.get(t);var c=i.makeNode(o);var u=new a(s,c);n.push(u)});return n},opify:function(e,t){var r=e;var n=[];while(r.length>1){for(var i=0;i<r.length;i+=2){var a=r[i];if(i+1===r.length){n.push(a);break}var s=r[i+1];var o=t(a,s);n.push(o)}r=n;n=[]}return r[0]},andify:function(e){var t=this.opify(e,function(e,t){return new s(e,t)});return t},orify:function(e){var t=this.opify(e,function(e,t){return new o(e,t)});return t}};module.exports=c},{"./NodeValueUtils":243,"./expr/E_Equals":279,"./expr/E_LogicalAnd":287,"./expr/E_LogicalOr":289,"./expr/ExprVar":303,"./expr/NodeValue":304}],238:[function(e,module,t){var r=e("../ext/Class");var n=e("./Generator");var i=r.create(n,{initialize:function(e,t){this.prefix=e?e:"v";this.nextValue=t?t:0},next:function(){++this.nextValue;var e=this.prefix+"_"+this.nextValue;return e}});i.create=function(e){var t=new i(e,0);return t};module.exports=i},{"../ext/Class":2,"./Generator":239}],239:[function(e,module,t){var r=e("../ext/Class");var n=r.create({next:function(){throw new Error("Override me")}});module.exports=n},{"../ext/Class":2}],240:[function(e,module,t){var r=e("../ext/Class");var n=e("./Generator");var i=r.create(n,{initialize:function(e,t){this.generator=e;this.blacklist=t},next:function(){var e;do{e=this.generator.next()}while(this.blacklist.indexOf(e)!==-1);return e}});module.exports=i},{"../ext/Class":2,"./Generator":239}],241:[function(e,module,t){var r=e("../rdf/Triple");var n=e("../rdf/NodeFactory");var i=e("./NodeValueUtils");var a=e("./expr/ExprVar");var s=e("./expr/E_OneOf");var o=e("./expr/E_LangMatches");var c=e("./expr/E_LogicalOr");var u=e("./expr/E_Lang");var l=e("./expr/E_Bound");var f=e("./expr/E_Regex");var v=e("./expr/E_Str");var p=e("./ExprUtils");var h=e("./Concept");var d=e("./Relation");var g=e("./ConceptUtils");var m=e("./element/ElementTriplesBlock");var y=e("./element/ElementGroup");var x=e("./element/ElementOptional");var S=e("./element/ElementFilter");var _=e("./VarUtils");var w=e("./BestLabelConfig");var b={createRelationLiteralPreference:function(e){var t=new w(e);var r=b.createRelationPrefLabels(t);return r},createRelationPrefLabels:function(e){var t=e.getLangs();var n=e.getPredicates();var c=e.getSubjectVar();var l=e.getPredicateVar();var f=e.getObjectVar();var v=new a(l);var h=new a(f);var g=t.map(function(e){var t=new o(new u(h),i.makeString(e));return t});var x=p.orify(g);var _=new s(v,n);var w=[];w.push(new m([new r(c,l,f)]));w.push(new S(_));w.push(new S(x));var b=new y(w);var C=new d(b,c,f);return C}};module.exports=b},{"../rdf/NodeFactory":99,"../rdf/Triple":102,"./BestLabelConfig":224,"./Concept":228,"./ConceptUtils":229,"./ExprUtils":237,"./NodeValueUtils":243,"./Relation":250,"./VarUtils":256,"./element/ElementFilter":261,"./element/ElementGroup":262,"./element/ElementOptional":264,"./element/ElementTriplesBlock":267,"./expr/E_Bound":277,"./expr/E_Lang":283,"./expr/E_LangMatches":284,"./expr/E_LogicalOr":289,"./expr/E_OneOf":291,"./expr/E_Regex":292,"./expr/E_Str":293,"./expr/ExprVar":303}],242:[function(e,module,t){var r=e("../ext/Class");var n=e("../vocab/rdfs");var i=r.create({initialize:function(e,t,r){this.langs=e||["en",""];this.predicates=t||[n.label];this.predicateFavored=!!r},getLangs:function(){return this.langs},getPredicates:function(){return this.predicates},isPredicateFavored:function(){return this.predicateFavored},toString:function(){var e=["LiteralPreference",this.langs,this.predicates,this.predicateFavored].join(", ");return e}});module.exports=i},{"../ext/Class":2,"../vocab/rdfs":409}],243:[function(e,module,t){var r=e("../rdf/NodeFactory");var n=e("./expr/NodeValue");var i=e("./expr/NodeValueNode");var a=e("../rdf/AnonIdStr");var s=e("../vocab/xsd");var o={nvNothing:new n(r.createAnon(new a("node value nothing"))),nvFalse:new n(r.createTypedLiteralFromValue(false,s.xboolean)),nvTrue:new n(r.createTypedLiteralFromValue(false,s.xboolean)),createLiteral:function(e,t){var n=r.createTypedLiteralFromValue(e,t);var a=new i(n);return a},makeString:function(e){return o.createLiteral(e,s.xstring.getUri())},makeInteger:function(e){return o.createLiteral(e,s.xint.getUri())},makeDecimal:function(e){return o.createLiteral(e,s.decimal.getUri())},makeFloat:function(e){return o.createLiteral(e,s.xfloat.getUri())},makeNode:function(e){var t=new i(e);return t}};module.exports=o},{"../rdf/AnonIdStr":95,"../rdf/NodeFactory":99,"../vocab/xsd":411,"./expr/NodeValue":304,"./expr/NodeValueNode":305}],244:[function(e,module,t){var r=e("lodash.union");var n=function(e){return typeof e==="function"};var i={getVarsMentioned:function(e){var t=e.reduce(function(e,t){var i=t.getVarsMentioned;if(!i||!n(i)){console.log("[ERROR] .getVarsMentioned not found on object ",t)}var a=t.getVarsMentioned();var s=r(e,a);return s},[]);return t}};module.exports=i},{"lodash.union":495}],245:[function(e,module,t){var r=e("../ext/Class");var n=e("../rdf/NodeUtils");var i=e("../rdf/NodeFactory");var a=e("../rdf/Triple");var s=r.create({classLabel:"jassa.sparql.Quad",initialize:function(e,t,r,n){this.graph=e||s.defaultGraphNodeGenerated;this.subject=t;this.predicate=r;this.object=n},asTriple:function(){var e=new a(this.subject,this.predicate,this.object);return e},toString:function(){return this.graph+" "+this.subject+" "+this.predicate+" "+this.object},copySubstitute:function(e){var t=new s(n.getSubstitute(this.graph,e),n.getSubstitute(this.subject,e),n.getSubstitute(this.predicate,e),n.getSubstitute(this.object,e));return t},getGraph:function(){return this.graph},getSubject:function(){return this.subject},getPredicate:function(){return this.predicate},getObject:function(){return this.object},getVarsMentioned:function(){var e=[];n.pushVar(e,this.graph);n.pushVar(e,this.subject);n.pushVar(e,this.predicate);n.pushVar(e,this.object);return e}});s.defaultGraphNodeGenerated=i.createUri("urn:x-arq:DefaultGraphNode");s.defaultGraphIri=i.createUri("urn:x-arq:DefaultGraph");s.unionGraph=i.createUri("urn:x-arq:UnionGraph");s.createFromTriple=function(e,t){e=e||s.defaultGraphNodeGenerated;var r=new s(e,t.subject,t.predicate,t.object);return r};module.exports=s},{"../ext/Class":2,"../rdf/NodeFactory":99,"../rdf/NodeUtils":100,"../rdf/Triple":102}],246:[function(e,module,t){var r=e("../util/collection/HashMap");var n=e("../rdf/Triple");var i=e("./element/ElementGroup");var a=e("./element/ElementTriplesBlock");var s=e("./element/ElementNamedGraph");var o=e("./ElementUtils");var c=e("./Quad");var u={triplesToQuads:function(e,t){var r=e.map(function(e){var r=new c.createFromTriple(t,e);return r});return r},quadsToElement:function(e){var t=this.groupByGraph(e);var r=this.groupToElement(t);return r},groupByGraph:function(e){var t=new r;e.forEach(function(e){var r=e.getGraph();var n=t.getOrCreate(r,[]);n.push(e)});return t},groupToElement:function(e){var t=e.entries();var r=t.map(function(e){var t=e.key;var r=e.val;var n=r.map(function(e){return e.asTriple()});var i=new a(n);var o=t==null||t.equals(c.defaultGraphNodeGenerated)?i:new s(t,i);return o});var n=new i(r);return n}};module.exports=u},{"../rdf/Triple":102,"../util/collection/HashMap":389,"./ElementUtils":233,"./Quad":245,"./element/ElementGroup":262,"./element/ElementNamedGraph":263,"./element/ElementTriplesBlock":267}],247:[function(e,module,t){var r=e("../ext/Class");var n=e("lodash.union");var i=e("../util/ObjectUtils");var a=e("./VarExprList");var s=e("../util/ArrayUtils");var o=e("./ElementHelpers");var c=e("./ElementUtils");var u=e("./QueryType");var l=e("./expr/ExprAggregator");var f=r.create({classLabel:"jassa.sparql.Query",initialize:function(){this.type=0;this.distinct=false;this.reduced=false;this.queryResultStar=false;this.projectVars=new a;this.groupBy=[];this.orderBy=[];this.queryPattern=null;this.constructTemplate=null;this.limit=null;this.offset=null},getAggregators:function(){var e=this.getProject().entries();var t=[];e.forEach(function(e){var r=e.expr;if(r instanceof l){var n=r.getAggregator();t.push(n)}});return t},setQuerySelectType:function(){this.type=0},isQueryResultStar:function(){return this.queryResultStar},setQueryResultStar:function(e){this.queryResultStar=e},getQueryPattern:function(){return this.queryPattern},setQueryPattern:function(e){this.queryPattern=e},getProjectVars:function(){var e=this.projectVars?this.projectVars.getVars():null;return e},setProjectVars:function(e){this.projectVars=e},getProject:function(){return this.projectVars},getGroupBy:function(){return this.groupBy},getOrderBy:function(){return this.orderBy},getLimit:function(){return this.limit},getOffset:function(){return this.offset},toStringOrderBy:function(){var e=this.orderBy&&this.orderBy.length>0?"Order By "+this.orderBy.join(" ")+" ":"";return e},toStringGroupBy:function(){var e=this.groupBy&&this.groupBy.length>0?"Group By "+this.groupBy.join(" ")+" ":"";return e},clone:function(){return this.copySubstitute(i.identity)},flatten:function(){var e=this.clone();e.queryPattern=this.queryPattern?this.queryPattern.flatten():null;return e},getVarsMentioned:function(){if(!f.warnGetVarsMentioned){console.log("[WARN] sparql.Query.getVarsMentioned(): Not implemented properly yet. Things may break!");f.warnGetVarsMentioned=true}var e=this.queryPattern.getVarsMentioned();return e},copySubstitute:function(e){var t=new f;t.type=this.type;t.distinct=this.distinct;t.reduced=this.reduced;t.queryResultStar=this.queryResultStar;t.limit=this.limit;t.offset=this.offset;t.projectVars=this.projectVars.copySubstitute(e);if(this.constructTemplate){t.constructTemplate=this.constructTemplate.copySubstitute(e)}t.orderBy=this.orderBy==null?null:this.orderBy.map(function(t){return t.copySubstitute(e)});t.groupBy=this.groupBy==null?null:this.groupBy.map(function(t){return t.copySubstitute(e)});t.queryPattern=this.queryPattern.copySubstitute(e);return t},setOptions:function(e){if(typeof e==="undefined"){return}if(typeof e.limit!=="undefined"){this.setLimit(e.limit)}if(typeof e.offset!=="undefined"){this.setOffset(e.offset)}if(typeof e.distinct!=="undefined"){this.setDistinct(e.distinct)}},setOffset:function(e){this.offset=e?e:null},setLimit:function(e){if(e===0){this.limit=0}else{this.limit=e?e:null}},isDistinct:function(){return this.distinct},setDistinct:function(e){this.distinct=e===true},isReduced:function(){return this.reduced},setReduced:function(e){this.reduced=e===true},toString:function(){switch(this.type){case u.Select:return this.toStringSelect();case u.Construct:return this.toStringConstruct()}},toStringProjection:function(){var e=this.queryResultStar?"*":this.projectVars.toString();return e},toStringLimitOffset:function(){var e="";if(this.limit!=null){e+=" Limit "+this.limit}if(this.offset!=null){e+=" Offset "+this.offset}return e},toStringSelect:function(){var e=this.distinct?"Distinct ":"";var t="Select "+e+this.toStringProjection()+" {"+this.queryPattern+"} "+this.toStringGroupBy()+this.toStringOrderBy()+this.toStringLimitOffset();return t},toStringConstruct:function(){var e="Construct "+this.constructTemplate+" {"+this.queryPattern+"}"+this.toStringOrderBy()+this.toStringLimitOffset();return e}});module.exports=f},{"../ext/Class":2,"../util/ArrayUtils":368,"../util/ObjectUtils":376,"./ElementHelpers":232,"./ElementUtils":233,"./QueryType":248,"./VarExprList":254,"./expr/ExprAggregator":295,"lodash.union":495}],248:[function(e,module,t){var r={};r.Unknown=-1;r.Select=0;r.Construct=1;r.Ask=2;r.Describe=3;module.exports=r},{}],249:[function(e,module,t){var r=e("../util/ArrayUtils");var n=e("../rdf/Triple");var i=e("./expr/ExprVar");var a=e("./expr/E_OneOf");var s=e("./expr/ExprAggregator");var o=e("./agg/AggCount");var c=e("./element/ElementFilter");var u=e("./element/ElementGroup");var l=e("./element/ElementUnion");var f=e("./element/ElementSubQuery");var v=e("./element/ElementTriplesBlock");var p=e("./Query");var h={injectElement:function(e,t){var r=e.getQueryPattern();var n=new u([r,t]);var i=n.flatten();e.setQueryPattern(i);return e},injectSortElement:function(e,t){var n=t.getElement();h.injectElement(e,n);var i=t.getSortConditions();var a=e.getOrderBy();r.clear(a);r.addAll(a,i);return e},createQueryCount:function(e,t,r,n,a,c,l){var v=e.length===1?e[0]:new u(e);var h=r?new i(r):null;var d;var g=t||c||a&&a.length>0;if(g){var m=new p;m.setQueryPattern(v);if(a){for(var y=0;y<a.length;++y){var x=a[y];m.getProject().add(x)}}if(r){m.getProject().add(r)}if(m.getProjectVars().length===0){m.setQueryResultStar(true)}m.setDistinct(c);m.setLimit(t);d=new f(m)}else{d=new u(e)}var S=new p;S.setQueryPattern(d);if(a){a.forEach(function(e){S.getProject().add(e);S.getGroupBy().push(new i(e))})}S.getProject().add(n,new s(null,new o));return S},createQueryUnionSubQueries:function(e,t){var r;if(e.length===0){r=null}else{if(e.length===1){r=e[0]}else{t=t||e[0].getProjectVars();var n=e.map(function(e){var t=new f(e);return t});var i=new l(n);r=new p;r.setQuerySelectType();t.forEach(function(e){r.getProject().add(e)});r.setQueryPattern(i)}}return r},createQueryDescribeViaSelect:function(e,t,r,s){var o=new p;o.setQuerySelectType();o.setDistinct(true);var l=new u([new v([new n(t,r,s)]),new c(new a(new i(t),e))]);o.setQueryPattern(l);o.getProject().add(t);o.getProject().add(r);o.getProject().add(s);return o}};module.exports=h},{"../rdf/Triple":102,"../util/ArrayUtils":368,"./Query":247,"./agg/AggCount":257,"./element/ElementFilter":261,"./element/ElementGroup":262,"./element/ElementSubQuery":266,"./element/ElementTriplesBlock":267,"./element/ElementUnion":268,"./expr/E_OneOf":291,"./expr/ExprAggregator":295,"./expr/ExprVar":303}],250:[function(e,module,t){var r=e("../ext/Class");var n=e("./ElementUtils");var i=r.create({initialize:function(e,t,r){this.element=e;this.sourceVar=t;this.targetVar=r},getElement:function(){return this.element},getSourceVar:function(){return this.sourceVar},getTargetVar:function(){return this.targetVar},isEmpty:function(){var e=n.isEmpty(this.element);return e},toString:function(){var e="("+[this.element,this.sourceVar,this.targetVar].join("; ")+")";return e}});module.exports=i},{"../ext/Class":2,"./ElementUtils":233}],251:[function(e,module,t){var r=e("./Relation");var n=e("./Query");var i=e("./expr/ExprVar");var a=e("./expr/ExprAggregator");var s=e("./element/ElementSubQuery");var o=e("./agg/AggCountVarDistinct");var c=e("./Concept");var u=e("./ConceptUtils");var l={createQueryDistinctValueCount:function(e,t){var r=new n;var s=r.getProject();s.add(e.getSourceVar());s.add(t,new a(null,new o(new i(e.getTargetVar()))));r.setQueryPattern(e.getElement());r.getGroupBy().push(new i(e.getSourceVar()));return r},createQueryRawSize:function(e,t,r,n){var i=new c(e.getElement(),e.getSourceVar());var a=u.createQueryRawSize(i,t,r,n);return a},createQueryValueCount:function(e,t,r,s){var c=new n;var u=c.getProject();u.add(e.getSourceVar());u.add(r,new a(null,new o(new i(e.getTargetVar()))));c.setQueryPattern(e.getElement())
;c.getGroupBy().push(new i(e.getSourceVar()))},createRelationDistinctValueCount:function(e,t){var n=this.createQueryDistinctValueCount(e,t);var i=new s(n);var a=new r(i,e.getSourceVar(),t);return a}};module.exports=l},{"./Concept":228,"./ConceptUtils":229,"./Query":247,"./Relation":250,"./agg/AggCountVarDistinct":258,"./element/ElementSubQuery":266,"./expr/ExprAggregator":295,"./expr/ExprVar":303}],252:[function(e,module,t){var r=e("../ext/Class");var n=r.create({classLabel:"jassa.sparql.SortCondition",initialize:function(e,t){this.expr=e;this.direction=t},getExpr:function(){return this.expr},getDirection:function(){return this.direction},toString:function(){var e;if(this.direction==="asc"){e="Asc("+this.expr+")"}else if(this.direction==="desc"){e="Desc("+this.expr+")"}else{e=""+this.expr}return e},copySubstitute:function(e){var t=this.expr.copySubstitute(e);var r=new n(t,this.direction);return r}});module.exports=n},{"../ext/Class":2}],253:[function(e,module,t){var r=e("../ext/Class");var n=e("../rdf/NodeFactory");var i=e("./VarUtils");var a=r.create({classLabel:"jassa.sparql.SparqlString",initialize:function(e,t){this.value=e;this.varsMentioned=t?t:[]},toString:function(){return this.value},getString:function(){return this.value},copySubstitute:function(e){var t=this.value;var r=[];var n="@@@@";var i=new RegExp(n,"g");this.varsMentioned.forEach(function(i){var a="\\?"+i.getName()+"([^\\w])?";var s=new RegExp(a,"g");var o=e(i);if(o){var c;if(o.isVariable()){c=n+o.getName();r.push(o)}else{c=o.toString()}t=t.replace(s,c+"$1")}else{r.push(i)}});t=t.replace(i,"?");return new a(t,r)},getVarsMentioned:function(){return this.varsMentioned}});a.create=function(e,t){var r;if(t!=null){r=t.map(function(e){return n.createVar(e)})}else{r=i.extractSparqlVars(e)}var s=new a(e,r);return s};module.exports=a},{"../ext/Class":2,"../rdf/NodeFactory":99,"./VarUtils":256}],254:[function(e,module,t){var r=e("../ext/Class");var n=e("../util/collection/HashMap");var i=e("../util/collection/HashSet");var a=r.create({initialize:function(){this.vars=[];this.varToExpr=new n},contains:function(e){var t=this.vars.some(function(t){var r=t.equals(e);return r});return t},getVars:function(){return this.vars},getExpr:function(e){var t=this.varToExpr.get(e);return t},getExprMap:function(){return this.varToExpr},add:function(e,t){this.vars.push(e);if(t){this.varToExpr.put(e,t)}},addAll:function(e){this.vars.push.apply(this.vars,e)},entries:function(){var e=this;var t=this.vars.map(function(t){var r=e.varToExpr.get(t);return{v:t,expr:r}});return t},copySubstitute:function(e){var t=new a;var r=this.entries();for(var n=0;n<r.length;++n){var i=r[n];var s=e(i.v);var o=i.expr?i.expr.copySubstitute(e):null;t.add(s,o)}return t},toString:function(){var e=[];var t=this.entries();for(var r=0;r<t.length;++r){var n=t[r];var i=n.v;var a=n.expr;if(a){e.push("("+a+" As "+i+")")}else{e.push(i.toString())}}var s=e.join(" ");return s},getRefVars:function(){var e=new i;var t=this.entries();t.forEach(function(t){if(t.expr==null){e.add(t.v)}else{var r=t.expr.getVarsMentioned();r.forEach(function(t){e.add(t)})}});var r=e.map(function(e){return e});return r}});module.exports=a},{"../ext/Class":2,"../util/collection/HashMap":389,"../util/collection/HashSet":390}],255:[function(e,module,t){var r=e("../ext/Class");var n=e("../rdf/NodeFactory");var i=r.create({initialize:function(e){this.genSym=e},next:function(){var e=this.genSym.next();var t=n.createVar(e);return t}});module.exports=i},{"../ext/Class":2,"../rdf/NodeFactory":99}],256:[function(e,module,t){var r=e("./GenSym");var n=e("./GeneratorBlacklist");var i=e("./VarGen");var a=e("../rdf/NodeFactory");var s=e("../util/StringUtils");var o={g:a.createVar("g"),s:a.createVar("s"),p:a.createVar("p"),o:a.createVar("o"),_s_:a.createVar("_s_"),_p_:a.createVar("_p_"),_o_:a.createVar("_o_"),v:a.createVar("v"),w:a.createVar("w"),x:a.createVar("x"),y:a.createVar("y"),z:a.createVar("z"),a:a.createVar("a"),b:a.createVar("b"),c:a.createVar("c"),createVars:function(e){var t=e.map(function(e){return a.createVar(e)});return t},getVarName:function(e){return e.getName()},getVarNames:function(e){var t=e.map(function(e){return e.getName()});return t},createVarGen:function(e,t){if(!e){e="v"}var a=this.getVarNames(t);var s=r.create(e);var o=new n(s,a);var c=new i(o);return c},varPattern:/\?(\w+)/g,extractSparqlVars:function(e){var t=s.extractAllRegexMatches(this.varPattern,e,1);var r=[];for(var n=0;n<t.length;++n){var i=t[n];var o=a.createVar(i);r.push(o)}return r},freshVarGen:function(e,t){var a=o.getVarNames(t);var s=r.create(e);var c=new n(s,a);var u=new i(c);return u},freshVar:function(e,t){var r=this.freshVarGen(e,t);var n=r.next();return n},fnSubst:function(e){var t=function(t){var r=e.get(t);return r};return t}};module.exports=o},{"../rdf/NodeFactory":99,"../util/StringUtils":383,"./GenSym":238,"./GeneratorBlacklist":240,"./VarGen":255}],257:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(){},copySubstitute:function(e){return new n},getVarsMentioned:function(){return[]},toString:function(){return"Count(*)"}});module.exports=n},{"../../ext/Class":2}],258:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e){this.expr=e},copySubstitute:function(e){var t=this.expr.copySubstitute(e);var r=new n(t);return r},getVarsMentioned:function(){return this.expr.getVarsMentioned()},toString:function(){var e="Count(Distinct "+this.expr+")";return e}});module.exports=n},{"../../ext/Class":2}],259:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({classLabel:"jassa.sparql.Element"});module.exports=n},{"../../ext/Class":2}],260:[function(e,module,t){var r=e("../../ext/Class");var n=e("lodash.union");var i=e("../../rdf/NodeUtils");var a=e("./Element");var s=r.create(a,{classLabel:"jassa.sparql.ElementBind",initialize:function(e,t){this.expr=t;this.variable=e},getArgs:function(){return[]},getExpr:function(){return this.expr},getVar:function(){return this.variable},getVarsMentioned:function(){return n(this.expr.getVarsMentioned(),this.variable)},copy:function(){return new s(this.variable,this.expr)},copySubstitute:function(e){return new s(i.getSubstitute(this.variable,e),this.expr.copySubstitute(e))},flatten:function(){return this},toString:function(){return"bind("+this.expr+" as "+this.variable+")"}});module.exports=s},{"../../ext/Class":2,"../../rdf/NodeUtils":100,"./Element":259,"lodash.union":495}],261:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprUtils");var i=e("./Element");var a=r.create(i,{classLabel:"jassa.sparql.ElementFilter",initialize:function(e){if(Array.isArray(e)){throw new Error("[WARN] Array argument for filter is deprecated")}this.expr=e},getArgs:function(){return[]},copy:function(e){if(e.length!==0){throw new Error("Invalid argument")}var t=new a(this.expr);return t},copySubstitute:function(e){var t=this.expr.copySubstitute(e);return new a(t)},getVarsMentioned:function(){return this.expr.getVarsMentioned()},flatten:function(){return this},toString:function(){return"Filter("+this.expr+")"}});module.exports=a},{"../../ext/Class":2,"../ExprUtils":237,"./Element":259}],262:[function(e,module,t){var r=e("lodash.uniq");var n=e("../../ext/Class");var i=e("./Element");var a=e("./ElementFilter");var s=e("./ElementTriplesBlock");var o=e("../../rdf/TripleUtils");var c=e("./../ElementHelpers");var u=e("../PatternUtils");var l=n.create(i,{classLabel:"jassa.sparql.ElementGroup",initialize:function(e){this.elements=e?e:[];if(!Array.isArray(this.elements)){throw new Error(this.classLabel+" expects a single argument of type array, got ["+arguments.length+"] args; "+typeof e+": "+e)}},addElement:function(e){this.elements.push(e)},getArgs:function(){return this.elements},copy:function(e){var t=new l(e);return t},copySubstitute:function(e){var t=this.elements.map(function(t){return t.copySubstitute(e)});return new l(t)},getVarsMentioned:function(){var e=u.getVarsMentioned(this.elements);return e},toString:function(){return c.joinElements(" . ",this.elements)},flatten:function(){var e=this.elements.map(function(e){var t=e.flatten();return t});var t=[];e.forEach(function(e){if(e instanceof l){t.push.apply(t,e.elements)}else{t.push(e)}});var n=[];var i=[];var c=[];t.forEach(function(e){if(e instanceof s){n.push.apply(n,e.getTriples())}else if(e instanceof a){i.push(e)}else{c.push(e)}});var u=[];if(n.length>0){var f=o.uniqTriples(n);u.push(new s(f))}u.push.apply(u,c);var v=r(i,false,function(e){return e.toString()});u.push.apply(u,v);var p=u.length===1?u[0]:new l(u);return p}});module.exports=l},{"../../ext/Class":2,"../../rdf/TripleUtils":103,"../PatternUtils":244,"./../ElementHelpers":232,"./Element":259,"./ElementFilter":261,"./ElementTriplesBlock":267,"lodash.uniq":496}],263:[function(e,module,t){var r=e("lodash.union");var n=e("../../rdf/NodeUtils");var i=e("../../ext/Class");var a=e("./Element");var s=i.create(a,{classLabel:"jassa.sparql.ElementNamedGraph",initialize:function(e,t){this.node=e;this.element=t},getArgs:function(){return[this.element]},copy:function(e){if(e.length!==1){throw new Error("Invalid argument")}var t=new s(this.node,e[0]);return t},getVarsMentioned:function(){var e=this.element.getVarsMentioned();if(this.node.isVar()){e=r(e,this.node)}return e},copySubstitute:function(e){return new s(n.getSubstitute(this.node,e),this.element.copySubstitute(e))},flatten:function(){var e=new s(this.element.flatten());return e},toString:function(){var e=this.node!=null?"Graph "+this.node+" { "+this.element+" }":"{ "+this.element+" }";return e}});module.exports=s},{"../../ext/Class":2,"../../rdf/NodeUtils":100,"./Element":259,"lodash.union":495}],264:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Element");var i=r.create(n,{classLabel:"jassa.sparql.ElementOptional",initialize:function(e){this.optionalElement=e;if(!(e instanceof n)){throw new Error(this.classLabel+" only accepts an instance of Element as the argument")}},getArgs:function(){return[this.optionalElement]},copy:function(e){if(e.length!==1){throw new Error("Invalid argument")}var t=new i(e[0]);return t},getVarsMentioned:function(){return this.optionalElement.getVarsMentioned()},copySubstitute:function(e){return new i(this.optionalElement.copySubstitute(e))},flatten:function(){var e=new i(this.optionalElement.flatten());return e},toString:function(){return"Optional {"+this.optionalElement+"}"}});module.exports=i},{"../../ext/Class":2,"./Element":259}],265:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Element");var i=e("../SparqlString");var a=r.create(n,{classLabel:"jassa.sparql.ElementString",initialize:function(e){this.sparqlString=e},getArgs:function(){return[]},copy:function(e){if(e.length!==0){throw new Error("Invalid argument")}return this},toString:function(){return this.sparqlString.getString()},copySubstitute:function(e){var t=this.sparqlString.copySubstitute(e);return new a(t)},getVarsMentioned:function(){return this.sparqlString.getVarsMentioned()},flatten:function(){return this}});a.create=function(e,t){var r=i.create(e,t);var n=new a(r);return n};module.exports=a},{"../../ext/Class":2,"../SparqlString":253,"./Element":259}],266:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Element");var i=r.create(n,{classLabel:"jassa.sparql.ElementSubQuery",initialize:function(e){this.query=e},getQuery:function(){return this.query},getArgs:function(){return[]},copy:function(e){if(e.length!==0){throw new Error("Invalid argument")}var t=new i(this.query);return t},toString:function(){return"{ "+this.query+" }"},copySubstitute:function(e){return new i(this.query.copySubstitute(e))},flatten:function(){return new i(this.query.flatten())},getVarsMentioned:function(){return this.query.getVarsMentioned()}});module.exports=i},{"../../ext/Class":2,"./Element":259}],267:[function(e,module,t){var r=e("lodash.union");var n=e("../../ext/Class");var i=e("../../rdf/TripleUtils");var a=e("./Element");var s=n.create(a,{classLabel:"jassa.sparql.ElementTriplesBlock",initialize:function(e){this.triples=e?e:[]},getArgs:function(){return[]},copy:function(e){if(e.length!==0){throw new Error("Invalid argument")}var t=new s(this.triples);return t},getTriples:function(){return this.triples},addTriples:function(e){this.triples=this.triples.concat(e)},uniq:function(){this.triples=i.uniqTriples(this.triples)},copySubstitute:function(e){var t=this.triples.map(function(t){return t.copySubstitute(e)});return new s(t)},getVarsMentioned:function(){var e=[];this.triples.forEach(function(t){e=r(e,t.getVarsMentioned())});return e},flatten:function(){var e=i.uniqTriples(this.triples);var t=new s(e);return t},toString:function(){return this.triples.join(" . ")}});module.exports=s},{"../../ext/Class":2,"../../rdf/TripleUtils":103,"./Element":259,"lodash.union":495}],268:[function(e,module,t){var r=e("lodash.uniq");var n=e("../../ext/Class");var i=e("./Element");var a=e("./ElementFilter");var s=e("./ElementTriplesBlock");var o=e("../../rdf/TripleUtils");var c=e("./../ElementHelpers");var u=e("../PatternUtils");var l=n.create(i,{classLabel:"jassa.sparql.ElementUnion",initialize:function(e){this.elements=e?e:[];if(!Array.isArray(this.elements)){throw new Error(this.classLabel+" expects a single argument of type array, got ["+arguments.length+"] args; "+typeof e+": "+e)}},addElement:function(e){this.elements.push(e)},getArgs:function(){return this.elements},copy:function(e){var t=new l(e);return t},copySubstitute:function(e){var t=this.elements.map(function(t){return t.copySubstitute(e)});return new l(t)},getVarsMentioned:function(){var e=u.getVarsMentioned(this.elements);return e},toString:function(){var e="{"+this.elements.join(" } Union {")+"}";return e},flatten:function(){var e=this.elements.map(function(e){var t=e.flatten();return t});var t=new l(e);return t}});module.exports=l},{"../../ext/Class":2,"../../rdf/TripleUtils":103,"../PatternUtils":244,"./../ElementHelpers":232,"./Element":259,"./ElementFilter":261,"./ElementTriplesBlock":267,"lodash.uniq":496}],269:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({createElement:function(){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],270:[function(e,module,t){var r=e("../../ext/Class");var n=e("../element/ElementGroup");var i=e("./ElementFactory");var a=r.create(i,{initialize:function(e,t,r){this.simplify=e;this.elementFactories=t;this.forceGroup=r},isSimplify:function(){return this.simplify},getElementFactories:function(){return this.elementFactories},isForceGroup:function(){return this.forceGroup},createElement:function(){var e=this.elementFactories.map(function(e){var t=e.createElement();return t});var t=e.filter(function(e){return e!=null});var r=new n(t);if(this.simplify){r=r.flatten()}if(!this.forceGroup){var i=r.getArgs();if(i.length===1){r=i[0]}}return r}});module.exports=a},{"../../ext/Class":2,"../element/ElementGroup":262,"./ElementFactory":269}],271:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ElementFactory");var i=r.create(n,{initialize:function(e){this.element=e},createElement:function(){return this.element}});module.exports=i},{"../../ext/Class":2,"./ElementFactory":269}],272:[function(e,module,t){var r=e("../../ext/Class");var n=e("../join/JoinType");var i=e("../ElementUtils");var a=e("../element/ElementOptional");var s=e("../element/ElementGroup");var o=e("./ElementFactory");var c=r.create(o,{initialize:function(e,t,r,i,a){this.elementFactoryA=e;this.elementFactoryB=t;this.joinVarsA=r;this.joinVarsB=i;this.joinType=a?a:n.INNER_JOIN},createElement:function(){var e=this.elementFactoryA.createElement();var t=this.elementFactoryB.createElement();var r=e.getVarsMentioned();var o=t.getVarsMentioned();var c=i.createJoinVarMap(o,r,this.joinVarsB,this.joinVarsA);e=i.createRenamedElement(e,c);if(this.joinType===n.LEFT_JOIN){t=new a(t)}var u=new s([e,t]);return u}});module.exports=c},{"../../ext/Class":2,"../ElementUtils":233,"../element/ElementGroup":262,"../element/ElementOptional":264,"../join/JoinType":313,"./ElementFactory":269}],273:[function(e,module,t){var r=e("../../ext/Class");var n=e("../join/JoinType");var i=e("../join/JoinBuilder");var a=e("../element/ElementGroup");var s=e("./ElementFactory");var o=r.create(s,{initialize:function(e,t,r){this.conceptFactoryA=e;this.conceptFactoryB=t;this.joinType=r||n.INNER_JOIN},createElement:function(){var e=this.conceptFactoryA.createConcept();var t=this.conceptFactoryB.createConcept();var r=e.getElement();var n=t.getElement();if(t.isSubjectConcept()){return r}var s=[e.getVar()];var o=[t.getVar()];var c=i.create(r);var u=c.joinAny(this.joinType,s,n,o);var l=u.getJoinBuilder();var f=l.getElements();var v=new a(f);return v}});module.exports=o},{"../../ext/Class":2,"../element/ElementGroup":262,"../join/JoinBuilder":307,"../join/JoinType":313,"./ElementFactory":269}],274:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({getElement:function(){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],275:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ElementSupplier");var i=r.create(n,{initialize:function(e){this.element=e},getElement:function(){return this.element},setElement:function(e){this.element=e}});module.exports=i},{"../../ext/Class":2,"./ElementSupplier":274}],276:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ElementSupplier");var i=r.create(n,{initialize:function(e){this.elementFn=e},getElement:function(){return this.elementFn}});module.exports=i},{"../../ext/Class":2,"./ElementSupplier":274}],277:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprHelpers");var i=r.create({initialize:function(e){this.expr=e},copySubstitute:function(e){return new i(this.expr.copySubstitute(e))},getVarsMentioned:function(){var e=this.expr.getVarsMentioned();return e},getArgs:function(){return[this.expr]},copy:function(e){var t=n.newUnaryExpr(i,e);return t},toString:function(){return"bound("+this.expr+")"}});module.exports=i},{"../../ext/Class":2,"../ExprHelpers":236}],278:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.expr=e;this.node=t},copySubstitute:function(e){return new n(this.expr.copySubstitute(e),this.node.copySubstitute(e))}});module.exports=n},{"../../ext/Class":2}],279:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunction2");var i=r.create(n,{initialize:function($super,e,t){$super("=",e,t)},copySubstitute:function(e){return new i(this.left.copySubstitute(e),this.right.copySubstitute(e))},$copy:function(e,t){return new i(e,t)},toString:function(){return"("+this.left+" = "+this.right+")"},eval:function(){}});module.exports=i},{"../../ext/Class":2,"./ExprFunction2":299}],280:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunctionN");var i=r.create(n,{initialize:function($super,e,t){$super(e,t)},copy:function(e){var t=new i(this.name,e);return t},toString:function(){var e="<"+this.name+">("+this.getArgs().join(", ")+")";return e}});module.exports=i},{"../../ext/Class":2,"./ExprFunctionN":301}],281:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunction2");var i=e("../ExprHelpers");var a=r.create(n,{initialize:function($super,e,t){$super(">",e,t)},copySubstitute:function(e){return new a(this.left.copySubstitute(e),this.right.copySubstitute(e))},copy:function(e){return i.newBinaryExpr(a,e)},toString:function(){return"("+this.left+" > "+this.right+")"}});module.exports=a},{"../../ext/Class":2,"../ExprHelpers":236,"./ExprFunction2":299}],282:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprHelpers");var i=r.create({initialize:function(e){this.expr=e},copySubstitute:function(e){return new i(this.expr.copySubstitute(e))},getArgs:function(){return[this.expr]},copy:function(e){var t=n.newUnaryExpr(i,e);return t},toString:function(){return"isIri("+this.expr+")"},getVarsMentioned:function(){return this.expr.getVarsMentioned()}});module.exports=i},{"../../ext/Class":2,"../ExprHelpers":236}],283:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprHelpers");var i=r.create({initialize:function(e){this.expr=e},copySubstitute:function(e){return new i(this.expr.copySubstitute(e))},getArgs:function(){return[this.expr]},copy:function(e){var t=n.newUnaryExpr(i,e);return t},toString:function(){return"lang("+this.expr+")"},getVarsMentioned:function(){return this.expr.getVarsMentioned()}});module.exports=i},{"../../ext/Class":2,"../ExprHelpers":236}],284:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprHelpers");var i=e("../PatternUtils");var a=r.create({initialize:function(e,t){this.left=e;this.right=t},copySubstitute:function(e){return new a(this.left.copySubstitute(e),this.right.copySubstitute(e))},getArgs:function(){return[this.left,this.right]},copy:function(e){return n.newBinaryExpr(a,e)},toString:function(){return"langMatches("+this.left+", "+this.right+")"},getVarsMentioned:function(){var e=i.getVarsMentioned(this.getArgs());return e}});module.exports=a},{"../../ext/Class":2,"../ExprHelpers":236,"../PatternUtils":244}],285:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunction2");var i=e("../ExprHelpers");var a=r.create(n,{initialize:function($super,e,t){$super("<",e,t)},copySubstitute:function(e){return new a(this.left.copySubstitute(e),this.right.copySubstitute(e))},copy:function(e){return i.newBinaryExpr(a,e)},toString:function(){return"("+this.left+" < "+this.right+")"}});module.exports=a},{"../../ext/Class":2,"../ExprHelpers":236,"./ExprFunction2":299}],286:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprHelpers");var i=r.create({initialize:function(e,t){this.expr=e;this.pattern=t},copySubstitute:function(e){return new i(this.expr.copySubstitute(e),this.pattern)},getVarsMentioned:function(){return this.expr.getVarsMentioned()},getArgs:function(){return[this.expr]},copy:function(e){var t=n.newUnaryExpr(i,e);return t},toString:function(){var e=this.pattern.replace("'","\\'");return"("+this.expr+" Like '"+e+"')"}});module.exports=i},{"../../ext/Class":2,"../ExprHelpers":236}],287:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprHelpers");var i=e("./ExprFunction2");var a=r.create(i,{initialize:function($super,e,t){$super("&&",e,t)},copySubstitute:function(e){return new a(this.left.copySubstitute(e),this.right.copySubstitute(e))},copy:function(e){return n.newBinaryExpr(a,e)},toString:function(){return"("+this.left+" && "+this.right+")"}});module.exports=a},{"../../ext/Class":2,"../ExprHelpers":236,"./ExprFunction2":299}],288:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ExprHelpers");var i=e("./ExprFunction1");var a=r.create(i,{initialize:function(e){this.expr=e},copySubstitute:function(e){return new a(this.expr.copySubstitute(e))},getArgs:function(){return[this.expr]},copy:function(e){var t=n.newUnaryExpr(a,e);return t},toString:function(){return"(!"+this.expr+")"}});module.exports=a},{"../../ext/Class":2,"../ExprHelpers":236,"./ExprFunction1":298}],289:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunction2");var i=e("../ExprHelpers");var a=r.create(n,{initialize:function($super,e,t){$super("||",e,t)},copySubstitute:function(e){var t=this.left.copySubstitute(e);var r=this.right.copySubstitute(e);var n=new a(t,r);return n},getArgs:function(){return[this.left,this.right]},copy:function(e){return i.newBinaryExpr(a,e)},toString:function(){return"("+this.left+" || "+this.right+")"}});module.exports=a},{"../../ext/Class":2,"../ExprHelpers":236,"./ExprFunction2":299}],290:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunction0");var i=r.create(n,{initialize:function($super,e){$super("jassa.sparql.E_NotExists");this.element=e},getVarsMentioned:function(){return this.element.getVarsMentioned()},$copy:function(){return new i(this.element)},toString:function(){return"Not Exists ("+this.element+") "}});module.exports=i},{"../../ext/Class":2,"./ExprFunction0":297}],291:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Expr");var i=function(e,t){var r=t(e);if(!r){r=e}return r};var a=r.create(n,{initialize:function(e,t){this.lhsExpr=e;if(!Array.isArray(t)){throw new Error("nodes must be an array")}this.nodes=t},getVarsMentioned:function(){var e=this.lhsExpr.getVarsMentioned();return e},copySubstitute:function(e){var t=this.nodes.map(function(t){return i(t,e)});return new a(this.lhsExpr.copySubstitute(e),t)},toString:function(){if(!this.nodes||this.nodes.length===0){return"FALSE"}else{return"("+this.lhsExpr+" in ("+this.nodes.join(", ")+"))"}}});module.exports=a},{"../../ext/Class":2,"./Expr":294}],292:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Expr");var i=r.create(n,{initialize:function(e,t,r){this.expr=e;this.pattern=t;this.flags=r},copySubstitute:function(e){return new i(this.expr.copySubstitute(e),this.pattern,this.flags)},getVarsMentioned:function(){return this.expr.getVarsMentioned()},getArgs:function(){return[this.expr]},copy:function(e){if(e.length!==1){throw new Error("Invalid argument")}var t=e[0];var r=new i(t,this.pattern,this.flags);return r},toString:function(){var e=this.pattern.replace('"','\\"');var t=this.flags?', "'+this.flags.replace('"','\\"')+'"':"";return"regex("+this.expr+', "'+e+'"'+t+")"}});module.exports=i},{"../../ext/Class":2,"./Expr":294}],293:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunction1");var i=r.create(n,{initialize:function($super,e){$super("str",e)},getVarsMentioned:function(){return this.subExpr.getVarsMentioned()},copy:function(e){return new i(e[0])},toString:function(){return"str("+this.subExpr+")"}});module.exports=i},{"../../ext/Class":2,"./ExprFunction1":298}],294:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({isFunction:function(){return false},isVar:function(){return false},isConstant:function(){return false},getFunction:function(){throw new Error("Override me")},getExprVar:function(){throw new Error("Override me")},getConstant:function(){throw new Error("Override me")},copySubstitute:function(){throw new Error("Override me")},copy:function(){throw new Error("Override me")}});module.exports=n},{"../../ext/Class":2}],295:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeUtils");var i=e("../ExprHelpers");var a=r.create({initialize:function(e,t){this.v=e;this.agg=t},copySubstitute:function(e){var t=n.getSubstitute(this.v,e);var r=this.agg.copySubstitute(e);var i=new a(t,r);return i},getAggregator:function(){return this.agg},getArgs:function(){return[]},copy:function(e){var t=new a(this.v,this.agg);return t},toString:function(){return this.agg.toString()},getVarsMentioned:function(){var e=this.agg.getVarsMentioned();return e}});module.exports=a},{"../../ext/Class":2,"../../rdf/NodeUtils":100,"../ExprHelpers":236}],296:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Expr");var i=r.create(n,{getName:function(){throw new Error("Implement me")},isFunction:function(){return true},getFunction:function(){return this}});module.exports=i},{"../../ext/Class":2,"./Expr":294}],297:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunctionBase");var i=r.create(n,{initialize:function($super,e){$super(e)},getArgs:function(){return[]},copy:function(e){if(e&&e.length>0){throw new Error("Invalid argument")}var t=this.$copy(e);return t}});module.exports=i},{"../../ext/Class":2,"./ExprFunctionBase":300}],298:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunctionBase");var i=r.create(n,{initialize:function($super,e,t){$super(e);this.subExpr=t},getArgs:function(){return[this.subExpr]},copy:function(e){if(e.length!==1){throw new Error("Invalid argument")}var t=this.$copy(e);return t},getSubExpr:function(){return this.subExpr}});module.exports=i},{"../../ext/Class":2,"./ExprFunctionBase":300}],299:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunctionBase");var i=r.create(n,{initialize:function($super,e,t,r){$super(e);this.left=t;this.right=r},getArgs:function(){return[this.left,this.right]},copy:function(e){if(e.length!==2){throw new Error("Invalid argument")}var t=this.$copy(e[0],e[1]);return t},getLeft:function(){return this.left},getRight:function(){return this.right}});module.exports=i},{"../../ext/Class":2,"./ExprFunctionBase":300}],300:[function(e,module,t){var r=e("../../ext/Class");var n=e("../PatternUtils");var i=e("./ExprFunction");var a=r.create(i,{initialize:function(e){this.name=e},copySubstitute:function(e){var t=this.getArgs();var r=t.map(function(t){var r=t.copySubstitute(e);return r});var n=this.copy(r);return n},getVarsMentioned:function(){var e=n.getVarsMentioned(this.getArgs());return e},toString:function(){var e=this.name+"("+this.getArgs().join(", ")+")";return e}});module.exports=a},{"../../ext/Class":2,"../PatternUtils":244,"./ExprFunction":296}],301:[function(e,module,t){var r=e("../../ext/Class");var n=e("./ExprFunctionBase");var i=r.create(n,{initialize:function($super,e,t){$super(e,t);this.args=t},getArgs:function(){return this.args}});module.exports=i},{"../../ext/Class":2,"./ExprFunctionBase":300}],302:[function(e,module,t){var r=e("../../ext/Class");var n=e("../SparqlString");var i=e("./Expr");var a=r.create(i,{classLabel:"jassa.sparql.ExprString",initialize:function(e){this.sparqlString=e},copySubstitute:function(e){var t=this.sparqlString.copySubstitute(e);return new a(t)},getVarsMentioned:function(){return this.sparqlString.getVarsMentioned()},getArgs:function(){return[]},copy:function(e){if(e.length!==0){throw new Error("Invalid argument")}return this},toString:function(){return"(!"+this.expr+")"},create:function(e,t){var r=new a(n.create(e,t));return r}});module.exports=a},{"../../ext/Class":2,"../SparqlString":253,"./Expr":294}],303:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Expr");var i=e("./../NodeValueUtils");var a=r.create(n,{classLabel:"ExprVar",initialize:function(e){this.v=e},eval:function(e){var t=e.get(this.v);var r=i.makeNode(t);return r},copySubstitute:function(e){var t=e(this.v);var r;if(t==null){r=this}else if(t.isVariable()){r=new a(t)}else{r=i.makeNode(t)}return r},getArgs:function(){return[]},copy:function(e){if(e&&e.length>0){throw new Error("Invalid argument")}var t=new a(this.v);return t},isVar:function(){return true},getExprVar:function(){return this},asVar:function(){return this.v},getVarsMentioned:function(){return[this.v]},toString:function(){return this.v.toString()}});module.exports=a},{"../../ext/Class":2,"./../NodeValueUtils":243,"./Expr":294}],304:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Expr");var i=e("../../vocab/xsd");var a=e("../../rdf/NodeFactory");var s=r.create(n,{initialize:function(e){this.node=e},isConstant:function(){return true},getConstant:function(){return this},getArgs:function(){return[]},getVarsMentioned:function(){return[]},asNode:function(){throw new Error("makeNode is not overridden")},copySubstitute:function(){return this},toString:function(){var e=this.node;var t;if(e.isLiteral()){if(e.getLiteralDatatypeUri()===i.xstring.getUri()){var r=e.getLiteralLexicalForm();t="'"+r+"'"}else if(e.dataType===i.xdouble.value){return parseFloat(this.node.value)}}else{t=e.toString()}return t},eval:function(e){return this}});module.exports=s},{"../../ext/Class":2,"../../rdf/NodeFactory":99,"../../vocab/xsd":411,"./Expr":294}],305:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../vocab/xsd");var i=e("./NodeValue");var a=r.create(i,{initialize:function(e){this.node=e},asNode:function(){return this.node},toString:function(){var e=this.node;var t=null;if(e.isLiteral()){if(e.getLiteralDatatypeUri()===n.xstring.getUri()){t='"'+e.getLiteralLexicalForm()+'"'}}if(t==null){t=e.toString()}return t}});module.exports=a},{"../../ext/Class":2,"../../vocab/xsd":411,"./NodeValue":304}],306:[function(e,module,t){"use strict";var r={BestLabelConfig:e("./BestLabelConfig"),Binding:e("./Binding"),BindingUtils:e("./BindingUtils"),
CannedConceptUtils:e("./CannedConceptUtils"),Concept:e("./Concept"),ConceptUtils:e("./ConceptUtils"),DiffUtils:e("./DiffUtils"),DatasetDescription:e("./DatasetDescription"),ElementHelpers:e("./ElementHelpers"),ElementUtils:e("./ElementUtils"),ExprEvaluator:e("./ExprEvaluator"),ExprEvaluatorImpl:e("./ExprEvaluatorImpl"),ExprHelpers:e("./ExprHelpers"),ExprUtils:e("./ExprUtils"),GenSym:e("./GenSym"),Generator:e("./Generator"),GeneratorBlacklist:e("./GeneratorBlacklist"),LabelUtils:e("./LabelUtils"),LiteralPreference:e("./LiteralPreference"),NodeValueUtils:e("./NodeValueUtils"),PatternUtils:e("./PatternUtils"),Quad:e("./Quad"),QuadUtils:e("./QuadUtils"),Query:e("./Query"),QueryType:e("./QueryType"),QueryUtils:e("./QueryUtils"),Relation:e("./Relation"),RelationUtils:e("./RelationUtils"),SortCondition:e("./SortCondition"),SparqlString:e("./SparqlString"),VarExprList:e("./VarExprList"),VarGen:e("./VarGen"),VarUtils:e("./VarUtils"),AggCount:e("./agg/AggCount"),AggCountVarDistinct:e("./agg/AggCountVarDistinct"),Element:e("./element/Element"),ElementBind:e("./element/ElementBind"),ElementFilter:e("./element/ElementFilter"),ElementGroup:e("./element/ElementGroup"),ElementNamedGraph:e("./element/ElementNamedGraph"),ElementOptional:e("./element/ElementOptional"),ElementString:e("./element/ElementString"),ElementSubQuery:e("./element/ElementSubQuery"),ElementTriplesBlock:e("./element/ElementTriplesBlock"),ElementUnion:e("./element/ElementUnion"),ElementFactory:e("./element_factory/ElementFactory"),ElementFactoryCombine:e("./element_factory/ElementFactoryCombine"),ElementFactoryConst:e("./element_factory/ElementFactoryConst"),ElementFactoryJoin:e("./element_factory/ElementFactoryJoin"),ElementFactoryJoinConcept:e("./element_factory/ElementFactoryJoinConcept"),ElementSupplier:e("./element_supplier/ElementSupplier"),ElementSupplierConst:e("./element_supplier/ElementSupplierConst"),ElementSupplierFn:e("./element_supplier/ElementSupplierFn"),E_Bound:e("./expr/E_Bound"),E_Cast:e("./expr/E_Cast"),E_Equals:e("./expr/E_Equals"),E_Function:e("./expr/E_Function"),E_GreaterThan:e("./expr/E_GreaterThan"),E_Lang:e("./expr/E_Lang"),E_IsIri:e("./expr/E_IsIri"),E_LangMatches:e("./expr/E_LangMatches"),E_LessThan:e("./expr/E_LessThan"),E_Like:e("./expr/E_Like"),E_LogicalAnd:e("./expr/E_LogicalAnd"),E_LogicalNot:e("./expr/E_LogicalNot"),E_LogicalOr:e("./expr/E_LogicalOr"),E_NotExists:e("./expr/E_NotExists"),E_OneOf:e("./expr/E_OneOf"),E_Regex:e("./expr/E_Regex"),E_Str:e("./expr/E_Str"),Expr:e("./expr/Expr"),ExprAggregator:e("./expr/ExprAggregator"),ExprFunction:e("./expr/ExprFunction"),ExprFunction0:e("./expr/ExprFunction0"),ExprFunction1:e("./expr/ExprFunction1"),ExprFunction2:e("./expr/ExprFunction2"),ExprFunctionBase:e("./expr/ExprFunctionBase"),ExprFunctionN:e("./expr/ExprFunctionN"),ExprString:e("./expr/ExprString"),ExprVar:e("./expr/ExprVar"),NodeValue:e("./expr/NodeValue"),NodeValueNode:e("./expr/NodeValueNode"),JoinBuilder:e("./join/JoinBuilder"),JoinBuilderUtils:e("./join/JoinBuilderUtils"),JoinInfo:e("./join/JoinInfo"),JoinNode:e("./join/JoinNode"),JoinNodeInfo:e("./join/JoinNodeInfo"),JoinTargetState:e("./join/JoinTargetState"),JoinType:e("./join/JoinType"),KeywordSearchUtils:e("./search/KeywordSearchUtils"),UpdateData:e("./update/UpdateData"),UpdateDataDelete:e("./update/UpdateDataDelete"),UpdateDataInsert:e("./update/UpdateDataInsert"),UpdateModify:e("./update/UpdateModify"),UpdateWithUsing:e("./update/UpdateWithUsing")};module.exports=r},{"./BestLabelConfig":224,"./Binding":225,"./BindingUtils":226,"./CannedConceptUtils":227,"./Concept":228,"./ConceptUtils":229,"./DatasetDescription":230,"./DiffUtils":231,"./ElementHelpers":232,"./ElementUtils":233,"./ExprEvaluator":234,"./ExprEvaluatorImpl":235,"./ExprHelpers":236,"./ExprUtils":237,"./GenSym":238,"./Generator":239,"./GeneratorBlacklist":240,"./LabelUtils":241,"./LiteralPreference":242,"./NodeValueUtils":243,"./PatternUtils":244,"./Quad":245,"./QuadUtils":246,"./Query":247,"./QueryType":248,"./QueryUtils":249,"./Relation":250,"./RelationUtils":251,"./SortCondition":252,"./SparqlString":253,"./VarExprList":254,"./VarGen":255,"./VarUtils":256,"./agg/AggCount":257,"./agg/AggCountVarDistinct":258,"./element/Element":259,"./element/ElementBind":260,"./element/ElementFilter":261,"./element/ElementGroup":262,"./element/ElementNamedGraph":263,"./element/ElementOptional":264,"./element/ElementString":265,"./element/ElementSubQuery":266,"./element/ElementTriplesBlock":267,"./element/ElementUnion":268,"./element_factory/ElementFactory":269,"./element_factory/ElementFactoryCombine":270,"./element_factory/ElementFactoryConst":271,"./element_factory/ElementFactoryJoin":272,"./element_factory/ElementFactoryJoinConcept":273,"./element_supplier/ElementSupplier":274,"./element_supplier/ElementSupplierConst":275,"./element_supplier/ElementSupplierFn":276,"./expr/E_Bound":277,"./expr/E_Cast":278,"./expr/E_Equals":279,"./expr/E_Function":280,"./expr/E_GreaterThan":281,"./expr/E_IsIri":282,"./expr/E_Lang":283,"./expr/E_LangMatches":284,"./expr/E_LessThan":285,"./expr/E_Like":286,"./expr/E_LogicalAnd":287,"./expr/E_LogicalNot":288,"./expr/E_LogicalOr":289,"./expr/E_NotExists":290,"./expr/E_OneOf":291,"./expr/E_Regex":292,"./expr/E_Str":293,"./expr/Expr":294,"./expr/ExprAggregator":295,"./expr/ExprFunction":296,"./expr/ExprFunction0":297,"./expr/ExprFunction1":298,"./expr/ExprFunction2":299,"./expr/ExprFunctionBase":300,"./expr/ExprFunctionN":301,"./expr/ExprString":302,"./expr/ExprVar":303,"./expr/NodeValue":304,"./expr/NodeValueNode":305,"./join/JoinBuilder":307,"./join/JoinBuilderUtils":308,"./join/JoinInfo":309,"./join/JoinNode":310,"./join/JoinNodeInfo":311,"./join/JoinTargetState":312,"./join/JoinType":313,"./search/KeywordSearchUtils":314,"./update/UpdateData":315,"./update/UpdateDataDelete":316,"./update/UpdateDataInsert":317,"./update/UpdateModify":318,"./update/UpdateWithUsing":319}],307:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/collection/HashBidiMap");var i=e("../GenSym");var a=e("../GeneratorBlacklist");var s=e("../ElementUtils");var o=e("../element/ElementGroup");var c=e("../element/ElementOptional");var u=e("../VarUtils");var l=e("./JoinNode");var f=e("./JoinTargetState");var v=e("./JoinInfo");var p=e("./JoinType");var h=r.create({initialize:function(e,t,r,s){if(e==null){console.log("[Error] Root element must not be null");throw new Error("Bailing out")}this.usedVarNames=[];this.usedVars=[];this.aliasGenerator=new i("a");this.varNameGenerator=new a(new i("v"),this.usedVarNames);this.aliasToState={};this.rootAlias=r?r:this.aliasGenerator.next();if(s==null){s=[]}var o=this.createTargetState(this.rootAlias,new n,s,e,t,s);this.aliasToState[this.rootAlias]=o;this.rootNode=o.getJoinNode()},getRootNode:function(){return this.rootNode},getJoinNode:function(e){var t=this.aliasToState[e];var r=t?t.getJoinNode():null;return r},getState:function(e){return this.aliasToState[e]},getElement:function(e){var t=this.aliasToState[e];var r=t?t.getElement():null;return r},addVars:function(e){var t=this;e.forEach(function(e){var r=e.getName();var n=t.usedVarNames.indexOf(r)!==-1;if(!n){t.usedVarNames.push(r);t.usedVars.push(e)}})},createTargetState:function(e,t,r,n,i,a){var o=r.map(function(e){var r=t.get(e);return r});var c=s.createJoinVarMap(this.usedVars,i,o,a,this.varNameGenerator);var u=null;if(n!=null){u=s.createRenamedElement(n,c)}var v=c.getInverse().keys();this.addVars(v);var p=new l(this,e,a);var h=new f(c,p,u,v);return h},addJoin:function(e,t,r,n,i,a){var s=this.aliasToState[t];var o=s.getVarMap();if(!a){a=this.aliasGenerator.next()}var c=n.getVarsMentioned();var u=this.createTargetState(a,o,r,n,c,i);var l=new v(a,e);s.getJoinInfos().push(l);this.aliasToState[a]=u;var f=u.getJoinNode();return f},getElementsRec:function(e){var t=[];var r=e.getElement();if(r!=null){t.push(r)}var n=e.getJoinNodeInfos();var i=this;n.forEach(function(e){var r=e.getJoinNode();var n=i.getElementsRec(r);var a=new o(n);var s=e.getJoinType();switch(s){case p.LEFT_JOIN:a=new c(a);break;case p.INNER_JOIN:break;default:throw new Error("[ERROR] Unsupported join type: "+s)}t.push(a)});return t},getElements:function(){var e=this.getRootNode();var t=this.getElementsRec(e);return t},getAliasToVarMap:function(){var e={};this.aliasToState.forEach(function(t,r){e[r]=t.varMap});return e},create:function(e,t,r){var n=e.getVarsMentioned();var i=new h(e,n,t,r);var a=i.getRootNode();return a},createWithEmptyRoot:function(e,t){var r=u.varNamesToNodes(e);var n=new h(null,r,t);var i=n.getRootNode();return i}});module.exports=h},{"../../ext/Class":2,"../../util/collection/HashBidiMap":388,"../ElementUtils":233,"../GenSym":238,"../GeneratorBlacklist":240,"../VarUtils":256,"../element/ElementGroup":262,"../element/ElementOptional":264,"./JoinInfo":309,"./JoinNode":310,"./JoinTargetState":312,"./JoinType":313}],308:[function(e,module,t){var r={getChildren:function(e){return e.getJoinNodes()}};module.exports=r},{}],309:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.alias=e;this.joinType=t},getAlias:function(){return this.alias},getJoinType:function(){return this.joinType},toString:function(){return this.joinType+" "+this.alias}});module.exports=n},{"../../ext/Class":2}],310:[function(e,module,t){var r=e("../../ext/Class");var n=e("./JoinNodeInfo");var i=e("./JoinType");var a=r.create({initialize:function(e,t,r){this.joinBuilder=e;this.alias=t;this.targetJoinVars=r},getJoinBuilder:function(){return this.joinBuilder},getJoinVars:function(){return this.targetJoinVars},getElement:function(){return this.joinBuilder.getElement(this.alias)},getVarMap:function(){return this.joinBuilder.getVarMap(this.alias)},getJoinNodeInfos:function(){var e=this.joinBuilder.getState(this.alias);var t=this;var r=e.getJoinInfos().map(function(e){var r=e.getAlias();var i=t.joinBuilder.getJoinNode(r);var a=new n(i,e.getJoinType());return a});return r},joinAny:function(e,t,r,n,i){var a=this.joinBuilder.addJoin(e,this.alias,t,r,n,i);return a},join:function(e,t,r,n){var a=this.joinAny(i.INNER_JOIN,e,t,r,n);return a},leftJoin:function(e,t,r,n){var a=this.joinAny(i.LEFT_JOIN,e,t,r,n);return a},joinTree:function(){},leftJoinTree:function(){},joinTreeAny:function(){}});module.exports=a},{"../../ext/Class":2,"./JoinNodeInfo":311,"./JoinType":313}],311:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.joinNode=e;this.joinType=t},getJoinNode:function(){return this.joinNode},getJoinType:function(){return this.joinType},toString:function(){return this.joinType+" "+this.joinNode}});module.exports=n},{"../../ext/Class":2}],312:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t,r,n){this.varMap=e;this.joinNode=t;this.element=r;this.elementVars=n;this.joinInfos=[]},getVarMap:function(){return this.varMap},getJoinNode:function(){return this.joinNode},getElement:function(){return this.element},getElementVars:function(){return this.elementVars},getJoinInfos:function(){return this.joinInfos}});module.exports=n},{"../../ext/Class":2}],313:[function(e,module,t){var r={INNER_JOIN:"inner_join",LEFT_JOIN:"left_join"};module.exports=r},{}],314:[function(e,module,t){var r=e("../expr/ExprVar");var n=e("../expr/E_LangMatches");var i=e("../expr/E_LogicalOr");var a=e("../expr/E_Lang");var s=e("../expr/E_Bound");var o=e("../expr/E_Regex");var c=e("../expr/E_Str");var u=e("../expr/E_Function");var l=e("../Concept");var f=e("../element/ElementGroup");var v=e("../element/ElementOptional");var p=e("../element/ElementFilter");var h=e("../NodeValueUtils");var d=e("../LabelUtils");var g={createConceptRegex:function(e,t,r){var n=r?this.createConceptRegexIncludeSubject(e,t):this.createConceptRegexLabelOnly(e,t);return n},createConceptRegexLabelOnly:function(e,t){var n;if(t){var i=new f([e.getElement(),new p(new o(new c(new r(e.getTargetVar())),t,"i"))]);n=new l(i,e.getSourceVar())}else{n=null}return n},createConceptRegexIncludeSubject:function(e,t){var n;if(t){var a=e.getElement();var u=e.getSourceVar();var h=e.getTargetVar();var d=new r(u);var g=new r(h);var m=new o(new c(g),t,"i");var y=new i(new o(new c(d),t,"i"),new s(g));var x=new f([new v(new f([a,new p(m)])),new p(y)]);n=new l(x,u)}else{n=null}return n},createConceptBifContains:function(e,t){var n;if(t){var i=e.getElement();var a=e.getTargetVar();var s=new r(a);var o=h.makeString(t);var c=new f([e.getElement(),new p(new u("<bif:contains>",[s,o]))]);var v=e.getSourceVar();n=new l(c,v)}else{n=null}return n}};module.exports=g},{"../Concept":228,"../LabelUtils":241,"../NodeValueUtils":243,"../element/ElementFilter":261,"../element/ElementGroup":262,"../element/ElementOptional":264,"../expr/E_Bound":277,"../expr/E_Function":280,"../expr/E_Lang":283,"../expr/E_LangMatches":284,"../expr/E_LogicalOr":289,"../expr/E_Regex":292,"../expr/E_Str":293,"../expr/ExprVar":303}],315:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../sparql/QuadUtils");var i=r.create({initialize:function(e){this.quads=e||[]},toString:function($super){var e=""+n.quadsToElement(this.quads);return e}});module.exports=i},{"../../ext/Class":2,"../../sparql/QuadUtils":246}],316:[function(e,module,t){var r=e("../../ext/Class");var n=e("./UpdateData");var i=r.create(n,{initialize:function($super,e){$super(e)},toString:function($super){var e="Delete Data { "+$super()+" }";return e}});module.exports=i},{"../../ext/Class":2,"./UpdateData":315}],317:[function(e,module,t){var r=e("../../ext/Class");var n=e("./UpdateData");var i=r.create(n,{initialize:function($super,e){$super(e)},toString:function($super){var e="Insert Data { "+$super()+" }";return e}});module.exports=i},{"../../ext/Class":2,"./UpdateData":315}],318:[function(e,module,t){var r=e("../../ext/Class");var n=e("./UpdateWithUsing");var i=e("../QuadUtils");var a=r.create(n,{initialize:function($super,e,t,r,n,i,a){$super(e,t,r);this.deleteQuads=n||[];this.insertQuads=i||[];this.whereElement=a||null},getDeleteQuads:function(){return this.deleteQuads},getInsertQuads:function(){return this.insertQuads},getWhereElement:function(){return this.whereElement},hasDeleteQuads:function(){var e=this.deleteQuads&&this.deleteQuads.length>0;return e},hasInsertQuads:function(){var e=this.insertQuads&&this.insertQuads.length>0;return e},toString:function($super){var e=this.hasInsertQuads();var t=this.hasDeleteQuads();var r=$super();if(t){r+="Delete { "+i.quadsToElement(this.getDeleteQuads())+" } "}if(e){r+="Insert { "+i.quadsToElement(this.getInsertQuads())+" } "}r+="Where { "+this.getWhereElement()+" } ";return r}});module.exports=a},{"../../ext/Class":2,"../QuadUtils":246,"./UpdateWithUsing":319}],319:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t,r){this.withNode=e;this.usingNodes=t;this.usingNamedNodes=r},toString:function(){var e="";if(this.withNode!=null){e+="WITH "+this.withNode+" "}if(this.usingNodes!=null){e+="USING "+this.usingNodes.join(" ")+" "}if(this.usingNamedNodes!=null){e+="USING NAMED"+this.usingNamedNodes.join(" ")+" "}return e}});module.exports=n},{"../../ext/Class":2}],320:[function(e,module,t){var r=e("./acc/AccRef");var n=e("./acc/AccTransform");var i={unwrapAccTransform:function(e){var t=e;while(t instanceof n){t=t.getSubAcc()}return t},getRefs:function(e,t){t=t||[];if(Array.isArray(e)){e.forEach(function(e){i.getRefs(e,t)})}else if(e instanceof r){t.push(e)}else{var n=e.getSubAccs();i.getRefs(n,t)}return t}};module.exports=i},{"./acc/AccRef":344,"./acc/AccTransform":345}],321:[function(e,module,t){var r=e("./agg/AggRef");var n=e("./agg/AggTransform");var i={unwrapAggTransform:function(e){var t=e;while(t instanceof n){t=t.getSubAgg()}return t},getRefs:function(e,t){t=t||[];if(e instanceof r){t.push(e)}else{var n=e.getSubAggs();n.forEach(function(e){i.getRefs(e,t)})}return t}};module.exports=i},{"./agg/AggRef":356,"./agg/AggTransform":357}],322:[function(e,module,t){var r=e("../ext/Class");var n=e("../util/ObjectUtils");var i=r.create({classLabel:"jassa.sponate.AttrPath",initialize:function(e){this.steps=e?e:[]},getSteps:function(){return this.steps},toString:function(){return this.steps.join(".")},slice:function(e,t){var r=this.steps.slice(e,t);return r},first:function(){return this.steps[0]},at:function(e){return this.steps[e]},isEmpty:function(){return this.steps.length===0},size:function(){return this.steps.length},concat:function(e){var t=this.steps.concat(e.getSteps());var r=new i(t);return r},find:function(e){var t=e;var r=this.steps;for(var i=0;i<r.length;++i){var a=r[i];if(!n.isObject(t)){throw new Error("[ERROR] Cannot access attribute of non-object",this.steps,e,t)}t=t[a]}return t}});i.parse=function(e){var t=e.split(".");return new i(t)};module.exports=i},{"../ext/Class":2,"../util/ObjectUtils":376}],323:[function(e,module,t){var r=e("../ext/Class");var n=e("./MappedConceptSource");var i=e("./MappedConcept");var a=e("./AggUtils");var s=e("../util/ObjectUtils");var o=e("./RefSpec");var c=e("./binding_mapper/BindingMapperExpr");var u=e("../sparql/expr/ExprVar");var l=e("./agg/AggMap");var f=e("lodash.foreach");var v=r.create({initialize:function(e){this.prefixMapping=e;this.nameToSource={}},getSource:function(e){return this.nameToSource[e]},createResolvedContext:function(){var e=new v(this.prefixMapping);f(this.nameToSource,function(t,r){var a=t.getMappedConcept();var s=a.getAgg();var o=s.clone();var c=new i(a.getConcept(),o);var u=new n(c,t.getSparqlService());e.addSource(r,u)});f(e.nameToSource,function(t,r){e.processRefs(r,t)});return e},processRefs:function(e,t){var r=t.getMappedConcept();var f=t.getSparqlService();var v=r.getAgg();var p=a.getRefs(v);var h=this;p.forEach(function(t){var v=t.getRefSpec();var p=v.getTarget();if(s.isFunction(p)){p=p()}if(p instanceof i){var d=p.getAgg();var g=d.getSubAgg();var m=g.getAttrToAgg();var y=a.unwrapAggTransform(m.id);var x=y.getBindingMapper();d=new l(x,g);var S=new i(p.getConcept(),d);var _=0;var w;while(h.getSource(w=e+"_fn_"+_)){++_}t.setRefSpec(new o(w,v.getAttr()));var b=t.getBindingMapper();if(!b){var C=r.getConcept();var E=C.getVar();b=new c(new u(E));t.setBindingMapper(b)}var L=new n(S,f);h.nameToSource[w]=L}else if(!s.isString(p)){throw new Error("Unknown target type: ",p)}})},addSource:function(e,t){this.nameToSource[e]=t}});module.exports=v},{"../ext/Class":2,"../sparql/expr/ExprVar":303,"../util/ObjectUtils":376,"./AggUtils":321,"./MappedConcept":327,"./MappedConceptSource":328,"./RefSpec":332,"./agg/AggMap":353,"./binding_mapper/BindingMapperExpr":360,"lodash.foreach":482}],324:[function(e,module,t){var r=e("../ext/Class");var n=e("./ListServiceUtils");var i=e("./AccUtils");var a=e("../util/collection/HashMap");var s=e("../util/collection/HashSet");var o=e("./LookupServiceUtils");var n=e("./ListServiceUtils");var c=e("../service/list_service/ListServiceTransformItems");var u=e("../util/ObjectUtils");var l=e("../util/Slot");var f=e("lodash.foreach");var v=e("../util/shared");var p=v.Promise;var h=e("../util/PromiseUtils");var d={indexAccMap:function(e,t,r){var n=e[t];if(!n){n=new a;e[t]=n}n.putMap(r)},mergeRefs:function(e,t){t.forEach(function(t){var r=t.getRefSpec();var n=r.getTarget();var i=t.getRefValue();var a;if(!(n in e)){a=new s;e[n]=a}else{a=e[n]}a.add(i)})},filterRefs:function(e,t){var r=[];t.forEach(function(t){var n=t.getRefSpec();var i=n.getTarget();var a=t.getRefValue();var s=e[i];var o=s&&s.containsKey(a);if(!o){r.push(t)}});return r},buildObjs:function(e){var t={};f(e,function(e,r){var n=new a;t[r]=n;e.entries().forEach(function(e){var t=e.key;var r=e.val;var i=r.getValue();n.put(t,i)})});return t},buildLazySlots:function(e,t,r,n){r=r||[];f(e,function(e,i){e.values().forEach(function(e){var i=d.buildSlots(e,t,null,n);i=i.reverse();r.push.apply(r,i)})});return r},buildSlots:function(e,t,r,n){r=r||[];if(Array.isArray(e)){e.forEach(function(i,a){var s=i&&i[t];if(s){var o=new l(e,a,i[t]);r.push(o)}if(!s||n){d.buildSlots(i,t,r,n)}})}else if(u.isObject(e)){f(e,function(i,a){var s=i&&i[t];if(s){var o=new l(e,a,i[t]);r.push(o)}if(!s||n){d.buildSlots(i,t,r,n)}})}return r},createLookupService:function(e,t){var r=e.getSource(t);if(!r){throw new Error("No source mapping with name "+t+" found")}var n=r.getSparqlService();var i=r.getMappedConcept();var a=o.createLookupServiceMappedConceptAcc(n,i);return a},createListService:function(e,t,r){var i=e.getSource(t);if(!i){throw new Error("No source mapping with name "+t+" found")}var a=i.getSparqlService();var s=i.getMappedConcept();if(s.getConcept().getVar().getName()==="rowId"){throw new Error("rowId cannot be used as the root ID of a MappedConcept")}var o=n.createListServiceAcc(a,s,r);var u=this;var l=new c(o,function(r){var n=u.collectState(e,t,r).spread(function(e,r,n){var i=u.postProcess(r,t,e);return i});return n});return l},collectState:function(e,t,r){var n={};var s=r.map(function(e){return e.key});var o=new a;var c={};r.forEach(function(e){var t=e.val;var r=t.getState();o.putMap(r);var n=i.getRefs(t);d.mergeRefs(c,n)});n[t]=o;var u=this.resolveRefs(e,c,n).then(function(e){var t=[s,n,e];return t});return u},postProcess:function(e,t,r){var n=[];f(e,function(e){var t=e.values();var r=i.getRefs(t);n.push.apply(n,r)});n.forEach(function(e){var t=e.getRefSpec();var r=t.getTarget();var n=e.getRefValue();e.setBaseValue({_ref:{targetName:r,refValue:n,attr:t.getAttr()}})});var a=d.buildObjs(e);var s=d.buildSlots(a,"_ref");var o=d.buildLazySlots(a,"_lazy",null,true);s.forEach(function(e){var t=e.getMeta();var r=a[t.targetName];var n=r.get(t.refValue);var i=t.attr;n=n!=null&&i!=null?n[i]:n;e.setValue(n)});o.forEach(function(e){var t=e.getMeta();var r=t.fn;var n=t.value;var i=r(n);e.setValue(i)});var c=r.map(function(e){var r=a[t];var n=r.get(e);var i={key:e,val:n};return i});return c},exec:function(e,t){var r=t.getSourceName();var n=this.createListService(e,r,t.isLeftJoin());var i=t.getLimit();var a=t.getOffset();var s=t.getFilterConcept();var o=n.fetchItems(s,i,a);return o},resolveRefs:function(e,t,r){var n=this;var a=Object.keys(t);var s=a.map(function(a){var s=t[a];var o=n.createLookupService(e,a);var c=s.entries();var u=o.lookup(c).then(function(t){var s=t.values();d.indexAccMap(r,a,t);var o=i.getRefs(s);var c=d.filterRefs(r,o);var u={};d.mergeRefs(u,c);var l=n.resolveRefs(e,u,r);return l});return u});return h.all(s)}};module.exports=d},{"../ext/Class":2,"../service/list_service/ListServiceTransformItems":169,"../util/ObjectUtils":376,"../util/PromiseUtils":378,"../util/Slot":382,"../util/collection/HashMap":389,"../util/collection/HashSet":390,"../util/shared":403,"./AccUtils":320,"./ListServiceUtils":325,"./LookupServiceUtils":326,"lodash.foreach":482}],325:[function(e,module,t){var r=e("../sparql/Concept");var n=e("../sparql/ConceptUtils");var i=e("./ServiceUtils");var a=e("../service/list_service/ListServiceSparqlQuery");var s=e("../service/list_service/ListServiceTransformItem");var o=e("../rdf/NodeFactory");var c=e("../sparql/BindingUtils");var u={createListServiceAcc:function(e,t,r){r=!!r;var i=t.getConcept();var u=n.createQueryList(i);var l=t.getAgg();var f=o.createVar("rowId");u.setQueryResultStar(true);var v=new a(e,u,i.getVar(),r);var p=new s(v,function(e){var t=e.key;var r=e.val.getBindings();r=c.cloneBindings(r);c.addRowIds(r,f);var n=l.createAcc();r.forEach(function(e){n.accumulate(e)});var i={key:t,val:n};return i});return p},createListServiceMappedConcept:function(e,t,r){var n=this.createListServiceAcc(e,t,r);var i=new s(n,function(e){var t=e.map(function(e){var t=e.val.getValue();return t});return t});return i}};module.exports=u},{"../rdf/NodeFactory":99,"../service/list_service/ListServiceSparqlQuery":165,"../service/list_service/ListServiceTransformItem":168,"../sparql/BindingUtils":226,"../sparql/Concept":228,"../sparql/ConceptUtils":229,"./ServiceUtils":334}],326:[function(e,module,t){var r=e("../sparql/ConceptUtils");var n=e("../service/lookup_service/LookupServiceSparqlQuery");var i=e("../service/lookup_service/LookupServiceTransform");var a=e("../service/lookup_service/LookupServiceFallback");var s=e("../service/lookup_service/LookupServiceFn");var o=e("../service/lookup_service/LookupServiceIdFilter");var c=e("../service/lookup_service/LookupServiceChunker");var u=e("../sparql/BestLabelConfig");var l=e("../util/ObjectUtils");var f=e("./MappedConceptUtils");var v=e("../rdf/NodeUtils");var p=e("../util/UriUtils");var h=e("../util/collection/HashMap");var d=e("./AccUtils");var g=e("../sparql/LiteralPreference");var m={createTransformAccResultSetPart:function(e){var t=function(t){var r=e.createAcc();var n=t.getBindings();n.forEach(function(e){r.accumulate(e)});return r};return t},createLookupServiceNodeLabels:function(e,t,r){t=t||new g;var n=new u(t);var i=f.createMappedConceptBestLabel(n);var h=this.createLookupServiceMappedConcept(e,i);if(r){h=new c(h,r)}h=new o(h,function(e){var t=e&&e.isUri();if(t){var r=e.getUri();t=p.isValidUri(r)}return t});var d=new s(function(e){var t=v.toPrettyString(e);return t});h=new a(h,d,function(e,t){var r=e==null||e.displayLabel==null;return r},function(e,t){var r={};if(t!=null){l.extend(r,t)}r.displayLabel=e;return r});return h},createLookupServiceMappedConcept:function(e,t){var r=this.createLookupServiceMappedConceptAcc(e,t);var n=new i(r,function(e){var t=e.getValue();return t});return n},createLookupServiceMappedConceptAcc:function(e,t){var a=t.getConcept();var s=r.createQueryList(a);var o=a.getVar();s.setQueryResultStar(true);var c=t.getAgg();var u=c.getSubAgg();var l=new n(e,s,o);var f=this.createTransformAccResultSetPart(u);var v=new i(l,f);return v}};module.exports=m},{"../rdf/NodeUtils":100,"../service/lookup_service/LookupServiceChunker":173,"../service/lookup_service/LookupServiceFallback":176,"../service/lookup_service/LookupServiceFn":177,"../service/lookup_service/LookupServiceIdFilter":179,"../service/lookup_service/LookupServiceSparqlQuery":184,"../service/lookup_service/LookupServiceTransform":186,"../sparql/BestLabelConfig":224,"../sparql/ConceptUtils":229,"../sparql/LiteralPreference":242,"../util/ObjectUtils":376,"../util/UriUtils":385,"../util/collection/HashMap":389,"./AccUtils":320,"./MappedConceptUtils":329}],327:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.concept=e;this.agg=t},getConcept:function(){return this.concept},getAgg:function(){return this.agg}});module.exports=n},{"../ext/Class":2}],328:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.mappedConcept=e;this.sparqlService=t},getMappedConcept:function(){return this.mappedConcept},getSparqlService:function(){return this.sparqlService}});module.exports=n},{"../ext/Class":2}],329:[function(e,module,t){var r=e("../rdf/NodeUtils");var n=e("../sparql/LabelUtils");var i=e("../sparql/VarUtils");var a=e("../sparql/expr/ExprVar");var s=e("./agg/AggArray");var o=e("./agg/AggLiteral");var c=e("./agg/AggMap");var u=e("./agg/AggObject");var l=e("./agg/AggBestLabel");var f=e("./agg/AggTransform");var v=e("./binding_mapper/BindingMapperExpr");var p=e("./binding_mapper/BindingMapperTransform");var h=e("../sparql/Concept");var d=e("./MappedConcept");var r=e("../rdf/NodeUtils");var g=e("../sparql/BestLabelConfig");var m={createMappedConceptLiteralPreference:function(e){var t=new g(e);var r=m.createMappedConceptBestLabel(t);return r},createMappedConceptBestLabel:function(e){var t=n.createRelationPrefLabels(e);var i=t.getSourceVar();var p=t.getTargetVar();var g=new u({id:new f(new o(new v(new a(i))),r.getValue),displayLabel:new f(new l(e),r.getValue),hiddenLabels:new s(new f(new o(new v(new a(p))),r.getValue))});g=new c(new v(new a(i)),g);var m=new h(t.getElement(),t.getSourceVar());var y=new d(m,g);return y}};module.exports=m},{"../rdf/NodeUtils":100,"../sparql/BestLabelConfig":224,"../sparql/Concept":228,"../sparql/LabelUtils":241,"../sparql/VarUtils":256,"../sparql/expr/ExprVar":303,"./MappedConcept":327,"./agg/AggArray":348,"./agg/AggBestLabel":350,"./agg/AggLiteral":352,"./agg/AggMap":353,"./agg/AggObject":354,"./agg/AggTransform":357,"./binding_mapper/BindingMapperExpr":360,"./binding_mapper/BindingMapperTransform":362}],330:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t,r){this.mapName=e;this.tableRef=t},getMapName:function(){return this.mapName},getTableRef:function(){return this.tableRef},getAttrPath:function(){return this.attrPath},toString:function(){var e=this.patternRef+"/"+this.tableRef+"@"+this.attrPath;return e}});module.exports=n},{"../ext/Class":2}],331:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t,r,n,i,a,s){this.sourceName=e;this.criteria=t;this.limit=r;this.offset=n;this.filterConcept=i;this._isLeftJoin=a;this.nodes=s},shallowClone:function(){var e=new n(this.sourceName,this.criteria,this.limit,this.offset,this.filterConcept,this._isLeftJoin,this.nodes);return e},getSourceName:function(){return this.sourceName},setSourceName:function(e){this.sourceName=e},getCriteria:function(){return this.criteria},setCriteria:function(e){this.criteria=e},getLimit:function(){return this.limit},setLimit:function(e){this.limit=e},getOffset:function(){return this.offset},setOffset:function(e){this.offset=e},getFilterConcept:function(){return this.filterConcept},setFilterConcept:function(e){this.filterConcept=e},isLeftJoin:function(){return this._isLeftJoin},setLeftJoin:function(e){this._isLeftJoin=e},getNodes:function(){return this.nodes},setNodes:function(e){this.nodes=e}});module.exports=n},{"../ext/Class":2}],332:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t){this.target=e;this.attr=t},getTarget:function(){return this.target},getAttr:function(){return this.attr}});module.exports=n},{"../ext/Class":2}],333:[function(e,module,t){var r=e("../rdf/NodeUtils");var n=e("../util/collection/HashMap");var i=e("./MappedConceptUtils");var a=e("../sparql/BestLabelConfig");var s=e("./facade/StoreFacade");var o=e("../service/lookup_service/LookupServiceListServiceSparql");var c={createRexLookupService:function(e){var t=new s(e,{});var c=new a;var u=i.createMappedConceptBestLabel(c);var l=function(e){var t={};var n=e.entries();n.forEach(function(e){var n=e.key;var i=e.val.predicates.entries();var a=t[n]={};i.forEach(function(e){var t=e.key;var n=a[t]={};var i=e.val.values.entries();i.forEach(function(e){var t=e.val.id;var i=r.toTalisRdfJson(t);n.push(i)})})})};var f=function(e){var t=new n;e.forEach(function(e){t.put(e.id,e)});return t};var v=function(e){var t=e.map(function(e){var t=r.toTalisRdfJson(e.id);return t});return t};var p=function(e){var t={};var i=new n;e.forEach(function(e){var n=e.s+" "+e.p;var a=t[n]=t[n]||0;++t[n];var s=r.toTalisRdfJson(e.o);var o=Object.keys(s);o.forEach(function(t){var r={s:e.s,p:e.p,i:a,c:t};var n=s[t];i.put(r,n)})});return i};t.addMap({name:"spo",template:[{id:"?s",data:[[{id:"?rowId",s:"?s",p:"?p",o:"?o | node"}],p]}],from:"?s ?p ?o"});var h=t.spo.getListService();var d=new o(h);return d}};module.exports=c},{"../rdf/NodeUtils":100,"../service/lookup_service/LookupServiceListServiceSparql":181,"../sparql/BestLabelConfig":224,"../util/collection/HashMap":389,"./MappedConceptUtils":329,"./facade/StoreFacade":365}],334:[function(e,module,t){var r={processResultSet:function(e,t){while(e.hasNext()){var r=e.next();t.accumulate(r)}var n=t.getValue();return n},processBindings:function(e,t){e.forEach(function(e){t.accumulate(e)});var r=t.getValue();return r},execAgg:function(e,t,r){var n=r.createAcc();var i=this.execAcc(e,t,n);return i},execAcc:function(e,t,n){var i=e.createQueryExecution(t);var a=i.execSelect().then(function(e){var t=r.processResultSet(e,n);return t});return a}};module.exports=r},{}],335:[function(e,module,t){var r=e("../util/ObjectUtils");var n=e("../util/PrefixUtils");var i=e("../sparql/element/Element");var a=e("../sparql/element/ElementString");var s=e("./TemplateParser");var o=e("./ListServiceUtils");var c=e("./agg/AggMap")
;var u=e("./MappedConcept");var l=e("../sparql/expr/ExprVar");var f=e("../sparql/Concept");var v=e("./AggUtils");var p={parseSpec:function(e,t,r){var n=e.template;var i=n instanceof u?n:this.parseSpecCore(e,t,r);return i},parseSpecCore:function(e,t,o){o=o||new s;var p=e.template;var h=e.from;var d;if(r.isString(h)){var g=h;if(t!=null){var m=t.getNsPrefixMap();g=n.expandPrefixes(m,g)}d=new a.create(g)}else if(h instanceof i){d=h}else if(r.isFunction(h)){throw new Error("ElementFactories / functions in the FROM part not supported anymore")}else{throw new Error("Unknown argument type for FROM attribute",h)}var y=o.parseAgg(p);var x=v.unwrapAggTransform(y);var S;if(x instanceof c){var _=x.getKeyBindingMapper();S=_.getExpr()}else{throw new Error("Could not obtain ID attribute from aggregator")}var w;if(S instanceof l){w=S.asVar()}else{throw new Error("Variable required for ID attribute, got an expression instead: "+S)}var b=new f(d,w);var C=new u(b,x);return C}};module.exports=p},{"../sparql/Concept":228,"../sparql/element/Element":259,"../sparql/element/ElementString":265,"../sparql/expr/ExprVar":303,"../util/ObjectUtils":376,"../util/PrefixUtils":377,"./AggUtils":321,"./ListServiceUtils":325,"./MappedConcept":327,"./TemplateParser":336,"./agg/AggMap":353}],336:[function(e,module,t){var r=e("lodash.uniq");var n=e("../ext/Class");var i=e("../util/ObjectUtils");var a=e("../rdf/NodeUtils");var s=e("../rdf/node/Node");var o=e("../rdf/node/Var");var c=e("../rdf/NodeFactory");var u=e("../sparql/expr/Expr");var l=e("../sparql/expr/ExprVar");var f=e("../sparql/expr/NodeValue");var v=e("../sparql/NodeValueUtils");var p=e("./agg/AggLiteral");var h=e("./agg/AggObjectCustom");var d=e("./agg/AggMap");var g=e("./agg/AggMap");var m=e("./agg/AggRef");var y=e("./agg/AggArray");var x=e("./agg/AggArrayStatic");var S=e("./agg/AggTransform");var _=e("./agg/AggTransformLazy");var w=e("./AggUtils");var b=e("./RefSpec");var C=e("./binding_mapper/BindingMapperExpr");var E=n.create({initialize:function(){this.attrs={id:"id",ref:"$ref"}},parseArray:function(e){var t=this;var r=e[e.length-1];var n=i.isFunction(r);var a;if(n){a=this.parseArrayTransform(e)}else{var s=e.some(function(e){var t=e.id||e.$ref||i.isString(e);return t});a=!s?this.parseArrayStatic(e):this.parseArrayDynamic(e)}return a},parseArrayTransform:function(e){var t=e.length-1;var r=e[t];var n=this;var i=e.slice(0,t);var a=i.map(function(e){var t=n.parseAgg(e);return t});var s=new x(a);var o=new _(s,function(e){var t=r.apply(null,e);return t});return o},parseArrayStatic:function(e){var t=this;var r=e.map(function(e){var r=t.parseAgg(e);return r});var n=new x(r);return n},parseArrayDynamic:function(e){if(e.length!==1){throw new Error("[ERROR] Arrays must have exactly one element that is either a string or an object",e)}var t=e[0];var r;if(i.isString(t)){r=this.parseArrayLiteral(t)}else if(Array.isArray(t)){if(t.length===1){var n=t[0];r=this.parseArrayConfig(n);var a=Object.keys(n);var s=a.length===2&&a.indexOf("id")>=0&&a.indexOf("$value")>=0;r=new S(r,function(e){var t={};e.forEach(function(e){t[e.id]=s?e.$value:e});return t})}else{throw new Error("Not implemented")}}else if(i.isObject(t)){r=this.parseArrayConfig(t)}else{throw new Error("Bailing out")}return r},parseArrayConfig:function(e){var t=this.attrs.id;var r=this.attrs.ref;var n=e[t]!=null;var i=e[r]!=null;if(n&&i){throw new Error("[ERROR] id and ref are mutually exclusive")}var a;if(n){var s=this.parseObject(e);var o=s.getAttrToAgg();var c=o[t];c=w.unwrapAggTransform(c);var u=c.getBindingMapper();a=new d(u,s);a=new S(a,function(e){return e.values()})}else if(i){a=this.parseArrayRef(e)}else{throw new Error("[ERROR] Not implemented")}return a},parseArrayRef:function(e){var t=e[this.attrs.ref];var r=this.parseRef(t);var n=r.getBindingMapper();var i=new d(n,r);i=new S(i,function(e){return e.values()});return i},parseArrayLiteral:function(e){var t=this.parseLiteral(e);var n=new S(new y(t),function(e){return r(e,function(e){return""+e})});return n},parseLiteral:function(e){var t=e.split("|").map(function(e){return e.trim()});var r=t[0];var n=this.parseExprString(r);var i=new p(new C(n));var s=t[1];if(s!=="node"){i=new S(i,a.getValue)}return i},parseObject:function(e){var t=e[this.attrs.ref];var r=t!=null?this.parseRef(t):this.parseObjectData(e);return r},parseRef:function(e){var t=e.target;if(!t){throw new Error("Missing target attribute in ref: ",e)}var r=new b(t,e.attr);var n=e.on;var i=null;if(n){var a=this.parseExprString(n);i=new C(a)}var s=new m(i,r);return s},parseObjectData:function(e){var t={};var r=this;var n=Object.keys(e);n.forEach(function(n){var i=e[n];var a=r.parseAgg(i);if(a==null){throw new Error("Failed to create aggregator for attribute ["+n+"] in "+JSON.stringify(e))}t[n]=a});var i=new h(t,this);return i},parseAgg:function(e){var t;if(i.isString(e)){t=this.parseLiteral(e)}else if(Array.isArray(e)){t=this.parseArray(e)}else if(i.isFunction(e)){throw new Error("Implement this case: "+JSON.stringify(e))}else if(e instanceof s&&e.isVariable()){var r=new l(e);t=new p(new C(r))}else if(e instanceof u){t=new p(new C(e))}else if(i.isObject(e)){var n=e.createAgg;if(n){t=new g(e)}else{t=this.parseObject(e)}}else{console.log("[ERROR] Unknown item type: ",e);throw new Error("Unkown item type")}return t},parseExpr:function(e){var t;if(i.isString(e)){t=this.parseExprString(e)}else if(e instanceof s&&e.isVariable()){t=new l(e)}else{throw new Error("Could not parse expression: ",e)}return t},parseExprString:function(e){var t;var r=e.charAt(0);if(r==="?"){var n=e.substr(1);var i=c.createVar(n);t=new l(i)}else if(r==='"'||r==="'"){t=e.substring(1,e.length-1);t=v.makeString(t)}else{t=v.makeString(e)}return t}});module.exports=E},{"../ext/Class":2,"../rdf/NodeFactory":99,"../rdf/NodeUtils":100,"../rdf/node/Node":112,"../rdf/node/Var":119,"../sparql/NodeValueUtils":243,"../sparql/expr/Expr":294,"../sparql/expr/ExprVar":303,"../sparql/expr/NodeValue":304,"../util/ObjectUtils":376,"./AggUtils":321,"./RefSpec":332,"./agg/AggArray":348,"./agg/AggArrayStatic":349,"./agg/AggLiteral":352,"./agg/AggMap":353,"./agg/AggObjectCustom":355,"./agg/AggRef":356,"./agg/AggTransform":357,"./agg/AggTransformLazy":358,"./binding_mapper/BindingMapperExpr":360,"lodash.uniq":496}],337:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({classLabel:"jassa.sponate.acc",accumulate:function(e){throw new Error("override me")},getValue:function(){throw new Error("override me")},getSubAccs:function(){throw new Error("override me")}});module.exports=n},{"../../ext/Class":2}],338:[function(e,module,t){var r=e("../../ext/Class");var n=e("../binding_mapper/BindingMapperIndex");var i=e("./Acc");var a=r.create(i,{classLabel:"jassa.sponate.AccFn",initialize:function(e,t){var r=this;this.i=0;this.subAgg=e;this.indexBindingMapper=t||new n;this.subAccs=[]},accumulate:function(e){var t=this.indexBindingMapper.map(e,this.i++);if(t!=null){var r=this.subAccs[t];if(!r){r=this.subAgg.createAcc();this.subAccs[t]=r}r.accumulate(e)}},getValue:function(){var e=[];this.subAccs.forEach(function(t,r){var n=t.getValue();if(n!=null){e[r]=n}});return e},getSubAccs:function(){var e=[];this.subAccs.forEach(function(t){if(t){e.push(t)}});return e}});module.exports=a},{"../../ext/Class":2,"../binding_mapper/BindingMapperIndex":361,"./Acc":337}],339:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Acc");var i=r.create(n,{classLabel:"jassa.sponate.AccArrayStatic",initialize:function(e){this.subAccs=e},accumulate:function(e){this.subAccs.forEach(function(t){t.accumulate(e)})},getValue:function(){var e=this.subAccs.map(function(e){var t=e.getValue();return t});return e},getSubAccs:function(){return this.subAccs}});module.exports=i},{"../../ext/Class":2,"./Acc":337}],340:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeUtils");var i=e("./Acc");var a=function(e,t){var r=[];var n=Math.max(e.length,t.length);for(var i=0;i<n;++i){var a=[e[i],t[i]];r.push(a)}return r};var s=function(e,t,r){var n=false;var i=Math.max(e.length,t.length);for(var a=0;a<i;++a){var s=e[a];var o=t[a];if(r(s,o)){if(r(o,s)){continue}n=true;break}else{if(!r(o,s)){continue}n=false;break}}return n};var o=function(e,t){return e<t};var c=function(e,t){var r=-1;for(var n=0;n<e.length;++n){var i=e[n];if(i.equals(t)){r=n;break}}return r};var u=r.create(i,{initialize:function(e){this.bestLiteralConfig=e;this.bestMatchNode=null;this.bestMatchScore=[1e3,1e3]},getSubAccs:function(){return[]},accumulate:function(e){var t=this.bestLiteralConfig;var r=e.get(t.getSubjectVar());var i=e.get(t.getPredicateVar());var a=e.get(t.getObjectVar());if(this.bestMatchNode==null){this.bestMatchNode=r}var u=n.getLang(a);var l=c(t.getPredicates(),i);var f=t.getLangs().indexOf(u);var v=[l,f];var p=v.every(function(e){return e>=0});if(p){var h=s(v,this.bestMatchScore,o);if(h===true){this.bestMatchScore=v;this.bestMatchNode=a}}},getValue:function(){return this.bestMatchNode}});module.exports=u},{"../../ext/Class":2,"../../rdf/NodeUtils":100,"./Acc":337}],341:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/ObjectUtils");var i=e("./Acc");var a=r.create(i,{classLabel:"jassa.sponate.AccLiteral",initialize:function(e){this.bindingMapper=e;this.value=null},accumulate:function(e){var t=this.bindingMapper.map(e,0);if(false){if(this.value!=null&&!n.isEqual(this.value,t)){console.log("[WARN] Reassigned value: Original",this.value," New: ",t)}}this.value=t},getValue:function(){return this.value},getSubAccs:function(){return[]}});module.exports=a},{"../../ext/Class":2,"../../util/ObjectUtils":376,"./Acc":337}],342:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../util/collection/HashMap");var i=e("./Acc");var a=r.create(i,{classLabel:"jassa.sponate.AccMap",initialize:function(e,t){this.keyBindingMapper=e;this.subAgg=t;this.state=new n},getState:function(){return this.state},accumulate:function(e){var t=this.keyBindingMapper.map(e,0);if(t!=null){var r=this.state.get(t);if(!r){r=this.subAgg.createAcc();this.state.put(t,r)}r.accumulate(e)}},getValue:function(){var e=new n;var t=this.state.entries();t.forEach(function(t){var r=t.key;var n=t.val;var i=n.getValue();e.put(r,i)});return e},getSubAccs:function(){var e=this.state.entries();var t=e.map(function(e){return e.val});return t}});module.exports=a},{"../../ext/Class":2,"../../util/collection/HashMap":389,"./Acc":337}],343:[function(e,module,t){var r=e("lodash.foreach");var n=e("../../ext/Class");var i=e("./Acc");var a=n.create(i,{classLabel:"jassa.sponate.AccObject",initialize:function(e){this.attrToAcc=e},accumulate:function(e){r(this.attrToAcc,function(t){t.accumulate(e)})},getValue:function(){var e={};r(this.attrToAcc,function(t,r){var n=t.getValue();e[r]=n});return e},getSubAccs:function(){var e=[];r(this.attrToAcc,function(t){e.push(t)});return e}});module.exports=a},{"../../ext/Class":2,"./Acc":337,"lodash.foreach":482}],344:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Acc");var i=r.create(n,{classLabel:"jassa.sponate.AccRef",initialize:function(e,t){this.bindingMapper=e;this.refSpec=t;this.refValue=null;this.baseValue=null},getSubAccs:function(){return[]},getRefSpec:function(){return this.refSpec},getRefValue:function(){return this.refValue},accumulate:function(e){var t=this.bindingMapper.map(e,0);this.refValue=t},getBaseValue:function(){return this.baseValue},setBaseValue:function(e){this.baseValue=e},getValue:function(){return this.baseValue}});module.exports=i},{"../../ext/Class":2,"./Acc":337}],345:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Acc");var i=r.create(n,{classLabel:"jassa.sponate.AccTransform",initialize:function(e,t){this.subAcc=e;this.fn=t},getSubAcc:function(){return this.subAcc},accumulate:function(e){this.subAcc.accumulate(e)},getValue:function(){var e=this.subAcc.getValue();var t=this.fn(e);return t},getSubAccs:function(){return[this.subAcc]}});module.exports=i},{"../../ext/Class":2,"./Acc":337}],346:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Acc");var i=r.create(n,{classLabel:"jassa.sponate.AccTransformLazy",initialize:function(e,t){this.subAcc=e;this.fn=t},getSubAcc:function(){return this.subAcc},accumulate:function(e){this.subAcc.accumulate(e)},getValue:function(){var e={_lazy:{value:this.subAcc.getValue(),fn:this.fn}};return e},getSubAccs:function(){return[this.subAcc]}});module.exports=i},{"../../ext/Class":2,"./Acc":337}],347:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({classLabel:"jassa.sponate.Agg",createAcc:function(){throw new Error("override me")},getSubAggs:function(){throw new Error("override me")},clone:function(){throw new Error("override me")}});module.exports=n},{"../../ext/Class":2}],348:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Agg");var i=e("../acc/AccArray");var a=r.create(n,{classLabel:"jassa.sponate.AggArray",initialize:function(e,t){this.subAgg=e;this.indexBindingMapper=t},clone:function(){var e=new a(this.subAgg.clone(),this.indexBindingMapper);return e},createAcc:function(){var e=new i(this.subAgg,this.indexBindingMapper);return e},getSubAgg:function(){return this.subAgg},getIndexBindingMapper:function(){return this.indexBindingMapper},getSubAggs:function(){return[this.subAgg]},toString:function(){return this.expr.toString()}});module.exports=a},{"../../ext/Class":2,"../acc/AccArray":338,"./Agg":347}],349:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Agg");var i=e("../acc/AccArrayStatic");var a=r.create(n,{classLabel:"jassa.sponate.AggArrayStatic",initialize:function(e){this.subAggs=e},clone:function(){var e=this.subAggs.map(function(e){return e.clone()});var t=new a(e);return t},createAcc:function(){var e=this.subAggs.map(function(e){return e.createAcc()});var t=new i(e);return t},getSubAggs:function(){return this.subAggs},toString:function(){return"implement me"}});module.exports=a},{"../../ext/Class":2,"../acc/AccArrayStatic":339,"./Agg":347}],350:[function(e,module,t){var r=e("lodash.union");var n=e("../../ext/Class");var i=e("./Agg");var a=e("../acc/AccBestLabel");var s=n.create(i,{initialize:function(e){this.bestLiteralConfig=e},clone:function(){var e=new s(this.bestLiteralConfig);return e},createAcc:function(){var e=new a(this.bestLiteralConfig);return e},getSubAggs:function(){return[]},toString:function(){var e="bestLabel["+this.bestLiteralConfig+"]";return e}});module.exports=s},{"../../ext/Class":2,"../acc/AccBestLabel":340,"./Agg":347,"lodash.union":495}],351:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Agg");var i=r.create(n,{classLabel:"jassa.sponate.AggCustomAgg",initialize:function(e){this.fnAcc=e},getSubAggs:function(){return[]}});module.exports=i},{"../../ext/Class":2,"./Agg":347}],352:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Agg");var i=e("../acc/AccLiteral");var a=r.create(n,{classLabel:"jassa.sponate.AggLiteral",initialize:function(e){this.bindingMapper=e},clone:function(){var e=new a(this.bindingMapper);return e},getBindingMapper:function(){return this.bindingMapper},getSubAggs:function(){return[]},createAcc:function(){var e=new i(this.bindingMapper);return e}});module.exports=a},{"../../ext/Class":2,"../acc/AccLiteral":341,"./Agg":347}],353:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Agg");var i=e("../acc/AccMap");var a=r.create(n,{classLabel:"jassa.sponate.AggMap",initialize:function(e,t){this.keyBindingMapper=e;this.subAgg=t},clone:function(){var e=new a(this.keyBindingMapper,this.subAgg.clone());return e},getKeyBindingMapper:function(){return this.keyBindingMapper},getSubAgg:function(){return this.subAgg},getSubAggs:function(){return[this.subAgg]},createAcc:function(){var e=new i(this.keyBindingMapper,this.subAgg);return e},toString:function(){var e="["+this.keyExpr+" -> "+this.subAgg+"]";return e}});module.exports=a},{"../../ext/Class":2,"../acc/AccMap":342,"./Agg":347}],354:[function(e,module,t){var r=e("lodash.foreach");var n=e("../../ext/Class");var i=e("./Agg");var a=e("../acc/AccObject");var s=n.create(i,{classLabel:"jassa.sponate.AggObject",initialize:function(e){this.attrToAgg=e},clone:function(){var e={};r(this.attrToAgg,function(t,r){e[r]=t.clone()});var t=new s(e);return t},getAttrToAgg:function(){return this.attrToAgg},createAcc:function(){var e={};r(this.attrToAgg,function(t,r){var n=t.createAcc();e[r]=n});var t=new a(e);return t},getSubAggs:function(){var e=[];r(this.attrToAgg,function(t){e.push(t)});return e},toString:function(){var e=[];r(this.attrToAgg,function(t,r){e.push('"'+r+'": '+t)});var t="{"+e.join(",")+"}";return t}});module.exports=s},{"../../ext/Class":2,"../acc/AccObject":343,"./Agg":347,"lodash.foreach":482}],355:[function(e,module,t){var r=e("../../ext/Class");var n=e("./AggObject");var i=r.create(n,{initialize:function($super,e,t){$super(e);this.templateParser=t},add:function(e,t){var r=this.templateParser.parseAgg(t);this.attrToAgg[e]=r;return r},del:function(e){delete this.attrToAgg[e]}});module.exports=i},{"../../ext/Class":2,"./AggObject":354}],356:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeFactory");var i=e("../acc/AccRef");var a=e("./Agg");var s=r.create(a,{classLabel:"jassa.sponate.AggRef",initialize:function(e,t){this.bindingMapper=e;this.refSpec=t},clone:function(){var e=new s(this.bindingMapper,this.refSpec);return e},getBindingMapper:function(){return this.bindingMapper},setBindingMapper:function(e){this.bindingMapper=e},getRefSpec:function(){return this.refSpec},setRefSpec:function(e){this.refSpec=e},getSubAggs:function(){return[]},createAcc:function(){var e=new i(this.bindingMapper,this.refSpec);return e},toString:function(){return JSON.stringify(this)}});module.exports=s},{"../../ext/Class":2,"../../rdf/NodeFactory":99,"../acc/AccRef":344,"./Agg":347}],357:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeFactory");var i=e("../acc/AccTransform");var a=e("./Agg");var s=r.create(a,{classLabel:"jassa.sponate.AggTransform",initialize:function(e,t){this.subAgg=e;this.fn=t},clone:function(){var e=new s(this.subAgg.clone(),this.fn);return e},getSubAgg:function(){return this.subAgg},getSubAggs:function(){return[this.subAgg]},createAcc:function(){var e=this.subAgg.createAcc();var t=new i(e,this.fn);return t},toString:function(){return JSON.stringify(this)}});module.exports=s},{"../../ext/Class":2,"../../rdf/NodeFactory":99,"../acc/AccTransform":345,"./Agg":347}],358:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/NodeFactory");var i=e("../acc/AccTransformLazy");var a=e("./Agg");var s=r.create(a,{classLabel:"jassa.sponate.AggTransformLazy",initialize:function(e,t){this.subAgg=e;this.fn=t},clone:function(){var e=new s(this.subAgg.clone(),this.fn);return e},getSubAgg:function(){return this.subAgg},getSubAggs:function(){return[this.subAgg]},createAcc:function(){var e=this.subAgg.createAcc();var t=new i(e,this.fn);return t},toString:function(){return JSON.stringify(this)}});module.exports=s},{"../../ext/Class":2,"../../rdf/NodeFactory":99,"../acc/AccTransformLazy":346,"./Agg":347}],359:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({map:function(e,t){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],360:[function(e,module,t){var r=e("../../ext/Class");var n=e("./BindingMapper");var i=r.create(n,{initialize:function(e){this.expr=e},getExpr:function(){return this.expr},map:function(e,t){var r=this.expr.eval(e);var n=r.asNode();return n}});module.exports=i},{"../../ext/Class":2,"./BindingMapper":359}],361:[function(e,module,t){var r=e("../../ext/Class");var n=e("./BindingMapper");var i=r.create(n,{map:function(e,t){return t}});module.exports=i},{"../../ext/Class":2,"./BindingMapper":359}],362:[function(e,module,t){var r=e("../../ext/Class");var n=e("./BindingMapper");var i=r.create(n,{initialize:function(e,t){this.subBindingMapper=e;this.fn=t},map:function(e,t){var r=this.subBindingMapper.map(e,t);var n=this.fn(r);return n}});module.exports=i},{"../../ext/Class":2,"./BindingMapper":359}],363:[function(e,module,t){var r=e("../../ext/Class");var n=e("./QueryFlow");var i=r.create({initialize:function(e,t){this.storeFacade=e;this.mappingName=t},getAggObject:function(){var e=this.getSource().getMappedConcept().getAgg().getSubAgg();return e},getSource:function(){var e=this.storeFacade.getContext().getSource(this.mappingName);return e},getListService:function(){var e=this.storeFacade.getListService(this.mappingName);return e},find:function(e){if(e){throw new Error("Criteria queries are currently not supported anymore - Sorry :/")}var t=new n(this.storeFacade,this.mappingName,e);return t}});module.exports=i},{"../../ext/Class":2,"./QueryFlow":364}],364:[function(e,module,t){var r=e("../../ext/Class");var n=e("../Query");var i=e("../Engine");var a=r.create({initialize:function(e,t,r){this.storeFacade=e;this.query=new n;this.query.setSourceName(t);this.query.setCriteria(r)},concept:function(e,t){this.query.setFilterConcept(e);this.query.setLeftJoin(t);return this},nodes:function(e){this.query.setNodes(e);return this},skip:function(e){this.query.setOffset(e);return this},limit:function(e){this.query.setLimit(e);return this},offset:function(e){this.query.setOffset(e);return this},list:function(){var e=this.storeFacade.getContext().createResolvedContext();var t=i.exec(e,this.query);return t},count:function(){}});module.exports=a},{"../../ext/Class":2,"../Engine":324,"../Query":331}],365:[function(e,module,t){var r=e("../../ext/Class");var n=e("../../rdf/PrefixMappingImpl");var i=e("../../util/ObjectUtils");var a=e("../Context");var s=e("../Engine");var o=e("../SponateUtils");var c=e("../MappedConceptSource");var u=e("../MappedConcept");var l=e("../../service/list_service/ListServiceFn");var f=e("./CollectionFacade");var i=e("../../util/ObjectUtils");var v=e("lodash.foreach");var p=r.create({initialize:function(e,t,r){this.defaultSparqlService=e;this.prefixMapping=t?t instanceof n?t:new n(t):new n;this.context=r||new a(t);this.nameToMappedConcept={}},getContext:function(){return this.context},addTemplate:function(e){var t=e.name;if(!t){throw new Error("Sponate spec must have a name")}var r=o.parseSpec(e,this.prefixMapping);this.nameToMappedConcept[t]=r},addMap:function(e){var t=e.name;if(!t){throw new Error("Sponate spec must have a name")}var r=e.service||this.defaultSparqlService;if(!r){throw new Error("No service provided for ",e)}var n;if(i.isString(e.template)){var a=e.template;var s=this.nameToMappedConcept[a];if(!s){throw new Error("No template with name "+a+" registered.")}n=new u(s.getConcept(),s.getAgg().clone())}else{n=o.parseSpec(e,this.prefixMapping)}var l=new c(n,r);this.context.addSource(t,l);this[t]=new f(this,t);return l},getListService:function(e,t){var r=this;var n=function(){var n=r.context.createResolvedContext();var i=s.createListService(n,e,t);return i};var i=new l(n);return i}});module.exports=p},{"../../ext/Class":2,"../../rdf/PrefixMappingImpl":101,"../../service/list_service/ListServiceFn":162,"../../util/ObjectUtils":376,"../Context":323,"../Engine":324,"../MappedConcept":327,"../MappedConceptSource":328,"../SponateUtils":335,"./CollectionFacade":363,"lodash.foreach":482}],366:[function(e,module,t){"use strict";var r={AccUtils:e("./AccUtils"),AggUtils:e("./AggUtils"),AttrPath:e("./AttrPath"),Context:e("./Context"),Engine:e("./Engine"),ListServiceUtils:e("./ListServiceUtils"),LookupServiceUtils:e("./LookupServiceUtils"),MappedConcept:e("./MappedConcept"),MappedConceptSource:e("./MappedConceptSource"),MappedConceptUtils:e("./MappedConceptUtils"),MappingRef:e("./MappingRef"),Query:e("./Query"),RefSpec:e("./RefSpec"),ServiceUtils:e("./ServiceUtils"),SponateUtils:e("./SponateUtils"),TemplateParser:e("./TemplateParser"),Acc:e("./acc/Acc"),AccArray:e("./acc/AccArray"),AccArrayStatic:e("./acc/AccArrayStatic"),AccBestLabel:e("./acc/AccBestLabel"),AccLiteral:e("./acc/AccLiteral"),AccMap:e("./acc/AccMap"),AccObject:e("./acc/AccObject"),AccRef:e("./acc/AccRef"),AccTransform:e("./acc/AccTransform"),AccTransformLazy:e("./acc/AccTransformLazy"),Agg:e("./agg/Agg"),AggArray:e("./agg/AggArray"),AggArrayStatic:e("./agg/AggArrayStatic"),AggBestLabel:e("./agg/AggBestLabel"),AggCustomAcc:e("./agg/AggCustomAcc"),AggLiteral:e("./agg/AggLiteral"),AggMap:e("./agg/AggMap"),AggObject:e("./agg/AggObject"),AggObjectCustom:e("./agg/AggObjectCustom"),AggRef:e("./agg/AggRef"),AggTransform:e("./agg/AggTransform"),AggTransformLazy:e("./agg/AggTransformLazy"),BindingMapper:e("./binding_mapper/BindingMapper"),BindingMapperExpr:e("./binding_mapper/BindingMapperExpr"),BindingMapperIndex:e("./binding_mapper/BindingMapperIndex"),BindingMapperTransform:e("./binding_mapper/BindingMapperTransform"),CollectionFacade:e("./facade/CollectionFacade"),QueryFlow:e("./facade/QueryFlow"),StoreFacade:e("./facade/StoreFacade"),RexUtils:e("./RexUtils")};module.exports=r},{"./AccUtils":320,"./AggUtils":321,"./AttrPath":322,"./Context":323,"./Engine":324,"./ListServiceUtils":325,"./LookupServiceUtils":326,"./MappedConcept":327,"./MappedConceptSource":328,"./MappedConceptUtils":329,"./MappingRef":330,"./Query":331,"./RefSpec":332,"./RexUtils":333,"./ServiceUtils":334,"./SponateUtils":335,"./TemplateParser":336,"./acc/Acc":337,"./acc/AccArray":338,"./acc/AccArrayStatic":339,"./acc/AccBestLabel":340,"./acc/AccLiteral":341,"./acc/AccMap":342,"./acc/AccObject":343,"./acc/AccRef":344,"./acc/AccTransform":345,"./acc/AccTransformLazy":346,"./agg/Agg":347,"./agg/AggArray":348,"./agg/AggArrayStatic":349,"./agg/AggBestLabel":350,"./agg/AggCustomAcc":351,"./agg/AggLiteral":352,"./agg/AggMap":353,"./agg/AggObject":354,"./agg/AggObjectCustom":355,"./agg/AggRef":356,"./agg/AggTransform":357,"./agg/AggTransformLazy":358,"./binding_mapper/BindingMapper":359,"./binding_mapper/BindingMapperExpr":360,"./binding_mapper/BindingMapperIndex":361,"./binding_mapper/BindingMapperTransform":362,"./facade/CollectionFacade":363,"./facade/QueryFlow":364,"./facade/StoreFacade":365}],367:[function(e,module,t){var r=e("./shared");var n=e("lodash.foreach");var i={transformHttpRequestHeadersAngularToJquery:function(e){if(e&&e.headers){var t=e.beforeSend;e.beforeSend=function(r){n(e.headers,function(e,t){r.setRequestHeader(t,e)});if(t){t(r)}}}},createAjaxWrapperFn:function(e){var t=function(){var t=r.Promise;var n=arguments[0];i.transformHttpRequestHeadersAngularToJquery(n);var a=e.apply(this,arguments);var s=t.resolve(a).cancellable()["catch"](t.TimeoutError,t.CancellationError,function(e){a.abort();throw e});return s};return t}};module.exports=i},{"./shared":403,"lodash.foreach":482}],368:[function(e,module,t){var r=e("./ObjectUtils");var n={compactTrailingNulls:function(e){while(e.length&&e[e.length-1]==null){e.pop()}},indexesOf:function(e,t,n){n=n||r.isEqual;var i=[];e.forEach(function(e,r){var a=n(t,e);if(a){i.push(r)}});return i},firstIndexOf:function(e,t,r){var i=n.indexesOf(e,t,r);var a=i.length>0?i[0]:-1;return a},contains:function(e,t,r){var i=n.indexesOf(e,t,r);var a=i.length>0;return a},addAll:function(e,t){return e.push.apply(e,t)},chunk:function(e,t){var r=[];for(var n=0;n<e.length;n+=t){var i=e.slice(n,n+t);r.push(i)}return r},clear:function(e){while(e.length>0){e.pop()}},replace:function(e,t){this.clear(e);if(t){e.push.apply(e,t)}},filter:function(e,t){var r=e.filter(t);this.replace(e,r);return e},find:function(e,t){var r=null;for(var n=0;n<e.length;++n){var i=e[n];var a=t(i);if(a){r=i;break}}return r},indexOf:function(e,t,n){n=n||r.isEqual;var i=-1;for(var a=0;a<e.length;++a){var s=e[a];if(n(t,s)){i=a;break}}return i},grep:function(e,t){var r=[];e.forEach(function(e,n){var i=t(e,n);if(i){r.push(n)}});return r},copyWithoutIndexes:function(e,t){var r={};t.forEach(function(e){r[e]=true});var n=[];for(var i=0;i<e.length;++i){var a=r[i];if(!a){n.push(e[i])}}return n},removeItemStrict:function(e,t){var r=e.indexOf(t);if(r>-1){this.removeIndexes(e,[r])}return e},removeIndexes:function(e,t){var r=this.copyWithoutIndexes(e,t);this.replace(e,r);return e},removeByGrep:function(e,t){var r=this.grep(e,t);this.removeIndexes(e,r)},removeItem:function(e,t,r){var i=n.firstIndexOf(e,t,r);if(i>=0){e.splice(i,1)}}};module.exports=n},{"./ObjectUtils":376}],369:[function(e,module,t){var r=e("./shared");var n=r.Promise;var i={extractArgs:function(e){var t=Array.prototype.slice.call(e,0);var r=t.length>1?t:t[0];return r},cacheExecution:function(e,t,r){var a=e[t];if(a==null){var s=false;var o=function(){s=true;delete e[t]};var c=r();var u=c.then(function(){o();var e=i.extractArgs(arguments);return e},function(e){o();throw e});a={promise:u,clients:{},nextId:0};if(!s){e[t]=a}}var l=a.promise;var f=a.clients;var v="client_"+a.nextId++;f[v]=true;var p=function(){if(v!=null){var e=f[v];if(!e){console.log("[ASSERTION ERROR] unknown client "+v)}delete f[v]}};var h=new n(function(e,t){l.then(function(t){p();e(t)},function(e){p();t(e)})}).cancellable()["catch"](function(e){p();v=null;if(Object.keys(f).length===0){l.cancel()}throw e});return h},cacheResult:function(e,t,r){var a;var s=e.getItem(t);if(s){a=n.resolve(s)}else{a=r().then(function(){var r=i.extractArgs(arguments);e.setItem(t,r);return r})}return a},cacheExecutionAndResult:function(e,t,r,n){var a=i.cacheResult(t,r,function(){var t=i.cacheExecution(e,r,function(){var e=n();return e});return t});return a}};module.exports=i},{"./shared":403}],370:[function(e,module,t){var r={indexPredicates:function(e,t,r,n){r=r||{};var i=e.id.toString();var a=r[i];if(!a){a=i}var s=t[a];if(!s){s={id:a,valueToMember:{},sources:[]};t[a]=s}var o=s.sources;if(o.indexOf(n)<0){o.push(n)}var c=s.valueToMember;e.values.forEach(function(t){var r=t.id.toString();var i=c[r];if(!i){i={predicate:e.id,value:t,sources:[]};c[r]=i}var a=i.sources;if(a.indexOf(n)<0){a.push(n)}})},clusterLink:function(e,t,n){n=n||{};if(e.source){e.source.predicates.forEach(function(e){r.indexPredicates(e,n,t,"source")})}if(e.target){e.target.predicates.forEach(function(e){r.indexPredicates(e,n,t,"target")})}return n}};module.exports=r},{}],371:[function(e,module,t){var r={toggleItem:function(e,t){var r;if(e.contains(t)){e.remove(t);r=false}else{e.add(t);r=true}return r}};module.exports=r},{}],372:[function(e,module,t){var r={pnLocalPattern:/^[^\s\/]+$/,isValidSparqlLocalName:function(e){var t=this.pnLocalPattern.exec(e);var r=!!t;return r}};module.exports=r},{}],373:[function(e,module,t){var r={tryEval:function(e,t){var r;try{r=e()}catch(e){r=t}return r}};module.exports=r},{}],374:[function(e,module,t){var r=e("../ext/JSONCanonical");var n=function(e){var t=typeof e;return t==="function"||t==="object"&&Boolean(e)};var i={stringifyCyclic:function(e,t){var i=[];var a=r.stringify(e,function(e,r){if(n(r)){if(i.indexOf(r)>=0){return}i.push(r);if(t){r=t(e,r)}}return r});return a}};module.exports=i},{"../ext/JSONCanonical":3}],375:[function(e,module,t){var r=e("./collection/HashMap");var n=e("./ObjectUtils");var i={indexBy:function(e,t,i){i=i||new r;var a;if(n.isString(t)){a=function(e){return e[t]}}else{a=t}e.forEach(function(e){var t=a(e);i.put(t,e)});return i},retainKeys:function(e,t){var r=e.keys();r.forEach(function(r){var n=t.contains(r);if(!n){e.remove(r)}})}};module.exports=i},{"./ObjectUtils":376,"./collection/HashMap":389}],376:[function(e,module,t){var r=e("lodash.isequal");var n=e("./JsonUtils");var i={alloc:function(e,t){var r;if(!(t in e)){r=e[t]=1}else{r=++e[t]}return r},free:function(e,t){var r;if(t in e){r=--e[t];if(r<=0){delete e[t]}}else{r=null}return r},isEmptyString:function(e){var t=e==null||e.length===0||e.trim()==="";return t},isObject:function(e){var t=typeof e;return t==="function"||t==="object"&&Boolean(e)},isFunction:function(e){return typeof e==="function"},isString:function(e){return Object.prototype.toString.call(e)==="[object String]"},extend:function(e,t){for(var r in t){if(hasOwnProperty.call(t,r)){e[r]=t[r]}}return e},clear:function(e){for(var t in e){if(e.hasOwnProperty(t)){delete e[t]}}},isEqual:function(e,t){var n;if(e&&e.equals){n=e.equals(t)}else if(t&&t.equals){n=t.equals(e)}else{n=r(e,t)}return n
},defaultHashCode:function(e){var t;if(e&&e.hashCode){t=e.hashCode()}else{t=i.hashCode(e)}return t},identity:function(e){return e},hashCodeStr:function(e){var t=0,r=e&&e.length?e.length:0;for(var n=0;n<r;n++){t=t*31+e.charCodeAt(n);t=t&t}return t},hashCode:function(e,t){var r=n.stringifyCyclic(e,function(e,r){var n=null;if(!t&&i.isObject(r)){var a=null;i.defaultHashFnNames.some(function(e){if(i.isFunction(r[e])){a=e;return true}});var s=r[a];if(a&&s&&i.isFunction(s)){n=s.apply(r)}else{n=r}}else{n=r}if(t){t=false}return n});return r}};i.defaultHashFnNames=["hashCode"];module.exports=i},{"./JsonUtils":374,"lodash.isequal":487}],377:[function(e,module,t){var r=e("./StringUtils");var n={prefixPattern:/((\w|-)+):(\w|-)+/g,extractPrefixes:function(e){var t=r.extractAllRegexMatches(this.prefixPattern,e,1);return t},expandPrefixes:function(e,t){var r=this.extractPrefixes(t);var n=t;r.forEach(function(t){var r=e[t];if(r){var i=new RegExp(t+":(\\w+)","g");n=n.replace(i,"<"+r+"$1>")}});return n},permissiveCuriePattern:/^\s*([^:\/]+):([^\s\/:]*)\s*$/,permissivePrefixPattern:/\s*([^:]+)\s*:\s*([^\s]*)\s*/gm,parseCurie:function(e){var t=this.permissiveCuriePattern.exec(e);var r=t?{key:t[1],val:t[2]}:null;return r},parsePrefixDecls:function(e){var t={};var r;while((r=this.permissivePrefixPattern.exec(e))!=null){var n=r[1];var i=r[2];t[n]=i}return t}};module.exports=n},{"./StringUtils":383}],378:[function(e,module,t){var r=e("./shared");var n=r.Promise;var i=e("./ObjectUtils");var a={replaceService:function(e,t,r){var n=e[t];if(n&&n.cancelAll){n.cancelAll()}e[t]=r!=null?a.lastRequestify(r):null},lastRequestify:function(e){var t={};var r=function(e,t){var r=function(){var r=e.apply(t,arguments);return r};return r};var n=[];for(var s in e){var o=e[s];if(i.isFunction(o)){var c=a.lastRequest(r(o,e));t[s]=c;n.push(c)}}t.cancelAll=function(){n.forEach(function(e){try{if(e.deferred){e.deferred.cancel()}}catch(e){console.log(e)}})};return t},all:function(e){var t=n.all(e).cancellable()["catch"](n.CancellationError,function(t){e.forEach(function(e){try{if(e&&e.cancel){e.cancel()}}catch(e){console.log("[ERROR] Cancelling a promise raised an exception")}});throw t});return t},createDeferred:function(e){var t;var r;var i=new n(function(){t=arguments[0];r=arguments[1]});if(e){i.cancellable()}return{resolve:t,reject:r,promise:function(){return i},isCancellable:function(){var e;if(i.isCancellable){e=i.isCancellable()}else if(i.abort){e=true}return e},cancel:function(){if(i.cancel){i.cancel()}else if(i.abort){i.abort()}}}},defaultAbortFn:function(e){e.cancel()},defaultDeferredFn:function(){return a.createDeferred(true)},postpone:function(e,t,r,n){t=t==null?50:t;r=r||this.defaultAbortFn;n=n||a.defaultDeferredFn;return function(){var i=arguments;var a=n();var s=null;var o=setTimeout(function(){s=e.apply(this,i);s.then(function(){a.resolve.apply(this,arguments)}).fail(function(){a.reject.apply(this,arguments)})},t);var c=a.promise();c.abort=function(){if(s==null){clearTimeout(o)}else if(r!=null){r(s)}};return c}},lastRequest:function(e,t,r){t=t||a.defaultAbortFn;r=r||a.defaultDeferredFn;var n=null;var i;var s=null;var o=0;return function(){if(n==null){n=r();i=n.promise();var a=i.cancel;i.cancel=function(){if(a){a.call(i)}if(s&&n.isCancellable()){s.cancel()}}}this.deferred=n;var c=++o;var u=e.apply(this,arguments);if(t!=null&&s!=null){t(s)}s=u;u.then(function(){if(c===o&&n){n.resolve.apply(this,arguments);n=null}},function(){if(c===o&&n){n.reject.apply(this,arguments);n=null}});return i}},firstRequest:function(e,t){var r=null;return function(){if(r==null){var n=t();r=n.promise();var i=e.apply(this,arguments);var a=r.cancel;r.cancel=function(){if(a){a.call(r)}if(i&&n.isCancellable()){i.cancel()}};i.then(function(){if(n){n.resolve.apply(this,arguments);r=null}},function(){if(n){n.reject.apply(this,arguments);r=null}})}return r}}};module.exports=a},{"./ObjectUtils":376,"./shared":403}],379:[function(e,module,t){var r=e("../ext/Class");var n=e("./collection/HashMap");var i=e("./ObjectUtils");var a=r.create({initialize:function(){this._nextId=1;this.objToId=new n(function(e,t){return e===t},function(e){return i.hashCode(e)});this.idToState={}},nextId:function(){var e=(this._nextId++).toString();return e},getIdToState:function(){return this.idToState},getObjToId:function(){return this.objToId}});module.exports=a},{"../ext/Class":2,"./ObjectUtils":376,"./collection/HashMap":389}],380:[function(e,module,t){var r=e("../ext/Class");var n=e("./ObjectUtils");var i=e("./SerializationContext");var a=r.create({initialize:function(){this.classNameToClass={};this.classNameToFnSerialize={};this.classNameToFnDeserialize={};this.classNameToPrototype={}},registerOverride:function(e,t,r){this.classNameToFnSerialize[e]=t;this.classNameToFnDeserialize[e]=r},indexClasses:function(e){var t=this.findClasses(e);n.extend(this.classNameToClass,t);return t},findClasses:function(e){var t={};e.forEach(function(e){var r=e.classLabel||(e.prototype?e.prototype.classLabel:null);if(r){t[r]=e}});return t},getLabelForClass:function(e){var t=Object.getPrototypeOf(e);var r;this.classNameToClass.find(function(e,n){if(t===e.prototype){r=n;return true}});return r},getClassForLabel:function(e){var t;this.classNameToClass.find(function(r,n){if(n===e){t=r;return true}});return t},serialize:function(e,t){t=t||new i;var r=this.serializeRec(e,t);var n={root:r,idToState:t.getIdToState()};return n},serializeRec:function(e,t){var r;var i=t.getObjToId();var a=i.get(e);if(!a){a=t.nextId();i.put(e,a)}var s=t.getIdToState();var o=s[a];if(o){r={ref:a}}else if(n.isFunction(e)){r=undefined}else if(n.isObject(e)){var c=this.getLabelForClass(e);var u=function(e){var t=Boolean(e)||Object.toString.call(e)==="[object Number]"||Object.toString.call(e)==="[object Date]"||Object.toString.call(e)==="[object String]"||Object.toString.call(e)==="[object RegExp]";return t};var l=function(e){var t=e.prototype;var r=n.isObject(e)&&!u(e);var i=r&&t==null;return i};var f=u(e)||l(e)||Array.isArray(e);if(c==null&&!f){throw new Error("Failed to serialize instance without class label")}var v;if(c){v=this.classNameToPrototype[c];if(!v){var p=this.getClassForLabel(c);if(p){try{v=new p;this.classNameToPrototype[c]=v}catch(e){console.log("[WARN] Failed to create a prototype instance of class "+c,e)}}}}if(!v){v={}}var h=this.serializeAttrs(e,t,v);var d={};if(c){d.classLabel=c}if(Object.keys(h).length>0){d.attrs=h.attrs;if(h.parent!=null){d.parent=h.parent}}if(Array.isArray(e)){d.length=e.length}s[a]=d;r={ref:a}}else{r={value:e}}return r},serializeAttrs:function(e,t,r){var i={};var a=i;var s=a.attrs={};var o=this;var c=Object.keys(e);c.forEach(function(i){var a=e[i];var c=o.serializeRec(a,t);var u=r[i];var l=n.isEqual(c,u)||c==null&&u==null;if(l){return}if(c){s[i]=c}});return i},deserialize:function(e){var t=e.root;var r=e.idToState;var n={};var i=this.deserializeRef(t,r,n);return i},deserializeRef:function(e,t,r){var n=e.ref;var i=e.value;var a;if(n!=null){var s=n in r;if(s){a=r[n]}else{a=this.deserializeState(n,t,r)}}else{a=i}return a},deserializeState:function(e,t,r){var i;var a=t[e];if(a==null||!n.isObject(a)){console.log("State must be an object, was: ",a);throw new Error("Deserialization error")}var s=a.attrs;var o=a.classLabel;var c=a.length;if(o){var u=this.getClassForLabel(o);if(!u){throw new Error("Unknown class label encountered in deserialization: "+o)}i=new u}else if(c!=null){i=[]}else{i={}}r[e]=i;var l=this;if(s!=null){var f=Object.keys(s);f.forEach(function(e){var n=s[e];var a=l.deserializeRef(n,t,r);i[e]=a})}if(c!=null){i.length=c}return i}});module.exports=new a},{"../ext/Class":2,"./ObjectUtils":376,"./SerializationContext":379}],381:[function(e,module,t){var r=e("./collection/HashSet");var n={arrayToSet:function(e){var t=new r;t.addAll(e);return t}};module.exports=n},{"./collection/HashSet":390}],382:[function(e,module,t){var r=e("../ext/Class");var n=r.create({initialize:function(e,t,r){this.obj=e;this.attr=t;this.meta=r},setValue:function(e){this.obj[this.attr]=e},getValue:function(){return this.obj[this.attr]},getMeta:function(){return this.meta},toString:function(){return JSON.stringify(this)}});module.exports=n},{"../ext/Class":2}],383:[function(e,module,t){var r=e("lodash.uniq");var n={capitalize:function(e){return e&&e[0].toUpperCase()+e.slice(1)},createFnPrefix:function(e,t){return function(r){var n=t&&r==null?null:e+r;return n}},createFnSuffix:function(e,t){return function(r){var n=t&&r==null?null:r+e;return n}},extractAllRegexMatches:function(e,t,n){var i;var a=[];while((i=e.exec(t))!=null){a.push(i[n])}a=r(a);return a},parseAffixFn:function(e){var t;var r=e==null||e===""?"-":e.charAt(0);var n=r==="^"||r==="$"?e.slice(1):e;switch(r){case"^":t=function(e){return n+e};break;case"$":t=function(e){return e+n};break;default:t=function(e){return e}}return t}};module.exports=n},{"lodash.uniq":496}],384:[function(e,module,t){var r={visitDepthFirst:function(e,t,n){var i=n(e);if(i){var a=t(e);a.forEach(function(e){r.visitDepthFirst(e,t,n)})}},flattenTree:function(e,t,r){if(r==null){r=[]}if(e){r.push(e)}var n=e[t];var i=this;if(n){n.forEach(function(e){i.flattenTree(e,t,r)})}return r}};module.exports=r},{}],385:[function(e,module,t){var r={isValidUri:function(e){var t=true;t=t&&e.indexOf(" ")<0;t=t&&e.indexOf("<")<0;t=t&&e.indexOf(">")<0;return t},extractLabel:function(e){var t=e.lastIndexOf("#");var r=e.lastIndexOf("/");var n=Math.max(t,r);var i=n===e.length?e:e.substring(n+1);if(i===""){i=e}return i}};module.exports=r},{}],386:[function(e,module,t){var r=e("../../ext/Class");var n=e("../ObjectUtils");var i=e("../ArrayUtils");var a=r.create({initialize:function(e,t){this.items=e||[];this.fnEquals=t||n.isEqual},setItems:function(e){this.items=e},getArray:function(){return this.items},get:function(e){var t=this.items[e];return t},add:function(e){this.items.push(e)},indexesOf:function(e){var t=i.indexesOf(this.items,e,this.fnEquals);return t},contains:function(e){var t=i.contains(this.items,e,this.fnEquals);return t},firstIndexOf:function(e){var t=i.firstIndexOf(this.items,e,this.fnEquals);return t},lastIndexOf:function(e){var t=this.indexesOf(e);var r=t.length>0?t[t.length-1]:-1;return r},remove:function(e){i.removeItem(this.items,e,this.fnEquals)},size:function(){return this.items.length}});module.exports=a},{"../../ext/Class":2,"../ArrayUtils":368,"../ObjectUtils":376}],387:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(e,t){this.key=e;this.value=t},getKey:function(){return this.key},getValue:function(){return this.value},toString:function(){return this.key+"->"+this.value}});module.exports=n},{"../../ext/Class":2}],388:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashMap");var i=r.create({initialize:function(e,t,r){this.forward=new n(e,t);this.inverse=r?r:new i(e,t,this)},getInverse:function(){return this.inverse},put:function(e,t){this.remove(e);this.forward.put(e,t);this.inverse.forward.put(t,e)},remove:function(e){var t=this.get(e);if(t!==null){this.inverse.forward.remove(t)}this.forward.remove(e)},getMap:function(){return this.forward},get:function(e){var t=this.forward.get(e);return t},keyList:function(){var e=this.forward.keys();return e}});module.exports=i},{"../../ext/Class":2,"./HashMap":389}],389:[function(e,module,t){var r=e("lodash.foreach");var n=e("../../ext/Class");var i=e("./../ObjectUtils");var a=n.create({initialize:function(e,t){this.fnEquals=e?e:i.isEqual;this.fnHash=t?t:i.defaultHashCode;this.hashToBucket={};var r=this;this.fnGet=function(e){var t=r.get(e);return t}},hashCode:function(){var e=this;var t=function(t){var r=e.fnHash(t);if(r==null){r=3}else if(i.isString(r)){r=i.hashCodeStr(r)}return r};if(this.hash==null){var r=this.entries();var n=0;r.forEach(function(e){var r=t(e.key);var i=t(e.val);n+=19*r+7919*i});this.hash=n}return this.hash},equals:function(e){throw new Error("Not implemented yet")},clear:function(){this.hashToBucket={};this.hash=null},putEntry:function(e){this.put(e.key,e.val)},putEntries:function(e){var t=this;e.forEach(function(e){t.putEntry(e)});return this},putAll:function(e){return this.putMap(e)},putMap:function(e){var t=e.entries();var r=this.putEntries(t);return r},getOrCreate:function(e,t){var r;var n=this.containsKey(e);if(!n){this.put(e,t);r=t}else{r=this.get(e)}return r},put:function(e,t){this.hash=null;var r=this.fnHash(e);var n=this.hashToBucket[r];if(n==null){n=[];this.hashToBucket[r]=n}var i=this._indexOfKey(n,e);if(i>=0){n[i].val=t;return}var a={key:e,val:t};n.push(a)},_indexOfKey:function(e,t){if(e!=null){for(var r=0;r<e.length;++r){var n=e[r];var i=n.key;if(this.fnEquals(i,t)){return r}}}return-1},get:function(e){var t=this.fnHash(e);var r=this.hashToBucket[t];var n=this._indexOfKey(r,e);var i=n>=0?r[n].val:null;return i},remove:function(e){var t=this.fnHash(e);var r=this.hashToBucket[t];var n=this._indexOfKey(r,e);var i=n>=0;if(i){this.hash=null;r.splice(n,1);if(r.length===0){delete this.hashToBucket[t]}}return i},containsKey:function(e){var t=this.fnHash(e);var r=this.hashToBucket[t];var n=this._indexOfKey(r,e)>=0;return n},keys:function(){var e=[];r(this.hashToBucket,function(t){var r=[];t.forEach(function(e){if(e.key){r.push(e.key)}});e.push.apply(e,r)});return e},values:function(){var e=this.entries();var t=e.map(function(e){return e.val});return t},entries:function(){var e=[];r(this.hashToBucket,function(t){e.push.apply(e,t)});return e},forEach:function(e){var t=this.entries();t.forEach(function(t){e(t.val,t.key)})},toString:function(){var e=this.entries();var t=e.map(function(e){return e.key+": "+e.val});var r="{"+t.join(", ")+"}";return r},asFn:function(){return this.fnGet},size:function(){var e=this.entries();var t=e.length;return t},isEmpty:function(){var e=this.size();var t=e===0;return t}});module.exports=a},{"../../ext/Class":2,"./../ObjectUtils":376,"lodash.foreach":482}],390:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashMap");var i=r.create({initialize:function(e,t){this._map=new n(e,t)},isEmpty:function(){var e=this._map.isEmpty();return e},add:function(e){this._map.put(e,true)},hashCode:function(){var e=this._map.hashCode();return e},equals:function(e){var t=e!=null&&e._map!=null&&this._map.equals(e._map);return t},contains:function(e){var t=this._map.containsKey(e);return t},forEach:function(e){var t=this.entries();t.forEach(e)},map:function(e){var t=this.entries();var r=t.map(e);return r},retainAll:function(e){var t=this;this.forEach(function(r){var n=e.contains(r);if(!n){t.remove(r)}})},addAll:function(e){var t=this;e.forEach(function(e){t.add(e)})},removeAll:function(e){var t=this;e.forEach(function(e){t.remove(e)})},remove:function(e){this._map.remove(e)},entries:function(){var e=this._map.entries().map(function(e){return e.key});return e},clear:function(){this._map.clear()},toString:function(){var e=this.entries();var t="{"+e.join(", ")+"}";return t},size:function(){var e=this._map.size();return e}});module.exports=i},{"../../ext/Class":2,"./HashMap":389}],391:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({next:function(){throw new Error("Not overridden")},hasNext:function(){throw new Error("Not overridden")}});module.exports=n},{"../../ext/Class":2}],392:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Iterator");var i=r.create(n,{initialize:function(){this.current=null;this.advance=true;this.finished=false},finish:function(){this.finished=true;this.close();return null},$prefetch:function(){this.current=this.prefetch()},hasNext:function(){if(this.advance){this.$prefetch();this.advance=false}return this.finished===false},next:function(){if(this.finished){throw new Error("No more elments")}if(this.advance){this.$prefetch()}this.advance=true;return this.current},prefetch:function(){throw new Error("Not overridden")}});module.exports=i},{"../../ext/Class":2,"./Iterator":391}],393:[function(e,module,t){var r=e("../../ext/Class");var n=e("./Iterator");var i=r.create(n,{initialize:function(e,t){this.array=e;this.offset=t?t:0},getArray:function(){return this.array},hasNext:function(){var e=this.offset<this.array.length;return e},next:function(){var e=this.hasNext();var t;if(e){t=this.array[this.offset];++this.offset}else{t=null}return t}});module.exports=i},{"../../ext/Class":2,"./Iterator":391}],394:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashMap");var i=r.create({initialize:function(e,t){this.map=new n(e,t);this.keys=[]},put:function(e,t){var r=this.map.get(e);if(r){throw new Error("Key "+e+" already inserted")}this.keys.push(e);this.map.put(e,t)},get:function(e){var t=this.map.get(e);return t},getByIndex:function(e){var t=this.keys[e];var r=this.map.get(t);return r},entries:function(){var e=this;var t=this.keys.map(function(t){var r=e.map.get(t);var n={key:t,val:r};return n});return t},remove:function(e){for(var t=0;t<this.keys.length;t++){var r=this.keys[t];if(r===e){this.keys.splice(t,1);break}}this.map.remove(e)},removeByIndex:function(e){var t=this.keys[e];this.remove(t)},keyList:function(){return this.keys},size:function(){return this.keys.length}});module.exports=i},{"../../ext/Class":2,"./HashMap":389}],395:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashSet");var i=e("../ArrayUtils");var a=r.create({initialize:function(e){this.subMaps=e},get:function(e){var t=i.find(this.subMaps,function(t){var r=t.containsKey(e);return r});var r=t?t.get(e):null;return r},containsKey:function(e){var t=this.subMaps.some(function(t){var r=t.containsKey(e);return r});return t},entries:function(){var e=new n;var t=[];this.subMaps.forEach(function(r){var n=r.entries();n.forEach(function(r){var n=r.key;var i=e.contains(n);if(!i){e.add(n);t.push(r)}})});return t}});module.exports=a},{"../../ext/Class":2,"../ArrayUtils":368,"./HashSet":390}],396:[function(e,module,t){var r=e("../../ext/Class");var n=r.create({initialize:function(){this.entries={}},clone:function(){var e=new n;e.addMultiMap(this);return e},clear:function(){var e=Object.keys(this.entries);var t=this;e.forEach(function(e){delete t.entries[e]})},addMultiMap:function(e){for(var t in e.entries){var r=e.entries[t];for(var n=0;n<r.length;++n){var i=r[n];this.put(t,i)}}},get:function(e){return e in this.entries?this.entries[e]:[]},put:function(e,t){var r;if(e in this.entries){r=this.entries[e]}else{r=[];this.entries[e]=r}r.push(t)},removeKey:function(e){delete this.entries[e]}});module.exports=n},{"../../ext/Class":2}],397:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashSet");var i=r.create({initialize:function(e){this._sets=e},delegate:function(){throw new Error("Delegate method not overridden")},isEmpty:function(){var e=this.delegate().isEmpty();return e},add:function(e){throw new Error("Cannot insert into a set view.")},hashCode:function(){var e=this.delegate().hashCode();return e},equals:function(e){var t=e!=null&&e.delegate().equals(e);return t},contains:function(e){var t=this.delegate().contains(e);return t},forEach:function(e){this.delegate().forEach(e)},map:function(e){var t=this.delegate().map(e);return t},retainAll:function(e){throw new Error("Cannot modify read only set view")},addAll:function(e){throw new Error("Cannot modify read only set view")},removeAll:function(e){throw new Error("Cannot modify read only set view")},remove:function(e){throw new Error("Cannot modify read only set view")},entries:function(){var e=this.delegate().entries();return e},clear:function(){throw new Error("Cannot modify read only set view")},toString:function(){var e=this.delegate().toString();return e},size:function(){var e=this.delegate().size();return e}});module.exports=i},{"../../ext/Class":2,"./HashSet":390}],398:[function(e,module,t){var r=e("../../ext/Class");var n=e("./SetDelegate");var i=r.create(n,{initialize:function($super,e){$super(e);this.lastHash=null;this.delegateSet=null},computeHash:function(){var e=this._sets.reduce(function(e,t){var r=t.hashCode();var n=e+13*r;return n},0);return e},computeDelegate:function(){throw new Error("must be overridden")},delegate:function(){var e=this.computeHash();if(e!==this.lastHash){this.delegateSet=this.computeDelegate();this.lastHash=e}return this.delegateSet}});module.exports=i},{"../../ext/Class":2,"./SetDelegate":397}],399:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashSet");var i=e("./SetDelegateCache");var a=r.create(i,{initialize:function($super,e,t){$super([e,t]);this.a=e;this.b=t},computeDelegate:function(){var e=this;var t=new n;this.a.forEach(function(r){var n=e.b.contains(r);if(!n){t.add(r)}});return t}});module.exports=a},{"../../ext/Class":2,"./HashSet":390,"./SetDelegateCache":398}],400:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashSet");var i=e("./SetDelegateCache");var a=r.create(i,{initialize:function($super,e){$super(e)},computeDelegate:function(){var e=this;var t=new n;this._sets.forEach(function(e){t.addAll(e)});var r=new n;t.forEach(function(t){var n=e._sets.every(function(e){var r=e.contains(t);return r});if(n){r.add(t)}});return r}});module.exports=a},{"../../ext/Class":2,"./HashSet":390,"./SetDelegateCache":398}],401:[function(e,module,t){var r=e("../../ext/Class");var n=e("./HashSet");var i=e("./SetDelegateCache");var a=r.create(i,{initialize:function($super,e){$super(e)},computeDelegate:function(){var e=new n;this._sets.forEach(function(t){e.addAll(t)});return e}});module.exports=a},{"../../ext/Class":2,"./HashSet":390,"./SetDelegateCache":398}],402:[function(e,module,t){"use strict";var r={ArrayUtils:e("./ArrayUtils"),ExceptionUtils:e("./ExceptionUtils"),CacheUtils:e("./CacheUtils"),ClusterUtils:e("./ClusterUtils"),CollectionUtils:e("./CollectionUtils"),JsonUtils:e("./JsonUtils"),MapUtils:e("./MapUtils"),ObjectUtils:e("./ObjectUtils"),PrefixUtils:e("./PrefixUtils"),PromiseUtils:e("./PromiseUtils"),SerializationContext:e("./SerializationContext"),Serializer:e("./Serializer"),SetUtils:e("./SetUtils"),SetDelegate:e("./collection/SetDelegate"),SetDelegateCache:e("./collection/SetDelegateCache"),SetIntersection:e("./collection/SetIntersection"),SetDifference:e("./collection/SetDifference"),SetUnion:e("./collection/SetUnion"),StringUtils:e("./StringUtils"),TreeUtils:e("./TreeUtils"),UriUtils:e("./UriUtils"),shared:e("./shared"),ArrayList:e("./collection/ArrayList"),Entry:e("./collection/Entry"),HashBidiMap:e("./collection/HashBidiMap"),HashMap:e("./collection/HashMap"),HashSet:e("./collection/HashSet"),Iterator:e("./collection/Iterator"),IteratorAbstract:e("./collection/IteratorAbstract"),IteratorArray:e("./collection/IteratorArray"),ListMap:e("./collection/ListMap"),MapUnion:e("./collection/MapUnion"),MultiMapObjectArray:e("./collection/MultiMapObjectArray"),AjaxUtils:e("./AjaxUtils")};module.exports=r},{"./AjaxUtils":367,"./ArrayUtils":368,"./CacheUtils":369,"./ClusterUtils":370,"./CollectionUtils":371,"./ExceptionUtils":373,"./JsonUtils":374,"./MapUtils":375,"./ObjectUtils":376,"./PrefixUtils":377,"./PromiseUtils":378,"./SerializationContext":379,"./Serializer":380,"./SetUtils":381,"./StringUtils":383,"./TreeUtils":384,"./UriUtils":385,"./collection/ArrayList":386,"./collection/Entry":387,"./collection/HashBidiMap":388,"./collection/HashMap":389,"./collection/HashSet":390,"./collection/Iterator":391,"./collection/IteratorAbstract":392,"./collection/IteratorArray":393,"./collection/ListMap":394,"./collection/MapUnion":395,"./collection/MultiMapObjectArray":396,"./collection/SetDelegate":397,"./collection/SetDelegateCache":398,"./collection/SetDifference":399,"./collection/SetIntersection":400,"./collection/SetUnion":401,"./shared":403}],403:[function(e,module,t){var r={Promise:null,ajax:function(){throw new Error("not set!")}};module.exports=r},{}],404:[function(e,module,t){var r={dcat:"http://www.w3.org/ns/dcat#",qb:"http://purl.org/linked-data/cube#",grddl:"http://www.w3.org/2003/g/data-view#",ma:"http://www.w3.org/ns/ma-ont#",org:"http://www.w3.org/ns/org#",owl:"http://www.w3.org/2002/07/owl#",prov:"http://www.w3.org/ns/prov#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfa:"http://www.w3.org/ns/rdfa#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rif:"http://www.w3.org/2007/rif#",rr:"http://www.w3.org/ns/r2rml#",sd:"http://www.w3.org/ns/sparql-service-description#",skos:"http://www.w3.org/2004/02/skos/core#",skosxl:"http://www.w3.org/2008/05/skos-xl#",wdr:"http://www.w3.org/2007/05/powder#",void:"http://rdfs.org/ns/void#",wdrs:"http://www.w3.org/2007/05/powder-s#",xhv:"http://www.w3.org/1999/xhtml/vocab#",xml:"http://www.w3.org/XML/1998/namespace",xsd:"http://www.w3.org/2001/XMLSchema#",gldp:"http://www.w3.org/ns/people#",cnt:"http://www.w3.org/2008/content#",earl:"http://www.w3.org/ns/earl#",ht:"http://www.w3.org/2006/http#",ptr:"http://www.w3.org/2009/pointers#",cc:"http://creativecommons.org/ns#",ctag:"http://commontag.org/ns#",dc:"http://purl.org/dc/terms/",dcterms:"http://purl.org/dc/terms/",dc11:"http://purl.org/dc/elements/1.1/",foaf:"http://xmlns.com/foaf/0.1/",gr:"http://purl.org/goodrelations/v1#",ical:"http://www.w3.org/2002/12/cal/icaltzd#",og:"http://ogp.me/ns#",rev:"http://purl.org/stuff/rev#",sioc:"http://rdfs.org/sioc/ns#",v:"http://rdf.data-vocabulary.org/#",vcard:"http://www.w3.org/2006/vcard/ns#",schema:"http://schema.org/"};module.exports=r},{}],405:[function(e,module,t){var r=e("../rdf/NodeFactory");var n="http://purl.org/vocab/changeset/schema#";var i={ChangeSet:r.createUri(n+"ChangeSet"),addition:r.createUri(n+"addition"),changeReason:r.createUri(n+"changeReason"),createdDate:r.createUri(n+"createdDate"),creatorName:r.createUri(n+"creatorName"),precedingChangeSet:r.createUri(n+"precedingChangeSet"),removal:r.createUri(n+"removal"),statement:r.createUri(n+"statement"),subjectOfChange:r.createUri(n+"subjectOfChange"),service:r.createUri(n+"service"),graph:r.createUri(n+"graph"),transaction:r.createUri(n+"transaction")};module.exports=i},{"../rdf/NodeFactory":99}],406:[function(e,module,t){"use strict";var r={owl:e("./owl"),rdf:e("./rdf"),rdfs:e("./rdfs"),wgs84:e("./wgs84"),xsd:e("./xsd"),cs:e("./cs"),InitialContext:e("./InitialContext")};module.exports=r},{"./InitialContext":404,"./cs":405,"./owl":407,"./rdf":408,"./rdfs":409,"./wgs84":410,"./xsd":411}],407:[function(e,module,t){var r=e("../rdf/NodeFactory");var n="http://www.w3.org/2002/07/owl#";var i={Class:r.createUri(n+"Class"),DatatypeProperty:r.createUri(n+"DatatypeProperty"),ObjectProperty:r.createUri(n+"ObjectProperty"),AnnotationProperty:r.createUri(n+"AnnotationProperty")};module.exports=i},{"../rdf/NodeFactory":99}],408:[function(e,module,t){var r=e("../rdf/NodeFactory");var n="http://www.w3.org/1999/02/22-rdf-syntax-ns#";var i={type:r.createUri(n+"type"),Property:r.createUri(n+"Property")};module.exports=i},{"../rdf/NodeFactory":99}],409:[function(e,module,t){var r=e("../rdf/NodeFactory");var n="http://www.w3.org/2000/01/rdf-schema#";var i={label:r.createUri(n+"label"),comment:r.createUri(n+"comment"),subClassOf:r.createUri(n+"subClassOf")};module.exports=i},{"../rdf/NodeFactory":99}],410:[function(e,module,t){var r=e("../rdf/NodeFactory");var n="http://www.w3.org/2003/01/geo/wgs84_pos#";var i={lon:r.createUri(n+"long"),lat:r.createUri(n+"lat")};module.exports=i},{"../rdf/NodeFactory":99}],411:[function(e,module,t){var r="http://www.w3.org/2001/XMLSchema#";var n=e("../rdf/node/Node_Uri");var i={xboolean:new n(r+"boolean"),xint:new n(r+"int"),xinteger:new n(r+"integer"),xlong:new n(r+"long"),decimal:new n(r+"decimal"),xfloat:new n(r+"float"),xdouble:new n(r+"double"),xstring:new n(r+"string"),date:new n(r+"date"),dateTime:new n(r+"dateTime")};module.exports=i},{"../rdf/node/Node_Uri":117}],412:[function(e,module,t){"use strict";module.exports=function(e){var t=e._SomePromiseArray;function r(e){var r=new t(e);var n=r.promise();if(n.isRejected()){return n}r.setHowMany(1);r.setUnwrap();r.init();return n}e.any=function(e){return r(e)};e.prototype.any=function(){return r(this)}}},{}],413:[function(e,module,t){(function(t){"use strict";var r=new Error;var n=e("./schedule.js");var i=e("./queue.js");var a=typeof t!=="undefined"?t:undefined;function s(){this._isTickUsed=false;this._lateQueue=new i(16);this._normalQueue=new i(16);var e=this;this.drainQueues=function(){e._drainQueues()};this._schedule=n.isStatic?n(this.drainQueues):n}s.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0};s.prototype._withDomain=function(e){if(a!==undefined&&a.domain!=null&&!e.domain){e=a.domain.bind(e)}return e};s.prototype.throwLater=function(e,t){if(arguments.length===1){t=e;e=function(){throw t}}e=this._withDomain(e);if(typeof setTimeout!=="undefined"){setTimeout(function(){e(t)},0)}else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}};s.prototype.invokeLater=function(e,t,r){e=this._withDomain(e);this._lateQueue.push(e,t,r);this._queueTick()};s.prototype.invokeFirst=function(e,t,r){e=this._withDomain(e);this._normalQueue.unshift(e,t,r);this._queueTick()};s.prototype.invoke=function(e,t,r){e=this._withDomain(e);this._normalQueue.push(e,t,r);this._queueTick()};s.prototype.settlePromises=function(e){this._normalQueue._pushOne(e);this._queueTick()};s.prototype._drainQueue=function(e){while(e.length()>0){var t=e.shift();if(typeof t!=="function"){t._settlePromises();continue}var r=e.shift();var n=e.shift();t.call(r,n)}};s.prototype._drainQueues=function(){this._drainQueue(this._normalQueue);this._reset();this._drainQueue(this._lateQueue)};s.prototype._queueTick=function(){if(!this._isTickUsed){this._isTickUsed=true;this._schedule(this.drainQueues)}};s.prototype._reset=function(){this._isTickUsed=false};module.exports=new s;module.exports.firstLineError=r}).call(this,e("_process"))},{"./queue.js":436,"./schedule.js":439,_process:500}],414:[function(e,module,t){"use strict";var r;if(typeof Promise!=="undefined")r=Promise;function n(e){try{if(Promise===e)Promise=r}catch(e){}return e}module.exports=e("./promise.js")();module.exports.noConflict=n},{"./promise.js":431}],415:[function(e,module,t){"use strict";var r=Object.create;if(r){var n=r(null);var i=r(null);n[" size"]=i[" size"]=0}module.exports=function(t){var r=e("./util.js");var a=r.canEvaluate;var s=r.isIdentifier;function o(e){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,e))}function c(e){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))}function u(e,t,r){var n=r[e];if(typeof n!=="function"){if(!s(e)){return null}n=t(e);r[e]=n;r[" size"]++;if(r[" size"]>512){var i=Object.keys(r);for(var a=0;a<256;++a)delete r[i[a]];r[" size"]=i.length-256}}return n}function l(e){return u(e,o,n)}function f(e){return u(e,c,i)}function v(e){return e[this.pop()].apply(e,this)}t.prototype.call=function(e){var t=arguments.length;var r=new Array(t-1);for(var n=1;n<t;++n){r[n-1]=arguments[n]}if(a){var i=l(e);if(i!==null){return this._then(i,undefined,undefined,r,undefined)}}r.push(e);return this._then(v,undefined,undefined,r,undefined)};function p(e){return e[this]}function h(e){var t=+this;if(t<0)t=Math.max(0,t+e.length);return e[t]}
t.prototype.get=function(e){var t=typeof e==="number";var r;if(!t){if(a){var n=f(e);r=n!==null?n:p}else{r=p}}else{r=h}return this._then(r,undefined,undefined,e,undefined)}}},{"./util.js":446}],416:[function(e,module,t){"use strict";module.exports=function(t,r){var n=e("./errors.js");var i=n.canAttachTrace;var a=e("./async.js");var s=e("./util.js");var o=n.CancellationError;t.prototype._cancel=function(e){if(!this.isCancellable())return this;var t;var r=this;while((t=r._cancellationParent)!==undefined&&t.isCancellable()){r=t}this._unsetCancellable();var n=i(e)?e:new Error(s.toString(e));r._attachExtraTrace(n);r._target()._rejectUnchecked(e,n)};t.prototype.cancel=function(e){if(!this.isCancellable())return this;if(e===undefined)e=new o;a.invokeLater(this._cancel,this,e);return this};t.prototype.cancellable=function(){if(this._cancellable())return this;this._setCancellable();this._cancellationParent=undefined;return this};t.prototype.uncancellable=function(){var e=new t(r);e._propagateFrom(this,2|4);e._follow(this);e._unsetCancellable();return e};t.prototype.fork=function(e,t,r){var n=this._then(e,t,r,undefined,undefined);n._setCancellable();n._cancellationParent=undefined;return n}}},{"./async.js":413,"./errors.js":421,"./util.js":446}],417:[function(e,module,t){"use strict";module.exports=function(){var t=e("./util.js").inherits;var r=e("./es5.js").defineProperty;var n=null;var i=null;function a(e){this._parent=e;f(this,a)}t(a,Error);a.prototype.parent=function(){return this._parent};a.prototype.setParent=function(e){if(e===this)return;this._parent=e};a.prototype.hasParent=function(){return this._parent!==undefined};a.prototype.attachExtraTrace=function(e){var t=this;var r=e.stack;r=typeof r==="string"?r.split("\n"):[];this.protectErrorMessageNewlines(r);var n=1;var i=1;do{r=t.combine(r);i++}while((t=t.parent())!=null);var a=Error.stackTraceLimit||10;var s=(a+n)*i;var o=r.length;if(o>s){r.length=s}if(o>0)r[0]=r[0].split("\0").join("\n");if(r.length<=n){e.stack="(No stack trace)"}else{e.stack=r.join("\n")}};a.prototype.combine=function(e){var t=this.stack.split("\n");var r=e.length-1;var i=e[r];var a=-1;for(var s=t.length-1;s>=0;--s){if(t[s]===i){a=s;break}}for(var s=a;s>=0;--s){var o=t[s];if(e[r]===o){e.pop();r--}else{break}}e.push("From previous event:");var u=e.concat(t);var l=[];for(var s=0,f=u.length;s<f;++s){if(n.test(u[s])&&c(u[s])||s>0&&!n.test(u[s])&&u[s]!=="From previous event:"){continue}l.push(u[s])}return l};a.prototype.protectErrorMessageNewlines=function(e){for(var t=0;t<e.length;++t){if(n.test(e[t])){break}}if(t<=1)return;var r=[];for(var i=0;i<t;++i){r.push(e.shift())}e.unshift(r.join("\0"))};a.formatAndLogError=function(e,t){if(typeof console==="object"){var r;if(typeof e==="object"||typeof e==="function"){var n=e.stack;r=t+i(n,e)}else{r=t+String(e)}if(typeof console.warn==="function"||typeof console.warn==="object"){console.warn(r)}else if(typeof console.log==="function"||typeof console.log==="object"){console.log(r)}}};a.unhandledRejection=function(e){a.formatAndLogError(e,"^--- With additional stack trace: ")};a.possiblyUnhandledRejection=function(e){a.formatAndLogError(e,"Possibly unhandled ")};a.isSupported=function(){return typeof f==="function"};function s(e){var t;if(typeof e==="function"){t="[function "+(e.name||"anonymous")+"]"}else{t=e.toString();var r=/\[object [a-zA-Z0-9$_]+\]/;if(r.test(t)){try{var n=JSON.stringify(e);t=n}catch(e){}}if(t.length===0){t="(empty array)"}}return"(<"+o(t)+">, no stack trace)"}function o(e){var t=41;if(e.length<t){return e}return e.substr(0,t-3)+"..."}var c=function(){return false};var u=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function l(e){var t=e.match(u);if(t){return{fileName:t[1],line:parseInt(t[2],10)}}}a.setBounds=function(e,t){if(!a.isSupported())return;var r=e.stack.split("\n");var n=t.stack.split("\n");var i=-1;var s=-1;var o;var u;for(var f=0;f<r.length;++f){var v=l(r[f]);if(v){o=v.fileName;i=v.line;break}}for(var f=0;f<n.length;++f){var v=l(n[f]);if(v){u=v.fileName;s=v.line;break}}if(i<0||s<0||!o||!u||o!==u||i>=s){return}c=function(e){var t=l(e);if(t){if(t.fileName===o&&(i<=t.line&&t.line<=s)){return true}}return false}};var f=function e(){if(typeof Error.stackTraceLimit==="number"&&typeof Error.captureStackTrace==="function"){n=/^\s*at\s*/;i=function(e,t){if(typeof e==="string")return e;if(t.name!==undefined&&t.message!==undefined){return t.name+". "+t.message}return s(t)};var t=Error.captureStackTrace;var a=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo)/;c=function(e){return a.test(e)};return function(e,r){t(e,r)}}var o=new Error;if(typeof o.stack==="string"&&typeof"".startsWith==="function"&&o.stack.startsWith("stackDetection@")&&e.name==="stackDetection"){r(Error,"stackTraceLimit",{writable:true,enumerable:false,configurable:false,value:25});n=/@/;var u=/[@\n]/;i=function(e,t){if(typeof e==="string"){return t.name+". "+t.message+"\n"+e}if(t.name!==undefined&&t.message!==undefined){return t.name+". "+t.message}return s(t)};return function e(t){var r=(new Error).stack;var n=r.split(u);var i=n.length;var a="";for(var s=0;s<i;s+=2){a+=n[s];a+="@";a+=n[s+1];a+="\n"}t.stack=a}}else{i=function(e,t){if(typeof e==="string")return e;if((typeof t==="object"||typeof t==="function")&&t.name!==undefined&&t.message!==undefined){return t.name+". "+t.message}return s(t)};return null}}();return a}},{"./es5.js":423,"./util.js":446}],418:[function(e,module,t){"use strict";module.exports=function(t){var r=e("./util.js");var n=e("./errors.js");var i=r.tryCatch1;var a=r.errorObj;var s=e("./es5.js").keys;var o=n.TypeError;function c(e,t,r){this._instances=e;this._callback=t;this._promise=r}function u(e,t){var r={};var n=i(e,r,t);if(n===a)return n;var c=s(r);if(c.length){a.e=new o("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n");return a}return n}c.prototype.doFilter=function(e){var s=this._callback;var o=this._promise;var c=o._boundTo;for(var l=0,f=this._instances.length;l<f;++l){var v=this._instances[l];var p=v===Error||v!=null&&v.prototype instanceof Error;if(p&&e instanceof v){var h=i(s,c,e);if(h===a){t.e=h.e;return t}return h}else if(typeof v==="function"&&!p){var d=u(v,e);if(d===a){var g=n.canAttachTrace(a.e)?a.e:new Error(r.toString(a.e));this._promise._attachExtraTrace(g);e=a.e;break}else if(d){var h=i(s,c,e);if(h===a){t.e=h.e;return t}return h}}}t.e=e;return t};return c}},{"./errors.js":421,"./es5.js":423,"./util.js":446}],419:[function(e,module,t){"use strict";var r=e("./util.js");var n=r.isPrimitive;var i=r.wrapsPrimitiveReceiver;module.exports=function(e){var t=function(){return this};var r=function(){throw this};var a=function(e,t){if(t===1){return function(){throw e}}else if(t===2){return function(){return e}}};e.prototype["return"]=e.prototype.thenReturn=function(e){if(i&&n(e)){return this._then(a(e,2),undefined,undefined,undefined,undefined)}return this._then(t,undefined,undefined,e,undefined)};e.prototype["throw"]=e.prototype.thenThrow=function(e){if(i&&n(e)){return this._then(a(e,1),undefined,undefined,undefined,undefined)}return this._then(r,undefined,undefined,e,undefined)}}},{"./util.js":446}],420:[function(e,module,t){"use strict";module.exports=function(e,t){var r=e.reduce;e.prototype.each=function(e){return r(this,e,null,t)};e.each=function(e,n){return r(e,n,null,t)}}},{}],421:[function(e,module,t){"use strict";var r=e("./es5.js").freeze;var n=e("./es5.js").propertyIsWritable;var i=e("./util.js");var a=i.inherits;var s=i.notEnumerableProp;function o(e){try{s(e,"isOperational",true)}catch(e){}}function c(e){if(e==null)return false;return e instanceof S||e["isOperational"]===true}function u(e){return e instanceof Error}function l(e){return u(e)&&n(e,"stack")}function f(e,t){function r(n){if(!(this instanceof r))return new r(n);s(this,"message",typeof n==="string"?n:t);s(this,"name",e);if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}a(r,Error);return r}var v,p;var h=f("CancellationError","cancellation error");var d=f("TimeoutError","timeout error");var g=f("AggregateError","aggregate error");try{v=TypeError;p=RangeError}catch(e){v=f("TypeError","type error");p=f("RangeError","range error")}var m=("join pop push shift unshift slice filter forEach some "+"every map indexOf lastIndexOf reduce reduceRight sort reverse").split(" ");for(var y=0;y<m.length;++y){if(typeof Array.prototype[m[y]]==="function"){g.prototype[m[y]]=Array.prototype[m[y]]}}g.prototype.length=0;g.prototype["isOperational"]=true;var x=0;g.prototype.toString=function(){var e=Array(x*4+1).join(" ");var t="\n"+e+"AggregateError of:"+"\n";x++;e=Array(x*4+1).join(" ");for(var r=0;r<this.length;++r){var n=this[r]===this?"[Circular AggregateError]":this[r]+"";var i=n.split("\n");for(var a=0;a<i.length;++a){i[a]=e+i[a]}n=i.join("\n");t+=n+"\n"}x--;return t};function S(e){s(this,"name","OperationalError");s(this,"message",e);this.cause=e;this["isOperational"]=true;if(e instanceof Error){s(this,"message",e.message);s(this,"stack",e.stack)}else if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}a(S,Error);var _="__BluebirdErrorTypes__";var w=Error[_];if(!w){w=r({CancellationError:h,TimeoutError:d,OperationalError:S,RejectionError:S,AggregateError:g});s(Error,_,w)}module.exports={Error:Error,TypeError:v,RangeError:p,CancellationError:w.CancellationError,OperationalError:w.OperationalError,TimeoutError:w.TimeoutError,AggregateError:w.AggregateError,originatesFromRejection:c,markAsOriginatingFromRejection:o,canAttachTrace:l}},{"./es5.js":423,"./util.js":446}],422:[function(e,module,t){"use strict";module.exports=function(t){var r=e("./errors.js").TypeError;function n(e){var n=new r(e);var i=t.rejected(n);var a=i._peekContext();if(a!=null){a.attachExtraTrace(n)}return i}return n}},{"./errors.js":421}],423:[function(e,module,t){var r=function(){"use strict";return this===undefined}();if(r){module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!!(!r||r.writable||r.set)}}}else{var n={}.hasOwnProperty;var i={}.toString;var a={}.constructor.prototype;var s=function(e){var t=[];for(var r in e){if(n.call(e,r)){t.push(r)}}return t};var o=function(e,t,r){e[t]=r.value;return e};var c=function(e){return e};var u=function(e){try{return Object(e).constructor.prototype}catch(e){return a}};var l=function(e){try{return i.call(e)==="[object Array]"}catch(e){return false}};module.exports={isArray:l,keys:s,defineProperty:o,freeze:c,getPrototypeOf:u,isES5:r,propertyIsWritable:function(){return true}}}},{}],424:[function(e,module,t){"use strict";module.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)};e.filter=function(e,n,i){return r(e,n,i,t)}}},{}],425:[function(e,module,t){"use strict";module.exports=function(t,r,n){var i=e("./util.js");var a=i.wrapsPrimitiveReceiver;var s=i.isPrimitive;var o=i.thrower;function c(){return this}function u(){throw this}function l(e){return function(){return e}}function f(e){return function(){throw e}}function v(e,t,r){var n;if(a&&s(t)){n=r?l(t):f(t)}else{n=r?c:u}return e._then(n,o,undefined,t,undefined)}function p(e){var i=this.promise;var a=this.handler;var s=i._isBound()?a.call(i._boundTo):a();if(s!==undefined){var o=n(s,undefined);if(o instanceof t){o=o._target();return v(o,e,i.isFulfilled())}}if(i.isRejected()){r.e=e;return r}else{return e}}function h(e){var r=this.promise;var i=this.handler;var a=r._isBound()?i.call(r._boundTo,e):i(e);if(a!==undefined){var s=n(a,undefined);if(s instanceof t){s=s._target();return v(s,e,true)}}return e}t.prototype._passThroughHandler=function(e,t){if(typeof e!=="function")return this.then();var r={promise:this,handler:e};return this._then(t?p:h,t?p:undefined,undefined,r,undefined)};t.prototype.lastly=t.prototype["finally"]=function(e){return this._passThroughHandler(e,true)};t.prototype.tap=function(e){return this._passThroughHandler(e,false)}}},{"./util.js":446}],426:[function(e,module,t){"use strict";module.exports=function(t,r,n,i){var a=e("./errors.js");var s=a.TypeError;var o=e("./util.js").deprecated;var c=e("./util.js");var u=c.errorObj;var l=c.tryCatch1;var f=[];function v(e,r,n){var a=u;var s=t;var o=r.length;for(var c=0;c<o;++c){var f=l(r[c],undefined,e);if(f===a){return s.reject(a.e)}var v=i(f,n);if(v instanceof s)return v}return null}function p(e,r,i){var a=this._promise=new t(n);a._setTrace(undefined);this._generatorFunction=e;this._receiver=r;this._generator=undefined;this._yieldHandlers=typeof i==="function"?[i].concat(f):f}p.prototype.promise=function(){return this._promise};p.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver);this._receiver=this._generatorFunction=undefined;this._next(undefined)};p.prototype._continue=function(e){if(e===u){this._generator=undefined;var r=a.canAttachTrace(e.e)?e.e:new Error(c.toString(e.e));this._promise._attachExtraTrace(r);this._promise._reject(e.e,r);return}var n=e.value;if(e.done===true){this._generator=undefined;if(!this._promise._tryFollow(n)){this._promise._fulfill(n)}}else{var o=i(n,this._promise);if(!(o instanceof t)){o=v(o,this._yieldHandlers,this._promise);if(o===null){this._throw(new s("A value was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n"));return}}o._then(this._next,this._throw,undefined,this,null)}};p.prototype._throw=function(e){if(a.canAttachTrace(e))this._promise._attachExtraTrace(e);this._continue(l(this._generator["throw"],this._generator,e))};p.prototype._next=function(e){this._continue(l(this._generator.next,this._generator,e))};t.coroutine=function(e,t){if(typeof e!=="function"){throw new s("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n")}var r=Object(t).yieldHandler;var n=p;return function(){var t=e.apply(this,arguments);var i=new n(undefined,undefined,r);i._generator=t;i._next(undefined);return i.promise()}};t.coroutine.addYieldHandler=function(e){if(typeof e!=="function")throw new s("fn must be a function\n\n    See http://goo.gl/916lJJ\n");f.push(e)};t.spawn=function(e){o("Promise.spawn is deprecated. Use Promise.coroutine instead.");if(typeof e!=="function"){return r("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n")}var n=new p(e,this);var i=n.promise();n._run(t.spawn);return i}}},{"./errors.js":421,"./util.js":446}],427:[function(e,module,t){"use strict";module.exports=function(t,r,n,i){var a=e("./util.js");var s=a.canEvaluate;var o=a.tryCatch1;var c=a.errorObj;if(s){var u=function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))};var l=function(e){var t=[];for(var r=1;r<=e;++r)t.push("holder.p"+r);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,t.join(", ")))};var f=[];var v=[undefined];for(var p=1;p<=5;++p){f.push(u(p));v.push(l(p))}var h=function(e,t){this.p1=this.p2=this.p3=this.p4=this.p5=null;this.fn=t;this.total=e;this.now=0};h.prototype.callers=v;h.prototype.checkFulfillment=function(e){var t=this.now;t++;var r=this.total;if(t>=r){var n=this.callers[r];var i=o(n,undefined,this);if(i===c){e._rejectUnchecked(i.e)}else if(!e._tryFollow(i)){e._fulfillUnchecked(i)}}else{this.now=t}}}function d(e){this._reject(e)}t.join=function(){var e=arguments.length-1;var a;if(e>0&&typeof arguments[e]==="function"){a=arguments[e];if(e<6&&s){var o=new t(i);o._setTrace(undefined);var c=new h(e,a);var u=f;for(var l=0;l<e;++l){var v=n(arguments[l],undefined);if(v instanceof t){v=v._target();if(v._isPending()){v._then(u[l],d,undefined,o,c)}else if(v._isFulfilled()){u[l].call(o,v._value(),c)}else{o._reject(v._reason());v._unsetRejectionIsUnhandled()}}else{u[l].call(o,v,c)}}return o}}var p=arguments.length;var g=new Array(p);for(var m=0;m<p;++m){g[m]=arguments[m]}var o=new r(g).promise();return a!==undefined?o.spread(a):o}}},{"./util.js":446}],428:[function(e,module,t){"use strict";module.exports=function(t,r,n,i,a){var s=e("./util.js");var o=s.tryCatch3;var c=s.errorObj;var u={};var l=[];function f(e,t,r,n){this.constructor$(e);this._promise._setIsSpreadable();this._callback=t;this._preservedValues=n===a?new Array(this.length()):null;this._limit=r;this._inFlight=0;this._queue=r>=1?[]:l;this._init$(undefined,-2)}s.inherits(f,r);f.prototype._init=function(){};f.prototype._promiseFulfilled=function(e,r){var n=this._values;var a=this.length();var s=this._preservedValues;var l=this._limit;if(n[r]===u){n[r]=e;if(l>=1){this._inFlight--;this._drainQueue();if(this._isResolved())return}}else{if(l>=1&&this._inFlight>=l){n[r]=e;this._queue.push(r);return}if(s!==null)s[r]=e;var f=this._callback;var v=this._promise._boundTo;var p=o(f,v,e,r,a);if(p===c)return this._reject(p.e);var h=i(p,this._promise);if(h instanceof t){h=h._target();if(h._isPending()){if(l>=1)this._inFlight++;n[r]=u;return h._proxyPromiseArray(this,r)}else if(h._isFulfilled()){p=h._value()}else{h._unsetRejectionIsUnhandled();return this._reject(h._reason())}}n[r]=p}var d=++this._totalResolved;if(d>=a){if(s!==null){this._filter(n,s)}else{this._resolve(n)}}};f.prototype._drainQueue=function(){var e=this._queue;var t=this._limit;var r=this._values;while(e.length>0&&this._inFlight<t){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}};f.prototype._filter=function(e,t){var r=t.length;var n=new Array(r);var i=0;for(var a=0;a<r;++a){if(e[a])n[i++]=t[a]}n.length=i;this._resolve(n)};f.prototype.preservedValues=function(){return this._preservedValues};function v(e,t,r,n){var i=typeof r==="object"&&r!==null?r.concurrency:0;i=typeof i==="number"&&isFinite(i)&&i>=1?i:0;return new f(e,t,i,n)}t.prototype.map=function(e,t){if(typeof e!=="function")return n("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return v(this,e,t,null).promise()};t.map=function(e,t,r,i){if(typeof t!=="function")return n("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return v(e,t,r,i).promise()}}},{"./util.js":446}],429:[function(e,module,t){"use strict";module.exports=function(t){var r=e("./util.js");var n=e("./async.js");var i=r.tryCatch2;var a=r.tryCatch1;var s=r.errorObj;function o(e,t){if(!r.isArray(e))return c(e,t);var i=r.tryCatchApply(this,[null].concat(e),t);if(i===s){n.throwLater(i.e)}}function c(e,t){var r=this;var o=e===undefined?a(r,t,null):i(r,t,null,e);if(o===s){n.throwLater(o.e)}}function u(e,t){var r=this;var i=a(r,t,e);if(i===s){n.throwLater(i.e)}}t.prototype.nodeify=function(e,t){if(typeof e=="function"){var r=c;if(t!==undefined&&Object(t).spread){r=o}this._then(r,u,undefined,e,this._boundTo)}return this}}},{"./async.js":413,"./util.js":446}],430:[function(e,module,t){"use strict";module.exports=function(t,r){var n=e("./util.js");var i=e("./async.js");var a=e("./errors.js");var s=n.tryCatch1;var o=n.errorObj;t.prototype.progressed=function(e){return this._then(undefined,undefined,e,undefined,undefined)};t.prototype._progress=function(e){if(this._isFollowingOrFulfilledOrRejected())return;this._target()._progressUnchecked(e)};t.prototype._progressHandlerAt=function(e){return e===0?this._progressHandler0:this[(e<<2)+e-5+2]};t.prototype._doProgressWith=function(e){var r=e.value;var i=e.handler;var c=e.promise;var u=e.receiver;var l=s(i,u,r);if(l===o){if(l.e!=null&&l.e.name!=="StopProgressPropagation"){var f=a.canAttachTrace(l.e)?l.e:new Error(n.toString(l.e));c._attachExtraTrace(f);c._progress(l.e)}}else if(l instanceof t){l._then(c._progress,null,null,c,undefined)}else{c._progress(l)}};t.prototype._progressUnchecked=function(e){var n=this._length();var a=this._progress;for(var s=0;s<n;s++){var o=this._progressHandlerAt(s);var c=this._promiseAt(s);if(!(c instanceof t)){var u=this._receiverAt(s);if(typeof o==="function"){o.call(u,e,c)}else if(u instanceof r&&!u._isResolved()){u._promiseProgressed(e,c)}continue}if(typeof o==="function"){i.invoke(this._doProgressWith,this,{handler:o,promise:c,receiver:this._receiverAt(s),value:e})}else{i.invoke(a,c,e)}}}}},{"./async.js":413,"./errors.js":421,"./util.js":446}],431:[function(e,module,t){(function(t){"use strict";module.exports=function(){var r=function(){return new _("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")};var n=function(){return new q.PromiseInspection(this._target())};var i=e("./util.js");var a=e("./async.js");var s=e("./errors.js");var o=function(){};var c={};var u={e:null};var l=e("./thenables.js")(q,o);var f=e("./promise_array.js")(q,o,l);var v=e("./captured_trace.js")();var p=e("./catch_filter.js")(u);var h=e("./promise_resolver.js");var d=i.isArray;var g=i.errorObj;var m=i.tryCatch1;var y=i.tryCatch2;var x=i.tryCatchApply;var S=s.RangeError;var _=s.TypeError;var w=s.CancellationError;var b=s.TimeoutError;var C=s.OperationalError;var E=s.originatesFromRejection;var L=s.markAsOriginatingFromRejection;var j=s.canAttachTrace;var U=e("./errors_api_rejection")(q);var T;var F=false||!!(typeof t!=="undefined"&&typeof t.execPath==="string"&&typeof t.env==="object"&&(t.env["BLUEBIRD_DEBUG"]||t.env["NODE_ENV"]==="development"));function q(e){if(typeof e!=="function"){throw new _("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n")}if(this.constructor!==q){throw new _("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n")}this._bitField=0;this._fulfillmentHandler0=undefined;this._rejectionHandler0=undefined;this._progressHandler0=undefined;this._promise0=undefined;this._receiver0=undefined;this._settledValue=undefined;this._boundTo=undefined;if(e!==o)this._resolveFromResolver(e)}q.prototype.bind=function(e){var t=l(e,this);var r=new q(o);r._propagateFrom(this,2|1);var n=this._target();if(t instanceof q){n._then(o,r._reject,r._progress,r,null);t._then(function(e){if(r._isPending()){r._setBoundTo(e);r._follow(n)}},r._reject,r._progress,r,null)}else{r._setBoundTo(e);r._follow(n)}return r};q.prototype.toString=function(){return"[object Promise]"};q.prototype.caught=q.prototype["catch"]=function(e){var t=arguments.length;if(t>1){var r=new Array(t-1),n=0,i;for(i=0;i<t-1;++i){var a=arguments[i];if(typeof a==="function"){r[n++]=a}else{var s=new _("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n");this._attachExtraTrace(s);return q.reject(s)}}r.length=n;e=arguments[i];this._resetTrace();var o=new p(r,e,this);return this._then(undefined,o.doFilter,undefined,o,undefined)}return this._then(undefined,e,undefined,undefined,undefined)};q.prototype.reflect=function(){return this._then(n,n,undefined,this,undefined)};q.prototype.then=function(e,t,r){return this._then(e,t,r,undefined,undefined)};q.prototype.done=function(e,t,r){var n=this._then(e,t,r,undefined,undefined);n._setIsFinal()};q.prototype.spread=function(e,t){var r=this._target();var n=r._isSpreadable()?r===this?this:this.then():this.all();return n._then(e,t,undefined,c,undefined)};q.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()};q.prototype.toJSON=function(){var e={isFulfilled:false,isRejected:false,fulfillmentValue:undefined,rejectionReason:undefined};if(this.isFulfilled()){e.fulfillmentValue=this.value();e.isFulfilled=true}else if(this.isRejected()){e.rejectionReason=this.reason();e.isRejected=true}return e};q.prototype.all=function(){var e=new f(this).promise();e._setIsSpreadable();return e};q.prototype.error=function(e){return this.caught(E,e)};q.is=function(e){return e instanceof q};q.all=function(e){var t=new f(e).promise();t._setIsSpreadable();return t};q.method=function(e){if(typeof e!=="function"){throw new _("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}return function(){var t;switch(arguments.length){case 0:t=m(e,this,undefined);break;case 1:t=m(e,this,arguments[0]);break;case 2:t=y(e,this,arguments[0],arguments[1]);break;default:var r=arguments.length;var n=new Array(r);for(var i=0;i<r;++i){n[i]=arguments[i]}t=x(e,n,this);break}var a=new q(o);a._setTrace(undefined);a._resolveFromSyncValue(t);return a}};q.attempt=q["try"]=function(e,t,r){if(typeof e!=="function"){return U("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}var n=d(t)?x(e,t,r):m(e,r,t);var i=new q(o);i._setTrace(undefined);i._resolveFromSyncValue(n);return i};q.defer=q.pending=function(){var e=new q(o);e._setTrace(undefined);return new h(e)};q.bind=function(e){var t=l(e,undefined);var r=new q(o);r._setTrace(undefined);if(t instanceof q){t._then(function(e){r._setBoundTo(e);r._fulfill(undefined)},r._reject,r._progress,r,null)}else{r._setBoundTo(e);r._setFulfilled()}return r};q.cast=function(e){var t=l(e,undefined);if(!(t instanceof q)){var r=t;t=new q(o);t._setTrace(undefined);t._setFulfilled();t._settledValue=r;t._cleanValues()}return t};q.resolve=q.fulfilled=q.cast;q.reject=q.rejected=function(e){var t=new q(o);t._setTrace(undefined);L(e);t._setRejected();t._settledValue=e;t._cleanValues();if(!j(e)){var r=new Error(i.toString(e));t._setCarriedStackTrace(r)}t._ensurePossibleRejectionHandled();return t};q.onPossiblyUnhandledRejection=function(e){v.possiblyUnhandledRejection=typeof e==="function"?e:undefined};q.onUnhandledRejectionHandled=function(e){T=typeof e==="function"?e:undefined};q.longStackTraces=function(){if(a.haveItemsQueued()&&F===false){throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n")}F=v.isSupported()};q.hasLongStackTraces=function(){return F&&v.isSupported()};q.setScheduler=function(e){if(typeof e!=="function")throw new _("fn must be a function\n\n    See http://goo.gl/916lJJ\n");a._schedule=e};q.prototype._then=function(e,t,r,n,i){var s=i!==undefined;var c=s?i:new q(o);if(!s){c._propagateFrom(this,7)}var u=this._target();if(u!==this){if(n===undefined)n=this._boundTo;if(!s)c._setIsMigrated()}var l=u._addCallbacks(e,t,r,c,n);if(u._isResolved()&&!u._isSettlePromisesQueued()){a.invoke(u._settlePromiseAtPostResolution,u,l)}return c};q.prototype._settlePromiseAtPostResolution=function(e){if(this._isRejectionUnhandled())this._unsetRejectionIsUnhandled();this._settlePromiseAt(e)};q.prototype._length=function(){return this._bitField&131071};q.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0};q.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912};q.prototype._setLength=function(e){this._bitField=this._bitField&-131072|e&131071};q.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456};q.prototype._setRejected=function(){this._bitField=this._bitField|134217728};q.prototype._setFollowing=function(){this._bitField=this._bitField|536870912};q.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432};q.prototype._isFinal=function(){return(this._bitField&33554432)>0};q.prototype._cancellable=function(){return(this._bitField&67108864)>0};q.prototype._setCancellable=function(){this._bitField=this._bitField|67108864};q.prototype._unsetCancellable=function(){this._bitField=this._bitField&~67108864};q.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152};q.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&~2097152;if(this._isUnhandledRejectionNotified()){this._unsetUnhandledRejectionIsNotified();this._notifyUnhandledRejectionIsHandled()}};q.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0};q.prototype._isSpreadable=function(){return(this._bitField&131072)>0};q.prototype._setIsSpreadable=function(){this._bitField=this._bitField|131072};q.prototype._setIsMigrated=function(){this._bitField=this._bitField|4194304};q.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&~4194304};q.prototype._isMigrated=function(){return(this._bitField&4194304)>0};q.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288};q.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&~524288};q.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0};q.prototype._setCarriedStackTrace=function(e){this._bitField=this._bitField|1048576;this._fulfillmentHandler0=e};q.prototype._unsetCarriedStackTrace=function(){this._bitField=this._bitField&~1048576;this._fulfillmentHandler0=undefined};q.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0};q.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:undefined};q.prototype._receiverAt=function(e){var t=e===0?this._receiver0:this[e*5-5+4];if(this._isBound()&&t===undefined){return this._boundTo}return t};q.prototype._promiseAt=function(e){return e===0?this._promise0:this[e*5-5+3]};q.prototype._fulfillmentHandlerAt=function(e){return e===0?this._fulfillmentHandler0:this[e*5-5+0]};q.prototype._rejectionHandlerAt=function(e){return e===0?this._rejectionHandler0:this[e*5-5+1]};q.prototype._migrateCallbacks=function(e,t,r,n,i){if(n instanceof q)n._setIsMigrated();this._addCallbacks(e,t,r,n,i)};q.prototype._addCallbacks=function(e,t,r,n,i){var a=this._length();if(a>=131071-5){a=0;this._setLength(0)}if(a===0){this._promise0=n;if(i!==undefined)this._receiver0=i;if(typeof e==="function"&&!this._isCarryingStackTrace())this._fulfillmentHandler0=e;if(typeof t==="function")this._rejectionHandler0=t;if(typeof r==="function")this._progressHandler0=r}else{var s=a*5-5;this[s+3]=n;this[s+4]=i;if(typeof e==="function")this[s+0]=e;if(typeof t==="function")this[s+1]=t;if(typeof r==="function")this[s+2]=r}this._setLength(a+1);return a};q.prototype._setProxyHandlers=function(e,t){var r=this._length();if(r>=131071-5){r=0;this._setLength(0)}if(r===0){this._promise0=t;this._receiver0=e}else{var n=r*5-5;this[n+3]=t;this[n+4]=e}this._setLength(r+1)};q.prototype._proxyPromiseArray=function(e,t){this._setProxyHandlers(e,t)};q.prototype._setBoundTo=function(e){if(e!==undefined){this._bitField=this._bitField|8388608;this._boundTo=e}else{this._bitField=this._bitField&~8388608}};q.prototype._isBound=function(){return(this._bitField&8388608)===8388608};q.prototype._resolveFromResolver=function(e){var t=this;this._setTrace(undefined);this._pushContext();var r=y(e,undefined,function(e){if(t._tryFollow(e)){return}t._fulfill(e)},function(e){var r=j(e)?e:new Error(i.toString(e));t._attachExtraTrace(r);L(e);t._reject(e,r===e?undefined:r)});this._popContext();if(r!==undefined&&r===g){var n=r.e;var a=j(n)?n:new Error(i.toString(n));t._reject(n,a)}};q.prototype._settlePromiseFromHandler=function(e,t,n,a){if(a._isRejected())return;a._pushContext();var s;if(t===c&&!this._isRejected()){s=x(e,n,this._boundTo)}else{s=m(e,t,n)}a._popContext();if(s===g||s===a||s===u){var o=s===a?r():s.e;var f=j(o)?o:new Error(i.toString(o));if(s!==u)a._attachExtraTrace(f);a._rejectUnchecked(o,f)}else{s=l(s,a);if(s instanceof q){s=s._target();if(s._isRejected()&&!s._isCarryingStackTrace()&&!j(s._reason())){var f=new Error(i.toString(s._reason()));a._attachExtraTrace(f);s._setCarriedStackTrace(f)}a._follow(s)}else{a._fulfillUnchecked(s)}}};q.prototype._target=function(){var e=this;while(e._isFollowing())e=e._followee();return e};q.prototype._followee=function(){return this._rejectionHandler0};q.prototype._setFollowee=function(e){this._rejectionHandler0=e};q.prototype._follow=function(e){if(e._isPending()){var t=this._length();for(var r=0;r<t;++r){
e._migrateCallbacks(this._fulfillmentHandlerAt(r),this._rejectionHandlerAt(r),this._progressHandlerAt(r),this._promiseAt(r),this._receiverAt(r))}this._setFollowing();this._setLength(0);this._setFollowee(e);this._propagateFrom(e,1)}else if(e._isFulfilled()){this._fulfillUnchecked(e._value())}else{this._rejectUnchecked(e._reason(),e._getCarriedStackTrace())}if(e._isRejectionUnhandled())e._unsetRejectionIsUnhandled();if(F&&!e._trace.hasParent()){e._trace.setParent(this._trace)}};q.prototype._tryFollow=function(e){if(this._isFollowingOrFulfilledOrRejected()||e===this){return false}var t=l(e,this);if(!(t instanceof q)){return false}this._follow(t._target());return true};q.prototype._resetTrace=function(){if(F){this._trace=new v(this._peekContext())}};q.prototype._setTrace=function(e){if(F){var t=this._peekContext();if(e!==undefined&&e._trace.parent()===t){this._trace=e._trace}else{this._trace=new v(t)}}return this};q.prototype._attachExtraTrace=function(e){if(F&&j(e)){this._trace.attachExtraTrace(e)}};q.prototype._cleanValues=function(){if(this._cancellable()){this._cancellationParent=undefined}};q.prototype._propagateFrom=function(e,t){if((t&1)>0&&e._cancellable()){this._setCancellable();this._cancellationParent=e}if((t&4)>0){this._setBoundTo(e._boundTo)}if((t&2)>0){this._setTrace(e)}};q.prototype._fulfill=function(e){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(e)};q.prototype._reject=function(e,t){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(e,t)};q.prototype._settlePromiseAt=function(e){var t=this._promiseAt(e);var r=t instanceof q;if(r&&t._isMigrated()){t._unsetIsMigrated();return a.invoke(this._settlePromiseAt,this,e)}var n=this._isFulfilled()?this._fulfillmentHandlerAt(e):this._rejectionHandlerAt(e);var i=this._isCarryingStackTrace()?this._getCarriedStackTrace():undefined;var s=this._settledValue;var o=this._receiverAt(e);this._clearCallbackDataAtIndex(e);if(typeof n==="function"){if(!r){n.call(o,s,t)}else{this._settlePromiseFromHandler(n,o,s,t)}}else if(o instanceof f){if(!o._isResolved()){if(this._isFulfilled()){o._promiseFulfilled(s,t)}else{o._promiseRejected(s,t)}}}else if(this._isFulfilled()){t._fulfill(s)}else{t._reject(s,i)}if(e>=4&&(e&31)===4)a.invokeLater(this._setLength,this,0)};q.prototype._clearCallbackDataAtIndex=function(e){if(e===0){if(!this._isCarryingStackTrace()){this._fulfillmentHandler0=undefined}this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=undefined}else{var t=e*5-5;this[t+3]=this[t+4]=this[t+0]=this[t+1]=this[t+2]=undefined}};q.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824};q.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824};q.prototype._unsetSettlePromisesQueued=function(){this._bitField=this._bitField&~-1073741824};q.prototype._queueSettlePromises=function(){if(!this._isSettlePromisesQueued()){a.settlePromises(this);this._setSettlePromisesQueued()}};q.prototype._fulfillUnchecked=function(e){if(e===this){var t=r();this._attachExtraTrace(t);return this._rejectUnchecked(t,undefined)}this._setFulfilled();this._settledValue=e;this._cleanValues();if(this._length()>0){this._queueSettlePromises()}};q.prototype._rejectUncheckedCheckError=function(e){var t=j(e)?e:new Error(i.toString(e));this._rejectUnchecked(e,t===e?undefined:t)};q.prototype._rejectUnchecked=function(e,t){if(e===this){var n=r();this._attachExtraTrace(n);return this._rejectUnchecked(n)}this._setRejected();this._settledValue=e;this._cleanValues();if(this._isFinal()){a.throwLater(function(e){if("stack"in e){a.invokeFirst(v.unhandledRejection,undefined,e)}throw e},t===undefined?e:t);return}if(t!==undefined)this._setCarriedStackTrace(t);if(this._length()>0){this._queueSettlePromises()}else{this._ensurePossibleRejectionHandled()}};q.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();var e=this._length();for(var t=0;t<e;t++){this._settlePromiseAt(t)}};q.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled();if(v.possiblyUnhandledRejection!==undefined){a.invokeLater(this._notifyUnhandledRejection,this,undefined)}};q.prototype._notifyUnhandledRejectionIsHandled=function(){if(typeof T==="function"){a.throwLater(T,this)}};q.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue;var t=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified();if(t!==undefined){this._unsetCarriedStackTrace();e=t}if(typeof v.possiblyUnhandledRejection==="function"){v.possiblyUnhandledRejection(e,this)}}};var k=[];q.prototype._peekContext=function(){var e=k.length-1;if(e>=0){return k[e]}return undefined};q.prototype._pushContext=function(){if(!F)return;k.push(this._trace)};q.prototype._popContext=function(){if(!F)return;k.pop()};q.prototype._resolveFromSyncValue=function(e){if(e===g){this._setRejected();var t=e.e;this._settledValue=t;this._cleanValues();this._attachExtraTrace(t);this._ensurePossibleRejectionHandled()}else{var r=l(e,this);if(r instanceof q){r=r._target();this._follow(r)}else{this._setFulfilled();this._settledValue=e;this._cleanValues()}}};if(!v.isSupported()){q.longStackTraces=function(){};F=false}q._makeSelfResolutionError=r;e("./finally.js")(q,u,l);e("./direct_resolve.js")(q);e("./synchronous_inspection.js")(q);e("./join.js")(q,f,l,o);q.RangeError=S;q.CancellationError=w;q.TimeoutError=b;q.TypeError=_;q.OperationalError=C;q.RejectionError=C;q.AggregateError=s.AggregateError;i.toFastProperties(q);i.toFastProperties(q.prototype);q.Promise=q;v.setBounds(a.firstLineError,i.lastLineError);e("./nodeify.js")(q);e("./using.js")(q,U,l);e("./generators.js")(q,U,o,l);e("./map.js")(q,f,U,l,o);e("./cancel.js")(q,o);e("./promisify.js")(q,o);e("./props.js")(q,f,l);e("./race.js")(q,o,l);e("./reduce.js")(q,f,U,l,o);e("./settle.js")(q,f);e("./call_get.js")(q);e("./some.js")(q,f,U);e("./progress.js")(q,f);e("./any.js")(q);e("./each.js")(q,o);e("./timers.js")(q,o,l);e("./filter.js")(q,o);q.prototype=q.prototype;return q}}).call(this,e("_process"))},{"./any.js":412,"./async.js":413,"./call_get.js":415,"./cancel.js":416,"./captured_trace.js":417,"./catch_filter.js":418,"./direct_resolve.js":419,"./each.js":420,"./errors.js":421,"./errors_api_rejection":422,"./filter.js":424,"./finally.js":425,"./generators.js":426,"./join.js":427,"./map.js":428,"./nodeify.js":429,"./progress.js":430,"./promise_array.js":432,"./promise_resolver.js":433,"./promisify.js":434,"./props.js":435,"./race.js":437,"./reduce.js":438,"./settle.js":440,"./some.js":441,"./synchronous_inspection.js":442,"./thenables.js":443,"./timers.js":444,"./using.js":445,"./util.js":446,_process:500}],432:[function(e,module,t){"use strict";module.exports=function(t,r,n){var i=e("./errors.js").canAttachTrace;var a=e("./util.js");var s=a.isArray;function o(e){switch(e){case-1:return undefined;case-2:return[];case-3:return{}}}function c(e){var n=this._promise=new t(r);var i;if(e instanceof t){i=e;n._propagateFrom(i,1|4)}n._setTrace(i);this._values=e;this._length=0;this._totalResolved=0;this._init(undefined,-2)}c.prototype.length=function(){return this._length};c.prototype.promise=function(){return this._promise};c.prototype._init=function e(r,i){var a=n(this._values,undefined);if(a instanceof t){a._setBoundTo(this._promise._boundTo);a=a._target();this._values=a;if(a._isFulfilled()){a=a._value();if(!s(a)){var c=new t.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");this.__hardReject__(c);return}}else if(a._isPending()){a._then(e,this._reject,undefined,this,i);return}else{a._unsetRejectionIsUnhandled();this._reject(a._reason());return}}else if(!s(a)){var c=new t.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");this.__hardReject__(c);return}if(a.length===0){if(i===-5){this._resolveEmptyArray()}else{this._resolve(o(i))}return}var u=this.getActualLength(a.length);this._length=u;this._values=this.shouldCopyValues()?new Array(u):this._values;var l=this._promise;for(var f=0;f<u;++f){if(this._isResolved())return;var v=n(a[f],l);if(v instanceof t){v=v._target();if(v._isPending()){v._proxyPromiseArray(this,f)}else if(v._isFulfilled()){this._promiseFulfilled(v._value(),f)}else{v._unsetRejectionIsUnhandled();this._promiseRejected(v._reason(),f)}}else{this._promiseFulfilled(v,f)}}};c.prototype._isResolved=function(){return this._values===null};c.prototype._resolve=function(e){this._values=null;this._promise._fulfill(e)};c.prototype.__hardReject__=c.prototype._reject=function(e){this._values=null;var t=i(e)?e:new Error(a.toString(e));this._promise._attachExtraTrace(t);this._promise._reject(e,t)};c.prototype._promiseProgressed=function(e,t){this._promise._progress({index:t,value:e})};c.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var r=++this._totalResolved;if(r>=this._length){this._resolve(this._values)}};c.prototype._promiseRejected=function(e,t){this._totalResolved++;this._reject(e)};c.prototype.shouldCopyValues=function(){return true};c.prototype.getActualLength=function(e){return e};return c}},{"./errors.js":421,"./util.js":446}],433:[function(e,module,t){"use strict";var r=e("./util.js");var n=r.maybeWrapAsError;var i=e("./errors.js");var a=i.TimeoutError;var s=i.OperationalError;var o=e("./async.js");var c=r.haveGetters;var u=e("./es5.js");function l(e){return e instanceof Error&&u.getPrototypeOf(e)===Error.prototype}function f(e){var t;if(l(e)){t=new s(e)}else{t=e}i.markAsOriginatingFromRejection(t);return t}function v(e){e._setIsSpreadable();return function(t,r){if(e===null)return;if(t){var i=f(n(t));e._attachExtraTrace(i);e._reject(i)}else if(arguments.length>2){var a=arguments.length;var s=new Array(a-1);for(var o=1;o<a;++o){s[o-1]=arguments[o]}e._fulfill(s)}else{e._fulfill(r)}e=null}}var p;if(!c){p=function(e){this.promise=e;this.asCallback=v(e);this.callback=this.asCallback}}else{p=function(e){this.promise=e}}if(c){var h={get:function(){return v(this.promise)}};u.defineProperty(p.prototype,"asCallback",h);u.defineProperty(p.prototype,"callback",h)}p._nodebackForPromise=v;p.prototype.toString=function(){return"[object PromiseResolver]"};p.prototype.resolve=p.prototype.fulfill=function(e){if(!(this instanceof p)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}var t=this.promise;if(t._tryFollow(e)){return}o.invoke(t._fulfill,t,e)};p.prototype.reject=function(e){if(!(this instanceof p)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}var t=this.promise;i.markAsOriginatingFromRejection(e);var n=i.canAttachTrace(e)?e:new Error(r.toString(e));t._attachExtraTrace(n);o.invoke(t._reject,t,e);if(n!==e){o.invoke(this._setCarriedStackTrace,this,n)}};p.prototype.progress=function(e){if(!(this instanceof p)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}o.invoke(this.promise._progress,this.promise,e)};p.prototype.cancel=function(){o.invoke(this.promise.cancel,this.promise,undefined)};p.prototype.timeout=function(){this.reject(new a("timeout"))};p.prototype.isResolved=function(){return this.promise.isResolved()};p.prototype.toJSON=function(){return this.promise.toJSON()};p.prototype._setCarriedStackTrace=function(e){if(this.promise.isRejected()){this.promise._setCarriedStackTrace(e)}};module.exports=p},{"./async.js":413,"./errors.js":421,"./es5.js":423,"./util.js":446}],434:[function(e,module,t){"use strict";module.exports=function(t,r){var n={};var i=e("./util.js");var a=e("./promise_resolver.js")._nodebackForPromise;var s=i.withAppended;var o=i.maybeWrapAsError;var c=i.canEvaluate;var u=e("./errors").TypeError;var l="Async";var f=function(e,t){return i.isIdentifier(e)&&e.charAt(0)!=="_"&&!i.isClass(t)};var v={__isPromisified__:true};function p(e){return e.replace(/([$])/,"\\$")}function h(e){try{return e.__isPromisified__===true}catch(e){return false}}function d(e,t,r){var n=i.getDataPropertyOrDefault(e,t+r,v);return n?h(n):false}function g(e,t,r){for(var n=0;n<e.length;n+=2){var i=e[n];if(r.test(i)){var a=i.replace(r,"");for(var s=0;s<e.length;s+=2){if(e[s]===a){throw new u("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",t))}}}}}function m(e,t,r,n){var a=i.inheritedDataKeys(e);var s=[];for(var o=0;o<a.length;++o){var c=a[o];var u=e[c];if(typeof u==="function"&&!h(u)&&!d(e,c,t)&&n(c,u,e)){s.push(c,u)}}g(s,t,r);return s}function y(e){var t=[e];var r=Math.max(0,e-1-5);for(var n=e-1;n>=r;--n){if(n===e)continue;t.push(n)}for(var n=e+1;n<=5;++n){t.push(n)}return t}function x(e){return i.filledRange(e,"arguments[","]")}function S(e){return i.filledRange(e,"_arg","")}function _(e){if(typeof e.length==="number"){return Math.max(Math.min(e.length,1023+1),0)}return 0}function w(e){if(i.isIdentifier(e)){return"."+e}else return"['"+e.replace(/(['\\])/g,"\\$1")+"']"}function b(e,c,u,l,f){var v=Math.max(0,_(l)-1);var p=y(v);var h=typeof u==="string"&&i.isIdentifier(u)?u+f:"promisified";function d(t){var r=x(t).join(", ");var i=t>0?", ":"";var a;if(typeof e==="string"){a="                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",w(e))}else if(c===n){a="                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            "}else if(c!==undefined){a="                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            "}else{a="                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            "}return a.replace("{{args}}",r).replace(", ",i)}function g(){var t="";for(var r=0;r<p.length;++r){t+="case "+p[r]+":"+d(p[r])}var i;if(typeof e==="string"){i="                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",w(e))}else if(c===n){i="                                                  \n                callback.apply(this, args);                                  \n            "}else{i="                                                  \n                callback.apply(receiver, args);                              \n            "}t+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",i);return t}return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function (Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(undefined);                                    \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",h).replace("Parameters",S(v)).replace("[CodeForSwitchCase]",g()))(t,e,c,s,o,a,r)}function C(e,i){function c(){var c=i;if(i===n)c=this;if(typeof e==="string"){e=c[e]}var u=new t(r);u._setTrace(undefined);var l=a(u);try{e.apply(c,s(arguments,l))}catch(e){var f=o(e);u._attachExtraTrace(f);u._reject(f)}return u}c.__isPromisified__=true;return c}var E=c?b:C;function L(e,t,r,a){var s=new RegExp(p(t)+"$");var o=m(e,t,s,r);for(var c=0,u=o.length;c<u;c+=2){var l=o[c];var f=o[c+1];var v=l+t;e[v]=a===E?E(l,n,l,f,t):a(f)}i.toFastProperties(e);return e}function j(e,t){return E(e,t,undefined,e)}t.promisify=function(e,t){if(typeof e!=="function"){throw new u("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}if(h(e)){return e}return j(e,arguments.length<2?n:t)};t.promisifyAll=function(e,t){if(typeof e!=="function"&&typeof e!=="object"){throw new u("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n")}t=Object(t);var r=t.suffix;if(typeof r!=="string")r=l;var n=t.filter;if(typeof n!=="function")n=f;var a=t.promisifier;if(typeof a!=="function")a=E;if(!i.isIdentifier(r)){throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n")}var s=i.inheritedDataKeys(e,{includeHidden:true});for(var o=0;o<s.length;++o){var c=e[s[o]];if(s[o]!=="constructor"&&i.isClass(c)){L(c.prototype,r,n,a);L(c,r,n,a)}}return L(e,r,n,a)}}},{"./errors":421,"./promise_resolver.js":433,"./util.js":446}],435:[function(e,module,t){"use strict";module.exports=function(t,r,n){var i=e("./util.js");var a=e("./errors_api_rejection")(t);var s=i.isObject;var o=e("./es5.js");function c(e){var t=o.keys(e);var r=t.length;var n=new Array(r*2);for(var i=0;i<r;++i){var a=t[i];n[i]=e[a];n[i+r]=a}this.constructor$(n)}i.inherits(c,r);c.prototype._init=function(){this._init$(undefined,-3)};c.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var r=++this._totalResolved;if(r>=this._length){var n={};var i=this.length();for(var a=0,s=this.length();a<s;++a){n[this._values[a+i]]=this._values[a]}this._resolve(n)}};c.prototype._promiseProgressed=function(e,t){this._promise._progress({key:this._values[t+this.length()],value:e})};c.prototype.shouldCopyValues=function(){return false};c.prototype.getActualLength=function(e){return e>>1};function u(e){var r;var i=n(e,undefined);if(!s(i)){return a("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}else if(i instanceof t){r=i._then(t.props,undefined,undefined,undefined,undefined)}else{r=new c(i).promise()}if(i instanceof t){r._propagateFrom(i,4)}return r}t.prototype.props=function(){return u(this)};t.props=function(e){return u(e)}}},{"./errors_api_rejection":422,"./es5.js":423,"./util.js":446}],436:[function(e,module,t){"use strict";function r(e,t,r,n,i){for(var a=0;a<i;++a){r[a+n]=e[a+t];e[a+t]=void 0}}function n(e){this._capacity=e;this._length=0;this._front=0}n.prototype._willBeOverCapacity=function(e){return this._capacity<e};n.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var r=this._front+t&this._capacity-1;this[r]=e;this._length=t+1};n.prototype._unshiftOne=function(e){var t=this._capacity;this._checkCapacity(this.length()+1);var r=this._front;var n=(r-1&t-1^t)-t;this[n]=e;this._front=n;this._length=this.length()+1};n.prototype.unshift=function(e,t,r){this._unshiftOne(r);this._unshiftOne(t);this._unshiftOne(e)};n.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n)){this._pushOne(e);this._pushOne(t);this._pushOne(r);return}var i=this._front+n-3;this._checkCapacity(n);var a=this._capacity-1;this[i+0&a]=e;this[i+1&a]=t;this[i+2&a]=r;this._length=n};n.prototype.shift=function(){var e=this._front,t=this[e];this[e]=undefined;this._front=e+1&this._capacity-1;this._length--;return t};n.prototype.length=function(){return this._length};n.prototype._checkCapacity=function(e){if(this._capacity<e){this._resizeTo(this._capacity<<1)}};n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front;var i=this._length;if(n+i>t){var a=n+i&t-1;r(this,0,this,t,a)}};module.exports=n},{}],437:[function(e,module,t){"use strict";module.exports=function(t,r,n){var i=e("./errors_api_rejection.js")(t);var a=e("./util.js").isArray;var s=function(e){return e.then(function(t){return o(t,e)})};function o(e,o){var c=n(e,undefined);if(c instanceof t){return s(c)}else if(!a(e)){return i("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")}var u=new t(r);if(o!==undefined){u._propagateFrom(o,7)}else{u._setTrace(undefined)}var l=u._fulfill;var f=u._reject;for(var v=0,p=e.length;v<p;++v){var h=e[v];if(h===undefined&&!(v in e)){continue}t.cast(h)._then(l,f,undefined,u,null)}return u}t.race=function(e){return o(e,undefined)};t.prototype.race=function(){return o(this,undefined)}}},{"./errors_api_rejection.js":422,"./util.js":446}],438:[function(e,module,t){"use strict";module.exports=function(t,r,n,i,a){var s=e("./util.js");var o=s.tryCatch4;var c=s.tryCatch3;var u=s.errorObj;function l(e,r,n,s){this.constructor$(e);this._preservedValues=s===a?[]:null;this._zerothIsAccum=n===undefined;this._gotAccum=false;this._reducingIndex=this._zerothIsAccum?1:0;this._valuesPhase=undefined;var o=i(n,undefined);var c=false;var u=o instanceof t;if(u){o=o._target();if(o._isPending()){o._proxyPromiseArray(this,-1)}else if(o._isFulfilled()){n=o._value();this._gotAccum=true}else{o._unsetRejectionIsUnhandled();this._reject(o._reason());c=true}}if(!(u||this._zerothIsAccum))this._gotAccum=true;this._callback=r;this._accum=n;if(!c)this._init$(undefined,-5)}s.inherits(l,r);l.prototype._init=function(){};l.prototype._resolveEmptyArray=function(){if(this._gotAccum||this._zerothIsAccum){this._resolve(this._preservedValues!==null?[]:this._accum)}};l.prototype._promiseFulfilled=function(e,r){var n=this._values;n[r]=e;var a=this.length();var s=this._preservedValues;var l=s!==null;var f=this._gotAccum;var v=this._valuesPhase;var p;if(!v){v=this._valuesPhase=Array(a);for(p=0;p<a;++p){v[p]=0}}p=v[r];if(r===0&&this._zerothIsAccum){if(!f){this._accum=e;this._gotAccum=f=true}v[r]=p===0?1:2}else if(r===-1){if(!f){this._accum=e;this._gotAccum=f=true}}else{if(p===0){v[r]=1}else{v[r]=2;if(f){this._accum=e}}}if(!f)return;var h=this._callback;var d=this._promise._boundTo;var g;for(var m=this._reducingIndex;m<a;++m){p=v[m];if(p===2){this._reducingIndex=m+1;continue}if(p!==1)return;e=n[m];if(e instanceof t){e=e._target();if(e._isFulfilled()){e=e._value()}else if(e._isPending()){return}else{e._unsetRejectionIsUnhandled();return this._reject(e._reason())}}if(l){s.push(e);g=c(h,d,e,m,a)}else{g=o(h,d,this._accum,e,m,a)}if(g===u)return this._reject(g.e);var y=i(g,this._promise);if(y instanceof t){y=y._target();if(y._isPending()){v[m]=4;return y._proxyPromiseArray(this,m)}else if(y._isFulfilled()){g=y._value()}else{y._unsetRejectionIsUnhandled();return this._reject(y._reason())}}this._reducingIndex=m+1;this._accum=g}if(this._reducingIndex<a)return;this._resolve(l?s:this._accum)};function f(e,t,r,i){if(typeof t!=="function")return n("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var a=new l(e,t,r,i);return a.promise()}t.prototype.reduce=function(e,t){return f(this,e,t,null)};t.reduce=function(e,t,r,n){return f(e,t,r,n)}}},{"./util.js":446}],439:[function(e,module,t){(function(e){"use strict";var t;if(typeof e==="object"&&typeof e.version==="string"){t=parseInt(e.version.split(".")[1],10)>10?setImmediate:e.nextTick}else if(typeof MutationObserver!=="undefined"){t=function(e){var t=document.createElement("div");var r=new MutationObserver(e);r.observe(t,{attributes:true});return function(){t.classList.toggle("foo")}};t.isStatic=true}else if(typeof setTimeout!=="undefined"){t=function(e){setTimeout(e,0)}}else{t=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}}module.exports=t}).call(this,e("_process"))},{_process:500}],440:[function(e,module,t){"use strict";module.exports=function(t,r){var n=t.PromiseInspection;var i=e("./util.js");function a(e){this.constructor$(e);this._promise._setIsSpreadable()}i.inherits(a,r);a.prototype._promiseResolved=function(e,t){this._values[e]=t;var r=++this._totalResolved;if(r>=this._length){this._resolve(this._values)}};a.prototype._promiseFulfilled=function(e,t){var r=new n;r._bitField=268435456;r._settledValue=e;this._promiseResolved(t,r)};a.prototype._promiseRejected=function(e,t){var r=new n;r._bitField=134217728;r._settledValue=e;this._promiseResolved(t,r)};t.settle=function(e){return new a(e).promise()};t.prototype.settle=function(){return new a(this).promise()}}},{"./util.js":446}],441:[function(e,module,t){"use strict";module.exports=function(t,r,n){var i=e("./util.js");var a=e("./errors.js").RangeError;var s=e("./errors.js").AggregateError;var o=i.isArray;function c(e){this.constructor$(e);this._howMany=0;this._unwrap=false;this._initialized=false}i.inherits(c,r);c.prototype._init=function(){if(!this._initialized){return}this._promise._setIsSpreadable();if(this._howMany===0){this._resolve([]);return}this._init$(undefined,-5);var e=o(this._values);if(!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()){this._reject(this._getRangeError(this.length()))}};c.prototype.init=function(){this._initialized=true;this._init()};c.prototype.setUnwrap=function(){this._unwrap=true};c.prototype.howMany=function(){return this._howMany};c.prototype.setHowMany=function(e){if(this._isResolved())return;this._howMany=e};c.prototype._promiseFulfilled=function(e){this._addFulfilled(e);if(this._fulfilled()===this.howMany()){this._values.length=this.howMany();if(this.howMany()===1&&this._unwrap){this._resolve(this._values[0])}else{this._resolve(this._values)}}};c.prototype._promiseRejected=function(e){this._addRejected(e);if(this.howMany()>this._canPossiblyFulfill()){var t=new s;for(var r=this.length();r<this._values.length;++r){t.push(this._values[r])}this._reject(t)}};c.prototype._fulfilled=function(){return this._totalResolved};c.prototype._rejected=function(){return this._values.length-this.length()};c.prototype._addRejected=function(e){this._values.push(e)};c.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e};c.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()};c.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)};c.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function u(e,t){if((t|0)!==t||t<0){return n("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n")}var r=new c(e);var i=r.promise();if(i.isRejected()){return i}r.setHowMany(t);r.init();return i}t.some=function(e,t){return u(e,t)};t.prototype.some=function(e){return u(this,e)};t._SomePromiseArray=c}},{"./errors.js":421,"./util.js":446}],442:[function(e,module,t){"use strict";module.exports=function(e){function t(e){if(e!==undefined){e=e._target();this._bitField=e._bitField;this._settledValue=e._isResolved()?e._settledValue:undefined}else{this._bitField=0;this._settledValue=undefined}}t.prototype.value=function(){if(!this.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n")}return this._settledValue};t.prototype.error=t.prototype.reason=function(){if(!this.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n")}return this._settledValue};t.prototype.isFulfilled=e.prototype._isFulfilled=function(){return(this._bitField&268435456)>0};t.prototype.isRejected=e.prototype._isRejected=function(){return(this._bitField&134217728)>0};t.prototype.isPending=e.prototype._isPending=function(){return(this._bitField&402653184)===0};t.prototype.isResolved=e.prototype._isResolved=function(){return(this._bitField&402653184)>0};e.prototype.isPending=function(){return this._target()._isPending()};e.prototype.isRejected=function(){return this._target()._isRejected()};e.prototype.isFulfilled=function(){return this._target()._isFulfilled()};e.prototype.isResolved=function(){return this._target()._isResolved()};e.prototype._value=function(){return this._settledValue};e.prototype._reason=function(){return this._settledValue};e.prototype.value=function(){var e=this._target();if(!e.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n")}return e._settledValue};e.prototype.reason=function(){var e=this._target();if(!e.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n")}return e._settledValue};e.PromiseInspection=t}},{}],443:[function(e,module,t){"use strict";module.exports=function(t,r){var n=e("./util.js");var i=e("./errors.js").canAttachTrace;var a=n.errorObj;var s=n.isObject;function o(e){try{return e.then}catch(e){a.e=e;return a}}function c(e,n){if(s(e)){if(e instanceof t){return e}else if(l(e)){var c=new t(r);c._setTrace(undefined);e._then(c._fulfillUnchecked,c._rejectUncheckedCheckError,c._progressUnchecked,c,null);return c}var u=o(e);if(u===a){if(n!==undefined&&i(u.e)){n._attachExtraTrace(u.e)}return t.reject(u.e)}else if(typeof u==="function"){return f(e,u,n)}}return e}var u={}.hasOwnProperty;function l(e){return u.call(e,"_promise0")}function f(e,r,a){var s=t.defer();var o=false;try{r.call(e,u,l,f)}catch(e){if(!o){o=true;var c=i(e)?e:new Error(n.toString(e));if(a!==undefined){a._attachExtraTrace(c)}s.promise._reject(e,c)}}return s.promise;function u(r){if(o)return;o=true;if(e===r){var n=t._makeSelfResolutionError();if(a!==undefined){a._attachExtraTrace(n)}s.promise._reject(n,undefined);return}s.resolve(r)}function l(e){if(o)return;o=true;var t=i(e)?e:new Error(n.toString(e));if(a!==undefined){a._attachExtraTrace(t)}s.promise._reject(e,t)}function f(e){if(o)return;var t=s.promise;if(typeof t._progress==="function"){t._progress(e)}}}return c}},{"./errors.js":421,"./util.js":446}],444:[function(e,module,t){"use strict";module.exports=function(t,r,n){var i=e("./errors.js");var a=t.TimeoutError;var s=function(e,t){if(!e.isPending())return;if(typeof t!=="string"){t="operation timed out"}var r=new a(t);i.markAsOriginatingFromRejection(r);e._attachExtraTrace(r);e._cancel(r)};var o=function(e,t){
t._fulfill(e)};var c=t.delay=function(e,i){if(i===undefined){i=e;e=undefined}i=+i;var a=n(e,undefined);var s=new t(r);if(a instanceof t){s._propagateFrom(a,7);s._follow(a._target());return s.then(function(e){return t.delay(e,i)})}else{s._setTrace(undefined);setTimeout(function t(){o(e,s)},i)}return s};t.prototype.delay=function(e){return c(this,e)};function u(e){var t=this;if(t instanceof Number)t=+t;clearTimeout(t);return e}function l(e){var t=this;if(t instanceof Number)t=+t;clearTimeout(t);throw e}t.prototype.timeout=function(e,n){var i=this._target();e=+e;var a=new t(r).cancellable();a._propagateFrom(this,7);a._follow(i);var o=setTimeout(function e(){s(a,n)},e);return a._then(u,l,undefined,o,undefined)}}},{"./errors.js":421}],445:[function(e,module,t){"use strict";module.exports=function(t,r,n){var i=e("./errors.js").TypeError;var a=e("./util.js").inherits;var s=t.PromiseInspection;function o(e){var r=e.length;for(var n=0;n<r;++n){var i=e[n];if(i.isRejected()){return t.reject(i.error())}e[n]=i._settledValue}return e}function c(e){setTimeout(function(){throw e},0)}function u(e){var t=n(e,undefined);if(t!==e&&typeof e._isDisposable==="function"&&typeof e._getDisposer==="function"&&e._isDisposable()){t._setDisposable(e._getDisposer())}return t}function l(e,r){var i=0;var a=e.length;var s=t.defer();function o(){if(i>=a)return s.resolve();var l=u(e[i++]);if(l instanceof t&&l._isDisposable()){try{l=n(l._getDisposer().tryDispose(r),undefined)}catch(e){return c(e)}if(l instanceof t){return l._then(o,c,null,null,null)}}o()}o();return s.promise}function f(e){var t=new s;t._settledValue=e;t._bitField=268435456;return l(this,t).thenReturn(e)}function v(e){var t=new s;t._settledValue=e;t._bitField=134217728;return l(this,t).thenThrow(e)}function p(e,t){this._data=e;this._promise=t}p.prototype.data=function(){return this._data};p.prototype.promise=function(){return this._promise};p.prototype.resource=function(){if(this.promise()._isFulfilled()){return this.promise()._value()}return null};p.prototype.tryDispose=function(e){var t=this.resource();var r=t!==null?this.doDispose(t,e):null;this._promise._unsetDisposable();this._data=this._promise=null;return r};p.isDisposer=function(e){return e!=null&&typeof e.resource==="function"&&typeof e.tryDispose==="function"};function h(e,t){this.constructor$(e,t)}a(h,p);h.prototype.doDispose=function(e,t){var r=this.data();return r.call(e,e,t)};t.using=function(){var e=arguments.length;if(e<2)return r("you must pass at least 2 arguments to Promise.using");var n=arguments[e-1];if(typeof n!=="function")return r("fn must be a function\n\n    See http://goo.gl/916lJJ\n");e--;var i=new Array(e);for(var a=0;a<e;++a){var s=arguments[a];if(p.isDisposer(s)){var c=s;s=s.promise();s._setDisposable(c)}i[a]=s}return t.settle(i).then(o).spread(n)._then(f,v,undefined,i,undefined)};t.prototype._setDisposable=function(e){this._bitField=this._bitField|262144;this._disposer=e};t.prototype._isDisposable=function(){return(this._bitField&262144)>0};t.prototype._getDisposer=function(){return this._disposer};t.prototype._unsetDisposable=function(){this._bitField=this._bitField&~262144;this._disposer=undefined};t.prototype.disposer=function(e){if(typeof e==="function"){return new h(e,this._target())}throw new i}}},{"./errors.js":421,"./util.js":446}],446:[function(require,module,exports){"use strict";var es5=require("./es5.js");var haveGetters=function(){try{var e={};es5.defineProperty(e,"f",{get:function(){return 3}});return e.f===3}catch(e){return false}}();var canEvaluate=typeof navigator=="undefined";var errorObj={e:{}};function tryCatch1(e,t,r){try{return e.call(t,r)}catch(e){errorObj.e=e;return errorObj}}function tryCatch2(e,t,r,n){try{return e.call(t,r,n)}catch(e){errorObj.e=e;return errorObj}}function tryCatch3(e,t,r,n,i){try{return e.call(t,r,n,i)}catch(e){errorObj.e=e;return errorObj}}function tryCatch4(e,t,r,n,i,a){try{return e.call(t,r,n,i,a)}catch(e){errorObj.e=e;return errorObj}}function tryCatchApply(e,t,r){try{return e.apply(r,t)}catch(e){errorObj.e=e;return errorObj}}var inherits=function(e,t){var r={}.hasOwnProperty;function n(){this.constructor=e;this.constructor$=t;for(var n in t.prototype){if(r.call(t.prototype,n)&&n.charAt(n.length-1)!=="$"){this[n+"$"]=t.prototype[n]}}}n.prototype=t.prototype;e.prototype=new n;return e.prototype};function asString(e){return typeof e==="string"?e:""+e}function isPrimitive(e){return e==null||e===true||e===false||typeof e==="string"||typeof e==="number"}function isObject(e){return!isPrimitive(e)}function maybeWrapAsError(e){if(!isPrimitive(e))return e;return new Error(asString(e))}function withAppended(e,t){var r=e.length;var n=new Array(r+1);var i;for(i=0;i<r;++i){n[i]=e[i]}n[i]=t;return n}function getDataPropertyOrDefault(e,t,r){if(es5.isES5){var n=Object.getOwnPropertyDescriptor(e,t);if(n!=null){return n.get==null&&n.set==null?n.value:r}}else{return{}.hasOwnProperty.call(e,t)?e[t]:undefined}}function notEnumerableProp(e,t,r){if(isPrimitive(e))return e;var n={value:r,configurable:true,enumerable:false,writable:true};es5.defineProperty(e,t,n);return e}var wrapsPrimitiveReceiver=function(){return this!=="string"}.call("string");function thrower(e){throw e}var inheritedDataKeys=function(){if(es5.isES5){return function(e,t){var r=[];var n=Object.create(null);var i=Object(t).includeHidden?Object.getOwnPropertyNames:Object.keys;while(e!=null){var a;try{a=i(e)}catch(e){return r}for(var s=0;s<a.length;++s){var o=a[s];if(n[o])continue;n[o]=true;var c=Object.getOwnPropertyDescriptor(e,o);if(c!=null&&c.get==null&&c.set==null){r.push(o)}}e=es5.getPrototypeOf(e)}return r}}else{return function(e){var t=[];for(var r in e){t.push(r)}return t}}}();function isClass(e){try{if(typeof e==="function"){var t=es5.keys(e.prototype);return t.length>0&&!(t.length===1&&t[0]==="constructor")}return false}catch(e){return false}}function toFastProperties(obj){function f(){}f.prototype=obj;return f;eval(obj)}var rident=/^[a-z$_][a-z$_0-9]*$/i;function isIdentifier(e){return rident.test(e)}function filledRange(e,t,r){var n=new Array(e);for(var i=0;i<e;++i){n[i]=t+i+r}return n}function safeToString(e){try{return e+""}catch(e){return"[no string representation]"}}var ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch1:tryCatch1,tryCatch2:tryCatch2,tryCatch3:tryCatch3,tryCatch4:tryCatch4,tryCatchApply:tryCatchApply,inherits:inherits,withAppended:withAppended,asString:asString,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,lastLineError:new Error};module.exports=ret},{"./es5.js":423}],447:[function(e,module,t){var r=[];module.exports=r},{}],448:[function(e,module,t){var r=e("lodash._basecreate"),n=e("lodash.isobject"),i=e("lodash._setbinddata"),a=e("lodash._slice");var s=[];var o=s.push;function c(e){var t=e[0],s=e[2],c=e[4];function u(){if(s){var e=a(s);o.apply(e,arguments)}if(this instanceof u){var i=r(t.prototype),l=t.apply(i,e||arguments);return n(l)?l:i}return t.apply(c,e||arguments)}i(u,e);return u}module.exports=c},{"lodash._basecreate":449,"lodash._setbinddata":472,"lodash._slice":474,"lodash.isobject":489}],449:[function(e,module,t){(function(t){var r=e("lodash._isnative"),n=e("lodash.isobject"),i=e("lodash.noop");var a=r(a=Object.create)&&a;function s(e,t){return n(e)?a(e):{}}if(!a){s=function(){function e(){}return function(r){if(n(r)){e.prototype=r;var i=new e;e.prototype=null}return i||t.Object()}}()}module.exports=s}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"lodash._isnative":464,"lodash.isobject":489,"lodash.noop":491}],450:[function(e,module,t){var r=e("lodash.bind"),n=e("lodash.identity"),i=e("lodash._setbinddata"),a=e("lodash.support");var s=/^\s*function[ \n\r\t]+\w/;var o=/\bthis\b/;var c=Function.prototype.toString;function u(e,t,u){if(typeof e!="function"){return n}if(typeof t=="undefined"||!("prototype"in e)){return e}var l=e.__bindData__;if(typeof l=="undefined"){if(a.funcNames){l=!e.name}l=l||!a.funcDecomp;if(!l){var f=c.call(e);if(!a.funcNames){l=!s.test(f)}if(!l){l=o.test(f);i(e,l)}}}if(l===false||l!==true&&l[1]&1){return e}switch(u){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,a){return e.call(t,r,n,i,a)}}return r(e,t)}module.exports=u},{"lodash._setbinddata":472,"lodash.bind":475,"lodash.identity":486,"lodash.support":494}],451:[function(e,module,t){var r=e("lodash._basecreate"),n=e("lodash.isobject"),i=e("lodash._setbinddata"),a=e("lodash._slice");var s=[];var o=s.push;function c(e){var t=e[0],s=e[1],u=e[2],l=e[3],f=e[4],v=e[5];var p=s&1,h=s&2,d=s&4,g=s&8,m=t;function y(){var e=p?f:this;if(u){var i=a(u);o.apply(i,arguments)}if(l||d){i||(i=a(arguments));if(l){o.apply(i,l)}if(d&&i.length<v){s|=16&~32;return c([t,g?s:s&~3,i,null,f,v])}}i||(i=arguments);if(h){t=e[m]}if(this instanceof y){e=r(t.prototype);var x=t.apply(e,i);return n(x)?x:e}return t.apply(e,i)}i(y,e);return y}module.exports=c},{"lodash._basecreate":449,"lodash._setbinddata":472,"lodash._slice":474,"lodash.isobject":489}],452:[function(e,module,t){var r=e("lodash.isarguments"),n=e("lodash.isarray");function i(e,t,a,s){var o=(s||0)-1,c=e?e.length:0,u=[];while(++o<c){var l=e[o];if(l&&typeof l=="object"&&typeof l.length=="number"&&(n(l)||r(l))){if(!t){l=i(l,t,a)}var f=-1,v=l.length,p=u.length;u.length+=v;while(++f<v){u[p++]=l[f]}}else if(!a){u.push(l)}}return u}module.exports=i},{"lodash.isarguments":453,"lodash.isarray":454}],453:[function(e,module,t){var r="[object Arguments]";var n=Object.prototype;var i=n.toString;function a(e){return e&&typeof e=="object"&&typeof e.length=="number"&&i.call(e)==r||false}module.exports=a},{}],454:[function(e,module,t){var r=e("lodash._isnative");var n="[object Array]";var i=Object.prototype;var a=i.toString;var s=r(s=Array.isArray)&&s;var o=s||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&a.call(e)==n||false};module.exports=o},{"lodash._isnative":464}],455:[function(e,module,t){function r(e,t,r){var n=(r||0)-1,i=e?e.length:0;while(++n<i){if(e[n]===t){return n}}return-1}module.exports=r},{}],456:[function(e,module,t){var r=e("lodash.forin"),n=e("lodash._getarray"),i=e("lodash.isfunction"),a=e("lodash._objecttypes"),s=e("lodash._releasearray");var o="[object Arguments]",c="[object Array]",u="[object Boolean]",l="[object Date]",f="[object Number]",v="[object Object]",p="[object RegExp]",h="[object String]";var d=Object.prototype;var g=d.toString;var m=d.hasOwnProperty;function y(e,t,d,x,S,_){if(d){var w=d(e,t);if(typeof w!="undefined"){return!!w}}if(e===t){return e!==0||1/e==1/t}var b=typeof e,C=typeof t;if(e===e&&!(e&&a[b])&&!(t&&a[C])){return false}if(e==null||t==null){return e===t}var E=g.call(e),L=g.call(t);if(E==o){E=v}if(L==o){L=v}if(E!=L){return false}switch(E){case u:case l:return+e==+t;case f:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case p:case h:return e==String(t)}var j=E==c;if(!j){var U=m.call(e,"__wrapped__"),T=m.call(t,"__wrapped__");if(U||T){return y(U?e.__wrapped__:e,T?t.__wrapped__:t,d,x,S,_)}if(E!=v){return false}var F=e.constructor,q=t.constructor;if(F!=q&&!(i(F)&&F instanceof F&&i(q)&&q instanceof q)&&("constructor"in e&&"constructor"in t)){return false}}var k=!S;S||(S=n());_||(_=n());var A=S.length;while(A--){if(S[A]==e){return _[A]==t}}var N=0;w=true;S.push(e);_.push(t);if(j){A=e.length;N=t.length;w=N==A;if(w||x){while(N--){var V=A,P=t[N];if(x){while(V--){if(w=y(e[V],P,d,x,S,_)){break}}}else if(!(w=y(e[N],P,d,x,S,_))){break}}}}else{r(t,function(t,r,n){if(m.call(n,r)){N++;return w=m.call(e,r)&&y(e[r],t,d,x,S,_)}});if(w&&!x){r(e,function(e,t,r){if(m.call(r,t)){return w=--N>-1}})}}S.pop();_.pop();if(k){s(S);s(_)}return w}module.exports=y},{"lodash._getarray":462,"lodash._objecttypes":469,"lodash._releasearray":470,"lodash.forin":483,"lodash.isfunction":488}],457:[function(e,module,t){var r=e("lodash._baseindexof"),n=e("lodash._cacheindexof"),i=e("lodash._createcache"),a=e("lodash._getarray"),s=e("lodash._largearraysize"),o=e("lodash._releasearray"),c=e("lodash._releaseobject");function u(e,t,u){var l=-1,f=r,v=e?e.length:0,p=[];var h=!t&&v>=s,d=u||h?a():p;if(h){var g=i(d);f=n;d=g}while(++l<v){var m=e[l],y=u?u(m,l,e):m;if(t?!l||d[d.length-1]!==y:f(d,y)<0){if(u||h){d.push(y)}p.push(m)}}if(h){o(d.array);c(d)}else if(u){o(d)}return p}module.exports=u},{"lodash._baseindexof":455,"lodash._cacheindexof":458,"lodash._createcache":460,"lodash._getarray":462,"lodash._largearraysize":466,"lodash._releasearray":470,"lodash._releaseobject":471}],458:[function(e,module,t){var r=e("lodash._baseindexof"),n=e("lodash._keyprefix");function i(e,t){var i=typeof t;e=e.cache;if(i=="boolean"||t==null){return e[t]?0:-1}if(i!="number"&&i!="string"){i="object"}var a=i=="number"?t:n+t;e=(e=e[i])&&e[a];return i=="object"?e&&r(e,t)>-1?0:-1:e?0:-1}module.exports=i},{"lodash._baseindexof":455,"lodash._keyprefix":465}],459:[function(e,module,t){var r=e("lodash._keyprefix");function n(e){var t=this.cache,n=typeof e;if(n=="boolean"||e==null){t[e]=true}else{if(n!="number"&&n!="string"){n="object"}var i=n=="number"?e:r+e,a=t[n]||(t[n]={});if(n=="object"){(a[i]||(a[i]=[])).push(e)}else{a[i]=true}}}module.exports=n},{"lodash._keyprefix":465}],460:[function(e,module,t){var r=e("lodash._cachepush"),n=e("lodash._getobject"),i=e("lodash._releaseobject");function a(e){var t=-1,i=e.length,a=e[0],s=e[i/2|0],o=e[i-1];if(a&&typeof a=="object"&&s&&typeof s=="object"&&o&&typeof o=="object"){return false}var c=n();c["false"]=c["null"]=c["true"]=c["undefined"]=false;var u=n();u.array=e;u.cache=c;u.push=r;while(++t<i){u.push(e[t])}return u}module.exports=a},{"lodash._cachepush":459,"lodash._getobject":463,"lodash._releaseobject":471}],461:[function(e,module,t){var r=e("lodash._basebind"),n=e("lodash._basecreatewrapper"),i=e("lodash.isfunction"),a=e("lodash._slice");var s=[];var o=s.push,c=s.unshift;function u(e,t,s,l,f,v){var p=t&1,h=t&2,d=t&4,g=t&8,m=t&16,y=t&32;if(!h&&!i(e)){throw new TypeError}if(m&&!s.length){t&=~16;m=s=false}if(y&&!l.length){t&=~32;y=l=false}var x=e&&e.__bindData__;if(x&&x!==true){x=a(x);if(x[2]){x[2]=a(x[2])}if(x[3]){x[3]=a(x[3])}if(p&&!(x[1]&1)){x[4]=f}if(!p&&x[1]&1){t|=8}if(d&&!(x[1]&4)){x[5]=v}if(m){o.apply(x[2]||(x[2]=[]),s)}if(y){c.apply(x[3]||(x[3]=[]),l)}x[1]|=t;return u.apply(null,x)}var S=t==1||t===17?r:n;return S([e,t,s,l,f,v])}module.exports=u},{"lodash._basebind":448,"lodash._basecreatewrapper":451,"lodash._slice":474,"lodash.isfunction":488}],462:[function(e,module,t){var r=e("lodash._arraypool");function n(){return r.pop()||[]}module.exports=n},{"lodash._arraypool":447}],463:[function(e,module,t){var r=e("lodash._objectpool");function n(){return r.pop()||{array:null,cache:null,criteria:null,false:false,index:0,null:false,number:null,object:null,push:null,string:null,true:false,undefined:false,value:null}}module.exports=n},{"lodash._objectpool":468}],464:[function(e,module,t){var r=Object.prototype;var n=r.toString;var i=RegExp("^"+String(n).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");function a(e){return typeof e=="function"&&i.test(e)}module.exports=a},{}],465:[function(e,module,t){var r="__1335248838000__";module.exports=r},{}],466:[function(e,module,t){var r=75;module.exports=r},{}],467:[function(e,module,t){var r=40;module.exports=r},{}],468:[function(e,module,t){var r=[];module.exports=r},{}],469:[function(e,module,t){var r={boolean:false,function:true,object:true,number:false,string:false,undefined:false};module.exports=r},{}],470:[function(e,module,t){var r=e("lodash._arraypool"),n=e("lodash._maxpoolsize");function i(e){e.length=0;if(r.length<n){r.push(e)}}module.exports=i},{"lodash._arraypool":447,"lodash._maxpoolsize":467}],471:[function(e,module,t){var r=e("lodash._maxpoolsize"),n=e("lodash._objectpool");function i(e){var t=e.cache;if(t){i(t)}e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null;if(n.length<r){n.push(e)}}module.exports=i},{"lodash._maxpoolsize":467,"lodash._objectpool":468}],472:[function(e,module,t){var r=e("lodash._isnative"),n=e("lodash.noop");var i={configurable:false,enumerable:false,value:null,writable:false};var a=function(){try{var e={},t=r(t=Object.defineProperty)&&t,n=t(e,e,e)&&t}catch(e){}return n}();var s=!a?n:function(e,t){i.value=t;a(e,"__bindData__",i)};module.exports=s},{"lodash._isnative":464,"lodash.noop":491}],473:[function(e,module,t){var r=e("lodash._objecttypes");var n=Object.prototype;var i=n.hasOwnProperty;var a=function(e){var t,n=e,a=[];if(!n)return a;if(!r[typeof e])return a;for(t in n){if(i.call(n,t)){a.push(t)}}return a};module.exports=a},{"lodash._objecttypes":469}],474:[function(e,module,t){function r(e,t,r){t||(t=0);if(typeof r=="undefined"){r=e?e.length:0}var n=-1,i=r-t||0,a=Array(i<0?0:i);while(++n<i){a[n]=e[t+n]}return a}module.exports=r},{}],475:[function(e,module,t){var r=e("lodash._createwrapper"),n=e("lodash._slice");function i(e,t){return arguments.length>2?r(e,17,n(arguments,2),null,t):r(e,1,null,null,t)}module.exports=i},{"lodash._createwrapper":461,"lodash._slice":474}],476:[function(e,module,t){var r=e("lodash._basecreatecallback"),n=e("lodash._baseisequal"),i=e("lodash.isobject"),a=e("lodash.keys"),s=e("lodash.property");function o(e,t,o){var c=typeof e;if(e==null||c=="function"){return r(e,t,o)}if(c!="object"){return s(e)}var u=a(e),l=u[0],f=e[l];if(u.length==1&&f===f&&!i(f)){return function(e){var t=e[l];return f===t&&(f!==0||1/f==1/t)}}return function(t){var r=u.length,i=false;while(r--){if(!(i=n(t[u[r]],e[u[r]],null,true))){break}}return i}}module.exports=o},{"lodash._basecreatecallback":450,"lodash._baseisequal":456,"lodash.isobject":489,"lodash.keys":477,"lodash.property":492}],477:[function(e,module,t){var r=e("lodash._isnative"),n=e("lodash.isobject"),i=e("lodash._shimkeys");var a=r(a=Object.keys)&&a;var s=!a?i:function(e){if(!n(e)){return[]}return a(e)};module.exports=s},{"lodash._isnative":464,"lodash._shimkeys":473,"lodash.isobject":489}],478:[function(e,module,t){var r=e("lodash.keys"),n=e("lodash._objecttypes");var i=function(e,t,i){var a,s=e,o=s;if(!s)return o;var c=arguments,u=0,l=typeof i=="number"?2:c.length;while(++u<l){s=c[u];if(s&&n[typeof s]){var f=-1,v=n[typeof s]&&r(s),p=v?v.length:0;while(++f<p){a=v[f];if(typeof o[a]=="undefined")o[a]=s[a]}}}return o};module.exports=i},{"lodash._objecttypes":469,"lodash.keys":479}],479:[function(e,module,t){module.exports=e(477)},{"/home/raven/Projects/Eclipse/jassa-core-parent/node_modules/lodash.createcallback/node_modules/lodash.keys/index.js":477,"lodash._isnative":464,"lodash._shimkeys":473,"lodash.isobject":489}],480:[function(e,module,t){var r=e("lodash.createcallback"),n=e("lodash.forown");function i(e,t,i){t=r(t,i,3);var a=-1,s=e?e.length:0;if(typeof s=="number"){while(++a<s){var o=e[a];if(t(o,a,e)){return o}}}else{var c;n(e,function(e,r,n){if(t(e,r,n)){c=e;return false}});return c}}module.exports=i},{"lodash.createcallback":476,"lodash.forown":484}],481:[function(e,module,t){var r=e("lodash._baseflatten"),n=e("lodash.map");function i(e,t,i,a){if(typeof t!="boolean"&&t!=null){a=i;i=typeof t!="function"&&a&&a[t]===e?null:t;t=false}if(i!=null){e=n(e,i,a)}return r(e,t)}module.exports=i},{"lodash._baseflatten":452,"lodash.map":490}],482:[function(e,module,t){var r=e("lodash._basecreatecallback"),n=e("lodash.forown");function i(e,t,i){var a=-1,s=e?e.length:0;t=t&&typeof i=="undefined"?t:r(t,i,3);if(typeof s=="number"){while(++a<s){if(t(e[a],a,e)===false){break}}}else{n(e,t)}return e}module.exports=i},{"lodash._basecreatecallback":450,"lodash.forown":484}],483:[function(e,module,t){var r=e("lodash._basecreatecallback"),n=e("lodash._objecttypes");var i=function(e,t,i){var a,s=e,o=s;if(!s)return o;if(!n[typeof s])return o;t=t&&typeof i=="undefined"?t:r(t,i,3);for(a in s){if(t(s[a],a,e)===false)return o}return o};module.exports=i},{"lodash._basecreatecallback":450,"lodash._objecttypes":469}],484:[function(e,module,t){var r=e("lodash._basecreatecallback"),n=e("lodash.keys"),i=e("lodash._objecttypes");var a=function(e,t,a){var s,o=e,c=o;if(!o)return c;if(!i[typeof o])return c;t=t&&typeof a=="undefined"?t:r(t,a,3);var u=-1,l=i[typeof o]&&n(o),f=l?l.length:0;while(++u<f){s=l[u];if(t(o[s],s,e)===false)return c}return c};module.exports=a},{"lodash._basecreatecallback":450,"lodash._objecttypes":469,"lodash.keys":485}],485:[function(e,module,t){module.exports=e(477)},{"/home/raven/Projects/Eclipse/jassa-core-parent/node_modules/lodash.createcallback/node_modules/lodash.keys/index.js":477,"lodash._isnative":464,"lodash._shimkeys":473,"lodash.isobject":489}],486:[function(e,module,t){function r(e){return e}module.exports=r},{}],487:[function(e,module,t){var r=e("lodash._basecreatecallback"),n=e("lodash._baseisequal");function i(e,t,i,a){return n(e,t,typeof i=="function"&&r(i,a,2))}module.exports=i},{"lodash._basecreatecallback":450,"lodash._baseisequal":456}],488:[function(e,module,t){function r(e){return typeof e=="function"}module.exports=r},{}],489:[function(e,module,t){var r=e("lodash._objecttypes");function n(e){return!!(e&&r[typeof e])}module.exports=n},{"lodash._objecttypes":469}],490:[function(e,module,t){var r=e("lodash.createcallback"),n=e("lodash.forown");function i(e,t,i){var a=-1,s=e?e.length:0;t=r(t,i,3);if(typeof s=="number"){var o=Array(s);while(++a<s){o[a]=t(e[a],a,e)}}else{o=[];n(e,function(e,r,n){o[++a]=t(e,r,n)})}return o}module.exports=i},{"lodash.createcallback":476,"lodash.forown":484}],491:[function(e,module,t){function r(){}module.exports=r},{}],492:[function(e,module,t){function r(e){return function(t){return t[e]}}module.exports=r},{}],493:[function(e,module,t){var r=e("lodash.createcallback"),n=e("lodash.forown");function i(e,t,i,a){if(!e)return i;var s=arguments.length<3;t=r(t,a,4);var o=-1,c=e.length;if(typeof c=="number"){if(s){i=e[++o]}while(++o<c){i=t(i,e[o],o,e)}}else{n(e,function(e,r,n){i=s?(s=false,e):t(i,e,r,n)})}return i}module.exports=i},{"lodash.createcallback":476,"lodash.forown":484}],494:[function(e,module,t){(function(t){var r=e("lodash._isnative");var n=/\bthis\b/;var i={};i.funcDecomp=!r(t.WinRTError)&&n.test(function(){return this});i.funcNames=typeof Function.name=="string";module.exports=i}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"lodash._isnative":464}],495:[function(e,module,t){var r=e("lodash._baseflatten"),n=e("lodash._baseuniq");function i(){return n(r(arguments,true,true))}module.exports=i},{"lodash._baseflatten":452,"lodash._baseuniq":457}],496:[function(e,module,t){var r=e("lodash._baseuniq"),n=e("lodash.createcallback");function i(e,t,i,a){if(typeof t!="boolean"&&t!=null){a=i;i=typeof t!="function"&&a&&a[t]===e?null:t;t=false}if(i!=null){i=n(i,a,3)}return r(e,t,i)}module.exports=i},{"lodash._baseuniq":457,"lodash.createcallback":476}],497:[function(e,module,t){var r=e("lodash.keys");function n(e){var t=-1,n=r(e),i=n.length,a=Array(i);while(++t<i){a[t]=e[n[t]]}return a}module.exports=n},{"lodash.keys":498}],498:[function(e,module,t){module.exports=e(477)},{"/home/raven/Projects/Eclipse/jassa-core-parent/node_modules/lodash.createcallback/node_modules/lodash.keys/index.js":477,"lodash._isnative":464,"lodash._shimkeys":473,"lodash.isobject":489}],499:[function(e,module,t){(function(e){(function(){var r;var n=[],i=[];var a=0;var s=+new Date+"";var o=75;var c=40;var u=" \t\v\f \ufeff"+"\n\r\u2028\u2029"+" ᠎             　";var l=/\b__p \+= '';/g,f=/\b(__p \+=) '' \+/g,v=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var p=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var h=/\w*$/;var d=/^\s*function[ \n\r\t]+\w/;var g=/<%=([\s\S]+?)%>/g;var m=RegExp("^["+u+"]*0+(?=.$)");var y=/($^)/;var x=/\bthis\b/;var S=/['\n\r\t\u2028\u2029\\]/g;var _=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"];var w=0;var b="[object Arguments]",C="[object Array]",E="[object Boolean]",L="[object Date]",j="[object Function]",U="[object Number]",T="[object Object]",F="[object RegExp]",q="[object String]";var k={};k[j]=false;k[b]=k[C]=k[E]=k[L]=k[U]=k[T]=k[F]=k[q]=true;var A={leading:false,maxWait:0,trailing:false};var N={configurable:false,enumerable:false,value:null,writable:false};var V={boolean:false,function:true,object:true,number:false,string:false,undefined:false};var P={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"};var R=V[typeof window]&&window||this;var I=V[typeof t]&&t&&!t.nodeType&&t;var M=V[typeof module]&&module&&!module.nodeType&&module;var O=M&&M.exports===I&&I;var B=V[typeof e]&&e;if(B&&(B.global===B||B.window===B)){R=B}function D(e,t,r){var n=(r||0)-1,i=e?e.length:0;while(++n<i){if(e[n]===t){return n}}return-1}function z(e,t){var r=typeof t;e=e.cache;if(r=="boolean"||t==null){return e[t]?0:-1}if(r!="number"&&r!="string"){r="object"}var n=r=="number"?t:s+t;e=(e=e[r])&&e[n];return r=="object"?e&&D(e,t)>-1?0:-1:e?0:-1}function Q(e){var t=this.cache,r=typeof e;if(r=="boolean"||e==null){t[e]=true}else{if(r!="number"&&r!="string"){r="object"}var n=r=="number"?e:s+e,i=t[r]||(t[r]={});if(r=="object"){(i[n]||(i[n]=[])).push(e)}else{i[n]=true}}}function H(e){return e.charCodeAt(0)}function G(e,t){var r=e.criteria,n=t.criteria,i=-1,a=r.length;while(++i<a){var s=r[i],o=n[i];if(s!==o){if(s>o||typeof s=="undefined"){return 1}if(s<o||typeof o=="undefined"){return-1}}}return e.index-t.index}function J(e){var t=-1,r=e.length,n=e[0],i=e[r/2|0],a=e[r-1];if(n&&typeof n=="object"&&i&&typeof i=="object"&&a&&typeof a=="object"){return false}var s=$();s["false"]=s["null"]=s["true"]=s["undefined"]=false;var o=$();o.array=e;o.cache=s;o.push=Q;while(++t<r){o.push(e[t])}return o}function W(e){return"\\"+P[e]}function K(){return n.pop()||[]}function $(){return i.pop()||{array:null,cache:null,criteria:null,false:false,index:0,null:false,number:null,object:null,push:null,string:null,true:false,undefined:false,value:null}}function X(e){e.length=0;if(n.length<c){n.push(e)}}function Y(e){var t=e.cache;if(t){Y(t)}e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null;if(i.length<c){i.push(e)}}function Z(e,t,r){t||(t=0);if(typeof r=="undefined"){r=e?e.length:0}var n=-1,i=r-t||0,a=Array(i<0?0:i);while(++n<i){a[n]=e[t+n]}return a}function ee(e){e=e?te.defaults(R.Object(),e,te.pick(R,_)):R;var t=e.Array,n=e.Boolean,i=e.Date,c=e.Function,P=e.Math,I=e.Number,M=e.Object,O=e.RegExp,B=e.String,Q=e.TypeError;var re=[];var ne=M.prototype;var ie=e._;var ae=ne.toString;var se=O("^"+B(ae).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var oe=P.ceil,ce=e.clearTimeout,ue=P.floor,le=c.prototype.toString,fe=Ge(fe=M.getPrototypeOf)&&fe,ve=ne.hasOwnProperty,pe=re.push,he=e.setTimeout,de=re.splice,ge=re.unshift;var me=function(){try{var e={},t=Ge(t=M.defineProperty)&&t,r=t(e,e,e)&&t}catch(e){}return r}();var ye=Ge(ye=M.create)&&ye,xe=Ge(xe=t.isArray)&&xe,Se=e.isFinite,_e=e.isNaN,we=Ge(we=M.keys)&&we,be=P.max,Ce=P.min,Ee=e.parseInt,Le=P.random;var je={};je[C]=t;je[E]=n;je[L]=i;je[j]=c;je[T]=M;je[U]=I;je[F]=O;je[q]=B;function Ue(e){return e&&typeof e=="object"&&!Xe(e)&&ve.call(e,"__wrapped__")?e:new Te(e)}function Te(e,t){this.__chain__=!!t;this.__wrapped__=e}Te.prototype=Ue.prototype;var Fe=Ue.support={};Fe.funcDecomp=!Ge(e.WinRTError)&&x.test(ee);Fe.funcNames=typeof c.name=="string";Ue.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:g,variable:"",imports:{_:Ue}};function qe(e){var t=e[0],r=e[2],n=e[4];function i(){if(r){var e=Z(r);pe.apply(e,arguments)}if(this instanceof i){var a=Ae(t.prototype),s=t.apply(a,e||arguments);return Et(s)?s:a}return t.apply(n,e||arguments)}Je(i,e);return i}function ke(e,t,r,n,i){if(r){var a=r(e);if(typeof a!="undefined"){return a}}var s=Et(e);if(s){var o=ae.call(e);if(!k[o]){return e}var c=je[o];switch(o){case E:case L:return new c(+e);case U:case q:return new c(e);case F:a=c(e.source,h.exec(e));a.lastIndex=e.lastIndex;return a}}else{return e}var u=Xe(e);if(t){var l=!n;n||(n=K());i||(i=K());var f=n.length;while(f--){if(n[f]==e){return i[f]}}a=u?c(e.length):{}}else{a=u?Z(e):it({},e)}if(u){if(ve.call(e,"index")){a.index=e.index}if(ve.call(e,"input")){a.input=e.input}}if(!t){return a}n.push(e);i.push(a);(u?Jt:pt)(e,function(e,s){a[s]=ke(e,t,r,n,i)});if(l){X(n);X(i)}return a}function Ae(e,t){return Et(e)?ye(e):{}}if(!ye){Ae=function(){function t(){}return function(r){if(Et(r)){t.prototype=r;var n=new t;t.prototype=null}return n||e.Object()}}()}function Ne(e,t,r){if(typeof e!="function"){return Yr}if(typeof t=="undefined"||!("prototype"in e)){return e}var n=e.__bindData__;if(typeof n=="undefined"){if(Fe.funcNames){n=!e.name}n=n||!Fe.funcDecomp;if(!n){var i=le.call(e);if(!Fe.funcNames){n=!d.test(i)}if(!n){n=x.test(i);Je(e,n)}}}if(n===false||n!==true&&n[1]&1){return e}switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,a){return e.call(t,r,n,i,a)}}return Vr(e,t)}function Ve(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5];var o=r&1,c=r&2,u=r&4,l=r&8,f=t;function v(){var e=o?a:this;if(n){var p=Z(n);pe.apply(p,arguments)}if(i||u){p||(p=Z(arguments));if(i){pe.apply(p,i)}if(u&&p.length<s){r|=16&~32;return Ve([t,l?r:r&~3,p,null,a,s])}}p||(p=arguments);if(c){t=e[f]}if(this instanceof v){e=Ae(t.prototype);var h=t.apply(e,p);return Et(h)?h:e}return t.apply(e,p)}Je(v,e);return v}function Pe(e,t){var r=-1,n=He(),i=e?e.length:0,a=i>=o&&n===D,s=[];if(a){var c=J(t);if(c){n=z;t=c}else{a=false}}while(++r<i){var u=e[r];if(n(t,u)<0){s.push(u)}}if(a){Y(t)}return s}function Re(e,t,r,n){var i=(n||0)-1,a=e?e.length:0,s=[];while(++i<a){var o=e[i];if(o&&typeof o=="object"&&typeof o.length=="number"&&(Xe(o)||$e(o))){if(!t){o=Re(o,t,r)}var c=-1,u=o.length,l=s.length;s.length+=u;while(++c<u){s[l++]=o[c]}}else if(!r){s.push(o)}}return s}function Ie(e,t,r,n,i,a){if(r){var s=r(e,t);if(typeof s!="undefined"){return!!s}}if(e===t){return e!==0||1/e==1/t}var o=typeof e,c=typeof t;if(e===e&&!(e&&V[o])&&!(t&&V[c])){return false}if(e==null||t==null){return e===t}var u=ae.call(e),l=ae.call(t);if(u==b){u=T}if(l==b){l=T}if(u!=l){return false}switch(u){case E:case L:return+e==+t;case U:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case F:case q:return e==B(t)}var f=u==C;if(!f){var v=ve.call(e,"__wrapped__"),p=ve.call(t,"__wrapped__");if(v||p){return Ie(v?e.__wrapped__:e,p?t.__wrapped__:t,r,n,i,a)}if(u!=T){return false}var h=e.constructor,d=t.constructor;if(h!=d&&!(Ct(h)&&h instanceof h&&Ct(d)&&d instanceof d)&&("constructor"in e&&"constructor"in t)){return false}}var g=!i;i||(i=K());a||(a=K());var m=i.length;while(m--){if(i[m]==e){return a[m]==t}}var y=0;s=true;i.push(e);a.push(t);if(f){m=e.length;y=t.length;s=y==m;if(s||n){while(y--){var x=m,S=t[y];if(n){while(x--){if(s=Ie(e[x],S,r,n,i,a)){break}}}else if(!(s=Ie(e[y],S,r,n,i,a))){break}}}}else{ft(t,function(t,o,c){if(ve.call(c,o)){y++;return s=ve.call(e,o)&&Ie(e[o],t,r,n,i,a)}});if(s&&!n){ft(e,function(e,t,r){if(ve.call(r,t)){return s=--y>-1}})}}i.pop();a.pop();if(g){X(i);X(a)}return s}function Me(e,t,r,n,i){(Xe(t)?Jt:pt)(t,function(t,a){var s,o,c=t,u=e[a];if(t&&((o=Xe(t))||Tt(t))){var l=n.length;while(l--){if(s=n[l]==t){u=i[l];break}}if(!s){var f;if(r){c=r(u,t);if(f=typeof c!="undefined"){u=c}}if(!f){u=o?Xe(u)?u:[]:Tt(u)?u:{}}n.push(t);i.push(u);if(!f){Me(u,t,r,n,i)}}}else{if(r){c=r(u,t);if(typeof c=="undefined"){c=t}}if(typeof c!="undefined"){u=c}}e[a]=u})}function Oe(e,t){return e+ue(Le()*(t-e+1))}function Be(e,t,r){
var n=-1,i=He(),a=e?e.length:0,s=[];var c=!t&&a>=o&&i===D,u=r||c?K():s;if(c){var l=J(u);i=z;u=l}while(++n<a){var f=e[n],v=r?r(f,n,e):f;if(t?!n||u[u.length-1]!==v:i(u,v)<0){if(r||c){u.push(v)}s.push(f)}}if(c){X(u.array);Y(u)}else if(r){X(u)}return s}function De(e){return function(t,r,n){var i={};r=Ue.createCallback(r,n,3);var a=-1,s=t?t.length:0;if(typeof s=="number"){while(++a<s){var o=t[a];e(i,o,r(o,a,t),t)}}else{pt(t,function(t,n,a){e(i,t,r(t,n,a),a)})}return i}}function ze(e,t,r,n,i,a){var s=t&1,o=t&2,c=t&4,u=t&8,l=t&16,f=t&32;if(!o&&!Ct(e)){throw new Q}if(l&&!r.length){t&=~16;l=r=false}if(f&&!n.length){t&=~32;f=n=false}var v=e&&e.__bindData__;if(v&&v!==true){v=Z(v);if(v[2]){v[2]=Z(v[2])}if(v[3]){v[3]=Z(v[3])}if(s&&!(v[1]&1)){v[4]=i}if(!s&&v[1]&1){t|=8}if(c&&!(v[1]&4)){v[5]=a}if(l){pe.apply(v[2]||(v[2]=[]),r)}if(f){ge.apply(v[3]||(v[3]=[]),n)}v[1]|=t;return ze.apply(null,v)}var p=t==1||t===17?qe:Ve;return p([e,t,r,n,i,a])}function Qe(e){return et[e]}function He(){var e=(e=Ue.indexOf)===yr?D:e;return e}function Ge(e){return typeof e=="function"&&se.test(e)}var Je=!me?tn:function(e,t){N.value=t;me(e,"__bindData__",N);N.value=null};function We(e){var t,r;if(!(e&&ae.call(e)==T)||(t=e.constructor,Ct(t)&&!(t instanceof t))){return false}ft(e,function(e,t){r=t});return typeof r=="undefined"||ve.call(e,r)}function Ke(e){return tt[e]}function $e(e){return e&&typeof e=="object"&&typeof e.length=="number"&&ae.call(e)==b||false}var Xe=xe||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&ae.call(e)==C||false};var Ye=function(e){var t,r=e,n=[];if(!r)return n;if(!V[typeof e])return n;for(t in r){if(ve.call(r,t)){n.push(t)}}return n};var Ze=!we?Ye:function(e){if(!Et(e)){return[]}return we(e)};var et={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var tt=mt(et);var rt=O("("+Ze(tt).join("|")+")","g"),nt=O("["+Ze(et).join("")+"]","g");var it=function(e,t,r){var n,i=e,a=i;if(!i)return a;var s=arguments,o=0,c=typeof r=="number"?2:s.length;if(c>3&&typeof s[c-2]=="function"){var u=Ne(s[--c-1],s[c--],2)}else if(c>2&&typeof s[c-1]=="function"){u=s[--c]}while(++o<c){i=s[o];if(i&&V[typeof i]){var l=-1,f=V[typeof i]&&Ze(i),v=f?f.length:0;while(++l<v){n=f[l];a[n]=u?u(a[n],i[n]):i[n]}}}return a};function at(e,t,r,n){if(typeof t!="boolean"&&t!=null){n=r;r=t;t=false}return ke(e,t,typeof r=="function"&&Ne(r,n,1))}function st(e,t,r){return ke(e,true,typeof t=="function"&&Ne(t,r,1))}function ot(e,t){var r=Ae(e);return t?it(r,t):r}var ct=function(e,t,r){var n,i=e,a=i;if(!i)return a;var s=arguments,o=0,c=typeof r=="number"?2:s.length;while(++o<c){i=s[o];if(i&&V[typeof i]){var u=-1,l=V[typeof i]&&Ze(i),f=l?l.length:0;while(++u<f){n=l[u];if(typeof a[n]=="undefined")a[n]=i[n]}}}return a};function ut(e,t,r){var n;t=Ue.createCallback(t,r,3);pt(e,function(e,r,i){if(t(e,r,i)){n=r;return false}});return n}function lt(e,t,r){var n;t=Ue.createCallback(t,r,3);ht(e,function(e,r,i){if(t(e,r,i)){n=r;return false}});return n}var ft=function(e,t,r){var n,i=e,a=i;if(!i)return a;if(!V[typeof i])return a;t=t&&typeof r=="undefined"?t:Ne(t,r,3);for(n in i){if(t(i[n],n,e)===false)return a}return a};function vt(e,t,r){var n=[];ft(e,function(e,t){n.push(t,e)});var i=n.length;t=Ne(t,r,3);while(i--){if(t(n[i--],n[i],e)===false){break}}return e}var pt=function(e,t,r){var n,i=e,a=i;if(!i)return a;if(!V[typeof i])return a;t=t&&typeof r=="undefined"?t:Ne(t,r,3);var s=-1,o=V[typeof i]&&Ze(i),c=o?o.length:0;while(++s<c){n=o[s];if(t(i[n],n,e)===false)return a}return a};function ht(e,t,r){var n=Ze(e),i=n.length;t=Ne(t,r,3);while(i--){var a=n[i];if(t(e[a],a,e)===false){break}}return e}function dt(e){var t=[];ft(e,function(e,r){if(Ct(e)){t.push(r)}});return t.sort()}function gt(e,t){return e?ve.call(e,t):false}function mt(e){var t=-1,r=Ze(e),n=r.length,i={};while(++t<n){var a=r[t];i[e[a]]=a}return i}function yt(e){return e===true||e===false||e&&typeof e=="object"&&ae.call(e)==E||false}function xt(e){return e&&typeof e=="object"&&ae.call(e)==L||false}function St(e){return e&&e.nodeType===1||false}function _t(e){var t=true;if(!e){return t}var r=ae.call(e),n=e.length;if(r==C||r==q||r==b||r==T&&typeof n=="number"&&Ct(e.splice)){return!n}pt(e,function(){return t=false});return t}function wt(e,t,r,n){return Ie(e,t,typeof r=="function"&&Ne(r,n,2))}function bt(e){return Se(e)&&!_e(parseFloat(e))}function Ct(e){return typeof e=="function"}function Et(e){return!!(e&&V[typeof e])}function Lt(e){return Ut(e)&&e!=+e}function jt(e){return e===null}function Ut(e){return typeof e=="number"||e&&typeof e=="object"&&ae.call(e)==U||false}var Tt=!fe?We:function(e){if(!(e&&ae.call(e)==T)){return false}var t=e.valueOf,r=Ge(t)&&(r=fe(t))&&fe(r);return r?e==r||fe(e)==r:We(e)};function Ft(e){return e&&typeof e=="object"&&ae.call(e)==F||false}function qt(e){return typeof e=="string"||e&&typeof e=="object"&&ae.call(e)==q||false}function kt(e){return typeof e=="undefined"}function At(e,t,r){var n={};t=Ue.createCallback(t,r,3);pt(e,function(e,r,i){n[r]=t(e,r,i)});return n}function Nt(e){var t=arguments,r=2;if(!Et(e)){return e}if(typeof t[2]!="number"){r=t.length}if(r>3&&typeof t[r-2]=="function"){var n=Ne(t[--r-1],t[r--],2)}else if(r>2&&typeof t[r-1]=="function"){n=t[--r]}var i=Z(arguments,1,r),a=-1,s=K(),o=K();while(++a<r){Me(e,i[a],n,s,o)}X(s);X(o);return e}function Vt(e,t,r){var n={};if(typeof t!="function"){var i=[];ft(e,function(e,t){i.push(t)});i=Pe(i,Re(arguments,true,false,1));var a=-1,s=i.length;while(++a<s){var o=i[a];n[o]=e[o]}}else{t=Ue.createCallback(t,r,3);ft(e,function(e,r,i){if(!t(e,r,i)){n[r]=e}})}return n}function Pt(e){var r=-1,n=Ze(e),i=n.length,a=t(i);while(++r<i){var s=n[r];a[r]=[s,e[s]]}return a}function Rt(e,t,r){var n={};if(typeof t!="function"){var i=-1,a=Re(arguments,true,false,1),s=Et(e)?a.length:0;while(++i<s){var o=a[i];if(o in e){n[o]=e[o]}}}else{t=Ue.createCallback(t,r,3);ft(e,function(e,r,i){if(t(e,r,i)){n[r]=e}})}return n}function It(e,t,r,n){var i=Xe(e);if(r==null){if(i){r=[]}else{var a=e&&e.constructor,s=a&&a.prototype;r=Ae(s)}}if(t){t=Ue.createCallback(t,n,4);(i?Jt:pt)(e,function(e,n,i){return t(r,e,n,i)})}return r}function Mt(e){var r=-1,n=Ze(e),i=n.length,a=t(i);while(++r<i){a[r]=e[n[r]]}return a}function Ot(e){var r=arguments,n=-1,i=Re(r,true,false,1),a=r[2]&&r[2][r[1]]===e?1:i.length,s=t(a);while(++n<a){s[n]=e[i[n]]}return s}function Bt(e,t,r){var n=-1,i=He(),a=e?e.length:0,s=false;r=(r<0?be(0,a+r):r)||0;if(Xe(e)){s=i(e,t,r)>-1}else if(typeof a=="number"){s=(qt(e)?e.indexOf(t,r):i(e,t,r))>-1}else{pt(e,function(e){if(++n>=r){return!(s=e===t)}})}return s}var Dt=De(function(e,t,r){ve.call(e,r)?e[r]++:e[r]=1});function zt(e,t,r){var n=true;t=Ue.createCallback(t,r,3);var i=-1,a=e?e.length:0;if(typeof a=="number"){while(++i<a){if(!(n=!!t(e[i],i,e))){break}}}else{pt(e,function(e,r,i){return n=!!t(e,r,i)})}return n}function Qt(e,t,r){var n=[];t=Ue.createCallback(t,r,3);var i=-1,a=e?e.length:0;if(typeof a=="number"){while(++i<a){var s=e[i];if(t(s,i,e)){n.push(s)}}}else{pt(e,function(e,r,i){if(t(e,r,i)){n.push(e)}})}return n}function Ht(e,t,r){t=Ue.createCallback(t,r,3);var n=-1,i=e?e.length:0;if(typeof i=="number"){while(++n<i){var a=e[n];if(t(a,n,e)){return a}}}else{var s;pt(e,function(e,r,n){if(t(e,r,n)){s=e;return false}});return s}}function Gt(e,t,r){var n;t=Ue.createCallback(t,r,3);Wt(e,function(e,r,i){if(t(e,r,i)){n=e;return false}});return n}function Jt(e,t,r){var n=-1,i=e?e.length:0;t=t&&typeof r=="undefined"?t:Ne(t,r,3);if(typeof i=="number"){while(++n<i){if(t(e[n],n,e)===false){break}}}else{pt(e,t)}return e}function Wt(e,t,r){var n=e?e.length:0;t=t&&typeof r=="undefined"?t:Ne(t,r,3);if(typeof n=="number"){while(n--){if(t(e[n],n,e)===false){break}}}else{var i=Ze(e);n=i.length;pt(e,function(e,r,a){r=i?i[--n]:--n;return t(a[r],r,a)})}return e}var Kt=De(function(e,t,r){(ve.call(e,r)?e[r]:e[r]=[]).push(t)});var $t=De(function(e,t,r){e[r]=t});function Xt(e,r){var n=Z(arguments,2),i=-1,a=typeof r=="function",s=e?e.length:0,o=t(typeof s=="number"?s:0);Jt(e,function(e){o[++i]=(a?r:e[r]).apply(e,n)});return o}function Yt(e,r,n){var i=-1,a=e?e.length:0;r=Ue.createCallback(r,n,3);if(typeof a=="number"){var s=t(a);while(++i<a){s[i]=r(e[i],i,e)}}else{s=[];pt(e,function(e,t,n){s[++i]=r(e,t,n)})}return s}function Zt(e,t,r){var n=-Infinity,i=n;if(typeof t!="function"&&r&&r[t]===e){t=null}if(t==null&&Xe(e)){var a=-1,s=e.length;while(++a<s){var o=e[a];if(o>i){i=o}}}else{t=t==null&&qt(e)?H:Ue.createCallback(t,r,3);Jt(e,function(e,r,a){var s=t(e,r,a);if(s>n){n=s;i=e}})}return i}function er(e,t,r){var n=Infinity,i=n;if(typeof t!="function"&&r&&r[t]===e){t=null}if(t==null&&Xe(e)){var a=-1,s=e.length;while(++a<s){var o=e[a];if(o<i){i=o}}}else{t=t==null&&qt(e)?H:Ue.createCallback(t,r,3);Jt(e,function(e,r,a){var s=t(e,r,a);if(s<n){n=s;i=e}})}return i}var tr=Yt;function rr(e,t,r,n){if(!e)return r;var i=arguments.length<3;t=Ue.createCallback(t,n,4);var a=-1,s=e.length;if(typeof s=="number"){if(i){r=e[++a]}while(++a<s){r=t(r,e[a],a,e)}}else{pt(e,function(e,n,a){r=i?(i=false,e):t(r,e,n,a)})}return r}function nr(e,t,r,n){var i=arguments.length<3;t=Ue.createCallback(t,n,4);Wt(e,function(e,n,a){r=i?(i=false,e):t(r,e,n,a)});return r}function ir(e,t,r){t=Ue.createCallback(t,r,3);return Qt(e,function(e,r,n){return!t(e,r,n)})}function ar(e,t,n){if(e&&typeof e.length!="number"){e=Mt(e)}if(t==null||n){return e?e[Oe(0,e.length-1)]:r}var i=sr(e);i.length=Ce(be(0,t),i.length);return i}function sr(e){var r=-1,n=e?e.length:0,i=t(typeof n=="number"?n:0);Jt(e,function(e){var t=Oe(0,++r);i[r]=i[t];i[t]=e});return i}function or(e){var t=e?e.length:0;return typeof t=="number"?t:Ze(e).length}function cr(e,t,r){var n;t=Ue.createCallback(t,r,3);var i=-1,a=e?e.length:0;if(typeof a=="number"){while(++i<a){if(n=t(e[i],i,e)){break}}}else{pt(e,function(e,r,i){return!(n=t(e,r,i))})}return!!n}function ur(e,r,n){var i=-1,a=Xe(r),s=e?e.length:0,o=t(typeof s=="number"?s:0);if(!a){r=Ue.createCallback(r,n,3)}Jt(e,function(e,t,n){var s=o[++i]=$();if(a){s.criteria=Yt(r,function(t){return e[t]})}else{(s.criteria=K())[0]=r(e,t,n)}s.index=i;s.value=e});s=o.length;o.sort(G);while(s--){var c=o[s];o[s]=c.value;if(!a){X(c.criteria)}Y(c)}return o}function lr(e){if(e&&typeof e.length=="number"){return Z(e)}return Mt(e)}var fr=Qt;function vr(e){var t=-1,r=e?e.length:0,n=[];while(++t<r){var i=e[t];if(i){n.push(i)}}return n}function pr(e){return Pe(e,Re(arguments,true,true,1))}function hr(e,t,r){var n=-1,i=e?e.length:0;t=Ue.createCallback(t,r,3);while(++n<i){if(t(e[n],n,e)){return n}}return-1}function dr(e,t,r){var n=e?e.length:0;t=Ue.createCallback(t,r,3);while(n--){if(t(e[n],n,e)){return n}}return-1}function gr(e,t,n){var i=0,a=e?e.length:0;if(typeof t!="number"&&t!=null){var s=-1;t=Ue.createCallback(t,n,3);while(++s<a&&t(e[s],s,e)){i++}}else{i=t;if(i==null||n){return e?e[0]:r}}return Z(e,0,Ce(be(0,i),a))}function mr(e,t,r,n){if(typeof t!="boolean"&&t!=null){n=r;r=typeof t!="function"&&n&&n[t]===e?null:t;t=false}if(r!=null){e=Yt(e,r,n)}return Re(e,t)}function yr(e,t,r){if(typeof r=="number"){var n=e?e.length:0;r=r<0?be(0,n+r):r||0}else if(r){var i=jr(e,t);return e[i]===t?i:-1}return D(e,t,r)}function xr(e,t,r){var n=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var a=i;t=Ue.createCallback(t,r,3);while(a--&&t(e[a],a,e)){n++}}else{n=t==null||r?1:t||n}return Z(e,0,Ce(be(0,i-n),i))}function Sr(){var e=[],t=-1,r=arguments.length,n=K(),i=He(),a=i===D,s=K();while(++t<r){var c=arguments[t];if(Xe(c)||$e(c)){e.push(c);n.push(a&&c.length>=o&&J(t?e[t]:s))}}var u=e[0],l=-1,f=u?u.length:0,v=[];e:while(++l<f){var p=n[0];c=u[l];if((p?z(p,c):i(s,c))<0){t=r;(p||s).push(c);while(--t){p=n[t];if((p?z(p,c):i(e[t],c))<0){continue e}}v.push(c)}}while(r--){p=n[r];if(p){Y(p)}}X(n);X(s);return v}function _r(e,t,n){var i=0,a=e?e.length:0;if(typeof t!="number"&&t!=null){var s=a;t=Ue.createCallback(t,n,3);while(s--&&t(e[s],s,e)){i++}}else{i=t;if(i==null||n){return e?e[a-1]:r}}return Z(e,be(0,a-i))}function wr(e,t,r){var n=e?e.length:0;if(typeof r=="number"){n=(r<0?be(0,n+r):Ce(r,n-1))+1}while(n--){if(e[n]===t){return n}}return-1}function br(e){var t=arguments,r=0,n=t.length,i=e?e.length:0;while(++r<n){var a=-1,s=t[r];while(++a<i){if(e[a]===s){de.call(e,a--,1);i--}}}return e}function Cr(e,r,n){e=+e||0;n=typeof n=="number"?n:+n||1;if(r==null){r=e;e=0}var i=-1,a=be(0,oe((r-e)/(n||1))),s=t(a);while(++i<a){s[i]=e;e+=n}return s}function Er(e,t,r){var n=-1,i=e?e.length:0,a=[];t=Ue.createCallback(t,r,3);while(++n<i){var s=e[n];if(t(s,n,e)){a.push(s);de.call(e,n--,1);i--}}return a}function Lr(e,t,r){if(typeof t!="number"&&t!=null){var n=0,i=-1,a=e?e.length:0;t=Ue.createCallback(t,r,3);while(++i<a&&t(e[i],i,e)){n++}}else{n=t==null||r?1:be(0,t)}return Z(e,n)}function jr(e,t,r,n){var i=0,a=e?e.length:i;r=r?Ue.createCallback(r,n,1):Yr;t=r(t);while(i<a){var s=i+a>>>1;r(e[s])<t?i=s+1:a=s}return i}function Ur(){return Be(Re(arguments,true,true))}function Tr(e,t,r,n){if(typeof t!="boolean"&&t!=null){n=r;r=typeof t!="function"&&n&&n[t]===e?null:t;t=false}if(r!=null){r=Ue.createCallback(r,n,3)}return Be(e,t,r)}function Fr(e){return Pe(e,Z(arguments,1))}function qr(){var e=-1,t=arguments.length;while(++e<t){var r=arguments[e];if(Xe(r)||$e(r)){var n=n?Be(Pe(n,r).concat(Pe(r,n))):r}}return n||[]}function kr(){var e=arguments.length>1?arguments:arguments[0],r=-1,n=e?Zt(tr(e,"length")):0,i=t(n<0?0:n);while(++r<n){i[r]=tr(e,r)}return i}function Ar(e,t){var r=-1,n=e?e.length:0,i={};if(!t&&n&&!Xe(e[0])){t=[]}while(++r<n){var a=e[r];if(t){i[a]=t[r]}else if(a){i[a[0]]=a[1]}}return i}function Nr(e,t){if(!Ct(t)){throw new Q}return function(){if(--e<1){return t.apply(this,arguments)}}}function Vr(e,t){return arguments.length>2?ze(e,17,Z(arguments,2),null,t):ze(e,1,null,null,t)}function Pr(e){var t=arguments.length>1?Re(arguments,true,false,1):dt(e),r=-1,n=t.length;while(++r<n){var i=t[r];e[i]=ze(e[i],1,null,null,e)}return e}function Rr(e,t){return arguments.length>2?ze(t,19,Z(arguments,2),null,e):ze(t,3,null,null,e)}function Ir(){var e=arguments,t=e.length;while(t--){if(!Ct(e[t])){throw new Q}}return function(){var t=arguments,r=e.length;while(r--){t=[e[r].apply(this,t)]}return t[0]}}function Mr(e,t){t=typeof t=="number"?t:+t||e.length;return ze(e,4,null,null,null,t)}function Or(e,t,n){var i,a,s,o,c,u,l,f=0,v=false,p=true;if(!Ct(e)){throw new Q}t=be(0,t)||0;if(n===true){var h=true;p=false}else if(Et(n)){h=n.leading;v="maxWait"in n&&(be(t,n.maxWait)||0);p="trailing"in n?n.trailing:p}var d=function(){var n=t-(rn()-o);if(n<=0){if(a){ce(a)}var v=l;a=u=l=r;if(v){f=rn();s=e.apply(c,i);if(!u&&!a){i=c=null}}}else{u=he(d,n)}};var g=function(){if(u){ce(u)}a=u=l=r;if(p||v!==t){f=rn();s=e.apply(c,i);if(!u&&!a){i=c=null}}};return function(){i=arguments;o=rn();c=this;l=p&&(u||!h);if(v===false){var r=h&&!u}else{if(!a&&!h){f=o}var n=v-(o-f),m=n<=0;if(m){if(a){a=ce(a)}f=o;s=e.apply(c,i)}else if(!a){a=he(g,n)}}if(m&&u){u=ce(u)}else if(!u&&t!==v){u=he(d,t)}if(r){m=true;s=e.apply(c,i)}if(m&&!u&&!a){i=c=null}return s}}function Br(e){if(!Ct(e)){throw new Q}var t=Z(arguments,1);return he(function(){e.apply(r,t)},1)}function Dr(e,t){if(!Ct(e)){throw new Q}var n=Z(arguments,2);return he(function(){e.apply(r,n)},t)}function zr(e,t){if(!Ct(e)){throw new Q}var r=function(){var n=r.cache,i=t?t.apply(this,arguments):s+arguments[0];return ve.call(n,i)?n[i]:n[i]=e.apply(this,arguments)};r.cache={};return r}function Qr(e){var t,r;if(!Ct(e)){throw new Q}return function(){if(t){return r}t=true;r=e.apply(this,arguments);e=null;return r}}function Hr(e){return ze(e,16,Z(arguments,1))}function Gr(e){return ze(e,32,null,Z(arguments,1))}function Jr(e,t,r){var n=true,i=true;if(!Ct(e)){throw new Q}if(r===false){n=false}else if(Et(r)){n="leading"in r?r.leading:n;i="trailing"in r?r.trailing:i}A.leading=n;A.maxWait=t;A.trailing=i;return Or(e,t,A)}function Wr(e,t){return ze(t,16,[e])}function Kr(e){return function(){return e}}function $r(e,t,r){var n=typeof e;if(e==null||n=="function"){return Ne(e,t,r)}if(n!="object"){return an(e)}var i=Ze(e),a=i[0],s=e[a];if(i.length==1&&s===s&&!Et(s)){return function(e){var t=e[a];return s===t&&(s!==0||1/s==1/t)}}return function(t){var r=i.length,n=false;while(r--){if(!(n=Ie(t[i[r]],e[i[r]],null,true))){break}}return n}}function Xr(e){return e==null?"":B(e).replace(nt,Qe)}function Yr(e){return e}function Zr(e,t,r){var n=true,i=t&&dt(t);if(!t||!r&&!i.length){if(r==null){r=t}a=Te;t=e;e=Ue;i=dt(t)}if(r===false){n=false}else if(Et(r)&&"chain"in r){n=r.chain}var a=e,s=Ct(a);Jt(i,function(r){var i=e[r]=t[r];if(s){a.prototype[r]=function(){var t=this.__chain__,r=this.__wrapped__,s=[r];pe.apply(s,arguments);var o=i.apply(e,s);if(n||t){if(r===o&&Et(o)){return this}o=new a(o);o.__chain__=t}return o}}})}function en(){e._=ie;return this}function tn(){}var rn=Ge(rn=i.now)&&rn||function(){return(new i).getTime()};var nn=Ee(u+"08")==8?Ee:function(e,t){return Ee(qt(e)?e.replace(m,""):e,t||0)};function an(e){return function(t){return t[e]}}function sn(e,t,r){var n=e==null,i=t==null;if(r==null){if(typeof e=="boolean"&&i){r=e;e=1}else if(!i&&typeof t=="boolean"){r=t;i=true}}if(n&&i){t=1}e=+e||0;if(i){t=e;e=0}else{t=+t||0}if(r||e%1||t%1){var a=Le();return Ce(e+a*(t-e+parseFloat("1e-"+((a+"").length-1))),t)}return Oe(e,t)}function on(e,t){if(e){var r=e[t];return Ct(r)?e[t]():r}}function cn(e,t,n){var i=Ue.templateSettings;e=B(e||"");n=ct({},n,i);var a=ct({},n.imports,i.imports),s=Ze(a),o=Mt(a);var u,h=0,d=n.interpolate||y,m="__p += '";var x=O((n.escape||y).source+"|"+d.source+"|"+(d===g?p:y).source+"|"+(n.evaluate||y).source+"|$","g");e.replace(x,function(t,r,n,i,a,s){n||(n=i);m+=e.slice(h,s).replace(S,W);if(r){m+="' +\n__e("+r+") +\n'"}if(a){u=true;m+="';\n"+a+";\n__p += '"}if(n){m+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"}h=s+t.length;return t});m+="';\n";var _=n.variable,b=_;if(!b){_="obj";m="with ("+_+") {\n"+m+"\n}\n"}m=(u?m.replace(l,""):m).replace(f,"$1").replace(v,"$1;");m="function("+_+") {\n"+(b?"":_+" || ("+_+" = {});\n")+"var __t, __p = '', __e = _.escape"+(u?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var C="\n/*\n//# sourceURL="+(n.sourceURL||"/lodash/template/source["+w+++"]")+"\n*/";try{var E=c(s,"return "+m+C).apply(r,o)}catch(e){e.source=m;throw e}if(t){return E(t)}E.source=m;return E}function un(e,r,n){e=(e=+e)>-1?e:0;var i=-1,a=t(e);r=Ne(r,n,1);while(++i<e){a[i]=r(i)}return a}function ln(e){return e==null?"":B(e).replace(rt,Ke)}function fn(e){var t=++a;return B(e==null?"":e)+t}function vn(e){e=new Te(e);e.__chain__=true;return e}function pn(e,t){t(e);return e}function hn(){this.__chain__=true;return this}function dn(){return B(this.__wrapped__)}function gn(){return this.__wrapped__}Ue.after=Nr;Ue.assign=it;Ue.at=Ot;Ue.bind=Vr;Ue.bindAll=Pr;Ue.bindKey=Rr;Ue.chain=vn;Ue.compact=vr;Ue.compose=Ir;Ue.constant=Kr;Ue.countBy=Dt;Ue.create=ot;Ue.createCallback=$r;Ue.curry=Mr;Ue.debounce=Or;Ue.defaults=ct;Ue.defer=Br;Ue.delay=Dr;Ue.difference=pr;Ue.filter=Qt;Ue.flatten=mr;Ue.forEach=Jt;Ue.forEachRight=Wt;Ue.forIn=ft;Ue.forInRight=vt;Ue.forOwn=pt;Ue.forOwnRight=ht;Ue.functions=dt;Ue.groupBy=Kt;Ue.indexBy=$t;Ue.initial=xr;Ue.intersection=Sr;Ue.invert=mt;Ue.invoke=Xt;Ue.keys=Ze;Ue.map=Yt;Ue.mapValues=At;Ue.max=Zt;Ue.memoize=zr;Ue.merge=Nt;Ue.min=er;Ue.omit=Vt;Ue.once=Qr;Ue.pairs=Pt;Ue.partial=Hr;Ue.partialRight=Gr;Ue.pick=Rt;Ue.pluck=tr;Ue.property=an;Ue.pull=br;Ue.range=Cr;Ue.reject=ir;Ue.remove=Er;Ue.rest=Lr;Ue.shuffle=sr;Ue.sortBy=ur;Ue.tap=pn;Ue.throttle=Jr;Ue.times=un;Ue.toArray=lr;Ue.transform=It;Ue.union=Ur;Ue.uniq=Tr;Ue.values=Mt;Ue.where=fr;Ue.without=Fr;Ue.wrap=Wr;Ue.xor=qr;Ue.zip=kr;Ue.zipObject=Ar;Ue.collect=Yt;Ue.drop=Lr;Ue.each=Jt;Ue.eachRight=Wt;Ue.extend=it;Ue.methods=dt;Ue.object=Ar;Ue.select=Qt;Ue.tail=Lr;Ue.unique=Tr;Ue.unzip=kr;Zr(Ue);Ue.clone=at;Ue.cloneDeep=st;Ue.contains=Bt;Ue.escape=Xr;Ue.every=zt;Ue.find=Ht;Ue.findIndex=hr;Ue.findKey=ut;Ue.findLast=Gt;Ue.findLastIndex=dr;Ue.findLastKey=lt;Ue.has=gt;Ue.identity=Yr;Ue.indexOf=yr;Ue.isArguments=$e;Ue.isArray=Xe;Ue.isBoolean=yt;Ue.isDate=xt;Ue.isElement=St;Ue.isEmpty=_t;Ue.isEqual=wt;Ue.isFinite=bt;Ue.isFunction=Ct;Ue.isNaN=Lt;Ue.isNull=jt;Ue.isNumber=Ut;Ue.isObject=Et;Ue.isPlainObject=Tt;Ue.isRegExp=Ft;Ue.isString=qt;Ue.isUndefined=kt;Ue.lastIndexOf=wr;Ue.mixin=Zr;Ue.noConflict=en;Ue.noop=tn;Ue.now=rn;Ue.parseInt=nn;Ue.random=sn;Ue.reduce=rr;Ue.reduceRight=nr;Ue.result=on;Ue.runInContext=ee;Ue.size=or;Ue.some=cr;Ue.sortedIndex=jr;Ue.template=cn;Ue.unescape=ln;Ue.uniqueId=fn;Ue.all=zt;Ue.any=cr;Ue.detect=Ht;Ue.findWhere=Ht;Ue.foldl=rr;Ue.foldr=nr;Ue.include=Bt;Ue.inject=rr;Zr(function(){var e={};pt(Ue,function(t,r){if(!Ue.prototype[r]){e[r]=t}});return e}(),false);Ue.first=gr;Ue.last=_r;Ue.sample=ar;Ue.take=gr;Ue.head=gr;pt(Ue,function(e,t){var r=t!=="sample";if(!Ue.prototype[t]){Ue.prototype[t]=function(t,n){var i=this.__chain__,a=e(this.__wrapped__,t,n);return!i&&(t==null||n&&!(r&&typeof t=="function"))?a:new Te(a,i)}}});Ue.VERSION="2.4.2";Ue.prototype.chain=hn;Ue.prototype.toString=dn;Ue.prototype.value=gn;Ue.prototype.valueOf=gn;Jt(["join","pop","shift"],function(e){var t=re[e];Ue.prototype[e]=function(){var e=this.__chain__,r=t.apply(this.__wrapped__,arguments);return e?new Te(r,e):r}});Jt(["push","reverse","sort","unshift"],function(e){var t=re[e];Ue.prototype[e]=function(){t.apply(this.__wrapped__,arguments);return this}});Jt(["concat","slice","splice"],function(e){var t=re[e];Ue.prototype[e]=function(){return new Te(t.apply(this.__wrapped__,arguments),this.__chain__)}});return Ue}var te=ee();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){R._=te;define(function(){return te})}else if(I&&M){if(O){(M.exports=te)._=te}else{I._=te}}else{R._=te}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],500:[function(e,module,t){var r=module.exports={};r.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}if(t){var r=[];window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(r.length>0){var n=r.shift();n()}}},true);return function e(t){r.push(t);window.postMessage("process-tick","*")}}return function e(t){setTimeout(t,0)}}();r.title="browser";r.browser=true;r.env={};r.argv=[];function n(){}r.on=n;r.addListener=n;r.once=n;r.off=n;r.removeListener=n;r.removeAllListeners=n;r.emit=n;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}]},{},[1]);